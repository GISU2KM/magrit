!function(e){function t(t){for(var a,i,l=t[0],s=t[1],p=t[2],d=0,_=[];d<l.length;d++)i=l[d],r[i]&&_.push(r[i][0]),r[i]=0;for(a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a]);for(c&&c(t);_.length;)_.shift()();return o.push.apply(o,p||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],a=!0,l=1;l<n.length;l++){var s=n[l];0!==r[s]&&(a=!1)}a&&(o.splice(t--,1),e=i(i.s=n[0]))}return e}var a={},r={1:0};var o=[];function i(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=a,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var l=window.webpackJsonp=window.webpackJsonp||[],s=l.push.bind(l);l.push=t,l=l.slice();for(var p=0;p<l.length;p++)t(l[p]);var c=s;o.push([99,0]),n()}([,function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.check_remove_existing_box=function(e){var t=document.querySelector(e);t&&t.remove()},t.make_dialog_container=function(e,t,n){var a=e||"dialog",r=t||"",o=n||"dialog",i=document.createElement("div");i.setAttribute("id",e),i.setAttribute("class","twbs modal fade "+o),i.setAttribute("tabindex","-1"),i.setAttribute("role","dialog"),i.setAttribute("aria-labelledby","myModalLabel"),i.setAttribute("aria-hidden","true"),i.innerHTML='<div class="modal-dialog"><div class="modal-content"></div></div>',document.getElementById("twbs").appendChild(i);var l='<div class="modal-header">\n    <button type="button" id="xclose" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>\n    <h4 class="modal-title" id="gridModalLabel">'+r+'</h4>\n    </div>\n    <div class="modal-body"> </div>\n    <div class="modal-footer">\n    <button type="button" class="btn btn-primary btn_ok" data-dismiss="modal">'+i18next.t("app_page.common.confirm")+'</button>\n    <button type="button" class="btn btn-default btn_cancel">'+i18next.t("app_page.common.cancel")+"</button>\n    </div>",s=new Modal(document.getElementById(a),{content:l});return s.show(),s};var n,a,r,o=t.overlay_under_modal=(n=document.querySelector(".twbs"),(a=document.createElement("div")).id="overlay_twbs",a.style.width="100%",a.style.height="100%",a.style.position="fixed",a.style.zIndex=99,a.style.top=0,a.style.left=0,a.style.background="rgba(0,0,0,0.4)",a.style.display="none",n.insertBefore(a,n.childNodes[0]),{display:function(){a.style.display=""},hide:function(){a.style.display="none"}});t.make_confirm_dialog2=(r=new Set,function(t,n,a){t=t||"dialog",n=n||i18next.t("app_page.common.ask_confirm"),a=a||{};var i=document.createElement("div"),l=function(){for(var e=0;e<50;e++)if(!r.has(e))return r.add(e),e}();i.setAttribute("id","myModal_"+l),i.setAttribute("class","twbs modal fade "+t),i.setAttribute("tabindex","-1"),i.setAttribute("role","dialog"),i.setAttribute("aria-labelledby","myModalLabel"),i.setAttribute("aria-hidden","true"),i.innerHTML=a.widthFitContent?'<div class="modal-dialog fitContent"><div class="modal-content"></div></div>':'<div class="modal-dialog"><div class="modal-content"></div></div>',document.getElementById("twbs").appendChild(i),i=document.getElementById("myModal_"+l);var s=e.pending(),p=a.text_ok||i18next.t("app_page.common.confirm"),c=a.text_cancel||i18next.t("app_page.common.cancel"),d='<div class="modal-header">\n      <button type="button" id="xclose" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>\n      <h4 class="modal-title" id="gridModalLabel">'+n+'</h4>\n      </div>\n      <div class="modal-body"><p>'+(a.html_content||"")+'</p></div>\n      <div class="modal-footer">\n      <button type="button" class="btn btn-primary btn_ok" data-dismiss="modal">'+p+'</button>\n      <button type="button" class="btn btn-default btn_cancel">'+c+"</button>\n      </div>",_=new Modal(i,{backdrop:!0,keyboard:!1,content:d});_.show(),i.modal=_,o.display();var u=function(e){helper_esc_key_twbs_cb(e,y)},m=function(){document.removeEventListener("keydown",u),r.delete(l),o.hide(),i.remove()},y=function(){s.resolve(!1),m()};return i.querySelector(".btn_cancel").onclick=y,i.querySelector("#xclose").onclick=y,i.querySelector(".btn_ok").onclick=function(){s.resolve(!0),m()},document.addEventListener("keydown",u),s.promise})}).call(this,n(5))},function(e,n,a){"use strict";(function(e,r){Object.defineProperty(n,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,r=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(a=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(r)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();n.setUpInterface=function(t){e._app.waitingOverlay=(0,u.createWaitingOverlay)(),window.addEventListener("beforeunload",ne),window.addEventListener("unload",function(){var e=Object.getOwnPropertyNames(current_layers).filter(function(e){return current_layers[e].hasOwnProperty("key_name")?current_layers[e].targeted?0:current_layers[e].renderer&&(current_layers[e].renderer.indexOf("PropSymbols")>-1||current_layers[e].renderer.indexOf("Dorling")>-1||current_layers[e].renderer.indexOf("Choropleth")>-1||current_layers[e].renderer.indexOf("Categorical")>-1)?0:1:0});if(e.length){var t=new FormData;e.forEach(function(e){t.append("layer_name",current_layers[e].key_name)}),navigator.sendBeacon("/layers/delete",t)}},!1);var n=document.createElement("div");n.className="overlay_drop",n.id="overlay_drop",n.style.background="black",n.style.opacity="0.6",n.style.display="none",n.style.padding="10px";var a=document.createElement("div");a.style.border="dashed 2px white",a.style.margin="10px",a.style.background="rgba(0, 0, 0, 0.33)",a.style.borderRadius="1%",a.className="overlay_drop";var r=document.createElement("p");r.className="i18n",r.style.position="fixed",r.style.top="50%",r.style.left="50%",r.style.transform="translateX(-50%)translateY(-50%)",r.style.fontSize="14px",r.style.width="auto",r.style.bottom="0px",r.style.opacity="0.85",r.style.textAlign="center",r.style.color="white",r.style.padding="0.5em",r.setAttribute("data-i18n","[html]app_page.common.drop_msg"),r.innerHTML=i18next.t("app_page.common.drop_msg"),a.appendChild(r),n.appendChild(a),document.body.appendChild(n);for(var o=d3.select(".header_options_projection").append("div").attr("id","const_options_projection").style("display","inline-flex").append("div").attrs({class:"styled-select"}).insert("select").attrs({class:"i18n",id:"form_projection2"}).styles({width:"calc(100% + 20px)"}).on("change",A.handle_projection_select),i=0;i<A.shortListContent.length;i++){var s=A.shortListContent[i];o.append("option").attrs({class:"i18n",value:s,"data-i18n":"app_page.projection_name."+s}).text(i18next.t("app_page.projection_name."+s))}o.node().value="NaturalEarth2";var p=d3.select(".header_options_right").append("div").attr("id","const_options").style("display","inline");p.append("button").attrs({class:"const_buttons i18n tt",id:"new_project","data-i18n":"[title]app_page.tooltips.new_project","data-tippy-placement":"bottom"}).styles({cursor:"pointer",background:"transparent","margin-top":"5px"}).html('<img src="static/img/header/File_font_awesome_white.png" width="25" height="auto" alt="Load project file"/>').on("click",function(){window.localStorage.removeItem("magrit_project"),window.removeEventListener("beforeunload",ne),location.reload()}),p.append("button").attrs({class:"const_buttons i18n tt",id:"load_project","data-i18n":"[title]app_page.tooltips.load_project_file","data-tippy-placement":"bottom"}).styles({cursor:"pointer",background:"transparent","margin-top":"5px"}).html('<img src="static/img/header/Folder_open_alt_font_awesome_white.png" width="25" height="auto" alt="Load project file"/>').on("click",k.load_map_template),p.append("button").attrs({class:"const_buttons i18n tt",id:"save_file_button","data-i18n":"[title]app_page.tooltips.save_file","data-tippy-placement":"bottom"}).styles({cursor:"pointer",background:"transparent",margin:"auto"}).html('<img src="static/img/header/Breezeicons-actions-22-document-save-white.png" width="25" height="auto" alt="Save project to disk"/>').on("click",k.save_map_template),p.append("button").attrs({class:"const_buttons i18n tt",id:"documentation_link","data-i18n":"[title]app_page.tooltips.documentation","data-tippy-placement":"bottom"}).styles({cursor:"pointer",background:"transparent","margin-top":"5px"}).html('<img src="static/img/header/Documents_icon_-_noun_project_5020_white.png" width="20" height="auto" alt="Documentation"/>').on("click",function(){window.open("static/book/index.html","DocWindow","toolbar=yes,menubar=yes,resizable=yes,scrollbars=yes,status=yes").focus()}),p.append("button").attrs({id:"help_btn",class:"const_buttons i18n tt","data-i18n":"[title]app_page.help_box.tooltip_btn","data-tippy-placement":"bottom"}).styles({cursor:"pointer",background:"transparent"}).html('<img src="static/img/header/High-contrast-help-browser_white.png" width="20" height="20" alt="export_load_preferences" style="margin-bottom:3px;"/>').on("click",function(){document.getElementById("menu_lang")&&document.getElementById("menu_lang").remove();var t='<div class="about_content"><p style="font-size: 0.8em; margin-bottom:auto;"><span>'+i18next.t("app_page.help_box.version",{version:e._app.version})+"</span></p><p><b>"+i18next.t("app_page.help_box.useful_links")+'</b></p><p><button class="swal2-styled swal2_blue btn_doc">'+i18next.t("app_page.help_box.carnet_hypotheses")+'</button></p><p><button class="swal2-styled swal2_blue btn_contact">'+i18next.t("app_page.help_box.contact")+'</button></p><p><button class="swal2-styled swal2_blue btn_gh">'+i18next.t("app_page.help_box.gh_link")+'</button></p><p style="font-size: 0.8em; margin:auto;"><span>'+i18next.t("app_page.help_box.credits")+"</span></p></div>";swal({title:i18next.t("app_page.help_box.title"),html:t,showCancelButton:!0,showConfirmButton:!1,cancelButtonText:i18next.t("app_page.common.close"),animation:"slide-from-top",onOpen:function(){var e=document.getElementsByClassName("about_content")[0],t=e.querySelector("#credit_link");t.style.fontWeight="bold",t.style.cursor="pointer",t.color="#000",t.onclick=function(){window.open("http://riate.cnrs.fr","RiatePage","toolbar=yes,menubar=yes,resizable=yes,scrollbars=yes,status=yes").focus()},e.querySelector(".btn_doc").onclick=function(){window.open("http://magrit.hypotheses.org/","Carnet hypotheses","toolbar=yes,menubar=yes,resizable=yes,scrollbars=yes,status=yes").focus()},e.querySelector(".btn_contact").onclick=function(){window.open("/contact","ContactWindow","toolbar=yes,menubar=yes,resizable=yes,scrollbars=yes,status=yes").focus()},e.querySelector(".btn_gh").onclick=function(){window.open("https://www.github.com/riatelab/magrit","GitHubPage","toolbar=yes,menubar=yes,resizable=yes,scrollbars=yes,status=yes").focus()}}}).then(function(e){return null},function(e){return null})}),p.append("button").attrs({id:"current_app_lang",class:"const_buttons"}).styles({color:"white",cursor:"pointer","font-size":"14px","vertical-align":"super",background:"transparent","font-weight":"bold"}).html(i18next.language).on("click",function(){document.getElementById("menu_lang")?document.getElementById("menu_lang").remove():function(){var e=i18next.language,t="en"===e?["es","fr"]:"fr"===e?["en","es"]:["en","fr"],n=[{name:e,callback:me},{name:t[0],callback:me},{name:t[1],callback:me}],a=document.createElement("div");a.style.top="40px",a.style.right="0px",a.className="context-menu",a.id="menu_lang",a.style.minWidth="30px",a.style.width="50px",a.style.background="#000";var r=document.createElement("ul");a.appendChild(r);for(var o=function(e){var t=document.createElement("li"),o=document.createElement("span");r.appendChild(t),t.setAttribute("data-index",e),t.style.textAlign="right",t.style.paddingRight="16px",o.className="context-menu-item-name",o.style.color="white",o.textContent=n[e].name,t.appendChild(o),t.onclick=function(){n[e].callback(),a.remove()}},i=0;i<n.length;i++)o(i);document.querySelector("body").appendChild(a)}()});var c=d3.select("#menu"),d=(c.append("button").attr("id","btn_s1").attr("class","accordion i18n").attr("data-i18n","app_page.section1.title"),c.append("div").attr("class","panel").attr("id","accordion1")),g=(c.append("button").attr("id","btn_s2").attr("class","accordion i18n").attr("data-i18n","app_page.section2.title"),c.append("div").attr("class","panel").attr("id","accordion2_pre")),f=(c.append("button").attr("id","btn_s2b").attr("class","accordion i18n").style("display","none"),c.append("div").attr("class","panel").attr("id","accordion2b").style("display","none")),v=(c.append("button").attr("id","btn_s3").attr("class","accordion i18n").attr("data-i18n","app_page.section3.title"),c.append("div").attr("class","panel").attr("id","accordion3")),j=(c.append("button").attr("id","btn_s4").attr("class","accordion i18n").attr("data-i18n","app_page.section4.title"),c.append("div").attr("class","panel").attr("id","accordion4")),S=(c.append("button").attr("id","btn_s5").attr("class","accordion i18n").attr("data-i18n","app_page.section5b.title"),c.append("div").attr("class","panel").attr("id","accordion5b")),E=d.append("div").attrs({id:"section1",class:"i18n tt_menuleft","data-i18n":"[title]app_page.tooltips.section1","data-tippy-placement":"right"});window.section2_pre=g.append("div").attr("id","section2_pre"),window.section2=f.append("div").attr("id","section2"),v.append("div").attr("id","section3"),j.append("div").attr("id","section4"),S.append("div").attr("id","section5");var O=E.append("div");O.append("div").attr("id","target_layer_zone").styles({"text-align":"center","margin-bottom":"3px",border:"3px dashed #ccc",padding:"3px",color:"#ccc"}).html("Pas de couche cible"),O.append("div").attr("id","ext_dataset_zone").styles({"text-align":"center","margin-bottom":"3px",border:"3px dashed #ccc",padding:"3px",color:"#ccc"}).html("Pas de jeu de donnée externe");O.append("p").attr("id","join_section").styles({"text-align":"center","margin-top":"2px"}).html(""),O.append("hr").style("border-top","2px #ccc");var C=O.append("div").style("width","auto");C.append("img").attrs({id:"img_in_geom",class:"user_panel",src:"static/img/b/addgeom.png",width:"25",height:"25",alt:"Geometry layer"}).style("cursor","pointer").on("click",M),C.append("p").attrs({id:"input_geom",class:"user_panel i18n"}).styles({display:"inline",cursor:"pointer","margin-left":"4px","vertical-align":"super","font-weight":"bold"}).attr("data-i18n","[html]app_page.section1.add_geom").on("click",M);var I=O.append("div");I.append("img").attrs({id:"img_data_ext",class:"user_panel",src:"static/img/b/addtabular.png",width:"25",height:"25",alt:"Additional dataset"}).style("cursor","pointer").on("click",M),I.append("p").attrs({id:"data_ext",class:"user_panel i18n","data-i18n":"[html]app_page.section1.add_ext_dataset"}).styles({display:"inline",cursor:"pointer","margin-left":"4px","vertical-align":"super","font-weight":"bold"}).on("click",M);var q=O.append("div").attr("id","sample_zone");q.append("img").attrs({id:"sample_button",class:"user_panel",src:"static/img/b/addsample.png",width:"25",height:"25",alt:"Sample layers"}).style("cursor","pointer").on("click",X),q.append("span").attrs({id:"sample_link",class:"user_panel i18n"}).styles({display:"inline",cursor:"pointer","margin-left":"4px","vertical-align":"super","font-weight":"bold"}).attr("data-i18n","[html]app_page.section1.add_sample_data").on("click",X),O.append("p").styles({"text-align":"center",margin:"5px"}).insert("button").attrs({id:"btn_type_fields",class:"i18n","data-i18n":"[html]app_page.box_type_fields.title",disabled:!0}).styles({cursor:"pointer","border-radius":"4px",border:"1px solid lightgrey",padding:"3.5px"}).html(i18next.t("app_page.box_type_fields.title")).on("click",function(){var e=Object.getOwnPropertyNames(user_data)[0];(0,u.make_box_type_fields)(e)}),function(){for(var t=["prop.png","choro.png","typo.png","choroprop.png","proptypo.png","grid.png","cartogram.png","smooth.png","discont.png","typosymbol.png","flow.png","two_stocks.png"],n=section2_pre.append("div").attr("id","list_ico_func"),a=function(a,r){var o=t[a],i=o.split(".")[0];(0,_.get_menu_option)(i).desc;n.insert("img").styles({margin:"5px 16px",cursor:"pointer",width:"50px",float:"left","list-style":"none"}).attrs({class:"i18n tt_func","data-i18n":["[title]app_page.func_description.",i].join(""),src:["static/img/func_icons2/",o].join(""),id:"button_"+i}).on("click",function(){if(window.fields_handler){if(this.classList.contains("active"))return void ae("btn_s2b");(0,_.clean_menu_function)()}document.getElementById("accordion2b").style.display="",_app.current_functionnality=(0,_.get_menu_option)(i),_app.current_functionnality.menu_factory()(),window.fields_handler=_app.current_functionnality.fields_handler();var t=document.getElementById("btn_s2b");if(t.innerHTML='<span class="i18n" data-i18n="app_page.common.representation">'+i18next.t("app_page.common.representation")+'</span><span> : </span><span class="i18n" data-i18n="app_page.func_title.'+e._app.current_functionnality.name+'">'+i18next.t("app_page.func_title."+e._app.current_functionnality.name)+"</span>",t.style.display="","grayscale(100%)"!==this.style.filter){if(this.classList.add("active"),this.style.filter="invert(100%) saturate(200%)",e._app.targeted_layer_added){var n=Object.getOwnPropertyNames(user_data)[0];fields_handler.fill(n)}"flow"===i&&joined_dataset&&fields_handler.fill()}ae("btn_s2b")})},r=0,o=t.length;r<o;r++)a(r,o)}();var T=d3.select("#section3");window.layer_list=T.append("div").append("ul").attrs({id:"sortable",class:"layer_list"}),new Sortable(document.getElementById("sortable"),{animation:100,onUpdate:function(t){var n=[],a=[],r=svg_map.querySelectorAll(".layer"),o=null;"active"===document.getElementById("info_features").className&&(le(),o=!0);for(var i=0,l=t.target.childNodes.length;i<l;i++){var s=t.target.childNodes[i].getAttribute("layer_name");n[i]=e._app.layer_to_id.get(s),a[i]=r[i].id}for(var p=0,c=n.length;p<c;p++){var d=document.getElementById(n[p]),_=document.getElementById(n[p+1])||document.getElementById(n[p]);svg_map.insertBefore(_,d)}o&&le()},onStart:function(e){document.body.classList.add("no-drop")},onEnd:function(e){document.body.classList.remove("no-drop")}});var N=d3.select("#section4").append("div").style("margin","auto").append("ul").styles({display:"inline-block","list-style":"outside none none","margin-top":"0px",padding:"0px",width:"100%"}),F=N.append("li").styles({margin:"1px",padding:"4px","text-align":"center"});F.append("input").attrs({id:"title",class:"list_elem_section4 i18n",placeholder:"","data-i18n":"[placeholder]app_page.section4.map_title"}).styles({margin:"0px 0px 0px 3px",width:"160px"}).on("keyup",function(){var e,t;e=this.value,(t=d3.select("#map_title").select("text")).node()?t.text(e):map.append("g").attrs({class:"legend title",id:"map_title"}).style("cursor","pointer").insert("text").attrs({x:w/2,y:h/12,"alignment-baseline":"middle","text-anchor":"middle"}).styles({"font-family":"verdana","font-size":"20px",position:"absolute",color:"black"}).text(e).on("contextmenu dblclick",function(){d3.event.preventDefault(),d3.event.stopPropagation(),re()}).call(u.drag_elem_geo)}),F.append("span").styles({display:"inline",top:"4px",cursor:"pointer","vertical-align":"sub"}).html(P.sys_run_button.replace("submit","Title properties")).on("click",re);var G=N.append("li").styles({margin:"1px",padding:"4px"});G.append("input").styles({position:"absolute",right:"20px",width:"60px","margin-left":"15px"}).attrs({type:"color",id:"bg_color",class:"list_elem_section4 m_elem_right"}).property("value","#ffffff").on("change",function(){var e;e=this.value,map.style("background-color",e)}),G.append("p").attrs({class:"list_elem_section4 i18n","data-i18n":"[html]app_page.section4.background_color"});var D=N.append("li").styles({margin:"1px",padding:"4px"});D.append("input").attrs({id:"input-width",type:"number",class:"list_elem_section4 m_elem_right"}).property("value",w).on("change",function(){var e=+this.value;if(0===e||isNaN(e))this.value=w;else{var t=document.getElementById("map_ratio_select").value;"portrait"===t?(h=(0,m.round_value)(e/.70707,0),oe([e,h])):"landscape"===t?(h=(0,m.round_value)(.70707*e,0),oe([e,h])):oe([e,null])}}),D.append("p").attrs({class:"list_elem_section4 i18n","data-i18n":"[html]app_page.section4.map_width"});var R=N.append("li").styles({margin:"1px",padding:"4px"});R.append("input").attrs({id:"input-height",type:"number",class:"m_elem_right list_elem_section4"}).property("value",h).on("change",function(){var e=+this.value;if(0===e||isNaN(e))this.value=h;else{var t=document.getElementById("map_ratio_select").value;"portrait"===t?(w=(0,m.round_value)(.70707*e,0),oe([w,e])):"landscape"===t?(w=(0,m.round_value)(e/.70707,0),oe([w,e])):oe([null,e])}}),R.append("p").attrs({class:"list_elem_section4 i18n","data-i18n":"[html]app_page.section4.map_height"});var W=N.append("li").styles({margin:"1px",padding:"4px 0"}),H=W.append("select").attrs({class:"list_elem_section4 i18n m_elem_right",id:"map_ratio_select"});W.append("p").attr("class","list_elem_section4 i18n").style("padding","4px").attr("data-i18n","[html]app_page.section4.map_ratio"),H.append("option").text("").attr("data-i18n","[html]app_page.section4.ratio_user").attr("value","ratio_user"),H.append("option").text("").attr("data-i18n","[html]app_page.section4.ratio_landscape").attr("value","landscape"),H.append("option").text("").attr("data-i18n","[html]app_page.section4.ratio_portait").attr("value","portrait"),H.on("change",function(){var e=get_map_xy0(),t=document.innerWidth-e.x-1,n=document.innerHeight-e.y-1,a=t-w,r=n-h;if("portrait"===this.value)if(1.4===(0,m.round_value)(w/h,1)){var o=h;h=w,w=o}else r>=a?w=(0,m.round_value)(.70707*h,0):h=(0,m.round_value)(w/.70707,0);else if("landscape"===this.value)if(1.4===(0,m.round_value)(h/w,1)){var i=h;h=w,w=i}else r<=a?w=(0,m.round_value)(h/.70707,0):h=(0,m.round_value)(.70707*w,0);oe([w,h]),ie(this.value)});var V=svg_map.__zoom,U=N.append("li").styles({margin:"1px",padding:"4px"});U.append("button").styles({margin:0,padding:0}).attrs({id:"resize_fit",class:"m_elem_right list_elem_section4 button_st4 i18n","data-i18n":"[html]app_page.common.ok"}).on("click",function(){document.getElementById("btn_s4").click(),window.scrollTo(0,0),w=(0,y.Mround)(window.innerWidth-361),h=window.innerHeight-55,oe([w,h]),document.getElementById("map_ratio_select").value="ratio_user"}),U.append("p").attr("class","list_elem_section4 i18n").attr("data-i18n","[html]app_page.section4.resize_fit");var J=N.append("li").styles({margin:"1px",padding:"4px"});J.append("p").attrs({class:"list_elem_section4 i18n","data-i18n":"[html]app_page.section4.map_center_menu"}).style("cursor","pointer"),J.append("span").attr("id","map_center_menu_ico").styles({display:"inline-table",cursor:"pointer"}),J.on("click",function(){var e=document.getElementsByClassName("to_hide"),t=void 0;"none"===e[0].style.display?(t="",document.getElementById("map_center_menu_ico").classList.add("active")):(t="none",document.getElementById("map_center_menu_ico").classList.remove("active")),e[0].style.display=t,e[1].style.display=t,e[2].style.display=t,e[3].style.display=t});var K=N.append("li").style("display","none").attr("class","to_hide");K.append("p").attrs({class:"list_elem_section4 i18n","data-i18n":"[html]app_page.section4.map_center_x"}),K.append("input").style("width","80px").attrs({id:"input-center-x",class:"m_elem_right",type:"number",step:"any"}).property("value",(0,m.round_value)(V.x,2)).on("change",function(){svg_map.__zoom.x=+this.value,(0,b.zoom_without_redraw)()});var Q=N.append("li").style("display","none").attr("class","to_hide");Q.append("p").attrs({class:"list_elem_section4 i18n","data-i18n":"[html]app_page.section4.map_center_y"}),Q.append("input").attrs({id:"input-center-y",class:"list_elem_section4 m_elem_right",type:"number",step:"any"}).property("value",(0,m.round_value)(V.y,2)).style("width","80px").on("change",function(){svg_map.__zoom.y=+this.value,(0,b.zoom_without_redraw)()});var ee=N.append("li").style("display","none").attr("class","to_hide");ee.append("p").attrs({class:"list_elem_section4 i18n","data-i18n":"[html]app_page.section4.map_scale_k"}),ee.append("input").attrs({id:"input-scale-k",class:"list_elem_section4 m_elem_right",type:"number",step:"any"}).property("value",function(){var e=V.k*proj.scale();return e>2||e<-2?(0,m.round_value)(e,2):(0,m.round_value)(e,Math.round((0,m.get_nb_decimals)(e)/2))}).style("width","80px").on("change",function(){svg_map.__zoom.k=+this.value/proj.scale(),(0,b.zoom_without_redraw)()});var te=N.append("li").style("display","none").attr("class","to_hide");te.append("p").attrs({class:"list_elem_section4 i18n","data-i18n":"[html]app_page.section4.canvas_rotation"}),te.append("span").style("float","right").html("°"),te.append("input").attrs({id:"canvas_rotation_value_txt",class:"without_spinner",type:"number",min:0,max:360,step:"any"}).styles({width:"30px","margin-left":"10px",float:"right"}).property("value",0).on("change",function(){var e=+this.value,t=document.getElementById("form_rotate").value;isNaN(e)||e<-361?this.value=t:(this.value=e<0&&e>-361?360+e:e>360?360:+this.value,(0,b.rotate_global)(this.value),document.getElementById("form_rotate").value=this.value)}),te.append("input").attrs({type:"range",id:"form_rotate",min:0,max:360,step:1}).styles({width:"80px",margin:"0px 10px 5px 15px",float:"right"}).property("value",0).on("input",function(){(0,b.rotate_global)(this.value),document.getElementById("canvas_rotation_value_txt").value=this.value});var se=N.append("li").styles({margin:"1px",padding:"4px"});se.append("input").styles({margin:0,padding:0}).attrs({id:"autoalign_features",type:"checkbox",class:"m_elem_right list_elem_section4 i18n"}).on("change",function(){_app.autoalign_features=this.checked}),se.append("p").attr("class","list_elem_section4 i18n").attr("data-i18n","[html]app_page.section4.autoalign_features");var pe=N.append("li").styles({"text-align":"center"});pe.insert("p").styles({clear:"both",display:"block",margin:0}).attrs({class:"i18n","data-i18n":"[html]app_page.section4.layout_features"});var ce=pe.insert("p").styles({display:"inline-block",margin:"auto"});ce.insert("span").insert("img").attrs({id:"btn_arrow",src:"static/img/layout_icons/arrow-01.png",class:"layout_ft_ico i18n tt","data-i18n":"[title]app_page.layout_features_box.arrow"}).on("click",function(){return(0,B.add_layout_feature)("arrow")}),ce.insert("span").insert("img").attrs({id:"btn_text_annot",src:"static/img/layout_icons/text-01.png",class:"layout_ft_ico i18n tt","data-i18n":"[title]app_page.layout_features_box.text_annot"}).on("click",function(){return(0,B.add_layout_feature)("text_annot")}),window.isIE||ce.insert("span").insert("img").attrs({id:"btn_symbol",src:"static/img/layout_icons/symbols-01.png",class:"layout_ft_ico i18n tt","data-i18n":"[title]app_page.layout_features_box.symbol"}).on("click",function(){return(0,B.add_layout_feature)("symbol")});ce.insert("span").insert("img").attrs({id:"btn_rectangle",src:"static/img/layout_icons/rect-01.png",class:"layout_ft_ico i18n tt","data-i18n":"[title]app_page.layout_features_box.rectangle"}).on("click",function(){return(0,B.add_layout_feature)("rectangle")}),ce.insert("span").insert("img").attrs({id:"btn_ellipse",src:"static/img/layout_icons/ellipse-01.png",class:"layout_ft_ico i18n tt","data-i18n":"[title]app_page.layout_features_box.ellipse"}).on("click",function(){return(0,B.add_layout_feature)("ellipse")});var de=pe.insert("p").styles({display:"inline-block",margin:"auto"});de.insert("span").insert("img").attrs({id:"btn_graticule",src:"static/img/layout_icons/graticule-01.png",class:"layout_ft_ico i18n tt","data-i18n":"[title]app_page.layout_features_box.graticule"}).on("click",function(){return(0,B.add_layout_feature)("graticule")}),de.insert("span").insert("img").attrs({id:"btn_north",src:"static/img/layout_icons/north-01.png",class:"layout_ft_ico i18n tt","data-i18n":"[title]app_page.layout_features_box.north_arrow"}).on("click",function(){return(0,B.add_layout_feature)("north_arrow")}),de.insert("span").insert("img").attrs({id:"btn_scale",src:"static/img/layout_icons/scale.png",class:"layout_ft_ico i18n tt","data-i18n":"[title]app_page.layout_features_box.scale"}).on("click",function(){return(0,B.add_layout_feature)("scale")}),de.insert("span").insert("img").attrs({id:"btn_sphere",src:"static/img/layout_icons/sphere-01.png",class:"layout_ft_ico i18n tt","data-i18n":"[title]app_page.layout_features_box.sphere"}).on("click",function(){return(0,B.add_layout_feature)("sphere")}),Z();var _e=d3.select("#section5").append("div"),ue=_e.append("p");ue.append("span").attr("class","i18n").attr("data-i18n","[html]app_page.section5b.type");var ye=ue.append("select").attrs({id:"select_export_type",class:"m_elem_right"}).on("change",function(){var e=this.value,t=document.getElementById("export_filename");"svg"===e?(document.getElementById("export_options_geo").style.display="none",document.getElementById("export_options_png").style.display="none",t.value="export.svg",t.style.display="",t.previousSibling.style.display=""):"png"===e?(document.getElementById("export_options_geo").style.display="none",document.getElementById("export_options_png").style.display="",t.value="export.png",t.style.display="",t.previousSibling.style.display=""):"geo"===e&&(document.getElementById("export_options_png").style.display="none",document.getElementById("export_options_geo").style.display="",t.style.display="none",t.previousSibling.style.display="none")});ye.append("option").text("SVG").attr("value","svg"),ye.append("option").text("PNG").attr("value","png"),ye.append("option").text("GEO").attr("value","geo");var ge=_e.append("p").attr("id","export_options_png").style("display","none");ge.append("span").attrs({class:"i18n","data-i18n":"[html]app_page.section5b.format"});var fe=ge.append("select").attrs({id:"select_png_format",class:"m_elem_right"});ie("user_defined"),fe.on("change",function(){var e=this.value,t="web"===e?" (px)":" (cm)",n=document.getElementById("export_png_height"),a=document.getElementById("export_png_width");"web"===e?(n.value=h,a.value=w):"user_defined"===e?(n.value=(0,y.Mround)(h/118.11*10)/10,a.value=(0,y.Mround)(w/118.11*10)/10):"A4_landscape"===e?(n.value=21,a.value=29.7):"A4_portrait"===e?(n.value=29.7,a.value=21):"A3_landscape"===e?(n.value=42,a.value=29.7):"A3_portrait"===e?(n.value=29.7,a.value=42):"A5_landscape"===e?(n.value=14.8,a.value=21):"A5_portrait"===e&&(n.value=21,a.value=14.8),document.getElementById("export_png_width_txt").innerHTML=t,document.getElementById("export_png_height_txt").innerHTML=t,e.indexOf("portrait")>-1||e.indexOf("landscape")>-1?(n.disabled="disabled",a.disabled="disabled"):(n.disabled=void 0,a.disabled=void 0)});var he=ge.append("p").style("margin","20px 0");he.append("span").attrs({class:"i18n","data-i18n":"[html]app_page.section5b.width"}),he.append("input").style("width","60px").attrs({id:"export_png_width",class:"m_elem_right",type:"number",step:.1}).property("value",w).on("change",function(){var e=h/w,t=document.getElementById("export_png_height");t.value=(0,y.Mround)(+this.value*e*10)/10}),he.append("span").attr("id","export_png_width_txt").html(" (px)");var ve=ge.append("p").style("margin","20px 0");ve.append("span").attrs({class:"i18n","data-i18n":"[html]app_page.section5b.height"}),ve.append("input").style("width","60px").attrs({id:"export_png_height",class:"m_elem_right",type:"number",step:.1}).property("value",h).on("change",function(){var e=h/w,t=document.getElementById("export_png_width");t.value=(0,y.Mround)(+this.value/e*10)/10}),ve.append("span").attr("id","export_png_height_txt").html(" (px)");var be=_e.append("p");be.append("span").attrs({class:"i18n","data-i18n":"[html]app_page.section5b.filename"}),be.append("input").attrs({id:"export_filename",class:"m_elem_right",type:"text"}).property("value","export.svg");var xe=_e.append("p").attr("id","export_options_geo").style("display","none");xe.append("p").style("margin-bottom","0").append("span").attrs({class:"i18n","data-i18n":"[html]app_page.export_box.option_layer"});xe.insert("select").styles({position:"sticky",float:"right"}).attrs({id:"layer_to_export",class:"i18n m_elem_right"});var we=xe.append("p").styles({clear:"both"});we.append("span").attrs({class:"i18n","data-i18n":"[html]app_page.export_box.option_datatype"});var ke=we.insert("select").attrs({id:"datatype_to_use",class:"i18n m_elem_right"}).style("margin-top","5px");xe.append("p").style("margin","auto").attrs({class:"i18n","data-i18n":"[html]app_page.export_box.option_projection"});var Ae=xe.append("p").style("margin","auto").insert("select").styles({position:"relative",float:"right","margin-right":"5px","font-size":"10.5px"}).attrs({id:"projection_to_use",disabled:!0,class:"i18n"}),je=xe.append("p").style("margin","auto").insert("input").attrs({id:"proj4str"}).styles({display:"none",width:"275px",position:"relative",float:"right","margin-right":"5px","font-size":"10.5px"}).on("keyup",function(){Se.disabled=0===this.value.length?"true":""});["GeoJSON","TopoJSON","ESRI Shapefile","GML","KML"].forEach(function(e){ke.append("option").attr("value",e).text(e)}),[["app_page.section5b.wgs84","epsg:4326"],["app_page.section5b.web_mercator","epsg:3857"],["app_page.section5b.laea_europe","epsg:3035"],["app_page.section5b.usa_albers","+proj=aea +lat_1=29.5 +lat_2=45.5 +lat_0=37.5 +lon_0=-96 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs"],["app_page.section5b.british_national_grid","epsg:27700"],["app_page.section5b.lambert93","epsg:2154"],["app_page.section5b.eckert_4","+proj=eck4 +lon_0=0 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs "],["app_page.section5b.proj4_prompt","proj4string"]].forEach(function(e){Ae.append("option").attrs({class:"i18n",value:e[1],"data-i18n":e[0]}).text(i18next.t(e[0]))}),ke.on("change",function(){"TopoJSON"===this.value||"KML"===this.value||"GeoJSON"===this.value?(Ae.node().options.selectedIndex=0,Ae.attr("disabled",!0),Se.disabled=""):Ae.attr("disabled",null)}),Ae.on("change",function(){"proj4string"===this.value?(je.style("display","initial"),""!==je.node().value&&void 0!==je.node().value||(Se.disabled="true")):(je.style("display","none"),Se.disabled="")});var Se=_e.append("p").style("float","left").append("button").attrs({id:"export_button_section5b",class:"i18n button_st4","data-i18n":"[html]app_page.section5b.export_button"}).on("click",function(){var e=document.getElementById("select_export_type").value,t=document.getElementById("export_filename").value;if("svg"===e)(0,x.export_compo_svg)(t);else if("geo"===e){var n=document.getElementById("layer_to_export").value,a=document.getElementById("datatype_to_use").value,r=document.getElementById("projection_to_use").value,o=document.getElementById("proj4str").value;(0,x.export_layer_geo)(n,a,r,o)}else if("png"===e){var i=document.getElementById("select_png_format").value,l=void 0;"web"===i?l=+document.getElementById("export_png_height").value/+h:(i="paper",l=118.11*+document.getElementById("export_png_height").value/+h),(0,x.export_compo_png)(i,l,t)}});map_div.append("div").attr("class","light-menu").styles({position:"absolute",right:"0px",bottom:"0px"}).selectAll("input").data([{id:"zoom_out",i18n:"[title]app_page.lm_buttons.zoom-",tooltip_position:"left",class:"zoom_button i18n tt",html:"-"},{id:"zoom_in",i18n:"[title]app_page.lm_buttons.zoom+",tooltip_position:"left",class:"zoom_button i18n tt",html:"+"},{id:"info_button",i18n:"[title]app_page.lm_buttons.i",tooltip_position:"left",class:"info_button i18n tt",html:"i"},{id:"brush_zoom_button",i18n:"[title]app_page.lm_buttons.zoom_rect",tooltip_position:"left",class:"brush_zoom_button i18n tt",html:'<img src="static/img/Inkscape_icons_zoom_fit_selection_blank.png" width="18" height="18" alt="Zoom_select"/>'},{id:"hand_button",i18n:"[title]app_page.lm_buttons.hand_button",tooltip_position:"left",class:"hand_button i18n tt",html:'<img src="static/img/Twemoji_1f513.png" width="18" height="18" alt="Hand_closed"/>'}]).enter().append("p").attr("class","cont_map_btn").style("margin","auto").insert("button").attrs(function(e){return{"data-tippy-placement":e.tooltip_position,class:e.class,"data-i18n":e.i18n,id:e.id}}).html(function(e){return e.html});if(d3.selectAll(".zoom_button").on("click",b.zoomClick),document.getElementById("info_button").onclick=le,document.getElementById("hand_button").onclick=Y,document.getElementById("brush_zoom_button").onclick=z.handleZoomRect,d3.select("body").append("div").attr("id","info_features").classed("active",!1).style("display","none").html(""),$(".accordion"),document.getElementById("btn_s1").dispatchEvent(new MouseEvent("click")),L(),t){var Ee=void 0;Ee=t.startsWith("http")?t:"https://gist.githubusercontent.com/"+t+"/raw/",(0,u.xhrequest)("GET",Ee,void 0,!0).then(function(e){(0,k.apply_user_preferences)(e)})}else{var ze=window.localStorage.getItem("magrit_project");ze&&ze.length&&ze.length>0?swal({title:"",allowOutsideClick:!1,allowEscapeKey:!1,type:"question",showConfirmButton:!0,showCancelButton:!0,confirmButtonText:i18next.t("app_page.common.new_project"),cancelButtonText:i18next.t("app_page.common.resume_last")}).then(function(){window.localStorage.removeItem("magrit_project"),e._app.first_layer=!0},function(e){(0,k.apply_user_preferences)(ze)}):e._app.first_layer=!0}l.default.set("notifier","position","bottom-left")},n.click_button_add_layer=M,n.prepare_drop_section=L,n.add_layer_topojson=U,n.handle_click_hand=Y,n.scale_to_lyr=K,n.center_map=Q,n.fitLayer=function(e){proj.scale(1).translate([0,0]);var t=J(e),n=.95/(0,y.Mmax)((t[1][0]-t[0][0])/w,(t[1][1]-t[0][1])/h),a=[(w-n*(t[1][0]+t[0][0]))/2,(h-n*(t[1][1]+t[0][1]))/2];return proj.scale(n).translate(a),[n,a]},n.add_sample_layer=X,n.add_simplified_land_layer=Z,n.prepare_available_symbols=function(){return(0,u.xhrequest)("GET","static/json/list_symbols.json",null).then(function(e){var t=JSON.parse(e);return r.all(t.map(function(e){return getImgDataUrl("static/img/svg_symbols/"+e)})).then(function(e){for(var n=0;n<t.length;n++)default_symbols.push([t[n],e[n]])})})},n.accordionize=$,n.switch_accordion_section=ae,n.canvas_mod_size=oe,n.displayInfoOnMove=le,n.remove_layer_cleanup=_e,n.binds_layers_buttons=ue;var l=O(a(10)),p=O(a(0)),c=(O(a(9)),a(8)),d=a(1),_=a(16),u=a(3),m=a(7),y=a(6),g=a(38),f=a(37),v=a(15),b=a(11),x=a(35),k=a(34),A=a(17),j=a(32),S=a(22),E=a(21),z=a(31),B=a(12),P=a(25);function O(e){return e&&e.__esModule?e:{default:e}}var C=273e5;function M(){var e=this,t=document.createElement("input");"img_data_ext"===e.id||"data_ext"===e.id?t.setAttribute("accept",".xls,.xlsx,.csv,.tsv,.ods,.txt"):"input_geom"!==e.id&&"img_in_geom"!==e.id||t.setAttribute("accept",".gml,.kml,.geojson,.topojson,.shp,.dbf,.shx,.prj,.cpg,.json"),t.setAttribute("type","file"),t.setAttribute("multiple",""),t.setAttribute("name","file[]"),t.setAttribute("enctype","multipart/form-data"),t.onchange=function(n){q((0,u.prepareFileExt)(n.target.files),e),t.remove()},t.click()}function I(){var e={target:i18next.t("app_page.common.target_l"),layout:i18next.t("app_page.common.layout_l")},t=!1;return swal({title:"",text:i18next.t("app_page.common.layer_type_selection"),type:"info",showCancelButton:!0,showCloseButton:!1,allowEscapeKey:!0,allowOutsideClick:!1,confirmButtonColor:"#DD6B55",confirmButtonText:i18next.t("app_page.common.confirm"),input:"select",inputPlaceholder:i18next.t("app_page.common.layer_type_selection"),inputOptions:e,inputValidator:function(e){return new r(function(n,a){e.indexOf("target")<0&&e.indexOf("layout")<0?a(i18next.t("app_page.common.no_value")):e.indexOf("target")>-1&&_app.targeted_layer_added&&!t?(t=!0,a(i18next.t("app_page.common.ask_replace_target_layer"))):(e.indexOf("target")>-1&&t&&ee(),n(e))})}})}function q(e,t){var n,a,r,o,l,s=Array.prototype.map.call(e,function(e){return e.size}).reduce(function(e,t){return e+t},0);if(e[0]&&!e[0]._ext&&(e=(0,u.prepareFileExt)(e)),s>C)return swal({title:i18next.t("app_page.common.error")+"!",text:i18next.t("app_page.common.too_large_input"),type:"error",customClass:"swal2_custom",allowEscapeKey:!1,allowOutsideClick:!1});if(1!==e.length){var c=[];if(Array.prototype.forEach.call(e,function(e){return"shp"===e._ext||"dbf"===e._ext||"shx"===e._ext||"prj"===e._ext||"cpg"===e._ext?c.push(e):null}),!(c.length>=4&&c.length<=6))return swal({title:i18next.t("app_page.common.error")+"!",text:i18next.t("app_page.common.alert_upload1"),customClass:"swal2_custom",type:"error",allowEscapeKey:!1,allowOutsideClick:!1});N(c)}else if(e[0]._ext.indexOf("json")>-1||"zip"===e[0]._ext||"gml"===e[0]._ext||"kml"===e[0]._ext)if(e[0]._ext.indexOf("json")<0)R(e[0]);else{var d=new FileReader;d.onloadend=function(){var t=(0,u.isValidJSON)(d.result),n=i(t,2),a=n[0],r=n[1];if(!a)return console.log(r),swal({title:i18next.t("app_page.common.error")+"!",text:i18next.t("app_page.common.alert_upload_invalid"),type:"error",customClass:"swal2_custom",allowOutsideClick:!1,allowEscapeKey:!1});if(r.type&&"FeatureCollection"===r.type)R(e[0]);else if(r.type&&"Topology"===r.type)!function(e){I().then(function(t){overlay_drop.style.display="none";var n=void 0;n=t.indexOf("target")>-1;var a=e[0],r=(e[0].name,new FileReader),o=new FormData;o.append("file[]",a),(0,u.xhrequest)("POST","convert_topojson",o,!0).then(function(e){var t=JSON.parse(e).key;r.onloadend=function(){var e=r.result,a=['{"key": ',t,',"file":',e,"}"].join("");U(a,{target_layer_on_add:n})},r.readAsText(a)},function(e){(0,u.display_error_during_computation)()})},function(e){overlay_drop.style.display="none"})}(e);else{if(!r.map_config||!r.layers)return swal({title:i18next.t("app_page.common.error")+"!",text:i18next.t("app_page.common.alert_upload_invalid"),type:"error",customClass:"swal2_custom",allowOutsideClick:!1,allowEscapeKey:!1});(0,k.apply_user_preferences)(d.result)}},d.readAsText(e[0])}else if("csv"===e[0]._ext||"tsv"===e[0]._ext)r=e[0],l=function(){var e=new FileReader,t=r.name;e.onload=function(e){var n=e.target.result,a=p.default.detect(n).encoding,i=new FileReader;i.onload=function(e){var a=(n=e.target.result).split("\n")[0];a=a.indexOf("\t")>-1?"\t":a.indexOf(";")>-1?";":",";var r=d3.dsvFormat(a).parse(n),i=Object.getOwnPropertyNames(r[0]).map(function(e){return e.toLowerCase?e.toLowerCase():e});(i.indexOf("x")>-1||i.indexOf("lat")>-1||i.indexOf("latitude")>-1)&&(i.indexOf("y")>-1||i.indexOf("lon")>-1||i.indexOf("longitude")>-1||i.indexOf("long")>-1||i.indexOf("lng")>-1)?o&&_app.targeted_layer_added?swal({title:i18next.t("app_page.common.error")+"!",text:i18next.t("app_page.common.error_only_one"),customClass:"swal2_custom",type:"error",allowEscapeKey:!1,allowOutsideClick:!1}):D(n,t.substring(0,t.indexOf(".csv"))):(dataset_name=t.substring(0,t.indexOf(".csv")),G(r))},i.readAsText(r,a)},e.readAsBinaryString(r)},0!==joined_dataset.length?T().then(function(){de(),l()},function(e){return null}):l();else{if(!(e[0]._ext.indexOf("xls")>-1||e[0]._ext.indexOf("ods")>-1)){var _=void 0;return Array.prototype.forEach.call(e,function(e){("shp"===e._ext||"dbf"===e._ext||"shx"===e._ext||"prj"===e._ext||"cpg"===e._ext)&&(_=!0)}),_?swal({title:i18next.t("app_page.common.error")+"!",text:i18next.t("app_page.common.alert_upload_shp"),type:"error",customClass:"swal2_custom",allowOutsideClick:!1,allowEscapeKey:!1}).then(function(e){return null},function(e){return null}):swal({title:i18next.t("app_page.common.error")+"!",text:i18next.t("app_page.common.alert_upload_invalid"),type:"error",customClass:"swal2_custom",allowOutsideClick:!1,allowEscapeKey:!1})}n=e[0],a=function(){var e=new FormData;e.append("action","submit_form"),e.append("file[]",n),(0,u.xhrequest)("POST","convert_tabular",e,!0).then(function(e){var t=JSON.parse(e);swal({title:"",text:i18next.t("app_page.common.warn_xls_sheet")+(t.message?"\n"+i18next.t(t.message[0],{sheet_name:t.message[1][0]}):""),type:"info",allowOutsideClick:!1,allowEscapeKey:!1}).then(function(){var e=d3.csvParse(t.file),n=Object.getOwnPropertyNames(e[0]).map(function(e){return e.toLowerCase?e.toLowerCase():e});!_app.targeted_layer_added&&(n.indexOf("x")>-1||n.indexOf("lat")>-1||n.indexOf("latitude")>-1)&&(n.indexOf("y")>-1||n.indexOf("lon")>-1||n.indexOf("longitude")>-1||n.indexOf("long")>-1||n.indexOf("lng")>-1)?D(t.file,t.name):(dataset_name=t.name,G(e))},function(e){return null})},function(e){(0,u.display_error_during_computation)()})},0!==joined_dataset.length?T().then(function(){de(),a()},function(){return null}):a()}}function L(){var e=void 0;Array.prototype.forEach.call(document.querySelectorAll("#map,.overlay_drop"),function(t){t.addEventListener("dragenter",function(e){e.preventDefault(),e.stopPropagation(),document.body.classList.contains("no-drop")||(document.getElementById("overlay_drop").style.display="")}),t.addEventListener("dragover",function(t){t.preventDefault(),t.stopPropagation(),document.body.classList.contains("no-drop")||e&&(clearTimeout(e),e=setTimeout(function(){document.getElementById("overlay_drop").style.display="none",e=null},2500))}),t.addEventListener("dragleave",function(t){t.preventDefault(),t.stopPropagation(),document.body.classList.contains("no-drop")?document.body.classList.remove("no-drop"):e=setTimeout(function(){document.getElementById("overlay_drop").style.display="none",e=null},2500)}),t.addEventListener("drop",function t(n){if(n.preventDefault(),n.stopPropagation(),e&&clearTimeout(e),!document.body.classList.contains("no-drop")&&n.dataTransfer.files.length){e=setTimeout(function(){document.getElementById("overlay_drop").style.display="none",e=null},750);var a=(0,u.prepareFileExt)(n.dataTransfer.files);1!==a.length||"shp"!==a[0]._ext&&"dbf"!==a[0]._ext&&"shx"!==a[0]._ext&&"prj"!==a[0]._ext&&"cpg"!==a[0]._ext?q(a):(Array.prototype.slice.call(document.querySelectorAll("#map,.overlay_drop")).forEach(function(e){e.removeEventListener("drop",t)}),function(e){function t(e,t){if(t.name.toLowerCase().indexOf(".shp")>-1)e.set(".shp",t),document.getElementById("f_shp").className="mini_button_ok";else if(t.name.toLowerCase().indexOf(".shx")>-1)e.set(".shx",t),document.getElementById("f_shx").className="mini_button_ok";else if(t.name.toLowerCase().indexOf(".prj")>-1)e.set(".prj",t),document.getElementById("f_prj").className="mini_button_ok";else if(t.name.toLowerCase().indexOf(".dbf")>-1)e.set(".dbf",t),document.getElementById("f_dbf").className="mini_button_ok";else{if(!(t.name.toLowerCase().indexOf(".cpg")>-1))return!1;e.set(".cpg",t),document.getElementById("f_cpg").className="mini_button_ok"}}var n=new Map;t(n,e[0]),swal({title:"",html:'<div style="border: dashed 1px green;border-radius: 1%;" id="dv_drop_shp"><strong>'+i18next.t("app_page.common.shp_one_by_one_msg1")+'</strong><br><p style="margin:auto;">'+i18next.t("app_page.common.shp_one_by_one_msg2",{name:""})+"</p><p><i>"+i18next.t("app_page.common.shp_one_by_one_msg3")+'</i></p><br><image id="img_drop" src="static/img/Ic_file_download_48px.svg"><br><p id="f_shp" class="mini_button_none">.shp</p><p id="f_shx" class="mini_button_none">.shx</p><p id="f_dbf" class="mini_button_none">.dbf</p><p id="f_prj" class="mini_button_none">.prj</p><p id="f_cpg" class="mini_button_none_orange">.cpg</p></div>',type:"info",showCancelButton:!0,showCloseButton:!1,allowEscapeKey:!0,allowOutsideClick:!1,confirmButtonColor:"#DD6B55",confirmButtonText:i18next.t("app_page.common.confirm"),preConfirm:function(){return new r(function(e,t){setTimeout(function(){4===n.size&&!n.has(".cpg")||5===n.size?e():t(i18next.t("app_page.common.shp_one_by_one_missing_files"))},50)})}}).then(function(){var e=[n.get(".shp"),n.get(".shx"),n.get(".dbf"),n.get(".prj")];n.has(".cpg")&&e.push(n.get(".cpg"));for(var t=0;t<e.length;t++)if(e[t].size>C)return overlay_drop.style.display="none",swal({title:i18next.t("app_page.common.error")+"!",text:i18next.t("app_page.common.too_large_input"),type:"error",allowEscapeKey:!1,allowOutsideClick:!1});N(e)},function(e){overlay_drop.style.display="none",console.log(e)}),document.getElementById("dv_drop_shp").addEventListener("drop",function(e){e.preventDefault(),e.stopPropagation();for(var a=(0,u.prepareFileExt)(e.dataTransfer.files),r=0;r<a.length;r++)t(n,a[r]);(4===n.size&&!n.has(".cpg")||5===n.size)&&(this.innerHTML=this.innerHTML.replace("Ic_file_download_48px.svg","Ic_check_36px.svg"))}),document.getElementById("dv_drop_shp").addEventListener("dragover",function(e){this.style.border="dashed 2.5px green",e.preventDefault(),e.stopPropagation()}),document.getElementById("dv_drop_shp").addEventListener("dragleave",function(e){this.style.border="dashed 1px green",e.preventDefault(),e.stopPropagation()})}(a))}else document.getElementById("overlay_drop").style.display="none"})})}function T(){return swal({title:"",text:i18next.t("app_page.common.ask_replace_dataset"),type:"warning",showCancelButton:!0,allowOutsideClick:!1,allowEscapeKey:!1,confirmButtonColor:"#DD6B55",confirmButtonText:i18next.t("app_page.common.confirm")})}function N(e,t){I().then(function(t){overlay_drop.style.display="none";var n=void 0;n=t.indexOf("target")>-1;var a=new FormData;a.append("action","submit_form");for(var r=0;r<e.length;r++)a.append("file["+r+"]",e[r]);(0,u.xhrequest)("POST","convert_to_topojson",a,!0).then(function(e){U(e,{target_layer_on_add:n})},function(e){(0,u.display_error_during_computation)()})},function(e){overlay_drop.style.display="none"})}function F(){var e=dataset_name.length>20?[dataset_name.substring(0,17),"(...)"].join(""):dataset_name,t=joined_dataset[0].length,n=Object.getOwnPropertyNames(joined_dataset[0][0]);document.getElementById("ext_dataset_zone").parentElement;d3.select("#ext_dataset_zone").styles({border:null,color:"black","margin-bottom":"3px",padding:null,"text-align":"initial"}).html(['<div style="display:inline-block;"><img id="img_data_ext" class="user_panel" src="static/img/b/tabular.png" width="26" height="26" alt="Additional dataset"></img></div>','<div style="display:inline-block;margin-left: 4px;">'," <b>",e,'</b><br><i><span style="font-size:9px;">',t," ",i18next.t("app_page.common.feature",{count:+t})," - ",n.length," ",i18next.t("app_page.common.field",{count:+n.length}),"</i></span>","</div>",'<div style="float:right;">','<img width="13" height="13" src="static/img/Trash_font_awesome.png" id="remove_dataset">','<img width="14" height="14" src="static/img/dataset.png" id="table_dataset_s1">',"</div>"].join("")),document.getElementById("remove_dataset").onclick=function(){swal({title:"",text:i18next.t("app_page.common.remove_tabular"),type:"warning",showCancelButton:!0,allowOutsideClick:!1,confirmButtonColor:"#DD6B55",confirmButtonText:i18next.t("app_page.common.delete")+"!",cancelButtonText:i18next.t("app_page.common.cancel")}).then(function(){de()},function(){return null})},_app.targeted_layer_added&&(0,g.valid_join_check_display)(!1),document.getElementById("table_dataset_s1").onclick=function(){S.boxExplore2.create(dataset_name)}}function G(e){if(e[0].hasOwnProperty(""))for(var t=e[0].hasOwnProperty("UID")?"Undefined_Name":"UID",n=0;n<e.length;++n)e[n][t]=e[n][""],delete e[n][""];var a=Object.getOwnPropertyNames(e[0]);a.map(function(t){return e[e.length-1][t]}).every(function(e){return""===e||void 0===e})&&(e=e.slice(0,e.length-1));for(var r=0;r<a.length;r++){for(var o=[],i=0;i<e.length&&(!(!e[i][a[r]].replace||isNaN(+e[i][a[r]].replace(",","."))&&isNaN(+e[i][a[r]].split(" ").join("")))||!isNaN(+e[i][a[r]]));i++){var l=e[i][a[r]].replace(",",".").split(" ").join("");o.push(isFinite(l)&&""!==l&&null!=l?+l:l)}if(o.length===e.length)for(var s=0;s<e.length;s++)e[s][a[r]]=o[s]}(joined_dataset.push(e),F(),_app.current_functionnality&&"flow"===_app.current_functionnality.name&&fields_handler.fill(),_app.targeted_layer_added)&&H(Object.getOwnPropertyNames(user_data)[0],"dataset")}function D(e,t){var n=new FormData;n.append("filename",t),n.append("csv_file",e),(0,u.xhrequest)("POST","convert_csv_geo",n,!0).then(function(e){dataset_name=void 0,U(e,{target_layer_on_add:!0})},function(e){(0,u.display_error_during_computation)()})}function R(e,t){I().then(function(t){overlay_drop.style.display="none";var n=void 0;n=t.indexOf("target")>-1;var a=new FormData;a.append("action","single_file"),a.append("file[]",e),(0,u.xhrequest)("POST","/convert_to_topojson",a,!0).then(function(e){U(e,{target_layer_on_add:n})},function(e){(0,u.display_error_during_computation)()})},function(e){overlay_drop.style.display="none"})}function W(e,t,n,a){var r=+(a.length+t.toString().length+n.toString().length)>40?[a.substring(0,35),"(...)"].join(""):a,o=P.button_type.get(e);o=o.substring(10,o.indexOf("class")-2),d3.select("#target_layer_zone").styles({"text-align":"initial",padding:null,border:null,color:"black"}).html('<div style="display:inline-block;">\n<img src="'+o+'" width="26" height="26"></img>\n</div>\n<div style="display:inline-block;margin-left: 4px;">\n<b>'+r+'</b>\n<br>\n<i><span style="font-size:10px;">'+n+" "+i18next.t("app_page.common.feature",{count:+n})+" - "+t+" "+i18next.t("app_page.common.field",{count:+t})+'</i></span>\n</div>\n<div style="float:right;">\n<img width="13" height="13" src="static/img/Trash_font_awesome.png" id="remove_target">\n<img width="14" height="14" src="static/img/dataset.png" id="table_layer_s1">\n<img width="14" height="14" src="static/img/replace_target_layer.svg" id="downgrade_target">\n</div>'),document.getElementById("remove_target").onclick=function(){ce(Object.getOwnPropertyNames(user_data)[0])},document.getElementById("table_layer_s1").onclick=V,document.getElementById("downgrade_target").onclick=ee}function H(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"layer";swal({title:"",text:i18next.t("app_page.join_box.before_join_ask"),allowOutsideClick:!1,allowEscapeKey:!0,type:"question",showConfirmButton:!0,showCancelButton:!0,confirmButtonText:i18next.t("app_page.common.yes"),cancelButtonText:i18next.t("app_page.common.no")}).then(function(){createJoinBox(e)},function(n){"layer"===t&&(0,u.make_box_type_fields)(e)})}var V=function(){var e=Object.keys(user_data)[0];S.boxExplore2.create(e)};function U(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(0,u.isValidJSON)(e),a=i(n,2),r=a[0],o=a[1];if(r)if(o.Error)(0,u.display_error_during_computation)(o.Error);else{var l=!!t.result_layer_on_add,s=!!t.target_layer_on_add,p=!!t.skip_alert,d=!0===t.skip_rescale,m=t.fields_type?t.fields_type:void 0,y=o.file.transform?o.file:topojson.quantize(o.file,1e5),f=Object.getOwnPropertyNames(y.objects),h=c.ColorsSelected.random(),v=f[0],x=(0,_.check_layer_name)(t.choosed_name?t.choosed_name:v),w=encodeId(x),k=y.objects[v].geometries.length,j=y.objects[v],S=!1,E=void 0,z=void 0;if(f.length>1&&swal("",i18next.t("app_page.common.warning_multiple_layers"),"warning"),j.geometries&&0!==j.geometries.length){_app.layer_to_id.set(x,w),_app.id_to_layer.set(w,x);for(var B=0;B<k;B++)if(j.geometries[B]&&j.geometries[B].type){j.geometries[B].type.indexOf("Point")>-1?E="Point":j.geometries[B].type.indexOf("LineString")>-1?E="Line":j.geometries[B].type.indexOf("Polygon")>-1&&(E="Polygon");break}if(E){if(_app.first_layer&&(_e("World"),o.proj))try{z=proj4(o.proj)}catch(e){z=void 0,console.log(e)}current_layers[x]={type:E,n_features:k,"stroke-width-const":"Line"===E?1.5:.4,fill_color:{single:h},key_name:o.key},s?(current_layers[x].targeted=!0,user_data[x]=[],S=!0,current_layers[x].fields_type=[]):l&&(result_data[x]=[],current_layers[x].is_result=!0);var O=j.geometries[0].properties?Object.getOwnPropertyNames(j.geometries[0].properties):[],C=t.pointRadius?path.pointRadius(t.pointRadius):path,M=O.length;j.geometries.forEach(function(e,t){S&&M>0?(void 0!==e.id&&e.id!==t?(e.properties._uid=e.id,e.id=+t):e.id||(e.id=+t),user_data[x].push(e.properties)):S?(e.properties.id=e.id=t,user_data[x].push({id:e.properties.id})):l&&result_data[x].push(e.properties)});map.insert("g",".legend").attrs({id:w,class:S?"targeted_layer layer":"layer"}).styles({"stroke-linecap":"round","stroke-linejoin":"round"}).selectAll(".subunit").data(topojson.feature(y,j).features,function(e){return e.id}).enter().append("path").attrs({d:C,id:function(e,t){return"feature_"+t}}).styles({stroke:"Line"!==E?"rgb(0, 0, 0)":h,"stroke-opacity":1,fill:"Line"!==E?h:null,"fill-opacity":"Line"!==E?.9:0});var I=[s?"sortable_target ":l?"sortable_result ":null,w].join(""),q=layer_list.node(),L=document.createElement("li"),T=(0,u.get_display_name_on_layer_list)(x);if(L.setAttribute("class",I),L.setAttribute("layer_name",x),d3.select("#layer_to_export").append("option").attr("value",x).text(x),s?(current_layers[x].original_fields=new Set(Object.getOwnPropertyNames(user_data[x][0])),0!==joined_dataset.length&&(0,g.valid_join_check_display)(!1),W(E,M,k,x),_app.targeted_layer_added=!0,L.innerHTML=[T,'<div class="layer_buttons">',P.button_trash,P.sys_run_button_t2,P.button_zoom_fit,P.button_table,P.eye_open0,P.button_type.get(E),P.button_replace,"</div>"].join(""),window._target_layer_file=y,d||(K(x),Q(x)),void 0!==_app.current_functionnality&&fields_handler.fill(x),Y("lock"),document.getElementById("button_grid").setAttribute("data-i18n","Point"===E?"[title]app_page.func_description.grid_point":"[title]app_page.func_description.grid"),localize("#button_grid")):L.innerHTML=l?[T,'<div class="layer_buttons">',P.button_trash,P.sys_run_button_t2,P.button_zoom_fit,P.button_table,P.eye_open0,P.button_legend,P.button_result_type.get(t.func_name),P.button_replace,"</div>"].join(""):[T,'<div class="layer_buttons">',P.button_trash,P.sys_run_button_t2,P.button_zoom_fit,P.button_table,P.eye_open0,P.button_type.get(E),P.button_replace,"</div>"].join(""),s||void 0===_app.current_functionnality||"smooth"!==_app.current_functionnality.name&&"grid"!==_app.current_functionnality.name||fields_handler.fill(),"Point"===E&&(current_layers[x].pointRadius=t.pointRadius||path.pointRadius()),q.insertBefore(L,q.childNodes[0]),(0,A.handleClipPath)(current_proj_name),ue(x),d||(0,b.zoom_without_redraw)(),p||(m&&(current_layers[x].fields_type=m),void 0===z?swal({title:"",text:i18next.t("app_page.common.layer_success"),allowOutsideClick:!0,allowEscapeKey:!0,type:"success"}).then(function(){s&&joined_dataset.length>0?H(x):s&&(0,u.make_box_type_fields)(x)},function(e){s&&joined_dataset.length>0?H(x):s&&(0,u.make_box_type_fields)(x)}):swal({title:"",text:i18next.t("app_page.common.layer_success_and_proj"),showCancelButton:!0,showCloseButton:!1,allowEscapeKey:!0,allowOutsideClick:!0,type:"success"}).then(function(){_app.last_projection=o.proj,current_proj_name="def_proj4",(0,A.change_projection_4)(z);var e=tryFindNameProj(_app.last_projection);(0,A.addLastProjectionSelect)("def_proj4",_app.last_projection,e),s&&joined_dataset.length>0?H(x):s&&(0,u.make_box_type_fields)(x)},function(e){s&&joined_dataset.length>0?H(x):s&&(0,u.make_box_type_fields)(x)})),t.default_projection)if("proj4"===t.default_projection[0]){var N=t.default_projection[1],F=void 0;if(N.startsWith("EPSG:")){var G=+N.split("EPSG:")[1],D=_app.epsg_projections[G];N=D.proj4,F=D.name}current_proj_name="def_proj4",_app.last_projection=N,(0,A.change_projection_4)(proj4(N)),(0,A.addLastProjectionSelect)("def_proj4",_app.last_projection,F)}else"d3"===t.default_projection[0]&&(current_proj_name=t.default_projection[1],(0,A.change_projection)(t.default_projection[1]),(0,A.addLastProjectionSelect)(current_proj_name));return x}(0,u.display_error_during_computation)(i18next.t("app_page.common.error_invalid_empty"))}else(0,u.display_error_during_computation)(i18next.t("app_page.common.error_invalid_empty"))}else(0,u.display_error_during_computation)("Unable to load the layer")}function Y(e){var t,n=d3.select("#hand_button");"lock"===("object"===(void 0===e?"undefined":o(e))?n.classed("locked")?"unlock":"lock":!(!e||"string"!=typeof e)&&e)?(n.classed("locked",!0),n.html('<img src="static/img/Twemoji_1f512.png" width="18" height="18" alt="locked"/>'),map.select(".brush").remove(),document.getElementById("zoom_in").parentElement.style.display="none",document.getElementById("zoom_out").parentElement.style.display="none",document.getElementById("brush_zoom_button").parentElement.style.display="none",zoom.on("zoom",(t=svg_map.__zoom,function(){this.__zoom=t}))):(n.classed("locked",!1),n.html('<img src="static/img/Twemoji_1f513.png" width="18" height="18" alt="unlocked"/>'),zoom.on("zoom",b.zoom_without_redraw),document.getElementById("zoom_in").parentElement.style.display="",document.getElementById("zoom_out").parentElement.style.display="",document.getElementById("brush_zoom_button").parentElement.style.display="",map.select(".brush").remove())}function J(e){for(var t=svg_map.querySelector("#"+_app.layer_to_id.get(e)).childNodes,n=[[1/0,1/0],[-1/0,-1/0]],a=0,r=t.length;a<r;a++){var o=path.bounds(t[a].__data__);n[0][0]=o[0][0]<n[0][0]?o[0][0]:n[0][0],n[0][1]=o[0][1]<n[0][1]?o[0][1]:n[0][1],n[1][0]=o[1][0]>n[1][0]?o[1][0]:n[1][0],n[1][1]=o[1][1]>n[1][1]?o[1][1]:n[1][1]}if("ConicConformal"===current_proj_name){var i=(0,y.Mmax)((n[1][0]-n[0][0])/w,(n[1][1]-n[0][1])/h),l=path.bounds({type:"MultiPoint",coordinates:[[-69.3,-55.1],[20.9,-36.7],[147.2,-42.2],[162.1,67],[-160.2,65.7]]});(0,y.Mmax)((l[1][0]-l[0][0])/w,(l[1][1]-l[0][1])/h)<i&&(n=l)}else if("Armadillo"===current_proj_name){var s=(0,y.Mmax)((n[1][0]-n[0][0])/w,(n[1][1]-n[0][1])/h),p=path.bounds({type:"MultiPoint",coordinates:[[-69.3,-35],[-170,10],[-170,85],[0,-70],[20.9,-35],[147.2,-35],[170,85],[170,10]]});(0,y.Mmax)((p[1][0]-p[0][0])/w,(p[1][1]-p[0][1])/h)<s&&(n=p)}return n}function K(e){var n=J(e);n&&(s=.95/(0,y.Mmax)((n[1][0]-n[0][0])/w,(n[1][1]-n[0][1])/h)*proj.scale(),t=[0,0],proj.scale(s).translate(t),map.selectAll(".layer").selectAll("path").attr("d",path),(0,b.reproj_symbol_layer)())}function Q(e){var t=J(e),n=.95/(0,y.Mmax)((t[1][0]-t[0][0])/w,(t[1][1]-t[0][1])/h),a=[(w-n*(t[1][0]+t[0][0]))/2,(h-n*(t[1][1]+t[0][1]))/2],r=svg_map.__zoom;r.k=n,r.x=a[0],r.y=a[1]}function X(){(0,d.check_remove_existing_box)(".sampleDialogBox"),_app.list_extrabasemaps||(0,u.request_data)("GET","extrabasemaps").then(function(e){_app.list_extrabasemaps=JSON.parse(e.target.responseText).filter(function(e){return"Tunisia"!==e[0]})});var e=new Map([["quartier_paris",[{name:"n_sq_qu",type:"id"},{name:"c_qu",type:"id"},{name:"c_quinsee",type:"id"},{name:"l_qu",type:"id"},{name:"c_ar",type:"category",has_duplicate:!0},{name:"n_sq_ar",type:"category",has_duplicate:!0},{name:"surface",type:"stock"},{name:"P12_POP",type:"stock"},{name:"P07_POP",type:"stock"}]],["GrandParisMunicipalities",[{name:"DEPARTEMENT",type:"category",has_duplicate:!0},{name:"IDCOM",type:"id"},{name:"EPT",type:"category",has_duplicate:!0},{name:"REVENUS",type:"stock"},{name:"LIBCOM",type:"id"},{name:"LIBEPT",type:"category",has_duplicate:!0},{name:"MENAGES_FISCAUX",type:"stock"},{name:"UID",type:"id"},{name:"REVENUS_PAR_MENAGE",type:"ratio"}]],["martinique",[{name:"INSEE_COM",type:"id"},{name:"NOM_COM",type:"id",not_number:!0},{name:"STATUT",type:"category",has_duplicate:!0},{name:"SUPERFICIE",type:"stock"},{name:"P13_POP",type:"stock"},{name:"P13_LOG",type:"stock"},{name:"P13_LOGVAC",type:"stock"},{name:"Part_Logements_Vacants",type:"ratio"}]],["nuts2-2013-data",[{name:"id",type:"id",not_number:!0},{name:"name",type:"id",not_number:!0},{name:"POP",type:"stock"},{name:"GDP",type:"stock"},{name:"UNEMP",type:"ratio"},{name:"COUNTRY",type:"category",has_duplicate:!0}]],["voronoi_communes_2016_2-2",[{name:"INSEE_COM",type:"id"}]],["regions_2016_2-2",[{name:"CODE_REG",type:"id"}]],["departements_2016_2-2",[{name:"CODE_DEPT",type:"id"},{name:"CODE_REG",type:"category",has_duplicate:!0}]],["brazil",[{name:"ADMIN_NAME",type:"id",not_number:!0},{name:"Abbreviation",type:"id",not_number:!0},{name:"Capital",type:"id",not_number:!0},{name:"GDP_per_capita_2012",type:"stock"},{name:"Life_expectancy_2014",type:"ratio"},{name:"Pop2014",type:"stock"},{name:"REGIONS",type:"category",has_duplicate:!0},{name:"STATE2010",type:"id"},{name:"popdensity2014",type:"ratio"}]],["FR_communes",[{name:"INSEE_COM",type:"id"},{name:"NOM_COM",type:"id"},{name:"SUPERFICIE",type:"stock"},{name:"POPULATION",type:"stock"},{name:"CODE_DEPT",type:"category",has_duplicate:!0},{name:"NOM_DEPT",type:"category",has_duplicate:!0},{name:"CODE_REG",type:"category",has_duplicate:!0},{name:"NOM_REG",type:"category",has_duplicate:!0}]],["world_countries_data",[{name:"ISO2",type:"id",not_number:!0},{name:"ISO3",type:"id",not_number:!0},{name:"ISONUM",type:"id"},{name:"NAMEen",type:"id",not_number:!0},{name:"NAMEfr",type:"id",not_number:!0},{name:"UNRegion",type:"category",has_duplicate:!0},{name:"GrowthRate",type:"ratio"},{name:"PopDensity",type:"ratio"},{name:"PopTotal",type:"stock"},{name:"JamesBond",type:"stock"}]]]),t=new Map([["quartier_paris",["proj4","EPSG:2154"]],["GrandParisMunicipalities",["proj4","EPSG:2154"]],["martinique",["proj4","EPSG:2973"]],["nuts2-2013-data",["proj4","EPSG:3035"]],["voronoi_communes_2016_2-2",["proj4","EPSG:2154"]],["departements_2016_2-2",["proj4","EPSG:2154"]],["brazil",["proj4","EPSG:5527"]],["world_countries_data",["d3","NaturalEarth2"]],["commune_dep_971",["proj4","EPSG:32620"]],["commune_dep_972",["proj4","EPSG:32620"]],["commune_dep_973",["proj4","EPSG:2972"]],["commune_dep_974",["proj4","EPSG:2975"]],["commune_dep_976",["proj4","EPSG:7075"]]]),n=[[i18next.t("app_page.sample_layer_box.target_layer"),""],[i18next.t("app_page.sample_layer_box.grandparismunicipalities"),"GrandParisMunicipalities"],[i18next.t("app_page.sample_layer_box.quartier_paris"),"quartier_paris"],[i18next.t("app_page.sample_layer_box.martinique"),"martinique"],[i18next.t("app_page.sample_layer_box.departements_2016_2-2"),"departements_2016_2-2"],[i18next.t("app_page.layout_layer_box.departements_vor_2016_2-2"),"departements_vor_2016_2-2"],[i18next.t("app_page.sample_layer_box.regions_2016_2-2"),"regions_2016_2-2"],[i18next.t("app_page.layout_layer_box.france_contour_2016_2-2"),"france_contour_2016_2-2"],[i18next.t("app_page.sample_layer_box.nuts2_data"),"nuts2-2013-data"],[i18next.t("app_page.sample_layer_box.brazil"),"brazil"],[i18next.t("app_page.sample_layer_box.world_countries"),"world_countries_data"],[i18next.t("app_page.sample_layer_box.communes_reg_11"),"communes_reg_11"],[i18next.t("app_page.sample_layer_box.communes_reg_24"),"communes_reg_24"],[i18next.t("app_page.sample_layer_box.communes_reg_27"),"communes_reg_27"],[i18next.t("app_page.sample_layer_box.communes_reg_28"),"communes_reg_28"],[i18next.t("app_page.sample_layer_box.communes_reg_32"),"communes_reg_32"],[i18next.t("app_page.sample_layer_box.communes_reg_44"),"communes_reg_44"],[i18next.t("app_page.sample_layer_box.communes_reg_52"),"communes_reg_52"],[i18next.t("app_page.sample_layer_box.communes_reg_53"),"communes_reg_53"],[i18next.t("app_page.sample_layer_box.communes_reg_75"),"communes_reg_75"],[i18next.t("app_page.sample_layer_box.communes_reg_76"),"communes_reg_76"],[i18next.t("app_page.sample_layer_box.communes_reg_84"),"communes_reg_84"],[i18next.t("app_page.sample_layer_box.communes_reg_93"),"communes_reg_93"],[i18next.t("app_page.sample_layer_box.communes_reg_94"),"communes_reg_94"],[i18next.t("app_page.sample_layer_box.commune_dep_971"),"commune_dep_971"],[i18next.t("app_page.sample_layer_box.commune_dep_972"),"commune_dep_972"],[i18next.t("app_page.sample_layer_box.commune_dep_973"),"commune_dep_973"],[i18next.t("app_page.sample_layer_box.commune_dep_974"),"commune_dep_974"],[i18next.t("app_page.sample_layer_box.commune_dep_976"),"commune_dep_976"],[i18next.t("app_page.sample_layer_box.voronoi_communes_2016_2-2"),"voronoi_communes_2016_2-2"],[i18next.t("app_page.layout_layer_box.nuts0"),"nuts0"],[i18next.t("app_page.layout_layer_box.nuts1"),"nuts1"],[i18next.t("app_page.layout_layer_box.nuts2"),"nuts2"],[i18next.t("app_page.sample_layer_box.world_countries"),"world_countries_data"],[i18next.t("app_page.layout_layer_box.world_countries"),"world_country"],[i18next.t("app_page.layout_layer_box.world_capitals"),"world_cities"],[i18next.t("app_page.layout_layer_box.tissot"),"tissot"]],a=void 0,r=void 0,o=void 0;function i(){l.selectAll("div").remove(),(o=l.append("div").attr("id","panel1")).append("h3").html(i18next.t("app_page.sample_layer_box.subtitle1"));var e=o.append("p").html("").insert("select").attr("class","sample_target");n.forEach(function(t){e.append("option").html(t[0]).attr("value",t[1])}),e.on("change",function(){a=this.value}),o.append("p").styles({margin:"auto","text-align":"right",cursor:"pointer"}).append("span").html(i18next.t("app_page.sample_layer_box.more_basemaps")).on("click",function(){!function(){l.selectAll("div").remove(),(o=l.append("div").attr("id","panel2")).append("h3").html(i18next.t("app_page.sample_layer_box.subtitle1")),o.append("p").append("span").html(i18next.t("app_page.sample_layer_box.extra_basemaps_info"));for(var e=o.append("p").insert("select").on("change",function(){var e=this.value;r=[_app.list_extrabasemaps[e][0],_app.list_extrabasemaps[e][1],e]}),t=0,n=_app.list_extrabasemaps.length;t<n;t++)e.append("option").attr("value",t).html(_app.list_extrabasemaps[t][0]);o.append("p").styles({margin:"auto","text-align":"right",cursor:"pointer"}).append("span").html(i18next.t("app_page.sample_layer_box.back_sample")).on("click",function(){i()}),r?(0,u.setSelected)(e.node(),r[2]):r=[_app.list_extrabasemaps[0][0],_app.list_extrabasemaps[0][1],0],o.select("#link1").on("click",function(){window.open("http://www.naturalearthdata.com","Natural Earth","toolbar=yes,menubar=yes,resizable=yes,scrollbars=yes,status=yes").focus()}),o.select("#link2").on("click",function(){window.open("https://github.com/riatelab/basemaps/tree/master/Countries","riatelab/basemaps","toolbar=yes,menubar=yes,resizable=yes,scrollbars=yes,status=yes").focus()})}()}),a&&(0,u.setSelected)(e.node(),a)}(0,d.make_confirm_dialog2)("sampleDialogBox",i18next.t("app_page.sample_layer_box.title")).then(function(n){n&&I().then(function(n){var i=n.indexOf("target")>-1;if("panel1"===o.attr("id")){if(a){var l=a.indexOf("communes_reg")>-1?["proj4","EPSG:2154"]:t.get(a),s=a.indexOf("communes_reg")>-1||a.indexOf("commune_dep")>1?e.get("FR_communes"):e.get(a);!function(e,t){var n=new FormData;n.append("layer_name",e),(0,u.xhrequest)("POST","sample",n,!0).then(function(e){U(e,t)}).catch(function(e){(0,u.display_error_during_computation)(),console.log(e)})}(a,{target_layer_on_add:i,fields_type:s,default_projection:l})}}else if("panel2"===o.attr("id")){var p=new FormData;p.append("url",r[1]),p.append("layer_name",r[0]),(0,u.xhrequest)("POST","/convert_extrabasemap",p,!0).then(function(e){U(e,{target_layer_on_add:i})},function(e){(0,u.display_error_during_computation)()})}},function(e){console.log(e)})});var l=d3.select(".sampleDialogBox").select(".modal-body");setTimeout(function(e){document.querySelector("select.sample_target").focus()},500),i()}function Z(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.skip_rescale||!1,n=e.stroke||"rgb(0,0,0)",a=e.fill||"#d3d3d3",r=e.stroke_opacity||0,o=e.fill_opacity||.75,i=e.stroke_width||"0.3px",l=!(!1===e.visible),s=e.drop_shadow||!1,p=encodeId("World");_app.layer_to_id.set("World",p),_app.id_to_layer.set(p,"World"),current_layers.World={type:"Polygon",n_features:125,"stroke-width-const":+i.slice(0,-2),fill_color:{single:a}},map.insert("g",".legend").attrs({id:p,class:"layer","clip-path":"url(#clip)"}).style("stroke-width",i).selectAll(".subunit").data(topojson.feature(j.world_topology,j.world_topology.objects.World).features).enter().append("path").attr("d",path).styles({stroke:n,fill:a,"stroke-opacity":r,"fill-opacity":o}),(0,u.create_li_layer_elem)("World",null,"Polygon","sample"),s&&createDropShadow("World"),t||(K("World"),Q("World")),l||se("World"),(0,b.zoom_without_redraw)()}function $(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:".accordion",t=arguments[1],n=t&&"object"===(void 0===t?"undefined":o(t))?t:t&&"string"==typeof t?document.querySelector(t):document,a=n.querySelectorAll(e),r=0;r<a.length;r++)a[r].onclick=function(){var t=n.querySelector(e+".active");t&&(t.classList.toggle("active"),t.nextElementSibling.classList.toggle("show")),t&&t.id===this.id||(this.classList.toggle("active"),this.nextElementSibling.classList.toggle("show"))}}function ee(){var e=Object.keys(user_data)[0];if(e){delete current_layers[e].targeted,field_join_map=[],user_data={},_app.targeted_layer_added=!1,_target_layer_file=null,te(),(0,u.getAvailablesFunctionnalities)();var t=_app.layer_to_id.get(e);return document.querySelector("."+t+".sortable_target").classList.remove("sortable_target"),e}}function te(){d3.select("#target_layer_zone").styles({"text-align":"center",border:"3px dashed #ccc",padding:"3px",color:"#ccc"}).html("Pas de couche cible"),document.getElementById("join_section").innerHTML="",document.getElementById("btn_type_fields").setAttribute("disabled","true"),(0,u.getAvailablesFunctionnalities)(),(0,_.reset_user_values)()}var ne=function(t){(0,k.get_map_template)().then(function(e){window.localStorage.removeItem("magrit_project"),e.length<55e5&&window.localStorage.setItem("magrit_project",e)}),t.returnValue=e._app.targeted_layer_added||Object.getOwnPropertyNames(result_data).length>0?"Confirm exit":void 0};function ae(e){document.getElementById(e||"btn_s3").dispatchEvent(new MouseEvent("click"))}function re(){var e=d3.select("#map_title").select("text");if(e.node()&&""!==e.text()){var t={size:e.style("font-size"),font_weight:e.style("font-weight"),font_style:e.style("font-style"),text_decoration:e.style("text-decoration"),color:e.style("fill"),position_x:e.attr("x"),position_x_pct:(0,m.round_value)(+e.attr("x")/w*100,1),position_y:e.attr("y"),position_y_pct:(0,m.round_value)(+e.attr("y")/h*100,1),font_family:e.style("font-family"),stroke:e.style("stroke"),stroke_width:e.style("stroke-width")};t.font_weight="400"===t.font_weight||""===t.font_weight?"":"bold",t.font_family=t.font_family?t.font_family.replace(", ",","):t.font_family,(0,d.make_confirm_dialog2)("mapTitleitleDialogBox",i18next.t("app_page.title_box.title"),{widthFitContent:!0}).then(function(n){n||e.attrs({x:t.position_x,y:t.position_y}).styles({fill:t.color,stroke:t.stroke,"stroke-width":t.stroke_width,"font-family":t.font_family,"font-size":t.size,"font-style":t.font_style,"font-weight":t.font_weight,"text-decoration":t.text_decoration})});var n=d3.select(".mapTitleitleDialogBox").select(".modal-body").append("div").style("margin","15x");n.append("p").html(i18next.t("app_page.title_box.font_size")).insert("input").attrs({type:"number",min:2,max:40,step:1}).property("value",+t.size.split("px")[0]).style("width","65px").on("change",function(){e.style("font-size",this.value+"px")}),n.append("p").html(i18next.t("app_page.title_box.xpos")).insert("input").attrs({type:"number",min:0,max:100,step:1}).property("value",t.position_x_pct).style("width","65px").on("change",function(){e.attr("x",w*+this.value/100)}),n.append("p").html(i18next.t("app_page.title_box.ypos")).insert("input").attrs({type:"number",min:0,max:100,step:1}).property("value",t.position_y_pct).style("width","65px").on("change",function(){e.attr("y",h*+this.value/100)}),n.append("p").html(i18next.t("app_page.title_box.font_color")).insert("input").attr("type","color").property("value",(0,c.rgb2hex)(t.color)).on("change",function(){e.style("fill",this.value)});var a=n.append("p").html(i18next.t("app_page.title_box.font_family")).insert("select").attr("class","params").on("change",function(){e.style("font-family",this.value)});available_fonts.forEach(function(e){a.append("option").text(e[0]).attr("value",e[1])}),a.node().selectedIndex=available_fonts.map(function(e){return e[1]===t.font_family?"1":"0"}).indexOf("1");var r=n.append("p"),o=r.insert("span").attr("class","bold"===t.font_weight?"active button_disc":"button_disc").html('<img title="Bold" src="data:image/gif;base64,R0lGODlhFgAWAID/AMDAwAAAACH5BAEAAAAALAAAAAAWABYAQAInhI+pa+H9mJy0LhdgtrxzDG5WGFVk6aXqyk6Y9kXvKKNuLbb6zgMFADs=">'),i=r.insert("span").attr("class","italic"===t.font_style?"active button_disc":"button_disc").html('<img title="Italic" src="data:image/gif;base64,R0lGODlhFgAWAKEDAAAAAF9vj5WIbf///yH5BAEAAAMALAAAAAAWABYAAAIjnI+py+0Po5x0gXvruEKHrF2BB1YiCWgbMFIYpsbyTNd2UwAAOw==">'),l=r.insert("span").attr("class","underline"===t.text_decoration?"active button_disc":"button_disc").html('<img title="Underline" src="data:image/gif;base64,R0lGODlhFgAWAKECAAAAAF9vj////////yH5BAEAAAIALAAAAAAWABYAAAIrlI+py+0Po5zUgAsEzvEeL4Ea15EiJJ5PSqJmuwKBEKgxVuXWtun+DwxCCgA7">');o.on("click",function(){this.classList.contains("active")?(this.classList.remove("active"),e.style("font-weight","")):(this.classList.add("active"),e.style("font-weight","bold"))}),i.on("click",function(){this.classList.contains("active")?(this.classList.remove("active"),e.style("font-style","")):(this.classList.add("active"),e.style("font-style","italic"))}),l.on("click",function(){this.classList.contains("active")?(this.classList.remove("active"),e.style("text-decoration","")):(this.classList.add("active"),e.style("text-decoration","underline"))});var s="none"!==t.stroke,p=n.append("p"),_=n.append("p").style("display",s?"":"none");n.append("p").style("clear","both"),p.append("input").attrs({type:"checkbox",id:"title_buffer_chkbox",checked:!!s||null}).on("change",function(){this.checked?(_.style("display",""),e.style("stroke",u.node().value).style("stroke-width",y.node().value+"px")):(_.style("display","none"),e.style("stroke","none").style("stroke-width","1px"))}),p.append("label").attrs({for:"title_buffer_chkbox"}).text(i18next.t("app_page.title_box.buffer"));var u=_.insert("input").style("float","left").attrs({type:"color"}).property("value",s?(0,c.rgb2hex)(t.stroke):"#ffffff").on("change",function(){e.style("stroke",this.value)});_.insert("span").style("float","right").html(" px");var y=_.insert("input").styles({float:"right",width:"60px"}).attrs({type:"number",step:"0.1"}).property("value",s?+t.stroke_width.replace("px",""):1).on("change",function(){e.style("stroke-width",this.value+"px")})}else swal({title:"",text:i18next.t("app_page.common.error_no_title"),type:"error",allowOutsideClick:!0,allowEscapeKey:!0}).then(function(){return null},function(){return null})}function oe(e){e[0]&&(w=+e[0],map.attr("width",w).call(b.zoom_without_redraw),map_div.style("width",w+"px"),w+360+33<window.innerWidth?document.querySelector(".light-menu").style.right="-33px":document.querySelector(".light-menu").style.right="0px"),e[1]&&(h=+e[1],map.attr("height",h).call(b.zoom_without_redraw),map_div.style("height",h+"px")),(0,v.move_legends)();var t=void 0,n=document.getElementById("select_png_format").value;if("web"===n)t=1;else{if("user_defined"!==n)return;t=118.11}svg_map.__zoom;document.getElementById("export_png_width").value=(0,y.Mround)(w*t*10)/10,document.getElementById("export_png_height").value=(0,y.Mround)(h*t*10)/10,document.getElementById("input-width").value=w,document.getElementById("input-height").value=h}function ie(e){var t=d3.select("#select_png_format");t.selectAll("option").remove(),t.append("option").attrs({value:"web",class:"i18n","data-i18n":"[text]app_page.section5b.web"}),t.append("option").attrs({value:"user_defined",class:"i18n","data-i18n":"[text]app_page.section5b.user_defined"}),"portrait"===e?(t.append("option").attrs({value:"A5_portrait",class:"i18n","data-i18n":"[text]app_page.section5b.A5_portrait"}),t.append("option").attrs({value:"A4_portrait",class:"i18n","data-i18n":"[text]app_page.section5b.A4_portrait"}),t.append("option").attrs({value:"A3_portrait",class:"i18n","data-i18n":"[text]app_page.section5b.A3_portrait"})):"landscape"===e&&(t.append("option").attrs({value:"A5_landscape",class:"i18n","data-i18n":"[text]app_page.section5b.A5_landscape"}),t.append("option").attrs({value:"A4_landscape",class:"i18n","data-i18n":"[text]app_page.section5b.A4_landscape"}),t.append("option").attrs({value:"A3_landscape",class:"i18n","data-i18n":"[text]app_page.section5b.A3_landscape"})),localize("#select_png_format > .i18n")}function le(){var t=d3.select("#info_features");if(t.classed("active"))map.selectAll(".layer").selectAll("path").on("mouseover",null),map.selectAll(".layer").selectAll("circle").on("mouseover",null),map.selectAll(".layer").selectAll("rect").on("mouseover",null),t.classed("active",!1),t.style("display","none").html(""),d3.select("#info_button").classed("active",!1),svg_map.style.cursor="";else{map.select(".brush").remove(),d3.select("#brush_zoom_button").classed("active",!1);for(var n=svg_map.querySelectorAll(".layer"),a=null,r=n.length-1;r>-1;r--)if("hidden"!==n[r].style.visibility){a=e._app.id_to_layer.get(n[r].id);break}if(!a)return void swal("",i18next.t("app_page.common.error_no_visible"),"error");var o="#"+e._app.layer_to_id.get(a),i=current_layers[a].symbol||"path";map.select(o).selectAll(i).on("mouseover",function(e,n){var r=["<h3>",a,"</h3><i>Feature ",n+1,"/",current_layers[a].n_features,"</i><p>"],o=result_data[a]?result_data[a][n]:e.properties;Object.getOwnPropertyNames(o).forEach(function(e){r.push("<br><b>"+e+"</b> : "+o[e])}),r.push("</p>"),t.style("display",null).html(r.join(""))}),map.select(o).selectAll(i).on("mouseout",function(){t.style("display","none").html("")}),t.classed("active",!0),svg_map.style.cursor="help",d3.select("#info_button").classed("active",!0)}}function se(t){var n=void 0,a=void 0,r=void 0,o=void 0;"active"===document.getElementById("info_features").className&&(le(),o=!0),t?a=(r=document.querySelector("#sortable ."+e._app.layer_to_id.get(t)+" .active_button")).parentElement:(a=(r=this).parentElement,t=a.parentElement.getAttribute("layer_name"));var i=function(){se(t)};if("eye_closed"===r.id){n=1;var l=pe("open");l.onclick=i,a.replaceChild(l,r)}else{n=0;var s=pe("closed");s.onclick=i,a.replaceChild(s,r)}map.select("#"+e._app.layer_to_id.get(t)).style("visibility",0===n?"hidden":"initial"),map.selectAll(".lgdf_"+e._app.layer_to_id.get(t)).style("visibility",0===n?"hidden":"initial"),o&&le()}function pe(e){if("open"===e){var t=document.createElement("img");return t.setAttribute("src","static/img/b/eye_open.png"),t.setAttribute("class","active_button i18n"),t.setAttribute("id","eye_open"),t.setAttribute("width",17),t.setAttribute("height",17),t.setAttribute("alt","Visible"),t}if("closed"===e){var n=document.createElement("img");return n.setAttribute("src","static/img/b/eye_closed.png"),n.setAttribute("class","active_button i18n"),n.setAttribute("id","eye_closed"),n.setAttribute("width",17),n.setAttribute("height",17),n.setAttribute("alt","Not visible"),n}}function ce(e){e=e||this.parentElement.parentElement.getAttribute("layer_name"),swal({title:"",text:i18next.t("app_page.common.remove_layer",{layer:e}),type:"warning",customClass:"swal2_custom",showCancelButton:!0,allowOutsideClick:!1,confirmButtonColor:"#DD6B55",confirmButtonText:i18next.t("app_page.common.delete")+"!",cancelButtonText:i18next.t("app_page.common.cancel")}).then(function(){_e(e)},function(){return null})}function de(){field_join_map=[],joined_dataset=[],dataset_name=void 0,d3.select("#ext_dataset_zone").styles({border:"3px dashed #ccc",color:"rgb(204, 204, 204)",padding:"3px","text-align":"center"}).html("Pas de jeu de donnée externe"),document.getElementById("join_section").innerHTML=""}function _e(t){if(current_layers[t]){var n,a,r=e._app.layer_to_id.get(t);current_layers[t].is_result&&(map.selectAll([".lgdf_",r].join("")).remove(),result_data.hasOwnProperty(t)&&delete result_data[t],current_layers[t].hasOwnProperty("key_name")&&current_layers[t].renderer.indexOf("Choropleth")<0&&current_layers[t].renderer.indexOf("Categorical")<0&&(n=t,(a=new FormData).append("layer_name",current_layers[n].key_name),(0,u.xhrequest)("POST","layers/delete",a,!0).then(function(e){var t=JSON.parse(e);t.code&&"Ok"===t.code||console.log(e)}).catch(function(e){console.log(e)})));var o=map.select("#"+r).attr("filter");o&&svg_map.querySelector(o.substr(4).replace(")","")).remove(),map.select("#"+r).remove(),document.querySelector("#sortable ."+r).remove();var i=document.getElementById("layer_to_export").querySelector('option[value="'+t+'"]');i&&i.remove(),!e._app.current_functionnality||"smooth"!==e._app.current_functionnality.name&&"grid"!==e._app.current_functionnality.name||Array.prototype.slice.call(document.querySelectorAll(".mask_field")).forEach(function(e){var n=e.querySelector('option[value="'+t+'"]');n&&n.remove()}),current_layers[t].targeted&&(e._app.current_functionnality&&(0,_.clean_menu_function)(),field_join_map=[],user_data={},e._app.targeted_layer_added=!1,te(),"def_proj4"===current_proj_name&&(current_proj_name="NaturalEarth2",(0,A.change_projection)(current_proj_name),(0,A.addLastProjectionSelect)(current_proj_name))),delete current_layers[t]}}function ue(t){var n=e._app.layer_to_id.get(t),a=d3.select("#sortable").select("."+n);a.on("dblclick",function(){(0,f.handle_click_layer)(t)}),a.on("contextmenu",function(){d3.event.preventDefault()}),a.select("#trash_button").on("click",function(){ce(t)}),a.select(".active_button").on("click",function(){se(t)}),a.select(".style_button").on("click",function(){(0,f.handle_click_layer)(t)}),a.select(".style_target_layer").on("click",function(){(0,f.handle_click_layer)(t)}),a.select("#legend_button").on("click",function(){(0,v.handle_legend)(t)}),a.select("#browse_data_button").on("click",function(){S.boxExplore2.create(t)}),a.select("#replace_button").on("click",function(){!function(e){ee(),current_layers[e].targeted=!0,_app.targeted_layer_added=!0,user_data[e]=Array.from(document.querySelector("#"+_app.layer_to_id.get(e)).querySelectorAll("path")).map(function(e){return e.__data__.properties});var t=Object.keys(user_data[e][0]);W(current_layers[e].type,t.length,current_layers[e].n_features,e),current_layers[e].fields_type||(current_layers[e].original_fields=new Set(t)),current_layers[e].fields_type||(current_layers[e].fields_type=(0,u.type_col2)(user_data[e])),document.getElementById("btn_type_fields").removeAttribute("disabled"),(0,u.getAvailablesFunctionnalities)(e),K(e),Q(e),(0,b.zoom_without_redraw)();var n=_app.layer_to_id.get(e);document.querySelector("#sortable > ."+n).classList.add("sortable_target");var a={};a[e]={type:"FeatureCollection",features:Array.prototype.slice.call(document.querySelectorAll("#"+n+" > path")).map(function(e){return e.__data__})},window._target_layer_file=topojson.topology(a),current_layers[e].key_name||send_layer_server(e,"/layers/add")}(t)}),a.select("#zoom_fit_button").on("click",function(){Q(t),(0,b.zoom_without_redraw)()})}function me(){var e=this.name;if(e!==i18next.language){docCookies.setItem("user_lang",e,31536e3,"/"),i18next.changeLanguage(e,function(){localize(".i18n"),(0,E.bindTooltips)()}),document.getElementById("current_app_lang").innerHTML=e;var t=document.getElementById("menu_lang");t&&t.remove()}}}).call(this,a(4),a(5))},function(e,t,n){"use strict";(function(e,a){Object.defineProperty(t,"__esModule",{value:!0}),t.isValidJSON=t.cloneObj=t.clickLinkFromDataUrl=t.getFieldsType=t.type_col2=t.type_col=t.drag_waffle=t.drag_elem_geo2=t.drag_elem_geo=t.createWaitingOverlay=t.isNumber=void 0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.setSelected=function(e,t){e.value=t,e.dispatchEvent(new Event("change"))},t.display_error_during_computation=p,t.request_data=function(e,t,n){return new a(function(a,r){var o=new XMLHttpRequest;o.open(e,t,!0),o.onload=a,o.onerror=r,o.send(n)})},t.xhrequest=c,t.getImgDataUrl=function(e){return new a(function(t,n){var a=new XMLHttpRequest;a.onload=function(){var e=new FileReader;e.onloadend=function(){t(e.result)},e.readAsDataURL(a.response)},a.onerror=function(e){n(e)},a.open("GET",e,!0),a.responseType="blob",a.send()})},t.make_content_summary=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6;return[i18next.t("app_page.stat_summary.population")," : ",(0,i.round_value)(e.pop(),t),"<br>",i18next.t("app_page.stat_summary.min")," : ",(0,i.round_value)(e.min(),t)," | ",i18next.t("app_page.stat_summary.max")," : ",(0,i.round_value)(e.max(),t),"<br>",i18next.t("app_page.stat_summary.mean")," : ",(0,i.round_value)(e.mean(),t),"<br>",i18next.t("app_page.stat_summary.median")," : ",(0,i.round_value)(e.median(),t),"<br>",i18next.t("app_page.stat_summary.variance")," : ",(0,i.round_value)(e.variance(),t),"<br>",i18next.t("app_page.stat_summary.stddev")," : ",(0,i.round_value)(e.stddev(),t),"<br>",i18next.t("app_page.stat_summary.cov")," : ",(0,i.round_value)(e.cov(),t)].join("")},t.copy_layer=function(t,n,a,r){var o=encodeId(n),i=e._app.layer_to_id.get(t),l=svg_map.querySelector("#"+i);e._app.layer_to_id.set(n,o),e._app.id_to_layer.set(o,n),svg_map.appendChild(l.cloneNode(!0)),svg_map.lastChild.setAttribute("id",o);var s=document.getElementById(o);svg_map.insertBefore(s,svg_map.querySelector(".legend")),result_data[n]=[],current_layers[n]={n_features:current_layers[t].n_features,type:current_layers[t].type,ref_layer_name:t},current_layers[t].pointRadius&&(current_layers[n].pointRadius=current_layers[t].pointRadius);var p=l.getElementsByTagName("path"),c=s.getElementsByTagName("path");if(r)for(var d=0;d<p.length;d++){c[d].__data__={type:"Feature",properties:{},geometry:g(p[d].__data__.geometry)};for(var u=r.length,m=0;m<u;m++){var y=r[m];c[d].__data__.properties[y]=p[d].__data__.properties[y]}result_data[n].push(c[d].__data__.properties)}else for(var f=0;f<p.length;f++)c[f].__data__=p[f].__data__,result_data[n].push(c[f].__data__.properties);s.className.baseVal="layer",s.style.visibility="",s.removeAttribute("filter"),_(n,current_layers[n].n_features,[current_layers[n].type,a],"result")},t.send_layer_server=function(t,n){var a=function(t){var n=["#",e._app.layer_to_id.get(t)].join(""),a=[];return d3.select(n).selectAll("path").each(function(e,t){a.push({type:"Feature",id:t,properties:e.properties,geometry:{type:e.type,coordinates:e.coordinates}})}),JSON.stringify({type:"FeatureCollection",crs:{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}},features:a})}(t),r=new FormData;r.append("geojson",a),r.append("layer_name",t),c("POST",n,r,!1).then(function(e){current_layers[t].key_name=JSON.parse(e).key}).catch(function(e){p(),console.log(e)})},t.get_other_layer_names=function(){var e=Object.getOwnPropertyNames(current_layers),t=null;(t=e.indexOf("Graticule"))>-1&&e.splice(t,1);(t=e.indexOf("World"))>-1&&e.splice(t,1);(t=e.indexOf("Sphere"))>-1&&e.splice(t,1);return e},t.get_display_name_on_layer_list=d,t.create_li_layer_elem=_,t.make_box_type_fields=function(e){(0,o.make_dialog_container)("box_type_fields",i18next.t("app_page.box_type_fields.title"),"dialog"),d3.select("#box_type_fields").select(".modal-dialog").style("width","500px");var t=d3.select("#box_type_fields").select(".modal-body"),n=u(user_data[e]),r=current_layers[e].fields_type,i=r.map(function(e){return e.name}),l=a.pending(),s=document.getElementById("box_type_fields"),p=function(){s.remove(),o.overlay_under_modal.hide(),document.removeEventListener("keydown",d)};if(0===i.length){r=n.slice(),s.querySelector(".btn_cancel").remove();s.querySelector("#xclose").onclick=function(){current_layers[e].fields_type=n.slice(),y(e),l.resolve(!1),p()}}else if(n.length>r.length){n.forEach(function(e){-1===i.indexOf(e.name)&&r.push(e)}),s.querySelector(".btn_cancel").remove();s.querySelector("#xclose").onclick=function(){current_layers[e].fields_type=n.slice(),y(e),l.resolve(!1),p()}}else{var c=function(){current_layers[e].fields_type=r,l.resolve(!1),p()};s.querySelector(".btn_cancel").onclick=c,s.querySelector("#xclose").onclick=c}function d(t){var a=t||window.event,r="key"in a?"Escape"===a.key||"Esc"===a.key:27===a.keyCode;r&&(a.stopPropagation(),current_layers[e].fields_type=n.slice(),y(e),l.resolve(!1),p())}s.querySelector(".btn_ok").onclick=function(){var t=[];Array.prototype.forEach.call(document.querySelectorAll("#fields_select > li"),function(e){t.push({name:e.childNodes[0].innerHTML.trim(),type:e.childNodes[1].value})}),l.resolve(!0),current_layers[e].fields_type=t.slice(),y(e),window.fields_handler&&(fields_handler.unfill(),fields_handler.fill(e)),p()},document.addEventListener("keydown",d),document.getElementById("btn_type_fields").removeAttribute("disabled"),t.append("h3").html(i18next.t("app_page.box_type_fields.message_invite"));var _=t.append("ul").attr("id","fields_select").styles({padding:"0","list-style":"none"});_.selectAll("li").data(r).enter().append("li"),_.selectAll("li").insert("span").html(function(e){return e.name}),_.selectAll("li").insert("select").style("float","right").selectAll("option").data(["id","stock","ratio","category","unknown"]).enter().insert("option").attr("value",function(e){return e}).text(function(e){return i18next.t("app_page.box_type_fields."+e)}).exit(),_.selectAll("select").each(function(e){this.value=e.type});for(var m=0;m<r.length;m++)("category"===r[m].type||r[m].not_number)&&(_.node().childNodes[m].childNodes[1].options.remove(2),_.node().childNodes[m].childNodes[1].options.remove(1)),r[m].has_duplicate&&_.node().childNodes[m].childNodes[1].options.remove(0);return o.overlay_under_modal.display(),setTimeout(function(e){s.querySelector("button.btn_ok").focus()},400),l.promise},t.getAvailablesFunctionnalities=y,t.prepareFileExt=function(e){return Array.prototype.forEach.call(e,function(e){if(e._ext="",e.name.indexOf(".")>-1){var t=e.name.substring(0,e.name.lastIndexOf(".")),n=e.name.substring(e.name.lastIndexOf(".")+1,e.name.length);e._name=[t,n.toLowerCase()].join("."),e._ext=n.toLowerCase()}}),e},t.accordionize2=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:".accordion",t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:document).querySelectorAll(e),n=0;n<t.length;n++)t[n].onclick=function(){this.classList.toggle("active"),this.nextElementSibling.classList.toggle("show")}};var o=n(1),i=n(7),l=n(2),s=n(25);t.isNumber=function(e){return null!=e&&""!==e&&isFinite(e)&&!Number.isNaN(+e)},t.createWaitingOverlay=function(){var t=document.createElement("div");t.id="overlay",t.style.display="none",t.innerHTML='\n<img src="static/img/logo_magrit.png" alt="Magrit" style="left: 15px;position: absolute;" width="auto" height="26">\n<span class="i18n" style="z-index: 2; margin-top:85px; display: inline-block;" data-i18n="[html]app_page.common.loading_results"></span>\n<span style="z-index: 2;">...<br></span>\n<div class="spinner">\n  <div class="rect1"></div>\n  <div class="rect2"></div>\n  <div class="rect3"></div>\n  <div class="rect4"></div>\n  <div class="rect5"></div>\n</div>\n<span class="i18n" style="z-index: 2;display: inline-block; margin-bottom: 20px;" data-i18n="[html]app_page.common.long_computation"></span><br>';var n=document.createElement("button");return n.style.fontSize="13px",n.style.background="#4b9cdb",n.style.border="1px solid #298cda",n.style.fontWeight="bold",n.className="button_st3 i18n",n.setAttribute("data-i18n","[html]app_page.common.cancel"),t.appendChild(n),document.body.appendChild(t),n.onclick=function(){e._app.xhr_to_cancel&&(e._app.xhr_to_cancel.abort(),e._app.xhr_to_cancel=void 0),e._app.webworker_to_cancel&&(e._app.webworker_to_cancel.onmessage=null,e._app.webworker_to_cancel.terminate(),e._app.webworker_to_cancel=void 0),t.style.display="none"},{display:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.style.display="",e.cancel_button&&!1===e.cancel_button&&(n.style.display="none"),e.zIndex&&(t.style.zIndex=e.zIndex)},hide:function(){t.style.display="none",t.style.zIndex="",n.style.display=""}}},t.drag_elem_geo=d3.drag().subject(function(){var e=d3.select(this);return{x:e.attr("x"),y:e.attr("y"),map_locked:!!map_div.select("#hand_button").classed("locked")}}).on("start",function(){d3.event.sourceEvent.stopPropagation(),d3.event.sourceEvent.preventDefault(),(0,l.handle_click_hand)("lock")}).on("end",function(){d3.event.subject&&!d3.event.subject.map_locked&&(0,l.handle_click_hand)("unlock")}).on("drag",function(){d3.select(this).attr("x",d3.event.x).attr("y",d3.event.y)}),t.drag_elem_geo2=d3.drag().filter(function(){return current_layers[e._app.id_to_layer.get(this.parentElement.id)].draggable}).subject(function(){var t=current_layers[e._app.id_to_layer.get(this.parentElement.id)].symbol,n=d3.select(this);return"rect"===t?{x:n.attr("x"),y:n.attr("y"),symbol:t,map_locked:!!map_div.select("#hand_button").classed("locked")}:"circle"===t?{x:n.attr("cx"),y:n.attr("cy"),symbol:t,map_locked:!!map_div.select("#hand_button").classed("locked")}:void 0}).on("start",function(){d3.event.sourceEvent.stopPropagation(),d3.event.sourceEvent.preventDefault(),(0,l.handle_click_hand)("lock");var e=svg_map.__zoom,t=path.centroid(this.__data__.geometry);t[0]=t[0]*e.k+e.x,t[1]=t[1]*e.k+e.y,map.append("rect").attrs({x:t[0]-2,y:t[1]-2,height:4,width:4,id:"ref_symbol_location"}).style("fill","red")}).on("end",function(){d3.event.subject&&!d3.event.subject.map_locked&&(0,l.handle_click_hand)("unlock"),map.selectAll("#ref_symbol_location").remove()}).on("drag",function(){"rect"===d3.event.subject.symbol?d3.select(this).attr("x",d3.event.x).attr("y",d3.event.y):"circle"===d3.event.subject.symbol&&d3.select(this).attr("cx",d3.event.x).attr("cy",d3.event.y)}),t.drag_waffle=d3.drag().filter(function(){return current_layers[e._app.id_to_layer.get(this.parentElement.id)].draggable}).subject(function(){var e=d3.select(this),t=e.attr("transform");return t=t?t.slice(10,-1).split(/[ ,]+/).map(function(e){return+e}):[0,0],{x:e.attr("x")+t[0],y:e.attr("y")+t[1],map_locked:!!map_div.select("#hand_button").classed("locked")}}).on("start",function(){d3.event.sourceEvent.stopPropagation(),d3.event.sourceEvent.preventDefault(),(0,l.handle_click_hand)("lock")}).on("end",function(){d3.event.subject&&!d3.event.subject.map_locked&&(0,l.handle_click_hand)("unlock"),d3.select(this).style("cursor","grab")}).on("drag",function(){d3.select(this).attr("transform","translate("+[d3.event.x,d3.event.y]+")").style("cursor","grabbing")});function p(e){var t=t?"<br><i>"+i18next.t("app_page.common.details")+":</i> "+e:"";swal({title:i18next.t("app_page.common.error")+"!",text:""+i18next.t("app_page.common.error_message")+e,customClass:"swal2_custom",type:"error",allowOutsideClick:!1})}function c(t,n,r,o){return o&&e._app.waitingOverlay.display(),new a(function(a,i){var l=new XMLHttpRequest;e._app.xhr_to_cancel=l,l.open(t,n,!0),l.onload=function(t){a(t.target.responseText),e._app.xhr_to_cancel=void 0,o&&e._app.waitingOverlay.hide()},l.onerror=function(t){i(t),e._app.xhr_to_cancel=void 0,o&&e._app.waitingOverlay.hide()},l.send(r)})}function d(e){return+e.length>40?[e.substring(0,37),"(...)"].join(""):e}function _(e,t,n,a){var r=d(e),o=encodeId(e),i=layer_list.node(),p=document.createElement("li");if(p.setAttribute("layer_name",e),"result"===a){p.setAttribute("class",["sortable_result ",o].join(""));var c=void 0;current_layers[e].symbol&&"path"!==current_layers[e].symbol||(c=s.button_replace),p.innerHTML=[r,'<div class="layer_buttons">',s.button_trash,s.sys_run_button_t2,s.button_zoom_fit,s.button_table,s.eye_open0,s.button_legend,s.button_result_type.get(n[1]),c,"</div> "].join("")}else"sample"===a&&(p.setAttribute("class",["sortable ",o].join("")),p.innerHTML=[r,'<div class="layer_buttons">',s.button_trash,s.sys_run_button_t2,s.button_zoom_fit,s.button_table,s.eye_open0,s.button_type.get(n),s.button_replace,"</div> "].join(""));i.insertBefore(p,i.childNodes[0]),(0,l.binds_layers_buttons)(e)}t.type_col=function(e,t){for(var n=user_data.hasOwnProperty(e)?user_data[e]:result_data.hasOwnProperty(e)?result_data[e]:joined_dataset[0],a=Object.getOwnPropertyNames(n[0]),o=n.length,i=o>100?100:o-1,l={},s=void 0,p=void 0,c=0,d=a.length;c<d;++c){s=a[c],l[s]=[];for(var _=0;_<i;++_)"string"===(p=r(n[_][s]))&&0===n[_][s].length?p="empty":"string"===p&&!isNaN(Number(n[_][s]))||"number"===p?p="number":"object"===p&&isFinite(n[_][s])&&(p="empty"),l[a[c]].push(p)}for(var u=0,m=a.length;u<m;++u)s=a[u],l[s].every(function(e){return"number"===e||"empty"===e})&&l[s].indexOf("number")>-1?l[s]="number":l[s]="string";if(t){var y=[];return Object.keys(l).forEach(function(e){l[e]===t&&"_uid"!==e&&y.push(e)}),y}return l};var u=t.type_col2=function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];var n=[],a=e.length,o={},i={},l=t,s=void 0,p=void 0;l?(p=[l],l=void 0):(p=Object.getOwnPropertyNames(e[0]).filter(function(e){return"_uid"!==e}),l=void 0);for(var c=0,d=p.length;c<d;++c){o[l=p[c]]=[],i[l]=!1;for(var _={},u=0;u<a;++u){var m=e[u][l];if(_[m]?i[l]=!0:_[m]=!0,"object"===(s=void 0===m?"undefined":r(m))&&isFinite(m))s="empty";else if("string"===s&&0===m.length)s="empty";else if("string"===s&&!isNaN(Number(m))||"number"===s){var y=Number(m);s=(0|y)===m?"stock":(0|y)==+m?"stock":"ratio"}o[p[c]].push(s)}}for(var g=0,f=0,h=p.length;f<h;++f){var v=i[l=p[f]];("id"===l.toLowerCase()||l.toLowerCase().indexOf("name")>-1||l.toLowerCase().indexOf("nom")>-1)&&!v?(n.push({name:l,type:"id",has_duplicate:v}),g+=1):l.toLowerCase().indexOf("id")>-1&&g<1&&!v?(n.push({name:l,type:"id",has_duplicate:v}),g+=1):!v&&g<1&&o[l].every(function(e){return"string"===e||"stock"===e})?(n.push({name:l,type:"id",has_duplicate:v}),g+=1):o[l].every(function(e){return"string"===e})&&!v?(n.push({name:l,type:"id",has_duplicate:v}),g+=1):o[l].every(function(e){return"stock"===e||"empty"===e})&&o[l].indexOf("stock")>-1?n.push({name:l,type:"stock",has_duplicate:v}):o[l].every(function(e){return"string"===e||"empty"===e})&&o[l].indexOf("string")>-1?n.push({name:l,type:"category",has_duplicate:v}):o[l].every(function(e){return"ratio"===e||"stock"===e||"empty"===e})&&o[l].indexOf("ratio")>-1?n.push({name:l,type:"ratio"}):n.push({name:l,type:"unknown",has_duplicate:v})}return n},m=t.getFieldsType=function(e,t,n){if(!t&&!n)return null;var a=n||current_layers[t].fields_type;return a?a.filter(function(t){return t.type===e}).map(function(e){return e.name}):[]};function y(e){var t=document.getElementById("section2_pre");if(e){var n=m("stock",e),a=m("ratio",e),r=m("category",e),o=m("id",e),i=void 0,l=void 0,s=void 0,p=void 0;if("Line"===current_layers[e].type){for(var c=t.querySelectorAll("#button_grid, #button_discont, #button_smooth, #button_cartogram, #button_typosymbol, #button_flow"),d=0,_=c.length;d<_;d++)c[d].style.filter="grayscale(100%)";p=[],i=t.querySelectorAll("#button_prop"),l=t.querySelectorAll("#button_choro, #button_choroprop"),s=t.querySelectorAll("#button_typo, #button_proptypo")}else if("Point"===current_layers[e].type){for(var u=t.querySelectorAll("#button_discont, #button_cartogram"),y=0,g=u.length;y<g;y++)u[y].style.filter="grayscale(100%)";p=t.querySelectorAll("#button_flow"),i=t.querySelectorAll("#button_smooth, #button_prop, #button_grid"),l=t.querySelectorAll("#button_choro, #button_choroprop"),s=t.querySelectorAll("#button_typo, #button_proptypo, #button_typosymbol")}else p=t.querySelectorAll("#button_flow"),i=t.querySelectorAll("#button_smooth, #button_prop, #button_grid, #button_cartogram, #button_discont"),l=t.querySelectorAll("#button_choro, #button_choroprop, #button_discont"),s=t.querySelectorAll("#button_typo, #button_proptypo, #button_typosymbol");0===n.length?Array.prototype.forEach.call(i,function(e){return e.style.filter="grayscale(100%)"}):Array.prototype.forEach.call(i,function(e){return e.style.filter="invert(0%) saturate(100%)"}),0===a.length?Array.prototype.forEach.call(l,function(e){return e.style.filter="grayscale(100%)"}):Array.prototype.forEach.call(l,function(e){return e.style.filter="invert(0%) saturate(100%)"}),0===r.length?Array.prototype.forEach.call(s,function(e){return e.style.filter="grayscale(100%)"}):Array.prototype.forEach.call(s,function(e){return e.style.filter="invert(0%) saturate(100%)"}),0===o.length?Array.prototype.forEach.call(p,function(e){return e.style.filter="grayscale(100%)"}):Array.prototype.forEach.call(p,function(e){return e.style.filter="invert(0%) saturate(100%)"}),0===n.length||0===a.length?document.getElementById("button_choroprop").style.filter="grayscale(100%)":document.getElementById("button_choroprop").style.filter="invert(0%) saturate(100%)",0===n.length||0===r.length?document.getElementById("button_proptypo").style.filter="grayscale(100%)":document.getElementById("button_proptypo").style.filter="invert(0%) saturate(100%)","Polygon"===current_layers[e].type&&(n.length>0||a.length>0)?document.getElementById("button_discont").style.filter="invert(0%) saturate(100%)":document.getElementById("button_discont").style.filter="grayscale(100%)",n.length<2?document.getElementById("button_two_stocks").style.filter="grayscale(100%)":document.getElementById("button_two_stocks").style.filter="invert(0%) saturate(100%)"}else for(var f=t.querySelectorAll("#button_grid, #button_discont, #button_smooth, #button_cartogram, #button_typosymbol, #button_flow, #button_prop, #button_choro, #button_choroprop, #button_typo, #button_proptypo, #button_two_stocks"),h=0,v=f.length;h<v;h++)f[h].style.filter="grayscale(100%)"}t.clickLinkFromDataUrl=function(e,t){return fetch(e).then(function(e){return e.blob()}).then(function(e){var n=URL.createObjectURL(e),a=document.createElement("a");a.setAttribute("href",n),a.setAttribute("download",t),window.isIE?swal({title:"",html:'<div class="link_download"><p>'+i18next.t("app_page.common.download_link")+"</p></div>",showCancelButton:!0,showConfirmButton:!1,allowEscapeKey:!1,allowOutsideClick:!1,cancelButtonText:i18next.t("app_page.common.close"),animation:"slide-from-top",onOpen:function(){a.innerHTML=t,document.getElementsByClassName("link_download")[0].appendChild(a)},onClose:function(){URL.revokeObjectURL(n)}}).then(function(e){return null},function(e){return null}):(a.style.display="none",document.body.appendChild(a),a.click(),a.remove(),URL.revokeObjectURL(n))})};var g=t.cloneObj=function(e){return null===e||"object"!==(void 0===e?"undefined":r(e))?e:"[object Map]"===e.toString()?new Map(e.entries()):Object.assign({},e)};t.isValidJSON=function(e){try{return[!0,JSON.parse(e)]}catch(e){return[!1,e]}}}).call(this,n(4),n(5))},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Mmax=Math.max,t.Mmin=Math.min,t.Mabs=Math.abs,t.Mpow=Math.pow,t.Msqrt=Math.sqrt,t.Mround=Math.round,t.Mceil=Math.ceil},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PropSizer=t.get_precision_axis=t.round_value=t.contains_empty_val=void 0;t.min_fast=function(e){for(var t=e[0],n=1,a=e.length;n<a;++n){var r=+e[n];r&&r<t&&(t=r)}return t},t.max_fast=l,t.has_negative=function(e){for(var t=0;t<e.length;++t)if(+e[t]<0)return!0;return!1},t.get_nb_decimals=function(e){var t=e.toString().split(".");return t.length<2?0:t[1].length},t.get_nb_left_separator=function(e){return e.toString().split(".")[0].length},t.getDecimalSeparator=function(){return 1.1.toLocaleString().substr(1,1)},t.prop_sizer3_e=function(e,t,n,a){var r=Math.PI,o=Math.abs,i=Math.sqrt,s=e.length,p=[];t&&0!==t||(t=l(e));if("circle"===a)for(var c=n*n*r,d=c/t,_=0;_<s;++_)p.push(i(o(e[_])*d)/r);else if("line"===a)for(var u=n/t,m=0;m<s;++m)p.push(o(e[m])*u);else for(var y=n*n,g=y/t,f=0;f<s;++f)p.push(i(o(e[f])*g));return p},t.getBinsCount=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=e.filter(function(e){return e}).sort(function(e,t){return e-t}),r=n.length,o=n[0],i=n[r-1],l=(i-o)/t,s=new Array(t),p=[o],c=(r+1)/2,d=0,_=0;_<t;_++)p.push(p[_]+l);for(var u=1,m=0;u<r;u++){var y=p[u-1];for(s[u-1]=0;n[m]<=y;)d+=n[m],s[u-1]+=1,m+=1}var g=d/r,f=function(e,t){for(var n=e.length,r=0,o=0;o<n;o++)r+=Math.pow(e[o]-t,2);return(0,a.Msqrt)(1/n*r)}(n,g);return{breaks:p,counts:s,min:o,max:i,mean:g,median:(0|c)===c?n[c]:(n[Math.floor(c)]+n[Math.ceil(c)])/2,stddev:f}},t.haversine_dist=function(e,t){var n=Math.PI/180,l=+e[0],s=+e[1],p=+t[0],c=+t[1],d=(p-l)*n,_=(c-s)*n,u=r(d/2)*r(d/2)+o(l*n)*o(p*n)*r(_/2)*r(_/2);return 12742*i((0,a.Msqrt)(u),(0,a.Msqrt)(1-u))},t.coslaw_dist=function(e,t){var n=Math.PI/180,a=+e[0],r=+e[1],o=+t[0],i=+t[1],l=a*n,s=o*n,p=(i-r)*n;return 6371*Math.acos(Math.sin(l)*Math.sin(s)+Math.cos(l)*Math.cos(s)*Math.cos(p))},t.getTranslateNewLegend=function(){var e=svg_map.querySelectorAll(".legend_feature");if(0===e.length)return{x:0,y:0};try{return function(e){function t(e,t){return e.x>t.x||e.y>t.y?0:(t.x+1-e.x)*(t.y+1-e.y)}function n(e,t){for(var n=0;n<c;n++)1===d[e][n]?t[n]++:t[n]=0}function a(e,t){for(var n=e[0];n<e[1];n++)for(var a=t[0];a<t[1];a++)d[n][a]=0}var r=get_map_xy0(),o=r.x,i=r.y,l=100,s=40;o=Math.floor(o),i=Math.floor(i);for(var p=Math.floor(w),c=Math.floor(h),d=[],_=0;_<p;_++){d.push([]);for(var u=0;u<c;u++)d[_].push(1)}for(var m=0;m<e.length;m++){var y=e[m].getBoundingClientRect(),g=Math.floor(y.left-o),f=Math.floor(y.top-i);g<0&&(g=0),f<0&&(f=0);var v=g+Math.floor(y.width)>=p?p-1:g+Math.floor(y.width),b=f+Math.floor(y.height)>=c?c-1:f+Math.floor(y.height);a([g,v],[f,b])}return function(){for(var e=new Array(c+1),a=[],r={x:-1,y:-1},o={x:-1,y:-1},i=0;i<e.length;i++)e[i]=0;for(var d=p-1;d>=0;d--){n(d,e);for(var _=0,u=0;u<c+1;u++)if(e[u]>_&&(a.push({y:u,width:_}),_=e[u]),e[u]<_){for(var m=void 0,y=void 0;;){var g=a.pop();if(m=g.y,y=g.width,_*(u-m)>t(r,o)&&u-m>=l&&_>=s&&(r={x:d,y:m},o={x:d+_-1,y:u-1}),_=y,e[u]>=_)break}0!==(_=e[u])&&a.push({y:m,width:y})}}return{x:r.x,y:r.y,lenX:o.x-r.x+1,lenY:o.y-r.y+1,area:t(r,o)}}()}(e)}catch(e){return console.log(e),{x:0,y:0}}};var a=n(6),r=Math.sin,o=Math.cos,i=Math.atan2;function l(e){for(var t=e[0],n=1,a=e.length;n<a;++n){var r=+e[n];r>t&&(t=r)}return t}t.contains_empty_val=function(e){for(var t=e.length-1;t>-1;--t){if(null==e[t])return!0;if(isNaN(+e[t]))return!0}return!1};t.round_value=function(e,t){if(void 0===t)return e;var n=+["1",Array((0,a.Mabs)(t)).fill("0").join("")].join("");return t>=0?(0,a.Mround)(+e*n)/n:(0,a.Mround)(+e/n)*n};t.get_precision_axis=function(e,t,n){var a=t-e;return t>1&&a>100?".0f":a>10?0===n?".0f":".1f":a>1?n<2?".1f":".2f":a>.1?".3f":a>.01?".4f":a>.001?".5f":a>1e-4?".6f":a>1e-5?".7f":".8f"},t.PropSizer=function(e,t,n){var a=this;this.fixed_value=e;var r=Math.sqrt,o=Math.abs,i=Math.PI;"circle"===n?(this.smax=t*t*i,this.scale=function(e){return r(o(e)*a.smax/a.fixed_value)/i},this.get_value=function(e){return Math.pow(e*i,2)/a.smax*a.fixed_value}):"line"===n?(this.smax=t,this.scale=function(e){return o(e)*a.smax/a.fixed_value},this.get_value=function(e){return e/a.smax*a.fixed_value}):(this.smax=t*t,this.scale=function(e){return r(o(e)*a.smax/a.fixed_value)},this.get_value=function(e){return Math.pow(e,2)/a.smax*a.fixed_value})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addNewCustomPalette=t.randomColor=t.ColorsSelected=t.Colors=t.interpolateColor=t.interp_n=t.getColorBrewerArray=void 0,t.rgb2hex=l,t.hexToRgb=s;var a,r=n(27),o=(a=r)&&a.__esModule?a:{default:a};t.getColorBrewerArray=function(e,t){if(e<10&&e>=3)return o.default[t][e];if(e<3){var n=o.default[t][3];return[l(c(s(n[0]),s(n[1]))),l(c(s(n[1]),s(n[2])))]}if(e>9&&e<18){var a=o.default[t][9];return i(a,e-9,9)}if(e>=18){var r=o.default[t][9];return r=i(r,8,9),i(r,e-r.length,e)}};var i=t.interp_n=function(e,t,n){for(var a=[],r=[],o=0;o<t;++o)a.push(l(c(s(e[o]),s(e[o+1]))));for(var i=0;i<n;++i)r.push(e[i]),a[i]&&r.push(a[i]);return r};function l(e){if("string"==typeof e){if(e.indexOf("#")>-1||e.indexOf("rgb")<0)return e;var t=e.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);return t&&4===t.length?"#"+("0"+parseInt(t[1],10).toString(16)).slice(-2)+("0"+parseInt(t[2],10).toString(16)).slice(-2)+("0"+parseInt(t[3],10).toString(16)).slice(-2):""}return e&&3===e.length?"#"+("0"+parseInt(e[0],10).toString(16)).slice(-2)+("0"+parseInt(e[1],10).toString(16)).slice(-2)+("0"+parseInt(e[2],10).toString(16)).slice(-2):""}function s(e,t){var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return"string"===t?n?"rgb("+parseInt(n[1],16)+","+parseInt(n[2],16)+","+parseInt(n[3],16)+")":null:n?[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)]:null}var p,c=t.interpolateColor=function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5,a=e.slice(),r=0;r<3;r++)a[r]=Math.round(a[r]+n*(t[r]-e[r]));return a};t.Colors={names:{aqua:"#00ffff",azure:"#f0ffff",beige:"#f5f5dc",black:"#000000",blue:"#0000ff",brown:"#a52a2a",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkviolet:"#9400d3",fuchsia:"#ff00ff",gold:"#ffd700",green:"#008000",indigo:"#4b0082",khaki:"#f0e68c",lightblue:"#add8e6",lightcyan:"#e0ffff",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightyellow:"#ffffe0",lime:"#00ff00",magenta:"#ff00ff",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#ffa500",pink:"#ffc0cb",purple:"#800080",violet:"#800080",red:"#ff0000",silver:"#c0c0c0",white:"#ffffff",yellow:"#ffff00"},random:function(){for(var e=Object.keys(this.names),t=e.length,n=0,a=0,r=0;r<t;r++){var o=e[r];a+=1,Math.random()<1/a&&(n=o)}return n}},t.ColorsSelected={colorCodes:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc","#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"],seen:new Set,random:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.colorCodes.length,n=this.seen,a=this.colorCodes[0],r=40;for(n.size===t&&(n=new Set);r>0;){var o=Math.round(Math.random()*(t-1));if(a=this.colorCodes[o],!n.has(a)){n.add(a);break}r-=1}return e?s(a):a}},t.randomColor=(p=Math.random(),function(){return p+=.618033988749895,function(e,t,n){var a=void 0,r=void 0,o=void 0;if(0===t)a=r=o=n;else{var i=function(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e},l=n<.5?n*(1+t):n+t-n*t,s=2*n-l;a=i(s,l,e+1/3),r=i(s,l,e),o=i(s,l,e-1/3)}return"#"+Math.round(255*a).toString(16)+Math.round(255*r).toString(16)+Math.round(255*o).toString(16)}(p%=1,.5,.6)}),t.addNewCustomPalette=function(e,t){_app.custom_palettes.set(e,t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){this.items=[],this.addItem=function(e){this.items.push({isSimpleItem:!0,name:e.name,action:e.action})},this.addSubMenu=function(e){this.items.push({isSimpleItem:!1,name:e.name,menu:new ContextMenu}),this.items[this.items.length-1].menu.setItems(e.items)},this.removeItemByName=function(e){for(var t=this.items.length-1;t>0;t--)if(this.items[t].name.valueOf()===e.valueOf()){this.items.splice(t,1);break}},this.setItems=function(e){this.items=[];for(var t=0;t<e.length;t++)e[t].name&&(e[t].action?this.addItem(e[t]):e[t].items&&this.addSubMenu(e[t]))},this.showMenu=function(e,t,n){var a=this;n&&this.setItems(n),e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),this.initMenu(t);var r=this.DOMObj.getBoundingClientRect();e.clientY+window.scrollY+r.height<window.innerHeight||e.clientX+r.width<window.innerWidth?(this.DOMObj.style.top=e.clientY+window.scrollY+"px",this.DOMObj.style.left=e.clientX+"px"):(this.DOMObj.style.top=e.clientY+window.scrollY-r.height+"px",this.DOMObj.style.left=e.clientX-r.width+"px");var o=function e(){a.DOMObj&&a.DOMObj.parentNode&&a.DOMObj.parentNode.removeChild&&a.DOMObj.parentNode.removeChild(a.DOMObj),a.onclick=void 0,document.removeEventListener("click",e),document.removeEventListener("drag",e)};setTimeout(function(){document.addEventListener("click",o),document.removeEventListener("drag",o)},225)},this.initMenu=function(e){this.DOMObj&&this.DOMObj.parentNode&&this.DOMObj.parentNode.removeChild&&this.DOMObj.parentNode.removeChild(this.DOMObj);var t=this,n=document.createElement("div");n.className="context-menu";var a=document.createElement("ul");n.appendChild(a);for(var r=0;r<this.items.length;r++){var o=document.createElement("li");a.appendChild(o),o.setAttribute("data-index",r);var i=document.createElement("span");if(i.className="context-menu-item-name",i.textContent=this.items[r].name,o.appendChild(i),this.items[r].isSimpleItem)o.onclick=function(){var e=this.getAttribute("data-index");t.items[e].action()};else{var l=document.createElement("span");l.className="arrow",l.innerHTML="&#9658;",i.appendChild(l),this.items[r].menu.initMenu(o),this.items[r].menu.DOMObj.style.display="none",o.onmouseover=function(){var e=this;setTimeout(function(){e.querySelectorAll(".context-menu")[0].style.display=""},500)},o.onmouseout=function(){var e=this;setTimeout(function(){e.querySelectorAll(".context-menu")[0].style.display="none"},500)}}}this.DOMObj=n,e.appendChild(n)}},n(45)},,function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.zoom_without_redraw=i,t.reproj_symbol_layer=function(){for(var t=Object.keys(current_layers),n=t.length,a=void 0,r=0;r<n;r++)if(a=t[r],current_layers[a].renderer&&(current_layers[a].renderer.indexOf("PropSymbol")>-1||current_layers[a].renderer.indexOf("TypoSymbols")>-1||current_layers[a].renderer.indexOf("Label")>-1)){var o=current_layers[a].symbol;"text"===o?map.select("#"+e._app.layer_to_id.get(a)).selectAll(o).attrs(function(e){var t=path.centroid(e.geometry);return{x:t[0],y:t[1]}}):"image"===o?map.select("#"+e._app.layer_to_id.get(a)).selectAll(o).attrs(function(e,t){var n=path.centroid(e.geometry),a=+this.getAttribute("width").replace("px","")/2;return{x:n[0]-a,y:n[1]-a}}):"circle"===o?map.select("#"+e._app.layer_to_id.get(a)).selectAll(o).style("display",function(e){return isNaN(+path.centroid(e)[0])?"none":void 0}).attrs(function(e){var t=path.centroid(e);return{r:e.properties.prop_value,cx:t[0],cy:t[1]}}):"rect"===o&&map.select("#"+e._app.layer_to_id.get(a)).selectAll(o).style("display",function(e){return isNaN(+path.centroid(e)[0])?"none":void 0}).attrs(function(e){var t=path.centroid(e),n=e.properties.prop_value;return{height:n,width:n,x:t[0]-n/2,y:t[1]-n/2}})}else if(void 0!==current_layers[a].pointRadius)map.select("#"+e._app.layer_to_id.get(a)).selectAll("path").attr("d",path.pointRadius(current_layers[a].pointRadius));else if("TwoStocksWaffle"===current_layers[a].renderer){var i=svg_map.querySelector("#"+e._app.layer_to_id.get(a)).querySelectorAll("g"),l=i.length;if("circle"===current_layers[a].symbol)for(var s=0;s<l;s++)for(var p=path.centroid({type:"Point",coordinates:i[s].__data__.properties.centroid}),c=i[s].querySelectorAll("circle"),d=0,_=c.length;d<_;d++)c[d].setAttribute("cx",p[0]),c[d].setAttribute("cy",p[1]);else for(var u=0;u<l;u++)for(var m=path.centroid({type:"Point",coordinates:i[u].__data__.properties.centroid}),y=i[u].querySelectorAll("rect"),g=0,f=y.length;g<f;g++)y[g].setAttribute("x",m[0]),y[g].setAttribute("y",m[1])}},t.rotate_global=function(e){canvas_rotation_value=["rotate(",e,")"].join("");var t=d3.zoomTransform(svg_map);if(map.selectAll("g.layer").transition().duration(10).attr("transform",canvas_rotation_value+",translate("+[t.x,t.y]+"),scale("+t.k+")"),northArrow.displayed){var n=isNaN(+northArrow.svg_node.attr("rotate"))?0:+northArrow.svg_node.attr("rotate");northArrow.svg_node.attr("transform","rotate("+(+e+n)+","+northArrow.x_center+", "+northArrow.y_center+")")}i()},t.redraw_legends_symbols=l,t.zoomClick=function(){if(map_div.select("#hand_button").classed("locked"))return;var e="zoom_in"===this.id?1:-1,t=[w/2,h/2],n=d3.zoomTransform(svg_map),a=[n.x,n.y],r={x:a[0],y:a[1],k:n.k},o=1,l=[],s=[];d3.event.preventDefault(),o=n.k*(1+.1*e),l=[(t[0]-r.x)/r.k,(t[1]-r.y)/r.k],r.k=o,s=[l[0]*r.k+r.x,l[1]*r.k+r.y],r.x+=t[0]-s[0],r.y+=t[1]-s[1],function(e,t){var n=d3.zoomTransform(svg_map);d3.transition().duration(225).tween("zoom",function(){var a=d3.interpolate([n.x,n.y],e),r=d3.interpolate(n.k,t);return function(e){svg_map.__zoom.k=r(e);var t=a(e);svg_map.__zoom.x=t[0],svg_map.__zoom.y=t[1],i()}})}([r.x,r.y],r.k)};var a=n(7),r=n(15),o=n(18);function i(){var t=canvas_rotation_value||"",n=void 0,r=void 0;d3.event&&d3.event.transform&&d3.event.sourceEvent?(r=d3.event.transform+t,map.selectAll(".layer").transition().duration(50).style("stroke-width",function(){var t=e._app.id_to_layer.get(this.id);return current_layers[t].fixed_stroke?this.style.strokeWidth:current_layers[t]["stroke-width-const"]/d3.event.transform.k+"px"}).attr("transform",r),map.selectAll(".scalable-legend").transition().duration(50).attr("transform",r)):(r=(n=d3.zoomTransform(svg_map)).toString()+t,map.selectAll(".layer").transition().duration(50).style("stroke-width",function(){var t=e._app.id_to_layer.get(this.id);return current_layers[t].fixed_stroke?this.style.strokeWidth:current_layers[t]["stroke-width-const"]/n.k+"px"}).attr("transform",r),map.selectAll(".scalable-legend").transition().duration(50).attr("transform",r)),o.scaleBar.displayed&&o.scaleBar.update(),_app.legendRedrawTimeout&&clearTimeout(_app.legendRedrawTimeout),_app.legendRedrawTimeout=setTimeout(l,650);var i=svg_map.__zoom,s=proj.scale()*i.k;document.getElementById("input-center-x").value=(0,a.round_value)(i.x,2),document.getElementById("input-center-y").value=(0,a.round_value)(i.y,2),document.getElementById("input-scale-k").value=s>2||s<-2?(0,a.round_value)(s,2):(0,a.round_value)(s,Math.round((0,a.get_nb_decimals)(s)/2))}function l(t){for(var n=t?[t]:document.querySelectorAll("#legend_root_symbol"),a=svg_map.__zoom.k>4||svg_map.__zoom.k<.15,o=[],i=0;i<n.length;++i){var l=n[i].classList[2].split("lgdf_")[1],s=e._app.id_to_layer.get(l),p=current_layers[s].rendered_field,c=n[i].getAttribute("nested"),d=n[i].getAttribute("join_line"),_=n[i].getAttribute("display"),u=n[i].style.visibility,m=n[i].getAttribute("transform"),y=n[i].getAttribute("rounding_precision"),g=n[i].querySelector("#legendtitle").innerHTML,f=n[i].querySelector("#legendsubtitle").innerHTML,h=n[i].querySelector("#legend_bottom_note").innerHTML,v="true"===n[i].getAttribute("visible_rect")?{color:n[i].querySelector("#under_rect").style.fill,opacity:n[i].querySelector("#under_rect").style.fillOpacity}:void 0;n[i].remove(),(0,r.createLegend_symbol)(s,p,g,f,c,d,v,y,h);var b=document.querySelector(["#legend_root_symbol.lgdf_",l].join(""));b.style.visibility=u,m&&b.setAttribute("transform",m),_?(b.setAttribute("display",_),o.push(!0)):a&&b.setAttribute("display","none")}if(a&&o.length!==n.length&&alertify.notify(i18next.t("app_page.notification.warning_deactivation_prop_symbol_legend"),"warning",5),!t)for(var x=document.querySelectorAll("#legend_root_lines_class"),w=0;w<x.length;++w){var k=x[w].classList[2].split("lgdf_")[1],A=e._app.id_to_layer.get(k),j=current_layers[A].rendered_field,S=x[w].getAttribute("display"),E=x[w].style.visibility,z=x[w].getAttribute("transform"),B=x[w].getAttribute("rounding_precision"),P=x[w].querySelector("#legendtitle").innerHTML,O=x[w].querySelector("#legendsubtitle").innerHTML,C=x[w].querySelector("#legend_bottom_note").innerHTML,M="true"===x[w].getAttribute("visible_rect")?{color:x[w].querySelector("#under_rect").style.fill,opacity:x[w].querySelector("#under_rect").style.fillOpacity}:void 0;x[w].remove(),createLegend_discont_links(A,j,P,O,M,B,C);var I=document.querySelector(["#legend_root_lines_class.lgdf_",k].join(""));I.style.visibility=E,z&&I.setAttribute("transform",z),S&&I.setAttribute("display",S)}}}).call(this,n(4))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.make_red_line_snap=t.get_coords_snap_lines=void 0,t.add_layout_feature=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("not-allowed"===document.body.style.cursor)return;if("text_annot"===e){var n=document.getElementsByClassName("txt_annot"),_=[],g=void 0;n&&(_=Array.prototype.map.call(n,function(e){return+e.id.split("text_annotation_")[1]}));for(var f=0;f<50;f++)if(-1===_.indexOf(f)){_.push(f),g=["text_annotation_",f].join("");break}if(!g)return void swal(i18next.t("app_page.common.error")+"!",i18next.t("app_page.common.error_max_text_annot"),"error");I=g,q=function e(t){"key"in(t=t||window.event)&&"Escape"!==t.key&&"Esc"!==t.key||27!==t.keyCode||(L.dismiss(),document.body.style.cursor="",map.style("cursor","").on("click",null),document.removeEventListener("keydown",e))},L=a.default.notify(i18next.t("app_page.notification.instruction_click_map"),"warning",0),document.body.style.cursor="not-allowed",map.style("cursor","crosshair").on("click",function(){L.dismiss(),document.removeEventListener("keydown",q),map.style("cursor","").on("click",null),document.body.style.cursor="";var e=new p.default(svg_map,I,[d3.event.layerX,d3.event.layerY]);setTimeout(function(){e.editStyle()},350)}),document.addEventListener("keydown",q)}else if("sphere"===e){var h=(0,c.check_layer_name)(t.layer_name||"Sphere"),v=encodeId(h),b=t.fill||"#add8e6",x=t.fill_opacity||.2,w=t.stroke_width||"0.5px",k=t.stroke_opacity||1,A=t.stroke||"#ffffff";_app.layer_to_id.set(h,v),_app.id_to_layer.set(v,h),current_layers[h]={sphere:!0,type:"Polygon",n_features:1,"stroke-width-const":+w.slice(0,-2),fill_color:{single:b}},map.append("g").attrs({id:v,class:"layer"}).styles({"stroke-width":w}).append("path").datum({type:"Sphere"}).styles({fill:b,"fill-opacity":x,"stroke-opacity":k,stroke:A}).attrs({d:path}),isInterrupted(current_proj_name.toLowerCase())&&map.select("g#"+v).attr("clip-path","url(#clip)"),create_li_layer_elem(h,null,"Polygon","sample"),a.default.notify(i18next.t("app_page.notification.success_sphere_added"),"success",5),zoom_without_redraw(),setSphereBottom(v)}else if("graticule"===e){if(void 0!==current_layers.Graticule)return;var j=t.stroke||"#808080",S=t.stroke_width||"1px",E=t.stroke_opacity||1,z=t.stroke_dasharray||5,B=t.step||10,P=d3.geoGraticule().step([B,B]);if(t.extent){var O=_target_layer_file.bbox,C=[[10*Mround((O[0]-10)/10),10*Mround((O[1]-10)/10)],[10*Mround((O[2]+10)/10),10*Mround((O[3]+10)/10)]];P=P.extent(C),current_layers.Graticule.extent=C}var M=encodeId("Graticule");_app.layer_to_id.set("Graticule",M),_app.id_to_layer.set(M,"Graticule"),map.insert("g",".legend").attrs({id:M,class:"layer"}).styles({"stroke-width":S}).append("path").datum(P).attrs({d:path,class:"graticule"}).styles({"stroke-dasharray":z,fill:"none",stroke:j}),current_layers.Graticule={graticule:!0,type:"Line",n_features:1,"stroke-width-const":+S.slice(0,-2),fill_color:{single:j},opacity:E,step:B,dasharray:z},isInterrupted(current_proj_name.toLowerCase())&&map.select("g#"+M).attr("clip-path","url(#clip)"),create_li_layer_elem("Graticule",null,"Line","sample"),a.default.notify(i18next.t("app_page.notification.success_graticule_added"),"success",5),up_legends(),zoom_without_redraw()}else"scale"===e?s.scaleBar.displayed?ask_existing_feature("scalebar").then(function(){s.scaleBar.remove(),m("scalebar")},function(e){return null}):m("scalebar"):"north_arrow"===e?i.northArrow.displayed?ask_existing_feature("north_arrow").then(function(){i.northArrow.remove(),m("north_arrow")},function(e){return null}):m("north_arrow"):"arrow"===e?function(){var e=function e(t){"key"in(t=t||window.event)&&"Escape"!==t.key&&"Esc"!==t.key||27!==t.keyCode||(s.dismiss(),document.body.style.cursor="",map.style("cursor","").on("click",null),o&&o.remove&&o.remove(),document.removeEventListener("keydown",e))},t=u("arrow");if(null===t)return;var n=void 0,o=void 0,i=void 0,l=void 0;document.body.style.cursor="not-allowed";var s=a.default.notify(i18next.t("app_page.notification.instruction_click_map_arrow1"),"warning",0);document.addEventListener("keydown",e),map.style("cursor","crosshair").on("click",function(){n?(i=[d3.event.layerX,d3.event.layerY],l=map.append("rect").attrs({x:i[0]-2,y:i[1]-2,height:4,width:4}).style("fill","red")):(n=[d3.event.layerX,d3.event.layerY],o=map.append("rect").attrs({x:n[0]-2,y:n[1]-2,height:4,width:4}).style("fill","red"),s.dismiss(),s=a.default.notify(i18next.t("app_page.notification.instruction_click_map_arrow2"),"warning",0)),n&&i&&(s.dismiss(),document.removeEventListener("keydown",e),setTimeout(function(){o.remove(),l.remove()},1e3),map.style("cursor","").on("click",null),document.body.style.cursor="",new r.default("arrow_"+t,n,i,svg_map))})}():"ellipse"===e?function(){var e=function e(t){"key"in(t=t||window.event)&&"Escape"!==t.key&&"Esc"!==t.key||27!==t.keyCode||(i.dismiss(),document.body.style.cursor="",map.style("cursor","").on("click",null),document.removeEventListener("keydown",e))},t=u("ellipse");if(null===t)return;document.body.style.cursor="not-allowed";var n=void 0,r=void 0,i=a.default.notify(i18next.t("app_page.notification.instruction_click_map"),"warning",0);document.addEventListener("keydown",e),map.style("cursor","crosshair").on("click",function(){i.dismiss(),document.removeEventListener("keydown",e),n=[d3.event.layerX,d3.event.layerY],r=map.append("rect").attrs({x:n[0]-2,y:n[1]-2,height:4,width:4}).style("fill","red"),setTimeout(function(){r.remove()},1e3),map.style("cursor","").on("click",null),document.body.style.cursor="",new o.default("user_ellipse_"+t,n,svg_map)})}():"rectangle"===e?function(){var e=function e(t){"key"in(t=t||window.event)&&"Escape"!==t.key&&"Esc"!==t.key||27!==t.keyCode||(n.dismiss(),map.select(".brush_rect_draw").remove(),document.body.style.cursor="",document.removeEventListener("keydown",e))};var t=u("rectangle");if(null===t)return;var n=a.default.notify(i18next.t("app_page.notification.instruction_brush_map"),"warning",0);document.addEventListener("keydown",e),document.body.style.cursor="not-allowed";var r=d3.brush().on("end",function(){if(!d3.event.selection)return map.select(".brush_rect_draw").remove(),document.body.style.cursor="",n.dismiss(),document.removeEventListener("keydown",e),void a.default.notify(i18next.t("app_page.notification.brush_map_cancelled"),"warning",5);n.dismiss();var r=svg_map.__zoom.k,o=(d3.event.selection[1][0]-d3.event.selection[0][0])/r,i=(d3.event.selection[1][1]-d3.event.selection[0][1])/r;new l.default("user_rectangle_"+t,d3.event.selection[0],svg_map,!1,o,i),map.select(".brush_rect_draw").remove(),document.removeEventListener("keydown",e),document.body.style.cursor=""});map.append("g").attr("class","brush_rect_draw").call(r)}():"symbol"===e?function(){var e=function e(t){"key"in(t=t||window.event)&&"Escape"!==t.key&&"Esc"!==t.key||27!==t.keyCode||(n.dismiss(),document.body.style.cursor="",map.style("cursor","").on("click",null),document.removeEventListener("keydown",e))},t=u("single_symbol");if(null===t)return;var n=a.default.notify(i18next.t("app_page.notification.instruction_click_map"),"warning",0);document.addEventListener("keydown",e);var r=void 0,o=void 0,i=void 0,l=!1;window.default_symbols?l=!0:(window.default_symbols=[],i=(0,d.prepare_available_symbols)());document.body.style.cursor="not-allowed",map.style("cursor","crosshair").on("click",function(){n.dismiss(),document.removeEventListener("keydown",e),o=[d3.event.layerX,d3.event.layerY],r=map.append("rect").attrs({x:o[0]-2,y:o[1]-2,height:4,width:4}).style("fill","red"),setTimeout(function(){r.remove()},500),map.style("cursor","").on("click",null),document.body.style.cursor="",l?box_choice_symbol(window.default_symbols).then(function(e){e&&y(e.split("url(")[1].substring(1).slice(0,-2),o[0],o[1],45,45,"single_symbol_"+t)}):i.then(function(e){box_choice_symbol(window.default_symbols).then(function(e){e&&y(e.split("url(")[1].substring(1).slice(0,-2),o[0],o[1],45,45,"single_symbol_"+t)})})})}():swal(i18next.t("app_page.common.error")+"!",i18next.t("app_page.common.error"),"error");var I,q,L};var a=_(n(10)),r=_(n(43)),o=_(n(42)),i=n(23),l=_(n(41)),s=n(18),p=_(n(40)),c=n(16),d=n(2);function _(e){return e&&e.__esModule?e:{default:e}}t.get_coords_snap_lines=function(e){var t={x:[],y:[]};return pos_lgds_elem.forEach(function(n,a){a!=e&&(t.y.push([n.bottom,n.top],[n.top,n.bottom]),t.x.push([n.left,n.right],[n.right,n.left]))}),t},t.make_red_line_snap=function(e,t,n,a){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:750,o=void 0;return function(){o&&clearTimeout(o),map.select(".snap_line").remove();var i=map.append("line").attrs({x1:e,x2:t,y1:n,y2:a,class:"snap_line"}).styles({stroke:"red","stroke-width":.7});o=setTimeout(function(e){i.remove()},r)}()};var u=function(e){var t=void 0,n=void 0,a=void 0;"ellipse"===e?(t="user_ellipse",n="user_ellipse_",a="error_max_ellipses"):"rectangle"===e?(t="user_rectangle",n="user_rectangle_",a="error_max_rectangles"):"arrow"===e?(t="arrow",n="arrow_",a="error_max_arrows"):"single_symbol"===e&&(t="single_symbol",n="single_symbol_",a="error_max_symbols");var r=document.getElementsByClassName(t);if(!r)return 0;if(r.length>30)return swal(i18next.t("app_page.common.error"),i18next.t("app_page.common."+a),"error").catch(swal.noop),null;for(var o=[],i=0;i<r.length;i++)o.push(+r[i].id.split(n)[1]);if(-1===o.indexOf(r.length))return r.length;for(var l=0;l<r.length;l++)if(-1===o.indexOf(l))return l;return null};function m(e){var t=function e(t){"key"in(t=t||window.event)&&"Escape"!==t.key&&"Esc"!==t.key||27!==t.keyCode||(n.dismiss(),document.body.style.cursor="",map.style("cursor","").on("click",null),document.removeEventListener("keydown",e))},n=a.default.notify(i18next.t("app_page.notification.instruction_click_map"),"warning",0);document.addEventListener("keydown",t),document.body.style.cursor="not-allowed",map.style("cursor","crosshair").on("click",function(){n.dismiss(),document.removeEventListener("keydown",t),map.style("cursor","").on("click",null),document.body.style.cursor="","north_arrow"===e?i.northArrow.display(d3.event.layerX,d3.event.layerY):"scalebar"===e&&s.scaleBar.create(d3.event.layerX,d3.event.layerY)})}function y(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"30",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"30",o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=new ContextMenu;return map.append("g").attrs({class:"legend single_symbol",id:o}).insert("image").attrs({x:t||w/2,y:n||h/2,width:a,height:r,"xlink:href":e}).on("mouseover",function(){this.style.cursor="pointer"}).on("mouseout",function(){this.style.cursor="initial"}).on("dblclick contextmenu",function(){var e;i.showMenu(d3.event,document.querySelector("body"),(e=this,[{name:i18next.t("app_page.common.options"),action:function(){make_style_box_indiv_symbol(e)}},{name:i18next.t("app_page.common.up_element"),action:function(){up_legend(e.parentElement)}},{name:i18next.t("app_page.common.down_element"),action:function(){down_legend(e.parentElement)}},{name:i18next.t("app_page.common.delete"),action:function(){e.parentElement.remove()}}]))}).call(drag_elem_geo)}},,,function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.drag_legend_func=void 0;var a=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,r=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(a=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(r)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();t.handle_legend=function(e){if(void 0!=current_layers[e].renderer){var t=[".lgdf",_app.layer_to_id.get(e)].join("_"),n=svg_map.querySelectorAll(t);if(n.length>0)if(null==n[0].getAttribute("display"))Array.prototype.forEach.call(n,function(e){return e.setAttribute("display","none")});else{Array.prototype.forEach.call(n,function(e){return e.removeAttribute("display")});for(var a=get_map_xy0(),r=a.x,o=a.y,i=r-10,l=r+ +w+10,s=o-10,p=o+ +h+10,_=0;_<n.length;_++){var u=n[_].getBoundingClientRect();(u.left<i||u.left>l||u.top<s||u.top>p)&&n[_].setAttribute("transform","translate(0, 0)")}}else!function(e,t){var n=current_layers[e].renderer,a=current_layers[e].rendered_field,r=current_layers[e].rendered_field2,o=current_layers[e].type,i=void 0,l=void 0,s=(0,c.getTranslateNewLegend)();if(n.indexOf("Choropleth")>-1||n.indexOf("Gridded")>-1||n.indexOf("Stewart")>-1||n.indexOf("TypoSymbols")>-1)i=x(e,a,t,a,0);else if(n.indexOf("Categorical")>-1)i=x(e,a,t,a,4);else if(-1!==n.indexOf("LinksGraduated")||-1!==n.indexOf("DiscLayer"))i=function(e,t,n,a,r,o,i){var l="legend legend_feature lgdf_"+_app.layer_to_id.get(e),s=current_layers[e].breaks,p=s.length;if(void 0===o){var _=s.map(function(e,t){return e[0][0]}).concat(s[p-1][0][1]);o=b(_)}var u=map.insert("g").attrs({id:"legend_root_lines_class",class:l,transform:"translate(0,0)",rounding_precision:o,layer_field:t,layer_name:e}).styles({cursor:"grab","font-size":"11px","font-family":"verdana"}),f=u.insert("rect");u.insert("text").attrs(""!=a?{id:"legendtitle",x:48,y:30}:{id:"legendtitle",x:48,y:45}).styles({"font-size":"12px","font-family":"verdana","font-weight":"bold"}).text(n||""),u.insert("text").attrs({id:"legendsubtitle",x:48,y:45}).styles({"font-size":"12px","font-family":"verdana","font-style":"italic"}).text(a);var h=[],v=+current_layers[e].min_display;if("DiscLayer"===current_layers[e].renderer){var x=Array.prototype.map.call(svg_map.querySelector("#"+_app.layer_to_id.get(e)).querySelectorAll("path"),function(e){return+e.__data__.properties.disc_value});v=1!==v?x[(0,d.Mround)(v*current_layers[e].n_features)]:x[x.length-1]}for(var w=0;w<p;w++){var k=s[w];0!==k[1]&&(v>=+k[0][0]&&v<+k[0][1]?h.push({value:[v,k[0][1]],size:k[1]}):v<+k[0][0]&&v<+k[0][1]&&h.push({value:k[0],size:k[1]}))}h.reverse();var A=u.selectAll(".legend").append("g").data(h).enter().insert("g").attr("class",function(e,t){return"lg legend_"+t}),j=current_layers[e].size[1],S=current_layers[e].fill_color.single,E=48+j/2,z=0,B=48;A.append("rect").styles({fill:S,stroke:"rgb(0, 0, 0)","fill-opacity":1,"stroke-width":0}).attrs(function(e){return B=12+B+z,z=e.size*svg_map.__zoom.k,{x:E,y:B,width:45,height:z}}),B=48,z=0;var P=48+1.5*j+45,O=void 0;return A.append("text").attrs(function(e){return B=12+B+z,z=e.size*svg_map.__zoom.k,{x:P,y:O=B-z/4}}).styles({"alignment-baseline":"middle","font-size":"10px"}).text(function(e){return(0,c.round_value)(e.value[1],o).toLocaleString()}),u.insert("text").attrs({id:"lgd_choro_min_val",x:P,y:O+12}).styles({"alignment-baseline":"middle","font-size":"10px"}).text((0,c.round_value)(h[h.length-1].value[0],o).toLocaleString()),u.call(y(u)),u.append("g").insert("text").attrs({id:"legend_bottom_note",x:48,y:B+36}).styles({"font-size":"11px","font-family":"verdana"}).text(null!=i?i:""),g(u,f,r),m(u,e),u}(e,a,t,a);else if(-1!==n.indexOf("PropSymbolsChoro"))i=x(e,r,t,r,0),l="Line"===o?v(e,a,t,a):f(e,a,t,a);else if(-1!==n.indexOf("PropSymbolsTypo"))i=x(e,r,t,r,4),l="Line"===o?v(e,a,t,a):f(e,a,t,a);else if(-1!==n.indexOf("PropSymbols"))i="Line"===o?v(e,a,t,a):f(e,a,t,a);else if(-1!==n.indexOf("LinksProp"))i=v(e,a,t,a);else{if(-1===n.indexOf("TwoStocksWaffle"))return void swal("Oops..",i18next.t("No legend available for this representation")+".<br>"+i18next.t('Want to make a <a href="/">suggestion</a> ?'),"warning");i=function(e,t,n,a,r,o,i){var l="legend legend_feature lgdf_"+_app.layer_to_id.get(e),s=t.length,p=current_layers[e].fill_color,c=current_layers[e].symbol,d=current_layers[e].size,_=void 0,u=map.insert("g").attrs({id:"legend_root_waffle",class:l,transform:"translate(0,0)",layer_name:e}).styles({cursor:"grab","font-size":"11px","font-family":"verdana"}),f=u.insert("rect");u.insert("text").attrs(""!=a?{id:"legendtitle",x:48,y:30}:{id:"legendtitle",x:48,y:45}).styles({"font-size":"12px","font-family":"verdana","font-weight":"bold"}).text(n||""),u.insert("text").attrs({id:"legendsubtitle",x:48,y:45}).styles({"font-size":"12px","font-family":"verdana","font-style":"italic"}).text(a);for(var h=[],v=0;v<s;v++)h.push([t[v],p[v]]);var b=u.selectAll(".legend").append("g").data(h).enter().insert("g").attr("class",function(e,t){return"lg legend_"+t});b.append("rect").attrs(function(e,t){return{x:48,y:_=48+12*t+18*t,width:18,height:18}}).styles(function(e){return{fill:e[1],stroke:e[1]}}),b.append("text").attr("x",76).attr("y",function(e,t){return 48+18*t+12*t+12}).styles({"alignment-baseline":"middle","font-size":"10px"}).text(function(e){return e[0]});var x=u.append("g");"rect"===c?(x.insert("rect").attrs({x:48,y:_+36,width:d,height:d}).styles({fill:"lightgray",stroke:"black","stroke-width":"0.8px"}),x.insert("text").attrs({x:66+d,y:_+36+d/2+7,id:"ratio_txt"}).text(o||" = "+current_layers[e].ratio),_=_+54+d):(x.insert("circle").attrs({cx:48+d,cy:_+36+d,r:d}).styles({fill:"lightgray",stroke:"black","stroke-width":"0.8px"}),x.insert("text").attrs({x:66+2*d,y:_+36+d+7,id:"ratio_txt"}).text(o||" = "+current_layers[e].ratio),_=_+54+2*d);return u.append("g").insert("text").attrs({id:"legend_bottom_note",x:48,y:_}).styles({"font-size":"11px","font-family":"verdana"}).text(null!=i?i:""),u.call(y(u)),g(u,f,r),m(u,e),u}(e,a,t,"")}i&&s&&s.x&&i.attr("transform","translate("+s.x+","+s.y+")");if(pos_lgds_elem.set(i.attr("id")+" "+i.attr("class"),i.node().getBBox()),l){var p=i.node().getBBox(),_=s.y+p.height,u=s.x+p.width,k=(0,c.getTranslateNewLegend)();k.x!==s.x||k.y!==s.y?l.attr("transform","translate("+k.x+","+k.y+")"):_<h?l.attr("transform","translate("+s.x+","+_+")"):u<w&&l.attr("transform","translate("+u+","+s.y+")"),pos_lgds_elem.set(l.attr("id")+" "+l.attr("class"),l.node().getBBox())}}(e,""),function(){for(var e=svg_map.querySelectorAll(".legend"),t=0;t<e.length;t++)svg_map.appendChild(e[t],null)}()}},t.createLegend_symbol=f,t.move_legends=function(){for(var e=get_map_xy0(),t=w+e.x,n=h+e.y,r=[svg_map.querySelectorAll(".legend_feature"),svg_map.querySelectorAll("#scale_bar.legend")],o=0;o<2;++o)for(var i=r[o],l=0,s=i.length;l<s;++l){var p=i[l].getBoundingClientRect();if(p.left+p.width>t){var c=i[l].getAttribute("transform"),d=/\(([^\)]+)\)/.exec(c)[1].split(/[ ,]+/),_=a(d,2),u=_[0],m=_[1],y=p.left+p.width-t;i[l].setAttribute("transform",["translate(",[+u-y,m],")"].join(""))}if(p.top+p.height>n){var g=i[l].getAttribute("transform"),f=/\(([^\)]+)\)/.exec(g)[1].split(/[ ,]+/),v=a(f,2),b=v[0],x=v[1],k=p.top+p.height-n;i[l].setAttribute("transform",["translate(",[b,+x-k],")"].join(""))}}for(var A=document.querySelectorAll(".txt_annot"),j=0,S=A.length;j<S;j++){var E=A[j].getBoundingClientRect();if(E.left+E.width>t){var z=E.left+E.width-t,B=d3.select(A[j]),P=+B.select("rect").attr("x")-z,O=+B.select("text").attr("x")-z;O>0&&(B.select("rect").attr("x",P),B.select("text").attr("x",O).selectAll("tspan").attr("x",O))}if(E.top+E.height>n){var C=E.top+E.height-n,M=d3.select(A[j]),I=+M.select("rect").attr("y")-C,q=+M.select("text").attr("y")-C;q>0&&(M.select("rect").attr("y",I),M.select("text").attr("y",q))}}};var r,o=n(9),i=(r=o)&&r.__esModule?r:{default:r},l=n(8),s=n(1),p=n(3),c=n(7),d=n(6),_=n(2),u=n(12);function m(e,t){var n=new i.default,a=function(){return[{name:i18next.t("app_page.common.edit_style"),action:function(){j(e.attr("id"),e.attr("layer_name"))}},{name:i18next.t("app_page.common.up_element"),action:function(){!function(e){for(var t=svg_map.querySelectorAll(".legend"),n=+t.length,a=void 0,r=0;r<n;r++)t[r].id===e.id&&t[r].classList===e.classList&&(a=r);a!==n-1&&svg_map.insertBefore(t[a+1],t[a])}(e.node())}},{name:i18next.t("app_page.common.down_element"),action:function(){!function(e){for(var t=svg_map.querySelectorAll(".legend"),n=+t.length,a=void 0,r=0;r<n;r++)t[r].id===e.id&&t[r].classList===e.classList&&(a=r);0!==a&&svg_map.insertBefore(t[a],t[a-1])}(e.node())}},{name:i18next.t("app_page.common.hide"),action:function(){"none"!==e.attr("display")?e.attr("display","none"):e.attr("display",null)}}]};e.on("dblclick",function(){d3.event.stopPropagation(),d3.event.preventDefault(),j(e.attr("id"),e.attr("layer_name"))}),e.on("contextmenu",function(){n.showMenu(d3.event,document.querySelector("body"),a())})}var y=t.drag_legend_func=function(e){return d3.drag().subject(function(){var t=d3.select(this),n=t.attr("transform"),a=(0,u.get_coords_snap_lines)(t.attr("id")+" "+t.attr("class"));return 1===(n=n?n.slice(10,-1).split(/[ ,]+/).map(function(e){return+e}):[0,0]).length&&(n=[n[0],0]),{x:+t.attr("x")+n[0],y:+t.attr("y")+n[1],map_locked:!!map_div.select("#hand_button").classed("locked"),snap_lines:a,offset:[+e.select("#under_rect").attr("x"),+e.select("#under_rect").attr("y")]}}).on("start",function(){d3.event.sourceEvent.stopPropagation(),d3.event.sourceEvent.preventDefault(),(0,_.handle_click_hand)("lock")}).on("end",function(){d3.event.subject&&!d3.event.subject.map_locked&&(0,_.handle_click_hand)("unlock"),e.style("cursor","grab"),pos_lgds_elem.set(e.attr("id")+" "+e.attr("class"),e.node().getBBox())}).on("drag",function(){var t=d.Mmin,n=d.Mmax,a=[d3.event.x,d3.event.y],r=e.attr("transform");1===(r=r?r.slice(10,-1).split(/[ ,]+/).map(function(e){return+e}):[0,0]).length&&(r=[r[0],0]),e.attr("transform","translate("+a+")").style("cursor","grabbing");var o=e.node().getBBox(),i=d3.event.x,l=d3.event.y,s=void 0;if(_app.autoalign_features)for(var p=o.x,c=o.x+o.width,_=o.y,m=o.y+o.height,y=d3.event.subject.snap_lines.x,g=d3.event.subject.snap_lines.y,f=0;f<y.length;f++){if((0,d.Mabs)(y[f][0]-p)<10){var v=t(t(g[f][0],g[f][1]),_),b=n(n(g[f][0],g[f][1]),m);(0,u.make_red_line_snap)(y[f][0],y[f][0],v,b),i=y[f][0]-d3.event.subject.offset[0],s=!0}if((0,d.Mabs)(y[f][0]-c)<10){var x=t(t(g[f][0],g[f][1]),_),k=n(n(g[f][0],g[f][1]),m);(0,u.make_red_line_snap)(y[f][0],y[f][0],x,k),i=y[f][0]-o.width-d3.event.subject.offset[0],s=!0}if((0,d.Mabs)(g[f][0]-_)<10){var A=t(t(y[f][0],y[f][1]),p),j=n(n(y[f][0],y[f][1]),c);(0,u.make_red_line_snap)(A,j,g[f][0],g[f][0]),l=g[f][0]-d3.event.subject.offset[1],s=!0}if((0,d.Mabs)(g[f][0]-m)<10){var S=t(t(y[f][0],y[f][1]),p),E=n(n(y[f][0],y[f][1]),c);(0,u.make_red_line_snap)(S,E,g[f][0],g[f][0]),l=g[f][0]-o.height-d3.event.subject.offset[1],s=!0}}(o.width<w&&o.x<-10||o.x+o.width>+w+10)&&(i=r[0],s=!0),(o.height<h&&o.y<-10||o.y+o.height>+h+10)&&(l=r[1],s=!0),s&&e.attr("transform","translate("+[i,l]+")")})};function g(e,t,n){t.attrs({width:0,height:0});var a=e.node().getBBox(),r=e.attr("transform");1===(r=r?r.split("translate(")[1].split(")")[0].split(/[ ,]+/).map(function(e){return+e}):[0,0]).length&&(r=[r[0],0]);var o=a.x-12.5-r[0],i=a.y-12.5-r[1],l=a.x+a.width+12.5-r[0],s=a.y+a.height+12.5-r[1]-i,p=l-o;t.attrs({id:"under_rect",x:o,y:i,height:s,width:p}),n&&n.color&&n.opacity?(t.styles({fill:n.color,"fill-opacity":n.opacity}),e.attr("visible_rect","true").on("mouseover",null).on("mouseout",null)):(t.styles({fill:"green","fill-opacity":0}),e.attr("visible_rect","false").on("mouseover",function(){t.style("fill-opacity",.1)}).on("mouseout",function(){t.style("fill-opacity",0)}))}function f(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"false",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"false",l=arguments[6],s=arguments[7],p=arguments[8],_=(arguments.length>9&&void 0!==arguments[9]?arguments[9]:{}).parent||window.map,u=57,f=(current_layers[e].n_features,"legend legend_feature lgdf_"+_app.layer_to_id.get(e)),h=current_layers[e].symbol,v="PropSymbolsChoro"===current_layers[e].renderer||"PropSymbolsTypo"===current_layers[e].renderer||void 0!==current_layers[e].fill_color.two||void 0!==current_layers[e].fill_color.random?"#FFF":current_layers[e].fill_color.single,b="PropSymbolsChoro"===current_layers[e].renderer||"PropSymbolsTypo"===current_layers[e].renderer||void 0!==current_layers[e].fill_color.two||void 0!==current_layers[e].fill_color.random?"rgb(0, 0, 0)":map.select("#"+_app.layer_to_id.get(e)).select(h).style("stroke"),x=document.getElementById(_app.layer_to_id.get(e)).getElementsByTagName(h),w="circle"===h?"r":"width",k=+d3.zoomTransform(map.node()).k,A=a(current_layers[e].size,2),j=A[0],S=A[1],E=new c.PropSizer(j,S,h);if(!current_layers[e].size_legend_symbol){var z=Array.prototype.filter.call(x,function(e,t){if(0!=e[w].baseVal.value)return e[w].baseVal.value}),B=+z[0].getAttribute(w),P=+z[z.length-1].getAttribute(w),O=(0,d.Mabs)(+z[0].__data__.properties[t]),C=(0,d.Mabs)(+z[z.length-1].__data__.properties[t]),M=(0,d.Mmax)((0,c.get_nb_decimals)(O),(0,c.get_nb_decimals)(C)),I=(0,d.Msqrt)(B)-(0,d.Msqrt)(P),q=(0,d.Msqrt)(P)+I/3,L=(0,d.Mpow)(q+I/3,2);q=(0,d.Mpow)(q,2),current_layers[e].size_legend_symbol=[{value:O},{value:(0,c.round_value)(E.get_value(L),M)},{value:(0,c.round_value)(E.get_value(q),M)},{value:C}],s=current_layers[e].size_legend_symbol[0].value-current_layers[e].size_legend_symbol[1].value>1?0:(0,d.Mmax)((0,c.get_nb_decimals)(O),(0,c.get_nb_decimals)(C))}var T=current_layers[e].size_legend_symbol,N=[{size:E.scale(T[0].value)*k,value:T[0].value},{size:E.scale(T[1].value)*k,value:T[1].value},{size:E.scale(T[2].value)*k,value:T[2].value},{size:E.scale(T[3].value)*k,value:T[3].value}];0===N[3].value&&N.pop(),0===N[2].value&&N.pop();var F=_.insert("g").styles({cursor:"grab","font-size":"11px","font-family":"verdana"}).attrs({id:"legend_root_symbol",class:f,transform:"translate(0,0)",layer_name:e,nested:o,join_line:i,rounding_precision:s,layer_field:t}),G=F.insert("rect");F.insert("text").attrs(""!=r?{id:"legendtitle",x:48,y:30}:{id:"legendtitle",x:48,y:45}).styles({"font-size":"12px","font-family":"verdana","font-weight":"bold"}).text(n),F.insert("text").attrs({id:"legendsubtitle",x:48,y:45}).styles({"font-size":"12px","font-family":"verdana","font-style":"italic"}).text(r);var D=F.selectAll(".legend").append("g").data(N).enter().insert("g").attr("class",function(e,t){return"lg legend_"+t}),R=2*N[0].size,W=0;"rect"===h&&(u-=R/4);var H=u;if("false"===o){if("circle"===h)D.append("circle").styles({fill:v,stroke:b,"fill-opacity":1}).attrs(function(e,t){return H=4*t+e.size+H+W,W=e.size,{cx:52+R/4,cy:H,r:e.size}}),H=u,W=0,D.append("text").attrs(function(e,t){return H=4*t+e.size+H+W,W=e.size,{x:52+.75*R+7,y:H+2*t/3}}).styles({"alignment-baseline":"middle","font-size":"10px"}).text(function(e){return(0,c.round_value)(e.value,s).toLocaleString()});else if("rect"===h){D.append("rect").styles({fill:v,stroke:b,"fill-opacity":1}).attrs(function(e,t){return H=4*t+e.size/2+H+W,W=e.size,{x:52+R/4-W/2,y:H,width:W,height:W}}),H=u,W=0;var V=52+R/2+7;D.append("text").attrs(function(e,t){return H=4*t+e.size/2+H+W,W=e.size,{x:V,y:H+.51*e.size}}).styles({"alignment-baseline":"middle","font-size":"10px"}).text(function(e){return(0,c.round_value)(e.value,s).toLocaleString()})}}else if("true"===o){if("circle"===h){if("true"===i){d3.line().x(function(e){return e[0]}).y(function(e){return e[1]});D.append("line").attrs(function(e){return{x1:52+R/4-e.size,x2:52+.75*R+6.5,y1:60+R-e.size+.5,y2:60+R-e.size+.5,stroke:"#3f3f3f","stroke-width":.8}}),D.append("circle").attrs(function(e){return{cx:52+R/4,cy:60+R-e.size,r:e.size}}).styles({fill:v,stroke:b,"fill-opacity":1}),H=u,W=0,D.append("text").attrs(function(e){return{x:52+.75*R+7,y:63+R-e.size}}).styles({"alignment-baseline":"middle","font-size":"10px"}).text(function(e){return(0,c.round_value)(e.value,s).toLocaleString()})}else D.append("circle").attrs(function(e){return{cx:52+R/4,cy:60+R-e.size,r:e.size}}).styles({fill:v,stroke:b,"fill-opacity":1}),H=u,W=0,D.append("text").attrs(function(e){return{x:52+.75*R+7,y:61+R-2*e.size}}).styles({"alignment-baseline":"middle","font-size":"10px"}).text(function(e){return(0,c.round_value)(e.value,s).toLocaleString()});H=50+R}else"rect"===h&&(D.append("rect").attrs(function(e){return{x:52,y:60+R/2-e.size,width:e.size,height:e.size}}).styles({fill:v,stroke:b,"fill-opacity":1}),H=u,W=0,D.append("text").attrs(function(e){return{x:52+R/2+7,y:61+R/2-e.size}}).styles({"alignment-baseline":"middle","font-size":"10px"}).text(function(e){return(0,c.round_value)(e.value,s).toLocaleString()}),H=50+R/2)}if(void 0!==current_layers[e].break_val){var U=F.append("g");U.insert("text").attrs({id:"col1_txt",x:48,y:H+31.5}).styles({"alignment-baseline":"middle","font-size":"10px"}).html("< "+current_layers[e].break_val.toLocaleString()),U.insert("rect").attrs({id:"col1",x:48,y:H+36,width:18,height:18}).style("fill",current_layers[e].fill_color.two[0]),U.insert("text").attrs({id:"col1_txt",x:84,y:H+31.5}).styles({"alignment-baseline":"middle","font-size":"10px"}).html("> "+current_layers[e].break_val.toLocaleString()),U.insert("rect").attrs({id:"col2",x:84,y:H+36,width:18,height:18}).style("fill",current_layers[e].fill_color.two[1]),H+=45}return F.append("g").insert("text").attrs({id:"legend_bottom_note",x:48,y:H+36}).styles({"font-size":"11px","font-family":"verdana"}).text(null!=p?p:""),F.call(y(F)),g(F,G,l),_==map&&m(F),F}function v(e,t,n,a,r,o,i){var l="legend legend_feature lgdf_"+_app.layer_to_id.get(e),s=document.getElementById(_app.layer_to_id.get(e)).getElementsByTagName("path"),p=Array.prototype.filter.call(s,function(e){return"0"!==e.style.strokeWidth}),_=+p[0].style.strokeWidth,u=+p[p.length-1].style.strokeWidth,f=(0,d.Mabs)(+p[0].__data__.properties[t]),h=(0,d.Mabs)(+p[p.length-1].__data__.properties[t]),v=_-u,x=f-h,w=h+x/3,k=u+v/3,A=[{size:_,value:f},{size:k+v/3,value:w+x/3},{size:k,value:w},{size:u,value:h}];void 0===o&&(o=b(A.map(function(e){return e.value})));var j=map.insert("g").attrs({id:"legend_root_lines_symbol",class:l,transform:"translate(0,0)",rounding_precision:o,layer_field:t,layer_name:e}).styles({cursor:"grab","font-size":"11px","font-family":"verdana"}),S=j.insert("rect");j.insert("text").attrs(""!=a?{id:"legendtitle",x:48,y:30}:{id:"legendtitle",x:48,y:45}).styles({"font-size":"12px","font-family":"verdana","font-weight":"bold"}).text(n||"Title"),j.insert("text").attrs({id:"legendsubtitle",x:48,y:45}).styles({"font-size":"12px","font-family":"verdana","font-style":"italic"}).text(a);var E=j.selectAll(".legend").append("g").data(A).enter().insert("g").attr("class",function(e,t){return"lg legend_"+t}),z=0,B=48,P=current_layers[e].fill_color.single;E.append("rect").styles({fill:P,stroke:"rgb(0, 0, 0)","fill-opacity":1,"stroke-width":0}).attrs(function(e){return B=12+B+z,z=e.size,{x:48,y:B,width:45,height:e.size}}),B=48,z=0;return E.append("text").attrs(function(e){return{x:123,y:(B=12+B+e.size)+4-e.size/2}}).styles({"alignment-baseline":"middle","font-size":"10px"}).text(function(e){return(0,c.round_value)(e.value,o).toLocaleString()}),j.append("g").insert("text").attrs({id:"legend_bottom_note",x:48,y:B+18}).styles({"font-size":"11px","font-family":"verdana"}).text(null!=i?i:""),j.call(y(j)),g(j,S,r),j.select("#legendtitle").text(n||""),m(j),j}var b=function(e){if(e.filter(function(e){return(0|e)===e}).length===e.length)return 0;for(var t=void 0,n=0;n<e.length-1;n++){var a=+e[n+1]-+e[n];t?a<t&&(t=a):t=a}return t>1||t>.1?1:t>.01?2:t>.001?3:t>1e-4?4:t>1e-5?5:t>1e-6?6:t>1e-7?7:void 0};function x(e,t,n,a){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments[5],i=arguments[6],l=arguments[7],s=arguments[8],p="legend legend_feature lgdf_"+_app.layer_to_id.get(e),d=+r,_=null,u=void 0;if(current_layers[e].renderer.indexOf("Categorical")>-1||current_layers[e].renderer.indexOf("PropSymbolsTypo")>-1)u=[],current_layers[e].color_map.forEach(function(e,t){u.push({value:e[1],color:e[0]})}),current_layers[e].color_map.size;else if(current_layers[e].renderer.indexOf("TypoSymbols")>-1)u=[],current_layers[e].symbols_map.forEach(function(e,t){u.push({value:e[2],image:e[0]})}),current_layers[e].symbols_map.size;else if(u=current_layers[e].colors_breaks.map(function(e){return{value:e[0],color:e[1]}}),current_layers[e].colors_breaks.length,void 0===i){var f=current_layers[e].options_disc.breaks;i=b(f)}var h=map.insert("g").styles({cursor:"grab","font-size":"11px","font-family":"verdana"}).attrs({id:"legend_root",class:p,layer_field:t,transform:"translate(0,0)",boxgap:d,rounding_precision:i,layer_name:e}),v=h.insert("rect");h.insert("text").attrs(""!=a?{id:"legendtitle",x:48,y:30}:{id:"legendtitle",x:48,y:45}).styles({"font-size":"12px","font-family":"verdana","font-weight":"bold"}).text(n||""),h.insert("text").attrs({id:"legendsubtitle",x:48,y:45}).styles({"font-size":"12px","font-family":"verdana","font-style":"italic"}).text(a);var x=h.selectAll(".legend").append("g").data(u).enter().insert("g").attr("class",function(e,t){return"lg legend_"+t});if(-1===current_layers[e].renderer.indexOf("TypoSymbols")?x.append("rect").attrs(function(e,t){return{x:48,y:_=62.4+t*d+18*t,width:18,height:18}}).styles(function(e){return{fill:e.color,stroke:e.color}}):x.append("image").attrs(function(e,t){return{x:48,y:62.4+t*d+18*t,width:18,height:18,"xlink:href":e.image}}),current_layers[e].renderer.indexOf("Choropleth")>-1||current_layers[e].renderer.indexOf("PropSymbolsChoro")>-1||current_layers[e].renderer.indexOf("Gridded")>-1||current_layers[e].renderer.indexOf("Stewart")>-1){var w=void 0;x.append("text").attrs(function(e,t){return{x:76,y:w=62.4+18*t+t*d}}).styles({"alignment-baseline":"middle","font-size":"10px"}).text(function(e){return(0,c.round_value)(+e.value.split(" - ")[1],i).toLocaleString()}),h.insert("text").attrs({id:"lgd_choro_min_val",x:76,y:w+18+d}).styles({"alignment-baseline":"middle","font-size":"10px"}).text(function(e){return(0,c.round_value)(u[u.length-1].value.split(" - ")[0],i).toLocaleString()})}else x.append("text").attr("x",76).attr("y",function(e,t){return 62.4+18*t+t*d+12}).styles({"alignment-baseline":"middle","font-size":"10px"}).text(function(e){return e.value});if(current_layers[e].options_disc&&current_layers[e].options_disc.no_data){var k=h.append("g");k.append("rect").attrs({x:48,y:_+36,width:18,height:18}).styles({fill:current_layers[e].options_disc.no_data,stroke:current_layers[e].options_disc.no_data}),k.append("text").attrs({x:76,y:_+48.6,id:"no_data_txt"}).styles({"alignment-baseline":"middle","font-size":"10px"}).text(null!=l?l:"No data"),_+=36}return h.append("g").insert("text").attrs({id:"legend_bottom_note",x:48,y:_+36}).styles({"font-size":"11px","font-family":"verdana"}).text(null!=s?s:""),h.call(y(h)),g(h,v,o),m(h),h}function k(e,t,n,a){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments[5],i=arguments[6],l=arguments[7],s=arguments[8],p="legend legend_feature lgdf_"+_app.layer_to_id.get(e),d=+r,_=current_layers[e].colors_breaks.map(function(e){return{value:e[0],color:e[1]}}).reverse();void 0===i&&(i=b(current_layers[e].options_disc.breaks));var u=map.insert("g").styles({cursor:"grab","font-size":"11px","font-family":"verdana"}).attrs({id:"legend_root_horiz",class:p,layer_field:t,transform:"translate(0,0)",boxgap:d,rounding_precision:i,layer_name:e}),f=u.insert("rect"),h=""!==a?{id:"legendtitle",x:72,y:30,"text-anchor":"middle"}:{id:"legendtitle",x:72,y:45,"text-anchor":"middle"},v=u.insert("text").styles({"font-size":"12px","font-family":"verdana","font-weight":"bold"}).attrs(h),x=u.insert("text").styles({"font-size":"12px","font-family":"verdana","font-style":"italic"}).attrs({id:"legendsubtitle",x:72,y:45,"text-anchor":"middle"}),w=u.selectAll(".legend").append("g").data(_).enter().insert("g").attr("class",function(e,t){return"lg legend_"+t});if(w.append("rect").attr("x",function(e,t){return 30+(d+42)*t}).attr("y",58.8).attrs({width:42,height:16}).styles(function(e){return{fill:e.color,stroke:e.color}}),w.append("text").attr("x",function(e,t){return 30+(d+42)*t}).attr("y",94.8).attr("text-anchor","middle").styles({"font-size":"10px"}).text(function(e){return(0,c.round_value)(+e.value.split(" - ")[0],i).toLocaleString()}),u.insert("text").attrs({id:"lgd_choro_min_val",x:30+(d+42)*_.length,y:94.8,"text-anchor":"middle"}).styles({"font-size":"10px"}).text(function(e){return(0,c.round_value)(_[_.length-1].value.split(" - ")[1],i).toLocaleString()}),current_layers[e].options_disc&&current_layers[e].options_disc.no_data){var k=u.append("g");k.append("rect").attrs({x:72+(d+42)*_.length,y:58.8,width:42,height:16}).styles({fill:current_layers[e].options_disc.no_data,stroke:current_layers[e].options_disc.no_data}),k.append("text").attrs({x:51+(d+42)*(_.length+1),y:94.8,id:"no_data_txt","text-anchor":"middle"}).styles({"font-size":"10px"}).text(null!=l?l:"No data")}var A=u.append("g").insert("text").attrs({id:"legend_bottom_note",x:72,y:114.8,"text-anchor":"middle"}).styles({"font-size":"11px","font-family":"verdana"}),j=u.node().getBBox(),S=j.x+j.width/2;return v.attr("x",S).text(n||""),x.attr("x",S).text(a),A.attr("x",S).text(null!=s?s:""),u.call(y(u)),g(u,f,o),m(u),u}function A(t){var n,r,o,i,l,_,u,m,y=current_layers[t].symbol,g=current_layers[t].rendered_field,h=document.getElementById(_app.layer_to_id.get(t)).getElementsByTagName(y),v="circle"===y?"r":"width",b=Array.prototype.filter.call(h,function(e,t){if(0!=e[v].baseVal.value)return e[v].baseVal.value}),x=(0,d.Mabs)(+b[0].__data__.properties[g]),w=(n=svg_map.querySelector(["#legend_root_symbol.lgdf_",_app.layer_to_id.get(t)].join("")),r=current_layers[t].rendered_field,o=n.getAttribute("nested"),i=n.getAttribute("join_line"),l=n.getAttribute("rounding_precision"),_=n.querySelector("#legendtitle").innerHTML,u=n.querySelector("#legendsubtitle").innerHTML,m=n.querySelector("#legend_bottom_note").innerHTML,function(e){e&&(current_layers[t].size_legend_symbol=e.sort(function(e,t){return t.value-e.value}),T.property("value",e[0].value),N.property("value",e[1].value),F.property("value",e[2].value),G.property("value",e[3].value)),j.selectAll("g").remove(),f(t,r,_,u,o,i,{},l,m,{parent:j}),j.select("g").select("#under_rect").remove(),j.select("#legend_root_symbol").on(".drag",null)}),k=(0,s.make_confirm_dialog2)("legend_symbol_values_box",t+" - "+i18next.t("app_page.legend_symbol_values_box.title")).then(function(n){return current_layers[t].size_legend_symbol=n?current_layers[t].size_legend_symbol:L,e.resolve(n)}),A=d3.select(".legend_symbol_values_box").select(".modal-content").style("width","400px").select(".modal-body");A.append("p").style("text-align","center").insert("h3");var j=A.append("div").attr("id","sample_svg").style("float","left").append("svg").attrs({width:200,height:300,id:"svg_sample_legend"}),S=[].concat(current_layers[t].size_legend_symbol.map(function(e){return(0,p.cloneObj)(e)})),E=a(current_layers[t].size,2),z=E[0],B=E[1],P=new c.PropSizer(z,B,y),O=A.append("div").styles({float:"right",top:"100px",right:"20px",position:"relative"}),C=O.append("p"),M=O.append("p"),I=O.append("p"),q=O.append("p"),L=[].concat(S),T=C.insert("input").style("width","80px").attrs({class:"without_spinner",type:"number",max:x}).property("value",S[0].value).on("change",function(){var e=+this.value;isNaN(e)||(S[0]={size:P.scale(e),value:e},N.attr("max",e),w(S))}),N=M.insert("input").style("width","80px").attrs({class:"without_spinner",type:"number",max:S[0].value,min:S[2]}).property("value",S[1].value).on("change",function(){var e=+this.value;isNaN(e)||(S[1]={size:P.scale(e),value:e},T.attr("min",e),F.attr("max",e),w(S))}),F=I.insert("input").style("width","80px").attrs({class:"without_spinner",type:"number",max:S[1].value,min:S[3].value}).property("value",S[2].value).on("change",function(){var e=+this.value;isNaN(e)||(S[2]={size:P.scale(e),value:e},N.attr("min",e),G.attr("max",e),w(S))}),G=q.insert("input").style("width","80px").attrs({class:"without_spinner",type:"number",min:0,max:S[2].value}).property("value",S[3].value).on("change",function(){var e=+this.value;isNaN(e)||(S[3]={size:P.scale(e),value:e},F.attr("min",e),w(S))});return A.append("div").styles({clear:"both","text-align":"center"}).append("p").styles({"text-align":"center"}).insert("span").attrs({class:"button_st3"}).html(i18next.t("app_page.legend_symbol_values_box.reset")).on("click",function(){current_layers[t].size_legend_symbol=void 0,w(L)}),w(),k}function j(e,t){function n(){r=[a,"_legend_popup"].join(""),o=svg_map.querySelector(["#",e,".lgdf_",a].join("")),i=o.querySelector("#legendtitle"),d=o.querySelector("#legendsubtitle"),_=o.querySelector("#legend_bottom_note"),y=o.querySelector("#no_data_txt"),h=o.querySelector("#ratio_txt"),u=d3.select(o),m=u.selectAll(["#",e," .lg"].join("")).select("text")}var a=_app.layer_to_id.get(t),r=void 0,o=void 0,i=void 0,d=void 0,_=void 0,u=void 0,m=void 0,y=void 0,h=void 0,v={},b=void 0;n(),document.querySelector("."+r)&&document.querySelector("."+r).remove();var w={title_content:i.textContent,y_title:i.y.baseVal.getItem(0).value,subtitle_content:d.textContent,y_subtitle:d.y.baseVal.getItem(0).value,note_content:_.textContent,no_data_txt:null!=y?y.textContent:null,ratio_waffle_txt:null!=h?h.textContent:null,boxgap:+o.getAttribute("boxgap")};"true"===o.getAttribute("visible_rect")&&(v={color:o.querySelector("#under_rect").style.fill,opacity:o.querySelector("#under_rect").style.fillOpacity},b=(0,p.cloneObj)(v)),(0,s.make_confirm_dialog2)(r,t).then(function(e){e||(i.textContent=w.title_content,i.y.baseVal.getItem(0).value=w.y_title,d.textContent=w.subtitle_content,d.y.baseVal.getItem(0).value=w.y_subtitle,_.textContent=w.note_content,y?y.textContent=w.no_data_txt:h&&(h.textContent=w.ratio_waffle_txt),v=b),g(u,u.select("#under_rect"),v),n()});var j=document.querySelectorAll("."+r)[0],z=d3.select(j).select(".modal-dialog").style("width","375px").select(".modal-body"),B=void 0;z.append("p").style("text-align","center").insert("h3").html(i18next.t("app_page.legend_style_box.subtitle"));var P=z.append("p");P.append("span").html(i18next.t("app_page.legend_style_box.lgd_title")),P.append("input").style("float","right").property("value",i.textContent).on("keyup",function(){i.textContent=this.value});var O=z.append("p");O.insert("span").html(i18next.t("app_page.legend_style_box.var_name")),O.insert("input").style("float","right").property("value",d.textContent).on("keyup",function(){var e=""==d.textContent;e&&""!=this.value&&(i.y.baseVal.getItem(0).value=i.y.baseVal.getItem(0).value-15),d.textContent=this.value,e||""!=d.textContent||(i.y.baseVal.getItem(0).value=i.y.baseVal.getItem(0).value+15)});var C=z.insert("p");if(C.insert("span").html(i18next.t("app_page.legend_style_box.additionnal_notes")),C.insert("input").styles({float:"right","font-family":"12px Gill Sans Extrabold, sans-serif"}).property("value",_.textContent).on("keyup",function(){_.textContent=this.value}),y){var M=z.insert("p");M.insert("span").html(i18next.t("app_page.legend_style_box.no_data")),M.insert("input").styles({float:"right","font-family":"12px Gill Sans Extrabold, sans-serif"}).property("value",y.textContent).on("keyup",function(){y.textContent=this.value})}else if(h){var I=z.insert("p");I.insert("span").html(i18next.t("app_page.legend_style_box.ratio_waffle_txt")),I.insert("input").styles({float:"right","font-family":"12px Gill Sans Extrabold, sans-serif"}).property("value",h.textContent).on("keyup",function(){h.textContent=this.value})}"legend_root_symbol"===e&&z.insert("p").styles({"text-align":"center","margin-top":"25px !important"}).append("span").attr("class","button_disc").styles({cursor:"pointer"}).html(i18next.t("app_page.legend_style_box.choice_break_symbol")).on("click",function(){j.modal.hide(),A(t).then(function(e){j.modal.show(),e&&redraw_legends_symbols(svg_map.querySelector(["#legend_root_symbol.lgdf_",_app.layer_to_id.get(t)].join("")))})});if("TwoStocksWaffle"!==current_layers[t].renderer&&"Categorical"!==current_layers[t].renderer&&"TypoSymbols"!==current_layers[t].renderer&&!("PropSymbolsTypo"===current_layers[t].renderer&&e.indexOf("legend_root_symbol")<0)){var q=0,L=0;if(-1===e.indexOf("legend_root_symbol"))q=S(t),L=E(t);else{var T=[],N=[];m.each(function(e){T.push((0,c.get_nb_decimals)(e.value)),N.push((0,c.get_nb_left_separator)(e.value))}),q=(0,c.max_fast)(T),L=(0,c.min_fast)(N)}if(L=L>2?L:2,q>0||L>=2){if(o.getAttribute("rounding_precision"))B=o.getAttribute("rounding_precision");else{var F=[],G=[];m.each(function(){F.push(this.textContent)});for(var D=0;D<F.length;D++)G.push((0,c.get_nb_decimals)(F[D]));B=(0,c.max_fast)(G)}q>+B&&q>18&&(q=18);var R=z.append("p");R.append("span").html(i18next.t("app_page.legend_style_box.float_rounding")),R.append("input").attrs({id:"precision_range",type:"range",min:-+L,max:q,step:1}).styles({float:"right",width:"90px","vertical-align":"middle","margin-left":"10px"}).property("value",B).on("change",function(){var t=+this.value;if(d3.select("#precision_change_txt").html(t),o.setAttribute("rounding_precision",t),"legend_root"===e){for(var n=0;n<m._groups[0].length;n++){var a=m._groups[0][n].__data__.value.split(" - ");m._groups[0][n].innerHTML=(0,c.round_value)(+a[1],t).toLocaleString()}var r=+m._groups[0][m._groups[0].length-1].__data__.value.split(" - ")[0];o.querySelector("#lgd_choro_min_val").innerHTML=(0,c.round_value)(r,t).toLocaleString()}else if("legend_root_horiz"===e){for(var i=0;i<m._groups[0].length;i++){var l=m._groups[0][i].__data__.value.split(" - ");m._groups[0][i].innerHTML=(0,c.round_value)(+l[0],t).toLocaleString()}var s=+m._groups[0][m._groups[0].length-1].__data__.value.split(" - ")[1];o.querySelector("#lgd_choro_min_val").innerHTML=(0,c.round_value)(s,t).toLocaleString()}else if("legend_root_symbol"===e)for(var p=0;p<m._groups[0].length;p++){var d=m._groups[0][p].__data__.value;m._groups[0][p].innerHTML=(0,c.round_value)(+d,t).toLocaleString()}else if("legend_root_lines_class"===e){for(var _=0;_<m._groups[0].length;_++){var u=m._groups[0][_].__data__.value[1];m._groups[0][_].innerHTML=(0,c.round_value)(+u,t).toLocaleString()}var y=+m._groups[0][m._groups[0].length-1].__data__.value[0];o.querySelector("#lgd_choro_min_val").innerHTML=(0,c.round_value)(y,t).toLocaleString()}}),R.append("span").style("float","right").attr("id","precision_change_txt").html(""+B)}}if("legend_root"===e||"legend_root_horiz"===e){var W=0==+o.getAttribute("boxgap"),H=z.insert("p");H.append("input").style("margin-left","0px").attrs({type:"checkbox",id:"style_lgd"}).property("checked",W).on("change",function(){var a=current_layers[t].rendered_field2?current_layers[t].rendered_field2:current_layers[t].rendered_field,r=0==+(o=svg_map.querySelector("#"+e+".lgdf_"+_app.layer_to_id.get(t))).getAttribute("boxgap")?4:0,i=o.getAttribute("rounding_precision"),l=o.getAttribute("transform"),s=o.querySelector("#legendtitle").innerHTML,p=o.querySelector("#legendsubtitle").innerHTML,c=o.querySelector("#legend_bottom_note").innerHTML,d=o.querySelector("#no_data_txt");d=null!=d?d.textContent:null,o.remove(),"legend_root"===e?x(t,a,s,p,r,v,i,d,c):"legend_root_horiz"===e&&k(t,a,s,p,r,v,i,d,c),n(),l&&svg_map.querySelector("#"+e+".lgdf_"+_app.layer_to_id.get(t)).setAttribute("transform",l)}),H.append("label").attrs({for:"style_lgd",class:"i18n","data-i18n":"[html]app_page.legend_style_box.gap_boxes"}).html(i18next.t("app_page.legend_style_box.gap_boxes"))}else if("legend_root_symbol"===e){var V=current_layers[t].symbol,U="true"===o.getAttribute("nested"),Y=z.insert("p");Y.append("input").style("margin-left","0px").attrs({id:"style_lgd",type:"checkbox"}).property("checked",U).on("change",function(){K.style("display",this.checked&&"circle"===V?null:"none"),o=svg_map.querySelector(["#legend_root_symbol.lgdf_",_app.layer_to_id.get(t)].join(""));var e=current_layers[t].rendered_field,a=this.checked?"true":"false",r=K.select("input").property("checked")?"true":"false",i=o.getAttribute("rounding_precision"),l=o.getAttribute("transform"),s=o.querySelector("#legendtitle").innerHTML,p=o.querySelector("#legendsubtitle").innerHTML,c=o.querySelector("#legend_bottom_note").innerHTML;o.remove(),f(t,e,s,p,a,r,v,i,c),n(),l&&svg_map.querySelector(["#legend_root_symbol.lgdf_",_app.layer_to_id.get(t)].join("")).setAttribute("transform",l)}),Y.append("label").attrs({for:"style_lgd",class:"i18n","data-i18n":"[html]app_page.legend_style_box.nested_symbols"}).html(i18next.t("app_page.legend_style_box.nested_symbols"));var J="true"===o.getAttribute("join_line"),K=z.insert("p").style("display",U&&"circle"===V?null:"none");K.append("input").style("margin-left","0px").attrs({id:"style_lgd_join_line",type:"checkbox"}).property("checked",J).on("change",function(){o=svg_map.querySelector(["#legend_root_symbol.lgdf_",_app.layer_to_id.get(t)].join(""));var e=current_layers[t].rendered_field,a="true"===o.getAttribute("nested")?"true":"false",r=this.checked?"true":"false",i=o.getAttribute("rounding_precision"),l=o.getAttribute("transform"),s=o.querySelector("#legendtitle").innerHTML,p=o.querySelector("#legendsubtitle").innerHTML,c=o.querySelector("#legend_bottom_note").innerHTML;o.remove(),f(t,e,s,p,a,r,v,i,c),n(),l&&svg_map.querySelector(["#legend_root_symbol.lgdf_",_app.layer_to_id.get(t)].join("")).setAttribute("transform",l)}),K.append("label").attrs({for:"style_lgd_join_line",class:"i18n","data-i18n":"[html]app_page.legend_style_box.join_line"}).html(i18next.t("app_page.legend_style_box.join_line"))}var Q=z.insert("p");Q.insert("input").style("margin-left","0px").property("checked",void 0!==v.color||null).attrs({type:"checkbox",id:"rect_lgd_checkbox"}).on("change",function(){if(this.checked){X.style("display","");var e=document.getElementById("choice_color_under_rect");v=e?{color:e.value,opacity:1}:{color:"#ffffff",opacity:1}}else X.style("display","none"),v={};g(u,u.select("#under_rect"),v)}),Q.append("label").attrs({for:"rect_lgd_checkbox",class:"i18n","data-i18n":"[html]app_page.legend_style_box.under_rectangle"}).html(i18next.t("app_page.legend_style_box.under_rectangle"));var X=Q.insert("span").styles({float:"right",display:void 0===v.color?"none":""});if(X.insert("input").attrs({id:"choice_color_under_rect",type:"color"}).property("value",void 0===v.color?"#ffffff":(0,l.rgb2hex)(v.color)).on("change",function(){v={color:this.value,opacity:1},g(u,u.select("#under_rect"),v)}),"legend_root_horiz"===e||"legend_root"===e&&current_layers[t].options_disc){var Z=z.insert("p");Z.append("p").attr("id","vert_layout").attr("class","legend_root"===e?"opts_lgd_layout selected":"opts_lgd_layout").text(i18next.t("app_page.legend_style_box.lgd_layout_vertical")),Z.append("p").attr("id","horiz_layout").attr("class","legend_root"!==e?"opts_lgd_layout selected":"opts_lgd_layout").text(i18next.t("app_page.legend_style_box.lgd_layout_horizontal"));Z.selectAll(".opts_lgd_layout").on("click",function(){if(!this.classList.contains("selected")){Z.selectAll(".opts_lgd_layout").attr("class","opts_lgd_layout"),this.classList.add("selected");var a=current_layers[t].rendered_field2?current_layers[t].rendered_field2:current_layers[t].rendered_field,r=+(o=svg_map.querySelector("#"+e+".lgdf_"+_app.layer_to_id.get(t))).getAttribute("boxgap"),i=o.getAttribute("rounding_precision"),l=o.getAttribute("transform"),s=o.querySelector("#legendtitle").innerHTML,p=o.querySelector("#legendsubtitle").innerHTML,c=o.querySelector("#legend_bottom_note").innerHTML,d=o.querySelector("#no_data_txt");d=null!=d?d.textContent:null,o.remove(),"horiz_layout"===this.id?(k(t,a,s,p,r,v,i,d,c),e="legend_root_horiz"):(x(t,a,s,p,r,v,i,d,c),e="legend_root"),n(),l&&svg_map.querySelector("#"+e+".lgdf_"+_app.layer_to_id.get(t)).setAttribute("transform",l)}})}}var S=function(e){if(current_layers[e]&&current_layers[e].colors_breaks){var t=0;return current_layers[e].colors_breaks.forEach(function(e){var n=e[0].split(" - "),a=n[0].indexOf("."),r=n[1].indexOf(".");a>-1&&n[0].length-1-a>t&&(t=n[0].length-1-n[0].indexOf(".")),r>-1&&n[1].length-1-r>t&&(t=n[1].length-1-n[1].indexOf("."))}),t}};var E=function(e){if(current_layers[e]&&current_layers[e].colors_breaks){var t=[];return current_layers[e].colors_breaks.forEach(function(e){var n=e[0].split(" - "),a=n[0].indexOf("."),r=n[1].indexOf(".");t.push(a),t.push(r)}),(0,c.min_fast)(t)}}}).call(this,n(5))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.render_label_graticule=t.render_label=t.get_menu_option=void 0;var a=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,r=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(a=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(r)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();t.clean_menu_function=function(){fields_handler&&fields_handler.unfill&&(fields_handler.unfill(),fields_handler=void 0);if(_app.current_functionnality&&_app.current_functionnality.name){var e=document.getElementById("button_"+_app.current_functionnality.name);"grayscale(100%)"!==e.style.filter&&(e.style.filter="invert(0%) saturate(100%)"),e.classList.remove("active"),_app.current_functionnality=void 0}section2.select(".form-rendering").remove(),document.getElementById("accordion2b").style.display="none";var t=document.getElementById("btn_s2b");t.innerHTML=i18next.t("app_page.section2_.title_no_choice"),t.setAttribute("data-i18n","app_page.section2_.title_no_choice"),t.style.display="none"},t.reset_user_values=function(){re.box_typo=void 0,re.rendering_params={},re.cats={},q.rendering_params={},T.rendering_params={},F.rendering_params={},X.rendering_params={}},t.check_layer_name=b;var r,o=n(9),i=(r=o)&&r.__esModule?r:{default:r},l=n(8),s=n(26),p=n(24),c=n(3),d=n(7),_=n(6),u=n(2),m=n(15),y=n(11),g=n(39);var f;t.get_menu_option=(f={smooth:{name:"smooth",menu_factory:function(){return R},fields_handler:function(){return G}},prop:{name:"prop",menu_factory:function(){return te},fields_handler:function(){return ne}},choroprop:{name:"choroprop",menu_factory:function(){return I},fields_handler:function(){return q}},proptypo:{name:"proptypo",menu_factory:function(){return K},fields_handler:function(){return X}},choro:{name:"choro",menu_factory:function(){return N},fields_handler:function(){return F}},cartogram:{name:"cartogram",menu_factory:function(){return H},fields_handler:function(){return W}},grid:{name:"grid",menu_factory:function(){return oe},fields_handler:function(){return ie}},flow:{name:"flow",menu_factory:function(){return le},fields_handler:function(){return se}},discont:{name:"discont",menu_factory:function(){return Z},fields_handler:function(){return $}},typo:{name:"typo",menu_factory:function(){return L},fields_handler:function(){return T}},typosymbol:{name:"typosymbol",menu_factory:function(){return ae},fields_handler:function(){return re}},two_stocks:{name:"two_stocks",menu_factory:function(){return C},fields_handler:function(){return M}}},function(e){return f[e.toLowerCase()]||{}});function v(e){e.innerHTML=""}function b(e){var t=e.replace(/[^a-zA-Z0-9_-]/g,"_");if(t.match(/^\d+/)&&(t="_"+t),!current_layers.hasOwnProperty(t)&&["Graticule","World"].indexOf(t)<0)return t;var n=1,a=t.match(/_\d+$/);return a?(n=a[0],b([t=t.substring(t,t.indexOf(n)),parseInt(n.slice(1,n.length),10)+1].join("_"))):b([t,n].join("_"))}function x(){swal({title:"",text:i18next.t("app_page.common.error_type_fields"),type:"error"})}function w(e){swal({title:"",text:i18next.t("app_page.common.warning_empty_geom",{count:e.length}),type:"warning",showCancelButton:!1,allowOutsideClick:!1,confirmButtonColor:"#DD6B55",confirmButtonText:i18next.t("app_page.common.valid")+"!"})}var k=function(e){var t=_target_layer_file.bbox,n=(Object.getOwnPropertyNames(_target_layer_file.objects),"grid"===e?.09:.05),a=(0,d.haversine_dist)([t[0],(0,_.Mabs)(t[3])-(0,_.Mabs)(t[1])],[t[2],(0,_.Mabs)(t[3])-(0,_.Mabs)(t[1])]),r=(0,d.haversine_dist)([(0,_.Mabs)(t[2])-(0,_.Mabs)(t[0]),t[1]],[(0,_.Mabs)(t[2])-(0,_.Mabs)(t[0]),t[3]]),o=(0,_.Mmax)(a,r)*n;return o>10?10*(0,_.Mround)(o/10):(0,_.Mround)(o)};function A(e){var t=_target_layer_file.bbox,n=(0,d.haversine_dist)([t[0],(0,_.Mabs)(t[3])-(0,_.Mabs)(t[1])],[t[2],(0,_.Mabs)(t[3])-(0,_.Mabs)(t[1])]),a=(0,d.haversine_dist)([(0,_.Mabs)(t[2])-(0,_.Mabs)(t[0]),t[1]],[(0,_.Mabs)(t[2])-(0,_.Mabs)(t[0]),t[3]]),r=(0,_.Mmax)(a,n);return n*a/(e*e)>15e3?"higher":e>r/1.66?"lower":void 0}var j,S=(j=new Set(["q6","equal_interval","jenks","quantiles"]),function(e){if(e){var t=e.toLowerCase();j.has(t)&&(document.getElementById("ico_"+t).style.border="solid 1px green")}});function E(e){return e.append("div").attr("class","form-rendering")}function z(e,t,n){var a=e.append("p").style("clear","both");a.append("span").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.common.output"}).html(i18next.t("app_page.func_options.common.output")),a.insert("input").styles({width:"240px","font-size":"11.5px","margin-top":n}).attrs({class:"params",id:t})}function B(e){e.append("div").insert("span").attrs({"data-i18n":"[html]app_page.func_options.common.discretization_choice",class:"i18n"}).html(i18next.t("app_page.func_options.common.discretization_choice"));var t=e.append("p").style("margin","10px 0 0");t.append("img").styles({margin:"0 7.5px",cursor:"pointer"}).attrs({title:i18next.t("app_page.common.Q6"),src:"/static/img/discr_icons/q6.png",id:"ico_q6",class:"i18n","data-i18n":"[title]app_page.common.Q6"}),t.append("img").styles({margin:"0 7.5px",cursor:"pointer"}).attrs({title:i18next.t("app_page.common.jenks"),src:"/static/img/discr_icons/jenks.png",id:"ico_jenks",class:"i18n","data-i18n":"[title]app_page.common.jenks"}),t.append("img").styles({margin:"0 7.5px",cursor:"pointer"}).attrs({title:i18next.t("app_page.common.equal_interval"),src:"/static/img/discr_icons/equal_intervals.png",id:"ico_equal_interval",class:"i18n","data-i18n":"[title]app_page.common.equal_interval"}),t.append("img").styles({margin:"0 7.5px",cursor:"pointer"}).attrs({title:i18next.t("app_page.common.quantiles"),src:"/static/img/discr_icons/quantiles.png",id:"ico_quantiles",class:"i18n","data-i18n":"[title]app_page.common.quantiles"}),t.append("img").styles({margin:"0 7.5px",cursor:"pointer",width:"20px"}).attrs({title:i18next.t("app_page.common.user_defined"),src:"/static/img/High-contrast-system-run24.png",id:"ico_others",class:"i18n","data-i18n":"[title]app_page.common.user_defined"}),t.append("span").attrs({id:"choro_mini_choice_disc"}).styles({float:"right","margin-top":"5px","margin-left":"15px"}),t.append("img").styles({width:"15px",position:"absolute",right:"5px"}).attrs({id:"img_choice_disc",src:"/static/img/Red_x.png"})}function P(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e.append("p").styles({clear:"both","text-align":"right",margin:"auto"}).append("button").attrs({id:t,class:"params button_st3 i18n","data-i18n":"[html]app_page.func_options.common.render",disabled:!!n||null}).html(i18next.t("app_page.func_options.common.render"))}function O(e,t,n,a,r,o,i,l){var s=document.getElementById(o);if((s.innerHTML="",e&&void 0===i)&&!(i=(0,p.discretize_to_size)(e,n,t,a,r)[2]))return!1;s.style.marginTop="3px",s.style.marginBottom="3px";var c=document.createElement("p");c.style.margin="1px",c.style.wordSpacing="1.8em",c.style.paddingLeft="22px",c.innerHTML="Min - Max - Size",s.appendChild(c);var d=document.createElement("div");s.appendChild(d);for(var _=0;_<i.length;_++){var u=document.createElement("p");u.setAttribute("class","breaks_vals"),u.id=["line",_].join("_"),u.style.margin="0px";var m=document.createElement("input");m.setAttribute("type","number"),m.setAttribute("class","min_class"),m.setAttribute("step","any"),m.value=(+i[_][0][0]).toFixed(2),m.style.position="unset",u.appendChild(m);var y=document.createElement("input");y.setAttribute("type","number"),y.setAttribute("class","max_class"),y.setAttribute("step","any"),y.value=(+i[_][0][1]).toFixed(2),y.style.position="unset",u.appendChild(y);var g=document.createElement("input");g.setAttribute("type","number"),g.setAttribute("class","size_class"),g.setAttribute("step","any"),g.value=(+i[_][1]).toFixed(2),g.style.marginLeft="20px",g.style.position="unset",u.appendChild(g);var f=document.createElement("span");f.innerHTML=" px",u.appendChild(f),d.appendChild(u)}for(var h=document.getElementById(o).querySelectorAll(".min_class"),v=document.getElementById(o).querySelectorAll(".max_class"),b=0;b<h.length;b++)b>0&&function(){var e=b-1;h[b].onchange=function(){v[e].value=this.value,l&&l()}}(),b<h.length-1&&function(){var e=b+1;v[b].onchange=function(){h[e].value=this.value,l&&l()}}();if(l)for(var x=document.getElementById(o).querySelectorAll(".size_class"),w=0;w<x.length;w++)x[w].onchange=l}function C(e){var t=E(section2),n=t.append("p").attr("class","params_section2");n.append("span").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.twostocks.fields"}).html(i18next.t("app_page.func_options.twostocks.fields")),n.insert("select").attrs({class:"params",id:"TwoStocks_fields",multiple:"multiple",size:2});var a=t.append("p").attr("class","params_section2");a.append("span").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.twostocks.symbol_choice"}).html(i18next.t("app_page.func_options.twostocks.symbol_choice")),a.insert("select").attrs({class:"params",id:"TwoStocks_waffle_symbol"});var r=t.append("p").attr("class","params_section2");r.append("span").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.twostocks.waffle_size_circle",id:"TwoStocks_waffle_size_txt"}).html(i18next.t("app_page.func_options.twostocks.waffle_size_circle")),r.insert("input").attrs({id:"TwoStocks_waffle_size",type:"number",class:"params",min:1,max:20,step:1,value:3}).style("width","50px"),r.append("span").html(" (px)");var o=t.append("p").attr("class","params_section2");o.append("span").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.twostocks.waffle_width_rows"}).html(i18next.t("app_page.func_options.twostocks.waffle_width_rows")),o.insert("input").attrs({id:"TwoStocks_waffle_WidthRow",class:"params",type:"number",min:2,max:8,value:2,step:1}).style("width","50px");var i=t.append("p").attr("class","params_section2");i.append("span").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.twostocks.waffle_ratio"}).html(i18next.t("app_page.func_options.twostocks.waffle_ratio")),i.insert("input").attrs({id:"TwoStocks_waffle_ratio",class:"params",type:"number",min:1,max:1e6,value:100,step:1}).style("width","50px"),i.append("span").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.twostocks.waffle_ratio_units"}).html(i18next.t("app_page.func_options.twostocks.waffle_ratio_units")),z(t,"TwoStocks_output_name","15px"),P(t,"twoStocks_yes"),t.selectAll(".params").attr("disabled",!0)}var M={fill:function(e){if(e){section2.selectAll(".params").attr("disabled",null);var t=(0,c.getFieldsType)("stock",e),n=section2.select("#TwoStocks_waffle_symbol"),a=section2.select("#TwoStocks_fields"),r=section2.select("#twoStocks_yes"),o=(section2.select("#TwoStocks_waffle_ratio"),section2.select("#TwoStocks_output_name"));[["app_page.func_options.common.symbol_circle","circle"],["app_page.func_options.common.symbol_square","rect"]].forEach(function(e){n.append("option").text(i18next.t(e[0])).attrs({value:e[1],"data-i18n":"[text]"+e[0]})});var i=t.length<=4?t.length:4;t.forEach(function(e){a.append("option").text(e).attr("value",e)}),a.node().parentElement.style.marginBottom=16*i+"px",a.attr("size",i),n.on("change",function(){"circle"===this.value?section2.select("#TwoStocks_waffle_size_txt").attr("data-i18n","[html]app_page.func_options.twostocks.waffle_size_circle").text(i18next.t("app_page.func_options.twostocks.waffle_size_circle")):section2.select("#TwoStocks_waffle_size_txt").attr("data-i18n","[html]app_page.func_options.twostocks.waffle_size_square").text(i18next.t("app_page.func_options.twostocks.waffle_size_square"))}),o.node().value=e+"_Waffle",r.on("click",function(){var t={},r=document.getElementById("TwoStocks_output_name").value;if(r=b(r.length>0?r:e+"_Waffle"),t.ratio=+document.getElementById("TwoStocks_waffle_ratio").value,t.fields=Array.prototype.slice.call(a.node().selectedOptions).map(function(e){return e.value}),t.fields.length<2)swal({title:i18next.t("app_page.common.error")+"!",text:""+i18next.t("app_page.common.error_multiple_fields"),customClass:"swal2_custom",type:"error",allowOutsideClick:!1});else{for(var o=0,i=function(n){var a=t.fields[n];o+=(0,d.max_fast)(user_data[e].map(function(e){return+e[a]}))/t.ratio},s=0;s<t.fields.length;s++)i(s);o>900?swal({title:i18next.t("app_page.common.error")+"!",text:""+i18next.t("app_page.common.error_waffle_too_many"),customClass:"swal2_custom",type:"error",allowOutsideClick:!1}):(t.new_name=r,t.symbol_type=n.node().value,t.size=+document.getElementById("TwoStocks_waffle_size").value,t.nCol=+document.getElementById("TwoStocks_waffle_WidthRow").value,function(e,t){var n=Math.round,a=Math.floor,r=t.ratio,o=t.symbol_type,i=t.nCol,s=t.fields,p=t.new_name,_=s.length,u=[],m=[],y=void 0,g=encodeId(p);if(_app.layer_to_id.set(p,g),_app.id_to_layer.set(g,p),t.result_data)y=t.ref_colors,result_data[p]=JSON.parse(t.result_data);else{y=function(e){for(var t=[],n=0;n<e;n++)t.push((0,l.randomColor)());return t}(_),result_data[p]=[];var f=map.select("#"+_app.layer_to_id.get(e)).selectAll("path"),h=function(e){for(var t=[],n=0,a=e.length;n<a;++n){var r=e[n].__data__.geometry;if(r)if(r.type.indexOf("Multi")<0)t.push(d3.geoCentroid(r));else{for(var o=[],i=0;i<r.coordinates.length;i++)o.push(path.area({type:r.type,coordinates:[r.coordinates[i]]}));t.push(d3.geoCentroid({type:r.type,coordinates:[r.coordinates[o.indexOf((0,d.max_fast)(o))]]}))}else t.push(null)}return t}(f._groups[0]),v=[];f.each(function(t,n){if(h[n]){for(var a={id:t.id,centroid:h[n]},r=0;r<_;r++){var o=s[r];a[o]=+user_data[e][n][o]}result_data[p].push(a)}else v.push(t)}),v.length>0&&w(v)}for(var b=0,x=result_data[p].length;b<x;b++){for(var k=[],A=0,j=void 0,S=0;S<_;S++){var E=result_data[p][b][s[S]]/r;A+=E,j=y[S];for(var z=0;z<E;z++)k.push(j)}u.push(k),m.push(A)}var B=result_data[p].length,P=map.insert("g",".legend").attrs({id:g,class:"layer no_clip"});if("circle"===o)for(var O=t.size,C=0;C<result_data[p].length;C++){for(var M=path.centroid({type:"Point",coordinates:result_data[p][C].centroid}),I=P.append("g"),q=m[C],L=u[C],T=0;T<q;T++){var N=n(T%i*2*O),F=a(2*a(T/i)*O);I.append("circle").attrs({transform:"translate(-"+N+", -"+F+")",cx:M[0],cy:M[1],r:O,id:["waffle_",T," feature_",result_data[p][C].id].join(""),fill:L[T]})}I.node().__data__={properties:result_data[p][C]},I.call(drag_waffle)}else if("rect"===o)for(var G=t.size,D=G/5,R=0;R<result_data[p].length;R++){for(var W=path.centroid({type:"Point",coordinates:result_data[p][R].centroid}),H=P.append("g"),V=m[R],U=u[R],Y=0;Y<V;Y++){var J=n(Y%i*G)+D*n(Y%i),K=a(a(Y/i)*G)+D*a(Y/i);H.append("rect").attrs({transform:"translate(-"+J+", -"+K+")",x:W[0],y:W[1],width:G,height:G,id:["waffle_",Y," feature_",result_data[p][R].id].join(""),fill:U[Y]})}H.node().__data__={properties:result_data[p][R]},H.call(drag_waffle)}current_layers[p]={fill_color:y,n_features:B,renderer:"TwoStocksWaffle",symbol:o,rendered_field:s,size:t.size,ratio:r,nCol:i,"stroke-width-const":0,is_result:!0,ref_layer_name:e,draggable:!1},(0,c.create_li_layer_elem)(p,B,["Point","waffle"],"result")}(e,t),(0,y.zoom_without_redraw)(),(0,u.switch_accordion_section)(),(0,m.handle_legend)(r))}})}},unfill:function(){v(document.getElementById("TwoStocks_waffle_symbol")),v(document.getElementById("TwoStocks_fields")),v(document.getElementById("TwoStocks_waffle_ratio")),document.getElementById("TwoStocks_fields").size=2,document.getElementById("TwoStocks_fields").parentElement.style.marginBottom="25px",section2.selectAll(".params").attr("disabled",!0)}};function I(e){var t=E(section2),n=t.append("p").attr("class","params_section2");n.append("p").style("margin","auto").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.choroprop.field1"}).html(i18next.t("app_page.func_options.choroprop.field1")),n.insert("select").attrs({class:"params",id:"PropSymbolChoro_field_1"}).styles({position:"relative",float:"right","margin-bottom":"7.5px"});var a=t.append("p").attr("class","params_section2").styles({margin:"auto"});a.append("span").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.choroprop.fixed_size"}).html(i18next.t("app_page.func_options.choroprop.fixed_size")),a.insert("input").attrs({id:"PropSymbolChoro_ref_size",type:"number",class:"params",min:.1,max:100,value:60,step:"any"}).style("width","50px"),a.append("span").html(" (px)");var r=t.append("p").attr("class","params_section2");r.append("span").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.choroprop.on_value"}).html(i18next.t("app_page.func_options.choroprop.on_value")),r.insert("input").styles({width:"100px","margin-left":"10px"}).attrs({type:"number",class:"params",id:"PropSymbolChoro_ref_value"}).attrs({min:.1,step:.1});var o=t.append("p").attr("class","params_section2");o.append("span").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.choroprop.symbol_type"}).html(i18next.t("app_page.func_options.choroprop.symbol_type")),o.insert("select").attrs({class:"params i18n",id:"PropSymbolChoro_symbol_type"});var i=t.append("p").attr("class","params_section2");i.append("p").style("margin","auto").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.choroprop.field2"}).html(i18next.t("app_page.func_options.choroprop.field2")),i.insert("select").attrs({class:"params",id:"PropSymbolChoro_field_2"}).styles({position:"relative",float:"right","margin-bottom":"7.5px"});var l=t.insert("p").styles({clear:"both",margin:"auto"});l.insert("span").attr("id","container_sparkline_propsymbolchoro").styles({margin:"16px 50px 0px 4px",float:"right"}),B(l),z(t,"PropSymbolChoro_output_name","15px"),P(t,"propChoro_yes"),t.selectAll(".params").attr("disabled",!0)}var q={fill:function(e){if(e){section2.selectAll(".params").attr("disabled",null);var t=this,n=(0,c.getFieldsType)("stock",e),r=(0,c.getFieldsType)("ratio",e),o=user_data[e].length,i=section2.select("#PropSymbolChoro_field_1"),l=section2.select("#PropSymbolChoro_field_2"),_=section2.select("#ico_others"),g=section2.select("#ico_jenks"),f=section2.select("#ico_quantiles"),h=section2.select("#ico_equal_interval"),v=section2.select("#ico_q6"),w=section2.select("#PropSymbolChoro_output_name"),k=section2.select("#PropSymbolChoro_ref_value"),A=section2.select("#PropSymbolChoro_symbol_type"),j=section2.select("#PropSymbolChoro_ref_size"),E=section2.select("#choro_mini_choice_disc"),z=section2.select("#img_choice_disc"),B=section2.select("#propChoro_yes"),P=function(){g.style("border",null),v.style("border",null),f.style("border",null),h.style("border",null)};"Line"===current_layers[e].type?(j.attr("value",10),[["app_page.func_options.common.symbol_line","line"],["app_page.func_options.common.symbol_circle","circle"],["app_page.func_options.common.symbol_square","rect"]].forEach(function(e){A.append("option").text(i18next.t(e[0])).attrs({value:e[1],"data-i18n":"[text]"+e[0]})})):(j.attr("value",60),[["app_page.func_options.common.symbol_circle","circle"],["app_page.func_options.common.symbol_square","rect"]].forEach(function(e){A.append("option").text(i18next.t(e[0])).attrs({value:e[1],"data-i18n":"[text]"+e[0]})}));var O=function(n){var r=user_data[e].map(function(e){return e[n]}),o=(0,p.getOptNbClass)(r.length);J(r.map(function(e){return+e}),document.getElementById("container_sparkline_propsymbolchoro"));var i=(0,p.discretize_to_colors)(r,"quantiles",o),l=a(i,6),s=l[0],c=(l[1],l[2]),d=l[3],_=l[4],u=l[5];t.rendering_params[n]={nb_class:s,type:"quantiles",colors:d,breaks:c,no_data:u,colorsByFeature:_,renderer:"Choropleth",rendered_field:n,schema:["Reds"]},E.html(i18next.t("app_page.common.quantiles")+", "+i18next.t("app_page.common.class",{count:s})),B.attr("disabled",null),z.attr("src","/static/img/Light_green_check.png"),P(),f.style("border","solid 1px green"),r.length>7500?g.style("display","none"):g.style("display",null)};if(0!==n.length&&0!==r.length){var C=r[0];O(C),B.attr("disabled",!t.rendering_params[C]||null),n.forEach(function(e){i.append("option").text(e).attr("value",e)}),r.forEach(function(e){l.append("option").text(e).attr("value",e)}),i.on("change",function(){var t=this.value,n=(0,d.max_fast)(user_data[e].map(function(e){return+e[t]}));k.attrs({max:n,value:n}),w.attr("value",["PropSymbols",t,l.node().value,e].join("_"))}),l.on("change",function(){var n=this.value;J(user_data[e].map(function(e){return+e[n]}),document.getElementById("container_sparkline_propsymbolchoro")),w.attr("value",["PropSymbols",i.node().value,n,e].join("_")),void 0!==t.rendering_params[n]?(z.attr("src","/static/img/Light_green_check.png"),E.html([i18next.t("app_page.common."+t.rendering_params[n].type),", ",i18next.t("app_page.common.class",{count:t.rendering_params[n].nb_class})].join("")),P(),S(t.rendering_params[n].type)):O(n)}),g.on("click",function(){P(),this.style.border="solid 1px green";var n=l.node().value,r=user_data[e].map(function(e){return e[n]}),o=(0,p.getOptNbClass)(r.length),i=(0,p.discretize_to_colors)(r,"jenks",o,"BuGn"),s=a(i,6),c=s[0],d=(s[1],s[2]),_=s[3],u=s[4],m=s[5];t.rendering_params[n]={nb_class:c,type:"jenks",colors:_,breaks:d,no_data:m,colorsByFeature:u,renderer:"PropSymbolsChoro",rendered_field:n,schema:["BuGn"]},E.html(i18next.t("app_page.common.jenks")+", "+i18next.t("app_page.common.class",{count:c})),B.attr("disabled",null),z.attr("src","/static/img/Light_green_check.png")}),f.on("click",function(){P(),this.style.border="solid 1px green";var n=l.node().value,r=user_data[e].map(function(e){return e[n]}),o=(0,p.getOptNbClass)(r.length),i=(0,p.discretize_to_colors)(r,"quantiles",o,"BuGn"),s=a(i,6),c=s[0],d=(s[1],s[2]),_=s[3],u=s[4],m=s[5];t.rendering_params[n]={nb_class:c,type:"quantiles",colors:_,breaks:d,no_data:m,colorsByFeature:u,renderer:"PropSymbolsChoro",rendered_field:n,schema:["BuGn"]},E.html(i18next.t("app_page.common.quantiles")+", "+i18next.t("app_page.common.class",{count:c})),B.attr("disabled",null),z.attr("src","/static/img/Light_green_check.png")}),h.on("click",function(){P(),this.style.border="solid 1px green";var n=l.node().value,r=user_data[e].map(function(e){return e[n]}),o=(0,p.getOptNbClass)(r.length),i=(0,p.discretize_to_colors)(r,"equal_interval",o,"BuGn"),s=a(i,6),c=s[0],d=(s[1],s[2]),_=s[3],u=s[4],m=s[5];t.rendering_params[n]={nb_class:c,type:"equal_interval",colors:_,breaks:d,no_data:m,colorsByFeature:u,renderer:"PropSymbolsChoro",rendered_field:n,schema:["BuGn"]},E.html(i18next.t("app_page.common.equal_interval")+", "+i18next.t("app_page.common.class",{count:c})),B.attr("disabled",null),z.attr("src","/static/img/Light_green_check.png")}),v.on("click",function(){P(),this.style.border="solid 1px green";var n=l.node().value,r=user_data[e].map(function(e){return e[n]}),o=(0,p.discretize_to_colors)(r,"Q6",6,"BuGn"),i=a(o,6),s=i[0],c=(i[1],i[2]),d=i[3],_=i[4],u=i[5];t.rendering_params[n]={nb_class:s,type:"Q6",colors:d,breaks:c,no_data:u,colorsByFeature:_,renderer:"PropSymbolsChoro",rendered_field:n,schema:["BuGn"]},E.html(i18next.t("app_page.common.Q6")+", "+i18next.t("app_page.common.class",{count:s})),B.attr("disabled",null),z.attr("src","/static/img/Light_green_check.png")}),_.on("click",function(){var n=l.node().value,a=(0,p.getOptNbClass)(user_data[e].length);(t.rendering_params[n]?(0,s.display_discretization)(e,n,t.rendering_params[n].nb_class,{schema:t.rendering_params[n].schema,colors:t.rendering_params[n].colors,no_data:t.rendering_params[n].no_data,type:t.rendering_params[n].type,breaks:t.rendering_params[n].breaks,extra_options:t.rendering_params[n].extra_options}):(0,s.display_discretization)(e,n,a,{type:"quantiles"})).then(function(e){e&&(z.attr("src","/static/img/Light_green_check.png"),E.html([i18next.t("app_page.common."+e[1]),", ",i18next.t("app_page.common.class",{count:e[0]})].join("")),P(),S(e[1]),t.rendering_params[n]={nb_class:e[0],type:e[1],schema:e[5],no_data:e[6],breaks:e[2],colors:e[3],colorsByFeature:e[4],renderer:"PropSymbolsChoro",extra_options:e[7]})})}),B.on("click",function(){if(k.node().value){var n=t.rendering_params;if(n[l.node().value]){var a=A.node().value,r={},s=l.node().value,p=w.node().value;p=b(p.length>0?p:e+"_PropSymbolsChoro"),r.field=i.node().value,r.new_name=p,r.nb_features=o,r.ref_layer_name=e,r.symbol=a,r.ref_value=+k.node().value,r.ref_size=+j.node().value,r.fill_color=n[s].colorsByFeature,r.color_field=s,"line"===a?V(r):U(r);for(var c=[],d=n[s].breaks.length-1;d>0;--d)c.push([[n[s].breaks[d-1]," - ",n[s].breaks[d]].join(""),n[s].colors[d-1]]);var _={schema:n[s].schema,colors:n[s].colors,no_data:n[s].no_data,type:n[s].type,breaks:n[s].breaks,extra_options:n[s].extra_options};Object.assign(current_layers[p],{renderer:"PropSymbolsChoro",options_disc:_,rendered_field:i.node().value,rendered_field2:l.node().value,colors_breaks:c}),(0,y.zoom_without_redraw)(),(0,u.switch_accordion_section)(),(0,m.handle_legend)(p)}}}),(0,c.setSelected)(i.node(),n[0]),(0,c.setSelected)(l.node(),r[0])}else x()}},unfill:function(){v(document.getElementById("PropSymbolChoro_field_1")),v(document.getElementById("PropSymbolChoro_field_2")),v(document.getElementById("PropSymbolChoro_symbol_type")),section2.selectAll(".params").attr("disabled",!0)},rendering_params:{}},L=function(){var e=E(section2),t=e.append("p").attr("class","params_section2");t.append("p").style("margin","auto").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.typo.field"}).html(i18next.t("app_page.func_options.typo.field")),t.insert("select").attrs({id:"Typo_field_1",class:"params"}).styles({position:"relative",float:"right","margin-bottom":"7.5px"}),e.insert("p").attr("class","params_section2").styles({margin:"auto","text-align":"center",clear:"both"}).append("button").attrs({id:"Typo_class",class:"button_disc params i18n","data-i18n":"[html]app_page.func_options.typo.color_choice"}).styles({"font-size":"0.8em","text-align":"center"}).html(i18next.t("app_page.func_options.typo.color_choice")),z(e,"Typo_output_name"),P(e,"Typo_yes"),e.selectAll(".params").attr("disabled",!0)},T={fill:function(e){if(e){var t=this,n=(0,c.getFieldsType)("category",e),r=section2.select("#Typo_field_1"),o=section2.select("#Typo_yes"),i=section2.select("#Typo_class"),l=section2.select("#Typo_output_name"),p=function(n){var r=Q(e,n,null),o=a(r,2),i=(o[0],o[1]),l=i.size,s=user_data[e].map(function(e){return i.get(e[n])[0]});t.rendering_params[n]={nb_class:l,color_map:i,colorByFeature:s,renderer:"Categorical",rendered_field:n,skip_alert:!1}};n.forEach(function(e){r.append("option").text(e).attr("value",e)}),r.on("change",function(){var t=this.value;l.attr("value",["Typo",t,e].join("_")),p(t)});var d=n[0];p(d),o.attr("disabled",!t.rendering_params[d]||null),i.on("click",function(){var n=r.node().value,o=(current_layers[e].n_features,t.rendering_params[n]?t.rendering_params[n].color_map:void 0),i=Q(e,n,o),l=a(i,2),p=l[0];l[1];p.length>15?swal({title:"",text:i18next.t("app_page.common.error_too_many_features_color"),type:"warning",showCancelButton:!0,allowOutsideClick:!1,confirmButtonColor:"#DD6B55",confirmButtonText:i18next.t("app_page.common.valid")+"!",cancelButtonText:i18next.t("app_page.common.cancel")}).then(function(){(0,s.display_categorical_box)(user_data[e],e,n,p).then(function(e){e&&(t.rendering_params[n]={nb_class:e[0],color_map:e[1],colorByFeature:e[2],renderer:"Categorical",rendered_field:n,skip_alert:!0})})},function(e){return null}):(0,s.display_categorical_box)(user_data[e],e,n,p).then(function(e){e&&(t.rendering_params[n]={nb_class:e[0],color_map:e[1],colorByFeature:e[2],renderer:"Categorical",rendered_field:n,skip_alert:!0})})}),o.on("click",function(){var e=r.node().value,n=t.rendering_params[e],a=function(){if(n){var t=Object.getOwnPropertyNames(user_data)[0],a=l.node().value;n.new_name=b(a.length>0?a:["Typo",e,t].join("_")),function(e,t){var n=void 0;if(t.new_name){var a=[].concat((0,c.getFieldsType)("id",e),t.rendered_field);(0,c.copy_layer)(e,t.new_name,"typo",a),current_layers[t.new_name].key_name=current_layers[e].key_name,current_layers[t.new_name].type=current_layers[e].type,n=t.new_name}else n=e;var r=t.colorByFeature,o=t.color_map,i=t.rendered_field,l=map.select("#"+_app.layer_to_id.get(n));l.style("opacity",1).style("stroke-width",.75/d3.zoomTransform(svg_map).k+"px"),"Line"===current_layers[n].type?l.selectAll("path").styles({fill:"transparent","stroke-opacity":1}).style("stroke",function(e,t){return r[t]}):l.selectAll("path").style("fill",function(e,t){return r[t]}).styles({"fill-opacity":.9,"stroke-opacity":.9,stroke:"#000"});current_layers[n].renderer=t.renderer,current_layers[n].rendered_field=i,current_layers[n].fill_color={class:t.colorByFeature},current_layers[n]["stroke-width-const"]=.75,current_layers[n].is_result=!0,current_layers[n].color_map=o,(0,y.zoom_without_redraw)()}(t,n),(0,u.switch_accordion_section)(),(0,m.handle_legend)(n.new_name)}};n.color_map.size>15&&!n.skip_alert?swal({title:"",text:i18next.t("app_page.common.error_too_many_features_color"),type:"warning",showCancelButton:!0,allowOutsideClick:!1,confirmButtonColor:"#DD6B55",confirmButtonText:i18next.t("app_page.common.valid")+"!",cancelButtonText:i18next.t("app_page.common.cancel")}).then(function(){a()},function(e){return null}):a()}),l.attr("value","Typo_"+e),section2.selectAll(".params").attr("disabled",null),(0,c.setSelected)(r.node(),n[0])}},unfill:function(){v(document.getElementById("Typo_field_1")),section2.selectAll(".params").attr("disabled",!0)},rendering_params:{}};function N(){var e=E(section2),t=e.append("p").attr("class","params_section2");t.insert("p").style("margin","auto").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.common.field"}).html(i18next.t("app_page.func_options.common.field")),t.insert("select").attrs({id:"choro_field1",class:"params"}).styles({position:"relative",float:"right","margin-bottom":"7.5px"});var n=e.insert("p").attr("class","params_section2").styles({margin:"auto"});n.insert("span").attr("id","container_sparkline_choro").styles({margin:"16px 50px 0px 4px",float:"right"}),B(n),z(e,"Choro_output_name","15px"),P(e,"choro_yes"),e.selectAll(".params").attr("disabled",!0)}var F={fill:function(e){if(e){var t=this,n=(0,c.getFieldsType)("ratio",e),r=section2.select("#choro_field1"),o=section2.select("#Choro_output_name"),i=section2.select("#choro_yes"),l=section2.select("#img_choice_disc"),d=section2.select("#ico_jenks"),_=section2.select("#ico_quantiles"),y=section2.select("#ico_q6"),g=section2.select("#ico_equal_interval"),f=section2.select("#ico_others"),h=section2.select("#choro_mini_choice_disc"),v=function(){d.style("border",null),y.style("border",null),_.style("border",null),g.style("border",null)},w=function(n){var r=user_data[e].map(function(e){return e[n]}),o=(0,p.getOptNbClass)(r.length);J(r.map(function(e){return+e}),document.getElementById("container_sparkline_choro"));var s=(0,p.discretize_to_colors)(r,"quantiles",o),c=a(s,6),u=c[0],m=(c[1],c[2]),y=c[3],g=c[4],f=c[5];t.rendering_params[n]={nb_class:u,type:"quantiles",colors:y,breaks:m,no_data:f,colorsByFeature:g,renderer:"Choropleth",rendered_field:n,schema:["Reds"]},h.html(i18next.t("app_page.common.quantiles")+", "+i18next.t("app_page.common.class",{count:u})),i.attr("disabled",null),l.attr("src","/static/img/Light_green_check.png"),v(),_.style("border","solid 1px green"),r.length>7500?d.style("display","none"):d.style("display",null)};if(0!==n.length){section2.selectAll(".params").attr("disabled",null),n.forEach(function(e){r.append("option").text(e).attr("value",e)});var k=n[0];w(k),i.attr("disabled",!t.rendering_params[k]||null),r.on("change",function(){var n=this.value;if(J(user_data[e].map(function(e){return+e[n]}),document.getElementById("container_sparkline_choro")),o.attr("value",["Choro",n,e].join("_")),void 0!==t.rendering_params[n]){l.attr("src","/static/img/Light_green_check.png");var a="app_page.common."+t.rendering_params[n].type;h.html(i18next.t(a)+", "+i18next.t("app_page.common.class",{count:t.rendering_params[n].nb_class})),v(),S(t.rendering_params[n].type)}else w(n)}),d.on("click",function(){v(),this.style.border="solid 1px green";var n=r.node().value,o=user_data[e].map(function(e){return e[n]}),i=(0,p.getOptNbClass)(o.length),s=(0,p.discretize_to_colors)(o,"jenks",i),c=a(s,6),d=c[0],_=(c[1],c[2]),u=c[3],m=c[4],y=c[5];t.rendering_params[n]={nb_class:d,type:"jenks",colors:u,breaks:_,no_data:y,colorsByFeature:m,renderer:"Choropleth",rendered_field:n,schema:["Reds"]},h.html(i18next.t("app_page.common.jenks")+", "+i18next.t("app_page.common.class",{count:d})),l.attr("src","/static/img/Light_green_check.png")}),_.on("click",function(){v(),this.style.border="solid 1px green";var n=r.node().value,o=user_data[e].map(function(e){return e[n]}),i=(0,p.getOptNbClass)(o.length),s=(0,p.discretize_to_colors)(o,"quantiles",i),c=a(s,6),d=c[0],_=(c[1],c[2]),u=c[3],m=c[4],y=c[5];t.rendering_params[n]={nb_class:d,type:"quantiles",colors:u,breaks:_,no_data:y,colorsByFeature:m,renderer:"Choropleth",rendered_field:n,schema:["Reds"]},h.html(i18next.t("app_page.common.quantiles")+", "+i18next.t("app_page.common.class",{count:d})),l.attr("src","/static/img/Light_green_check.png")}),g.on("click",function(){v(),this.style.border="solid 1px green";var n=r.node().value,o=user_data[e].map(function(e){return e[n]}),i=(0,p.getOptNbClass)(o.length),s=(0,p.discretize_to_colors)(o,"equal_interval",i),c=a(s,6),d=c[0],_=(c[1],c[2]),u=c[3],m=c[4],y=c[5];t.rendering_params[n]={nb_class:d,type:"equal_interval",colors:u,breaks:_,no_data:y,colorsByFeature:m,renderer:"Choropleth",rendered_field:n,schema:["Reds"]},h.html(i18next.t("app_page.common.equal_interval")+", "+i18next.t("app_page.common.class",{count:d})),l.attr("src","/static/img/Light_green_check.png")}),y.on("click",function(){v(),this.style.border="solid 1px green";var n=r.node().value,o=user_data[e].map(function(e){return e[n]}),i=(0,p.discretize_to_colors)(o,"Q6",6),s=a(i,6),c=s[0],d=(s[1],s[2]),_=s[3],u=s[4],m=s[5];t.rendering_params[n]={nb_class:c,type:"Q6",colors:_,breaks:d,no_data:m,colorsByFeature:u,renderer:"Choropleth",rendered_field:n,schema:["Reds"]},h.html(i18next.t("app_page.common.Q6")+", "+i18next.t("app_page.common.class",{count:c})),l.attr("src","/static/img/Light_green_check.png")}),f.on("click",function(){var n=r.node().value,a=(0,p.getOptNbClass)(user_data[e].length);(t.rendering_params[n]?(0,s.display_discretization)(e,n,t.rendering_params[n].nb_class,{schema:t.rendering_params[n].schema,colors:t.rendering_params[n].colors,type:t.rendering_params[n].type,no_data:t.rendering_params[n].no_data,breaks:t.rendering_params[n].breaks,extra_options:t.rendering_params[n].extra_options}):(0,s.display_discretization)(e,n,a,{type:"quantiles"})).then(function(e){if(e){l.attr("src","/static/img/Light_green_check.png");var a="app_page.common."+e[1];h.html(i18next.t(a)+", "+i18next.t("app_page.common.class",{count:e[0]})),v(),S(e[1]),t.rendering_params[n]={nb_class:e[0],type:e[1],breaks:e[2],colors:e[3],schema:e[5],no_data:e[6],colorsByFeature:e[4],renderer:"Choropleth",rendered_field:n,new_name:"",extra_options:e[7]}}})}),i.on("click",function(){var n=r.node().value;if(t.rendering_params[n]){var a=o.node().value;t.rendering_params[n].new_name=b(a.length>0?a:["Choro",n,e].join("_")),Y(e,t.rendering_params[n]),(0,m.handle_legend)(t.rendering_params[n].new_name),(0,u.switch_accordion_section)()}}),(0,c.setSelected)(r.node(),n[0])}else x()}},unfill:function(){v(document.getElementById("choro_field1")),d3.selectAll(".params").attr("disabled",!0)},rendering_params:{}},G={fill:function(e){var t=(0,c.get_other_layer_names)(),n=d3.select("#stewart_mask"),a=void 0;v(n.node()),n.append("option").text("None").attr("value","None");for(var r,o=0,i=t.length;o<i;o++)r=t[o],"Polygon"===current_layers[r].type&&(n.append("option").text(r).attr("value",r),current_layers[r].targeted&&(a=r));if(a&&(0,c.setSelected)(n.node(),a),e){var l=(0,c.getFieldsType)("stock",e),s=section2.select("#stewart_field"),p=section2.select("#stewart_field2");if(0===l.length)return void x();p.append("option").text(" ").attr("value","None"),l.forEach(function(e){s.append("option").text(e).attr("value",e),p.append("option").text(e).attr("value",e)}),document.getElementById("stewart_span").value=k("stewart"),s.on("change",function(){document.getElementById("stewart_output_name").value=["Smoothed",this.value,e].join("_")}),document.getElementById("stewart_output_name").value=["Smoothed",l[0],e].join("_"),section2.select("#stewart_yes").on("click",D)}section2.selectAll(".params").attr("disabled",null)},unfill:function(){v(document.getElementById("stewart_field")),v(document.getElementById("stewart_field2")),v(document.getElementById("stewart_mask")),d3.selectAll(".params").attr("disabled",!0)}};function D(){var e=new FormData,t=document,n=t.getElementById("stewart_field").value,a=t.getElementById("stewart_field2").value,r={},o={},i=Object.getOwnPropertyNames(user_data)[0],s=+t.getElementById("stewart_span").value,p=+t.getElementById("stewart_beta").value,d=t.getElementById("stewart_func").value,_=t.getElementById("stewart_mask").value,y=document.getElementById("stewart_output_name").value,g=t.getElementById("stewart_nb_class").value,f=t.getElementById("stewart_breaks").value.trim(),h=+t.getElementById("stewart_resolution").value;if(g!==(0|g)&&(g|=0,t.getElementById("stewart_nb_class").value=g),h&&h>0){var v=A(h);if(v){var b="low"===v?i18next.t("app_page.common.error_too_low_resolution"):i18next.t("app_page.common.error_too_high_resolution");return void(0,c.display_error_during_computation)(b)}h*=1e3}else h=null;f=f.length>0?f.split("-").map(function(e){return+e.trim()}):null,r[n]=current_layers[i].original_fields.has(n)?[]:user_data[i].map(function(e){return+e[n]}),"None"!==a&&(o[a]=current_layers[i].original_fields.has(a)?[]:user_data[i].map(function(e){return+e[a]})),e.append("json",JSON.stringify({topojson:current_layers[i].key_name,variable1:r,variable2:o,span:1e3*s,beta:p,typefct:d,resolution:h,nb_class:g,user_breaks:f,mask_layer:"None"!==_?current_layers[_].key_name:""})),(0,c.xhrequest)("POST","compute/stewart",e,!0).then(function(e){var t=e.split("|||"),a=t[0],r={result_layer_on_add:!0,func_name:"smooth"};y.length>0&&(r.choosed_name=y);var o=(0,u.add_layer_topojson)(a,r);if(o){for(var i=JSON.parse(t[1]),s=(0,l.getColorBrewerArray)(i.min.length,"Oranges"),p=i.min.length,c=[],d=0;d<p;d++)c.push([i.min[d]+" - "+i.max[d],s[p-1-d]]);current_layers[o].fill_color={class:[]},current_layers[o].renderer="Stewart",current_layers[o].colors_breaks=c,current_layers[o].rendered_field=n,current_layers[o].color_palette={name:"Oranges",reversed:!0},current_layers[o].options_disc={breaks:[].concat(i.max[0],i.min).reverse()},map.select("#"+_app.layer_to_id.get(o)).selectAll("path").styles(function(e,t){return{fill:s[p-1-t],"fill-opacity":1,"stroke-opacity":0}}),(0,m.handle_legend)(o),(0,u.switch_accordion_section)()}},function(e){(0,c.display_error_during_computation)(),console.log(e)}).catch(function(e){(0,c.display_error_during_computation)(),console.log(e)})}function R(){var e=E(section2),t=e.append("p").attr("class","params_section2");t.append("p").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.smooth.field"}).html(i18next.t("app_page.func_options.smooth.field")),t.append("select").attrs({class:"params marg_auto",id:"stewart_field"});var n=e.append("p").attr("class","params_section2");n.append("p").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.smooth.divide_field"}).html(i18next.t("app_page.func_options.smooth.divide_field")),n.insert("select").attrs({class:"params marg_auto",id:"stewart_field2"});var a=e.append("p").attr("class","params_section2");a.append("span").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.smooth.span"}).text(i18next.t("app_page.func_options.smooth.span")),a.append("input").style("width","60px").attrs({type:"number",class:"params",id:"stewart_span",value:5,min:0,max:1e5,step:"any"}),a.append("span").html(" (km)");var r=e.append("p").attr("class","params_section2");r.append("span").styles({"margin-right":"35px"}).attrs({class:"i18n","data-i18n":"[html]app_page.func_options.smooth.beta"}).html(i18next.t("app_page.func_options.smooth.beta")),r.insert("input").style("width","60px").attrs({type:"number",class:"params",id:"stewart_beta",value:2,min:0,max:11,step:"any"});var o=e.append("p").attr("class","params_section2");o.append("span").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.smooth.resolution"}).text(i18next.t("app_page.func_options.smooth.resolution")),o.insert("input").style("width","60px").attrs({type:"number",class:"params",id:"stewart_resolution",min:1,max:1e6,step:"any"}),o.insert("label").html(" (km)");var i=e.append("p").attr("class","params_section2");i.append("span").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.smooth.func_options"}).html(i18next.t("app_page.func_options.smooth.function"));var l=i.insert("select").attrs({class:"params i18n",id:"stewart_func"}),s=e.append("p").attr("class","params_section2");s.append("span").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.smooth.nb_class"}).html(i18next.t("app_page.func_options.smooth.nb_class")),s.insert("input").style("width","50px").attrs({type:"number",class:"params",id:"stewart_nb_class",value:8,min:1,max:22,step:1});var p=e.append("p").attr("class","params_section2");p.append("span").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.smooth.break_values"}).html(i18next.t("app_page.func_options.smooth.break_values")),p.insert("textarea").styles({width:"100%",height:"2.2em","font-size":"0.9em"}).attrs({class:"params i18n",id:"stewart_breaks","data-i18n":"[placeholder]app_page.common.expected_class",placeholder:i18next.t("app_page.common.expected_class")});var c=e.append("p").attr("class","params_section2");c.append("p").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.common.mask"}).html(i18next.t("app_page.func_options.common.mask")),c.insert("select").attrs({class:"params mask_field",id:"stewart_mask"}),[["exponential","app_page.func_options.smooth.func_exponential"],["pareto","app_page.func_options.smooth.func_pareto"]].forEach(function(e){l.append("option").text(i18next.t(e[1])).attrs({value:e[0],"data-i18n":"[text]"+e[1]})}),z(e,"stewart_output_name"),P(e,"stewart_yes",!1),e.selectAll(".params").attr("disabled",!0)}var W={fill:function(e){if(e){var t=(0,c.getFieldsType)("stock",e),n=section2.select("#Anamorph_field"),a=section2.select("#Anamorph_algo"),r=section2.select("#Anamorph_yes");0!==t.length?(a.on("change",function(){"olson"===this.value?(section2.selectAll(".opt_dougenik").style("display","none"),section2.selectAll(".opt_olson").style("display",void 0)):"dougenik"===this.value&&(section2.selectAll(".opt_olson").style("display","none"),section2.selectAll(".opt_dougenik").style("display",void 0))}),section2.selectAll(".params").attr("disabled",null),t.forEach(function(e){n.append("option").text(e).attr("value",e)}),n.on("change",function(){var t=this.value,n=document.getElementById("Anamorph_opt3");if(document.getElementById("Anamorph_output_name").value=["Cartogram",this.value,e].join("_"),n){var a=(0,d.max_fast)(user_data[e].map(function(e){return+e[t]}));n.setAttribute("max",a),n.value=a}}),r.on("click",function(){var t=a.node().value,r=(user_data[e].length,n.node().value),o=document.getElementById("Anamorph_output_name").value;if("olson"===t){for(var i=current_layers[e].n_features,s=user_data[e],p=document.getElementById(_app.layer_to_id.get(e)).getElementsByTagName("path"),d=Math.sqrt,_=(Math.abs,[]),m=[],y=0;y<i;++y){var g=+s[y][r];!isNaN(g)&&isFinite(g)||(g=0),_.push([y,g,+path.area(p[y].__data__.geometry)])}_.sort(function(e,t){return t[1]-e[1]});var f=_[0][1]/_[0][2];_[0].push(1);for(var h=0;h<i;++h){var v=d(_[h][1]/_[h][2]/f);_[h].push(v)}_.sort(function(e,t){return e[0]-t[0]});var b=new FormData;b.append("json",JSON.stringify({topojson:current_layers[e].key_name,scale_values:_.map(function(e){return e[3]}),field_name:r})),(0,c.xhrequest)("POST","compute/olson",b,!0).then(function(t){var n={result_layer_on_add:!0,func_name:"cartogram"};o.length>0&&/^\w+$/.test(o)&&(n.choosed_name=o);var a=(0,u.add_layer_topojson)(t,n);current_layers[a].renderer="OlsonCarto",current_layers[a].rendered_field=r,current_layers[a].scale_max=1,current_layers[a].ref_layer_name=e,current_layers[a].scale_byFeature=m,map.select("#"+_app.layer_to_id.get(a)).selectAll("path").styles({stroke:"black","stroke-opacity":.8,"fill-opacity":.8}),(0,u.switch_accordion_section)()},function(e){(0,c.display_error_during_computation)(),console.log(e)})}else if("dougenik"===t){var x=new FormData,w={},k=document.getElementById("Anamorph_dougenik_iterations").value;if(w[r]=[],!current_layers[e].original_fields.has(r))for(var A=user_data[e],j=w[r],S=0,E=A.length;S<E;++S)j.push(+A[S][r]);x.append("json",JSON.stringify({topojson:current_layers[e].key_name,var_name:w,iterations:k})),(0,c.xhrequest)("POST","compute/carto_doug",x,!0).then(function(e){var t={result_layer_on_add:!0,func_name:"cartogram"};o.length>0&&/^\w+$/.test(o)&&(t.choosed_name=o);var n=(0,u.add_layer_topojson)(e,t);current_layers[n].fill_color={random:!0},current_layers[n].is_result=!0,current_layers[n]["stroke-width-const"]=.8,current_layers[n].renderer="Carto_doug",current_layers[n].rendered_field=r,map.select("#"+_app.layer_to_id.get(n)).selectAll("path").style("fill",function(e){return(0,l.randomColor)()}).style("fill-opacity",.8).style("stroke","black").style("stroke-opacity",.8),(0,u.switch_accordion_section)()},function(e){(0,c.display_error_during_computation)(),console.log(e)})}}),(0,c.setSelected)(n.node(),n.node().options[0].value)):x()}},unfill:function(){var e=document.getElementById("Anamorph_field");section2.selectAll(".params").attr("disabled",!0),v(e)}};function H(){var e=E(section2),t=e.append("p").attr("class","params_section2");t.append("span").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.cartogram.algo"}).html(i18next.t("app_page.func_options.cartogram.algo"));var n=t.insert("select").attrs({id:"Anamorph_algo",class:"params i18n"}),a=e.append("p").attr("class","params_section2");a.append("p").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.cartogram.field"}).html(i18next.t("app_page.func_options.cartogram.field")),a.insert("select").attrs({class:"params",id:"Anamorph_field"});var r=e.append("p").attr("class","params_section2 opt_dougenik");r.append("span").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.cartogram.dougenik_iterations"}).html(i18next.t("app_page.func_options.cartogram.dougenik_iterations")),r.insert("input").attrs({type:"number",class:"params",value:5,min:1,max:12,step:1,id:"Anamorph_dougenik_iterations"}),[["Dougenik & al. (1985)","dougenik"],["Olson (2005)","olson"]].forEach(function(e){n.append("option").text(e[0]).attr("value",e[1])}),z(e,"Anamorph_output_name"),P(e,"Anamorph_yes",!1),e.selectAll(".params").attr("disabled",!0),e.selectAll(".opt_olson").style("display","none")}function V(e,t){var n=e.ref_layer_name,a=e.field,r=e.color_field,o=e.nb_features,i=Math.abs,l=e.ref_size,s=e.ref_value,p=e.symbol,_=e.new_name,u=new d.PropSizer(s,l,p);if(!t){var m=(0,c.getFieldsType)("id",n).concat((0,c.getFieldsType)("category",n)),y=m?m.length:0,g=void 0,f=void 0,h=void 0;void 0!==e.break_val&&e.fill_color.two?(f=e.fill_color.two[0],h=e.fill_color.two[1],g=function(t,n){return t>e.break_val?h:f}):g=e.fill_color instanceof Array&&e.fill_color.length===o?function(t,n){return e.fill_color[n]}:function(){return e.fill_color},t=function(){for(var e=document.getElementById(_app.layer_to_id.get(n)).getElementsByTagName("path"),t=[],o=0,l=e.length;o<l;++o){var s=e[o].__data__,p=+s.properties[a],c={id:o,type:"Feature",properties:{},geometry:cloneObj(s.geometry)};if(y)for(var d=0;d<y;d++)c.properties[m[d]]=s.properties[m[d]];c.properties[a]=p,c.properties.prop_value=u.scale(p),c.properties.color=g(p,o),r&&(c.properties[r]=s.properties[r]),t.push([p,c])}return t.sort(function(e,t){return i(t[0])-i(e[0])}),{type:"FeatureCollection",features:t.map(function(e){return e[1]})}}()}var v=isInterrupted(current_proj_name.toLowerCase())||current_proj_name.toLowerCase().indexOf("conicconformal")>-1?"url(#clip)":null,b=encodeId(_);_app.layer_to_id.set(_,b),_app.id_to_layer.set(b,_),result_data[_]=[],map.insert("g",".legend").attrs({id:b,class:"layer","clip-path":v}).styles({"stroke-linecap":"round","stroke-linejoin":"round"}).selectAll("path").data(t.features).enter().append("path").attr("d",path).styles(function(e){return result_data[_].push(e.properties),{fill:"transparent",stroke:e.properties.color,"stroke-width":e.properties.prop_value}}),current_layers[_]={n_features:o,renderer:e.renderer||"PropSymbols",symbol:"path",rendered_field:a,size:[s,l],is_result:!0,ref_layer_name:n,type:"Line"},void 0!==e.fill_color.two?current_layers[_].fill_color=cloneObj(e.fill_color):e.fill_color instanceof Array?current_layers[_].fill_color={class:t.features.map(function(e){return e.properties.color})}:current_layers[_].fill_color={single:e.fill_color},void 0!==e.break_val&&(current_layers[_].break_val=e.break_val),(0,c.create_li_layer_elem)(_,o,["Line","prop"],"result")}function U(e,t){var n=e.ref_layer_name,a=e.field,r=e.color_field,o=e.nb_features,i=Math.abs,l=e.ref_size,s=e.ref_value,p=e.symbol,_=e.new_name,u=d3.zoomTransform(svg_map).k,m=new d.PropSizer(s,l,p),y=[],g=void 0;if(t)g=t;else{var f=(0,c.getFieldsType)("id",n).concat((0,c.getFieldsType)("category",n)),h=f?f.length:0,v=void 0,b=void 0,x=void 0;void 0!==e.break_val&&e.fill_color.two?(b=e.fill_color.two[0],x=e.fill_color.two[1],v=function(t,n){return t>e.break_val?x:b}):v=e.fill_color instanceof Array&&e.fill_color.length===o?function(t,n){return e.fill_color[n]}:function(){return e.fill_color},g=function(){for(var e=document.getElementById(_app.layer_to_id.get(n)).getElementsByTagName("path"),t=[],o=0,l=e.length;o<l;++o){var s=e[o].__data__,p=+s.properties[a],c={id:o,type:"Feature",properties:{},geometry:{type:"Point"}};if(s.geometry)if(s.geometry.type.indexOf("Multi")<0){if(h)for(var _=0;_<h;_++)c.properties[f[_]]=s.properties[f[_]];c.properties[a]=p,c.properties.prop_value=m.scale(p),c.geometry.coordinates=d3.geoCentroid(s.geometry),c.properties.color=v(p,o),r&&(c.properties[r]=s.properties[r]),t.push([p,c])}else{for(var u=[],g=0;g<s.geometry.coordinates.length;g++)u.push(path.area({type:s.geometry.type,coordinates:[s.geometry.coordinates[g]]}));var b=u.indexOf((0,d.max_fast)(u));if(h)for(var x=0;x<h;x++)c.properties[f[x]]=s.properties[f[x]];c.properties[a]=p,c.properties.prop_value=m.scale(p),c.geometry.coordinates=d3.geoCentroid({type:s.geometry.type,coordinates:[s.geometry.coordinates[b]]}),c.properties.color=v(p,o),r&&(c.properties[r]=s.properties[r]),t.push([p,c])}else y.push([o,s])}return t.sort(function(e,t){return i(t[0])-i(e[0])}),{type:"FeatureCollection",features:t.map(function(e){return e[1]})}}()}var k=encodeId(_);_app.layer_to_id.set(_,k),_app.id_to_layer.set(k,_),result_data[_]=[],"circle"===p?map.insert("g",".legend").attrs({id:k,class:"layer no_clip"}).selectAll("circle").data(g.features).enter().append("circle").attrs(function(e,t){return result_data[_].push(e.properties),{id:["PropSymbol_",t," feature_",e.id].join(""),r:e.properties.prop_value,cx:path.centroid(e)[0],cy:path.centroid(e)[1]}}).style("fill",function(e){return e.properties.color}).style("stroke","black").style("stroke-width",1/u).call(c.drag_elem_geo2):"rect"===p&&map.insert("g",".legend").attrs({id:k,class:"layer no_clip"}).selectAll("circle").data(g.features).enter().append("rect").attrs(function(e,t){var n=e.properties.prop_value;return result_data[_].push(e.properties),{id:["PropSymbol_",t," feature_",e.id].join(""),height:n,width:n,x:path.centroid(e)[0]-n/2,y:path.centroid(e)[1]-n/2}}).style("fill",function(e){return e.properties.color}).style("stroke","black").style("stroke-width",1/u).call(c.drag_elem_geo2),current_layers[_]={n_features:o,renderer:e.renderer||"PropSymbols",symbol:p,rendered_field:a,size:[s,l],"stroke-width-const":1,is_result:!0,ref_layer_name:n,draggable:!1},void 0!==e.fill_color.two?current_layers[_].fill_color=cloneObj(e.fill_color):e.fill_color instanceof Array?current_layers[_].fill_color={class:g.features.map(function(e){return e.properties.color})}:current_layers[_].fill_color={single:e.fill_color},void 0!==e.break_val&&(current_layers[_].break_val=e.break_val),(0,c.create_li_layer_elem)(_,o,["Point","prop"],"result"),y.length>0&&w(y)}function Y(e,t){var n=void 0;if(t.new_name){var a=[].concat((0,c.getFieldsType)("id",e),t.rendered_field);(0,c.copy_layer)(e,t.new_name,"choro",a),current_layers[t.new_name].key_name=current_layers[e].key_name,current_layers[t.new_name].type=current_layers[e].type,n=t.new_name}else n=e;var r=t.breaks,o={schema:t.schema,colors:t.colors,no_data:t.no_data,type:t.type,breaks:r,extra_options:t.extra_options},i=map.select("#"+_app.layer_to_id.get(n));i.style("opacity",1).style("stroke-width",.75/d3.zoomTransform(svg_map).k+"px"),"Line"===current_layers[n].type?i.selectAll("path").styles({fill:"transparent","stroke-opacity":1}).style("stroke",function(e,n){return t.colorsByFeature[n]}):i.selectAll("path").styles({"fill-opacity":1,"stroke-opacity":1,stroke:"#000"}).style("fill",function(e,n){return t.colorsByFeature[n]}),current_layers[n].renderer=t.renderer,current_layers[n].rendered_field=t.rendered_field,current_layers[n].fill_color={class:t.colorsByFeature},current_layers[n]["stroke-width-const"]=.75,current_layers[n].is_result=!0,current_layers[n].options_disc=o;for(var l=[],s=r.length-1;s>0;--s)l.push([[r[s-1]," - ",r[s]].join(""),t.colors[s-1]]);current_layers[n].colors_breaks=l,(0,y.zoom_without_redraw)()}function J(e,t,n,a){var r=a||(e.length>20?16:void 0)||(e.length>15?10:5),o=(0,d.getBinsCount)(e,r),i=3*r-3,l=document.createElement("canvas"),s=n||(0,d.max_fast)(o.counts);l.width=i,l.height=25;var p=t.querySelector("canvas");p&&p.remove(),t.appendChild(l);var c=l.getContext("2d");c.fillStyle="#f1f1f1",c.fillRect(0,0,l.width,l.height);var u,m,y,g=0;c.fillStyle="#6633ff";for(var f=0;f<r;f++){var h=Math.floor(24*(0,_.Mmin)(o.counts[f]/s,1));g+=1,c.fillRect(g,25,2,-h),g+=2}l.setAttribute("tooltip-info",(u=o,m=(0,_.Mmax)((0,d.get_nb_decimals)(u.min),(0,d.get_nb_decimals)(u.max)),y={min:u.min,max:u.max,mean:u.mean.toFixed(m),median:u.median.toFixed(m),stddev:u.stddev.toFixed(m)},i18next.t("app_page.stat_summary.mini_summary",y)));new Tooltip(l,{dataAttr:"tooltip-info",animation:"slideNfade",duration:50,delay:100,container:document.getElementById("twbs"),placement:"top"})}function K(e){var t=E(section2),n=t.append("p").attr("class","params_section2");n.append("p").style("margin","auto").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.proptypo.field1"}).html(i18next.t("app_page.func_options.proptypo.field1")),n.insert("select").attrs({class:"params",id:"PropSymbolTypo_field_1"}).styles({position:"relative",float:"right","margin-bottom":"7.5px"});var a=t.append("p").attr("class","params_section2");a.append("span").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.proptypo.fixed_size"}).html(i18next.t("app_page.func_options.proptypo.fixed_size")),a.insert("input").attrs({type:"number",class:"params",id:"PropSymbolTypo_ref_size",min:.1,max:100,value:60,step:"any"}).style("width","50px"),a.append("span").html(" (px)");var r=t.append("p").attr("class","params_section2");r.append("span").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.proptypo.on_value"}).html(i18next.t("app_page.func_options.proptypo.on_value")),r.insert("input").styles({width:"100px","margin-left":"10px"}).attrs({type:"number",class:"params",id:"PropSymbolTypo_ref_value"}).attrs({min:.1,step:.1});var o=t.append("p").attr("class","params_section2");o.append("span").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.proptypo.symbol_type"}).html(i18next.t("app_page.func_options.proptypo.symbol_type")),o.insert("select").attrs({class:"params",id:"PropSymbolTypo_symbol_type"});var i=t.append("p").attr("class","params_section2");i.append("p").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.proptypo.field2"}).html(i18next.t("app_page.func_options.proptypo.field2")),i.insert("select").attrs({class:"params",id:"PropSymbolTypo_field_2"}),t.insert("p").attr("class","params_section2").styles({margin:"auto","text-align":"center"}).append("button").attrs({id:"Typo_class",class:"button_disc params i18n","data-i18n":"[html]app_page.func_options.typo.color_choice"}).styles({"font-size":"0.8em","text-align":"center"}).html(i18next.t("app_page.func_options.typo.color_choice")),z(t,"PropSymbolTypo_output_name"),P(t,"propTypo_yes"),section2.selectAll(".params").attr("disabled",!0)}function Q(e,t,n){var a=[];if(!n){for(var r=new Map,o=0,i=user_data[e];o<i.length;++o){var s=i[o][t],p=r.get(s);r.set(s,p?[p[0]+1,[o].concat(p[1])]:[1,[o]])}r.forEach(function(e,t){a.push({name:t,display_name:t,nb_elem:e[0],color:(0,l.randomColor)()})}),r=new Map;for(var c=0;c<a.length;c++)r.set(a[c].name,[a[c].color,a[c].name,a[c].nb_elem]);return[a,r]}return n.forEach(function(e,t){a.push({name:t,display_name:e[1],nb_elem:e[2],color:e[0]})}),[a,n]}var X={fill:function(e){if(e){section2.selectAll(".params").attr("disabled",null);var t=this,n=(0,c.getFieldsType)("stock",e),r=(0,c.getFieldsType)("category",e),o=(user_data[e].length,section2.select("#PropSymbolTypo_field_1")),i=section2.select("#PropSymbolTypo_field_2"),l=section2.select("#PropSymbolTypo_ref_value"),p=section2.select("#PropSymbolTypo_ref_size"),_=section2.select("#PropSymbolTypo_symbol_type"),g=section2.select("#PropSymbolTypo_output_name"),f=section2.select("#Typo_class"),h=section2.select("#propTypo_yes"),v=function(n){var r=Q(e,n,null),o=a(r,2),i=(o[0],o[1]),l=i.size,s=user_data[e].map(function(e){return i.get(e[n])[0]});t.rendering_params[n]={nb_class:l,color_map:i,colorByFeature:s,renderer:"Categorical",rendered_field:n,skip_alert:!1}};if(0!==r.length&&0!==n.length){"Line"===current_layers[e].type?(p.attr("value",10),[["app_page.func_options.common.symbol_line","line"],["app_page.func_options.common.symbol_circle","circle"],["app_page.func_options.common.symbol_square","rect"]].forEach(function(e){_.append("option").text(i18next.t(e[0])).attrs({value:e[1],"data-i18n":"[text]"+e[0]})})):(p.attr("value",60),[["app_page.func_options.common.symbol_circle","circle"],["app_page.func_options.common.symbol_square","rect"]].forEach(function(e){_.append("option").text(i18next.t(e[0])).attrs({value:e[1],"data-i18n":"[text]"+e[0]})})),n.forEach(function(e){o.append("option").text(e).attr("value",e)}),r.forEach(function(e){i.append("option").text(e).attr("value",e)});var w=r[0];v(w),h.attr("disabled",!t.rendering_params[w]||null),o.on("change",function(){var t=this.value,n=(0,d.max_fast)(user_data[e].map(function(e){return+e[t]}));l.attrs({max:n,value:n}),g.attr("value",["Typo",t,i.node().value,e].join("_"))}),i.on("change",function(){var t=this.value;v(t),g.attr("value",["Typo",o.node().value,t,e].join("_"))}),f.on("click",function(){var n=i.node().value,r=b(["Typo",o.node().value,n,e].join("_")),l=t.rendering_params[n]?t.rendering_params[n].color_map:void 0,p=Q(e,n,l),c=a(p,2),d=c[0];c[1];d.length>15?swal({title:"",text:i18next.t("app_page.common.error_too_many_features_color"),type:"warning",showCancelButton:!0,allowOutsideClick:!1,confirmButtonColor:"#DD6B55",confirmButtonText:i18next.t("app_page.common.valid")+"!",cancelButtonText:i18next.t("app_page.common.cancel")}).then(function(){(0,s.display_categorical_box)(user_data[e],e,n,d).then(function(e){e&&(t.rendering_params[n]={nb_class:e[0],color_map:e[1],colorByFeature:e[2],renderer:"Categorical",rendered_field:n,new_name:r,skip_alert:!0})})},function(e){return null}):(0,s.display_categorical_box)(user_data[e],e,n,d).then(function(e){e&&(t.rendering_params[n]={nb_class:e[0],color_map:e[1],colorByFeature:e[2],renderer:"Categorical",rendered_field:n,new_name:r,skip_alert:!0})})}),h.on("click",function(){var e=function(){!function(e,t,n,a,r,o){if(!a||!t||!X.rendering_params[t])return;var i=Object.getOwnPropertyNames(user_data)[0],l=user_data[i].length,s=X.rendering_params[t],p={},c=b(n.length>0?n:["PropSymbolsTypo",e,t,i].join("_"));p.field=e,p.new_name=c,p.nb_features=l,p.ref_layer_name=i,p.symbol=o,p.ref_value=+a,p.color_field=t,p.ref_size=+r,p.fill_color=s.colorByFeature,"line"===o?V(p):U(p);Object.assign(current_layers[c],{renderer:"PropSymbolsTypo",rendered_field:e,rendered_field2:t,color_map:s.color_map}),(0,y.zoom_without_redraw)(),(0,u.switch_accordion_section)(),(0,m.handle_legend)(c)}(o.node().value,i.node().value,g.node().value,l.node().value,section2.select("#PropSymbolTypo_ref_size").node().value,section2.select("#PropSymbolTypo_symbol_type").node().value)},n=i.node().value;t.rendering_params[n].color_map.size>15&&!t.rendering_params[n].skip_alert?swal({title:"",text:i18next.t("app_page.common.error_too_many_features_color"),type:"warning",showCancelButton:!0,allowOutsideClick:!1,confirmButtonColor:"#DD6B55",confirmButtonText:i18next.t("app_page.common.valid")+"!",cancelButtonText:i18next.t("app_page.common.cancel")}).then(function(){e()},function(e){return null}):e()}),(0,c.setSelected)(o.node(),n[0]),(0,c.setSelected)(i.node(),r[0])}else x()}},unfill:function(){v(document.getElementById("PropSymbolTypo_field_1")),v(document.getElementById("PropSymbolTypo_field_2")),v(document.getElementById("PropSymbolTypo_symbol_type")),section2.selectAll(".params").attr("disabled",!0)},rendering_params:{}};function Z(){var e=E(section2),t=e.append("p").attr("class","params_section2");t.append("p").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.discont.field"}).html(i18next.t("app_page.func_options.discont.field")),t.insert("select").attrs({class:"params",id:"field_Discont"});var n=e.append("p").attr("class","params_section2");n.append("span").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.discont.type_discontinuity"}).html(i18next.t("app_page.func_options.discont.type_discontinuity"));var a=n.insert("select").attrs({class:"params i18n",id:"kind_Discont"});[["app_page.func_options.discont.type_relative","rel"],["app_page.func_options.discont.type_absolute","abs"]].forEach(function(e){a.append("option").text(i18next.t(e[0])).attrs({value:e[1],"data-i18n":"[text]"+e[0]})});var r=e.append("p").attr("class","params_section2");r.append("span").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.discont.discretization"}).html(i18next.t("app_page.func_options.discont.discretization"));var o=r.insert("select").attrs({class:"params i18n",id:"Discont_discKind"});[["app_page.common.equal_interval","equal_interval"],["app_page.common.quantiles","quantiles"],["app_page.common.Q6","Q6"],["app_page.common.jenks","jenks"]].forEach(function(e){o.append("option").text(i18next.t(e[0])).attrs({value:e[1],"data-i18n":"[text]"+e[0]})});var i=e.append("p").attr("class","params_section2");i.append("span").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.discont.color"}).html(i18next.t("app_page.func_options.discont.color")),i.insert("input").attrs({class:"params",id:"color_Discont",type:"color",value:l.ColorsSelected.random()}),z(e,"Discont_output_name"),P(e,"yes_Discont",!1),e.selectAll(".params").attr("disabled",!0)}var $={fill:function(e){if(e){var t=(0,c.getFieldsType)("stock",e).concat((0,c.getFieldsType)("ratio",e)),n=((0,c.getFieldsType)("id",e),section2.select("#kind_Discont")),a=section2.select("#field_Discont"),r=section2.select("#yes_Discont");0!==t.length?(n.on("change",function(){var t=a.node().value;document.getElementById("Discont_output_name").value=["Disc",t,this.value,e].join("_")}),t.forEach(function(e){a.append("option").text(e).attr("value",e)}),a.on("change",function(){var t=document.getElementById("kind_Discont").value;document.getElementById("Discont_output_name").value=["Disc",this.value,t,e].join("_")}),r.on("click",ee),section2.selectAll(".params").attr("disabled",null),document.getElementById("Discont_output_name").value=["Disc",a.node().value,n.node().value,e].join("_")):x()}},unfill:function(){v(document.getElementById("field_Discont")),section2.selectAll(".params").attr("disabled",!0)}},ee=function(){var e=Object.getOwnPropertyNames(user_data)[0],t=document.getElementById("field_Discont").value,n=document.getElementById("kind_Discont").value,r=document.getElementById("Discont_discKind").value,o=document.getElementById("color_Discont").value,i=document.getElementById("Discont_output_name").value;i=b(i.length>0?i:["Disc",t,n,e].join("_"));var l=encodeId(i);_app.layer_to_id.set(i,l),_app.id_to_layer.set(l,i);new Map,topojson.mesh,Math.max;var s=_target_layer_file;_app.waitingOverlay.display();var d=new Worker("static/dist/webworker_discont.js");_app.webworker_to_cancel=d,d.postMessage([s,e,t,n,r,void 0]),d.onmessage=function(n){var s=a(n.data,2),_=s[0],g=s[1];_app.webworker_to_cancel=void 0;var f=_.length,h=Array(4).fill(0).map(function(e,t){return 1+3*t}),v=(0,p.discretize_to_size)(_,r,4,1,10),b=a(v,4),x=b[2],w=b[3];if(w&&x){var k=isInterrupted(current_proj_name.toLowerCase())||current_proj_name.toLowerCase().indexOf("conicconformal")>-1?"url(#clip)":null;x=x.map(function(e){return[e[0],e[1]]}).filter(function(e){return void 0!==e[1]}),result_data[i]=[];for(var A=map.insert("g",".legend").attrs({id:l,class:"layer","clip-path":k}).styles({"stroke-linecap":"round","stroke-linejoin":"round"}),j=result_data[i],S=(A.node(),0);S<f;S++){var E=g[S][0],z=h[w.getClass(E)],B=A.append("path").datum(g[S][2]).attrs({d:path,id:["feature",S].join("_")}).styles({stroke:o,"stroke-width":z,fill:"transparent","stroke-opacity":1}).node().__data__;j.push(g[S][1]),B.geometry=g[S][2],B.properties=j[S],B.properties.prop_val=z}current_layers[i]={renderer:"DiscLayer",breaks:x,min_display:0,type:"Line",rendered_field:t,size:[.5,10],is_result:!0,fixed_stroke:!0,ref_layer_name:e,fill_color:{single:o},n_features:f},(0,c.create_li_layer_elem)(i,f,["Line","discont"],"result"),_app.waitingOverlay.hide();var P=.5*current_layers[i].n_features;A.selectAll("path").style("display",function(e,t){return t<=P?null:"none"}),current_layers[i].min_display=.5,d3.select("#layer_to_export").append("option").attr("value",i).text(i),(0,y.zoom_without_redraw)(),(0,u.switch_accordion_section)(),(0,m.handle_legend)(i),send_layer_server(i,"/layers/add"),d.terminate()}else{var O=4>Math.floor(1+3.3*Math.log10(f))?i18next.t("app_page.common.smaller"):i18next.t("app_page.common.larger");swal("",i18next.t("app_page.common.error_discretization",{arg:O}),"error")}}};function te(e){var t=E(section2),n=(0,_.Mround)(h/2-h/10),a=t.append("p").attr("class","params_section2");a.append("p").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.common.field"}).html(i18next.t("app_page.func_options.common.field")),a.insert("select").attrs({class:"params",id:"PropSymbol_field_1"});var r=t.append("p").attr("class","params_section2");r.append("span").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.prop.fixed_size"}).html(i18next.t("app_page.func_options.prop.fixed_size")),r.insert("input").attrs({id:"PropSymbol_ref_size",type:"number",class:"params",min:.2,max:n,value:60,step:.1}).style("width","50px"),r.append("span").html(" px");var o=t.append("p").attr("class","params_section2");o.append("span").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.prop.on_value"}).html(i18next.t("app_page.func_options.prop.on_value")),o.insert("input").styles({width:"100px","margin-left":"10px"}).attrs({id:"PropSymbol_ref_value",type:"number",class:"params",min:.1,step:.1});var i=t.append("p").attr("class","params_section2");i.append("span").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.prop.symbol_type"}).html(i18next.t("app_page.func_options.prop.symbol_type")),i.insert("select").attrs({class:"params i18n",id:"PropSymbol_symbol"});var s=t.append("p").attr("class","params_section2");s.append("span").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.prop.symbol_color"}).html(i18next.t("app_page.func_options.prop.symbol_color"));var p=s.append("select").attrs({id:"PropSymbol_nb_colors",class:"params"});p.append("option").attrs({value:1,class:"i18n","data-i18n":"[text]app_page.func_options.prop.options_one_color"}).text(i18next.t("app_page.func_options.prop.options_one_color")),p.append("option").attrs({value:2,class:"i18n","data-i18n":"[text]app_page.func_options.prop.options_two_colors"}).text(i18next.t("app_page.func_options.prop.options_two_colors"));var c=t.append("p").attr("class","params_section2").styles({"padding-top":"5px","margin-bottom":"-5px","text-align":"center"});c.insert("input").styles({position:"unset"}).attrs({type:"color",class:"params",id:"PropSymbol_color1",value:l.ColorsSelected.random()}),c.insert("input").styles({display:"none",position:"unset"}).attrs({type:"color",class:"params",id:"PropSymbol_color2",value:l.ColorsSelected.random()});var d=t.insert("p").attr("class","params_section2");d.insert("span").style("display","none").attrs({id:"PropSymbol_color_txt",class:"i18n","data-i18n":"[html]app_page.func_options.prop.options_break_two_colors"}).html(i18next.t("app_page.func_options.prop.options_break_two_colors")),d.insert("input").attrs({id:"PropSymbol_break_val",type:"number",class:"params"}).styles({display:"none",width:"75px"}),z(t,"PropSymbol_output_name"),P(t,"PropSymbol_yes",!1),t.selectAll(".params").attr("disabled",!0)}var ne={fill:function(e){if(e){section2.selectAll(".params").attr("disabled",null);var t=(0,c.getFieldsType)("stock",e),n=user_data[e].length,a=section2.select("#PropSymbol_field_1"),r=section2.select("#PropSymbol_nb_colors"),o=section2.select("#PropSymbol_yes"),i=section2.select("#PropSymbol_ref_value"),l=section2.select("#PropSymbol_ref_size"),s=section2.select("#PropSymbol_symbol"),p=section2.select("#PropSymbol_output_name"),_=section2.select("#PropSymbol_color1"),g=section2.select("#PropSymbol_color2"),f=section2.select("#PropSymbol_break_val"),h=section2.select("#PropSymbol_color_txt");"Line"===current_layers[e].type?(l.attr("value",10),[["app_page.func_options.common.symbol_line","line"],["app_page.func_options.common.symbol_circle","circle"],["app_page.func_options.common.symbol_square","rect"]].forEach(function(e){s.append("option").text(i18next.t(e[0])).attrs({value:e[1],"data-i18n":"[text]"+e[0]})})):(l.attr("value",60),[["app_page.func_options.common.symbol_circle","circle"],["app_page.func_options.common.symbol_square","rect"]].forEach(function(e){s.append("option").text(i18next.t(e[0])).attrs({value:e[1],"data-i18n":"[text]"+e[0]})})),t.forEach(function(e){a.append("option").text(e).attr("value",e)}),a.on("change",function(){var t=this.value,n=user_data[e].map(function(e){return+e[t]}),a=(0,d.max_fast)(n);p.attr("value",["PropSymbol",this.value,e].join("_")),i.attrs({max:a,value:a}),(0,d.has_negative)(n)?((0,c.setSelected)(r.node(),2),f.attr("value",0)):(0,c.setSelected)(r.node(),1)}),r.on("change",function(){1==+this.value?(g.style("display","none"),f.style("display","none"),h.style("display","none")):(g.style("display",null),f.style("display",null),h.style("display","inline"))}),o.on("click",function(){var t=a.node().value,o=s.node().value,c=p.node().value,d=b(c.length>0?c:["PropSymbols",t,e].join("_")),h={field:t,nb_features:n,new_name:d,ref_layer_name:e,symbol:o,ref_size:+l.node().value,ref_value:+i.node().value,fill_color:_.node().value};2==+r.node().value&&(h.break_val=+f.node().value,h.fill_color={two:[_.node().value,g.node().value]}),"line"===o?V(h):U(h),(0,y.zoom_without_redraw)(),(0,u.switch_accordion_section)(),(0,m.handle_legend)(d)}),p.attr("value",["PropSymbols",e].join("_")),(0,c.setSelected)(a.node(),t[0])}},unfill:function(){v(document.getElementById("PropSymbol_field_1")),v(document.getElementById("PropSymbol_symbol")),section2.selectAll(".params").attr("disabled",!0)}};function ae(){var e=E(section2),t=e.append("p").attr("class","params_section2");t.append("span").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.typosymbol.field"}).html(i18next.t("app_page.func_options.typosymbol.field")),t.insert("select").attrs({class:"params",id:"field_Symbol"}),e.insert("p").attr("class","params_section2").styles({"text-align":"center",margin:"auto"}).append("button").attrs({id:"selec_Symbol",class:"button_disc params i18n","data-i18n":"[html]app_page.func_options.typosymbol.symbols_choice"}).styles({"font-size":"0.8em","text-align":"center"}).html(i18next.t("app_page.func_options.typosymbol.symbols_choice")),z(e,"TypoSymbols_output_name"),P(e,"yesTypoSymbols"),e.selectAll(".params").attr("disabled",!0),window.default_symbols||(window.default_symbols=[],(0,u.prepare_available_symbols)())}var re={fill:function(e){if(e){var t=Object.getOwnPropertyNames(user_data[e][0]),n=section2.select("#field_Symbol"),a=section2.select("#selec_Symbol"),r=section2.select("#TypoSymbols_output_name"),o=section2.select("#yesTypoSymbols"),l=this;section2.selectAll(".params").attr("disabled",null),t.forEach(function(e){n.append("option").text(e).attr("value",e)}),n.on("change",function(){var e=this.value;o.attr("disabled",!l.rendering_params[e]||null)}),a.on("click",function(){swal({title:"",text:i18next.t("app_page.common.error_too_many_features"),type:"warning",showCancelButton:!0,allowOutsideClick:!1,confirmButtonColor:"#DD6B55",confirmButtonText:i18next.t("app_page.common.valid")+"!",cancelButtonText:i18next.t("app_page.common.cancel")}).then(function(){var t=document.getElementById("field_Symbol").value,n=l.rendering_params[t]?l.rendering_params[t].symbols_map:void 0;(0,g.display_box_symbol_typo)(e,t,n).then(function(e){e&&(document.getElementById("yesTypoSymbols").disabled=null,l.rendering_params[t]={nb_cat:e[0],symbols_map:e[1],field:t})})},function(){return null})}),o.on("click",function(){var e=n.node().value;!function(e,t){var n=Object.getOwnPropertyNames(user_data)[0],a=_app.layer_to_id.get(n),r=e.field,o=b(t.length>0?t:["Symbols",r,n].join("_")),l=document.getElementById(a).getElementsByTagName("path"),s=l.length;var p=function(){for(var e=[],t=0,n=l.length;t<n;++t){var a=l[t].__data__,o=a.properties[r],i={id:t,type:"Feature",properties:{},geometry:{type:"Point"}};if(a.geometry.type.indexOf("Multi")<0)i.properties.symbol_field=o,i.properties.id_parent=a.id,i.geometry.coordinates=d3.geoCentroid(a.geometry),e.push(i);else{for(var s=[],p=0;p<a.geometry.coordinates.length;p++)s.push(path.area({type:a.geometry.type,coordinates:[a.geometry.coordinates[p]]}));var c=s.indexOf((0,d.max_fast)(s));i.properties.symbol_field=o,i.properties.id_parent=a.id,i.geometry.coordinates=d3.geoCentroid({type:a.geometry.type,coordinates:[a.geometry.coordinates[c]]}),e.push(i)}}return{type:"FeatureCollection",features:e}}(),_=encodeId(o),f=new i.default;_app.layer_to_id.set(o,_),_app.id_to_layer.set(_,o),map.insert("g",".legend").attrs({id:_,class:"layer no_clip"}).selectAll("image").data(p.features).enter().insert("image").attrs(function(t){var n=e.symbols_map.get(t.properties.symbol_field),a=path.centroid(t.geometry);return{x:a[0]-n[1]/2,y:a[1]-n[1]/2,width:n[1],height:n[1],"xlink:href":n[0]}}).on("mouseover",function(){this.style.cursor="pointer"}).on("mouseout",function(){this.style.cursor="initial"}).on("contextmenu dblclick",function(){var e;f.showMenu(d3.event,document.querySelector("body"),(e=this,[{name:i18next.t("app_page.common.edit_style"),action:function(){(0,g.make_style_box_indiv_symbol)(e)}},{name:i18next.t("app_page.common.delete"),action:function(){e.style.display="none"}}]))}).call(drag_elem_geo),current_layers[o]={n_features:current_layers[n].n_features,renderer:"TypoSymbols",symbols_map:e.symbols_map,rendered_field:r,is_result:!0,symbol:"image",ref_layer_name:n},(0,c.create_li_layer_elem)(o,s,["Point","symbol"],"result"),(0,m.handle_legend)(o),(0,y.zoom_without_redraw)(),(0,u.switch_accordion_section)()}(l.rendering_params[e],r.node().value)}),(0,c.setSelected)(n.node(),t[0]),r.attr("value",["Symbols",e].join("_"))}},unfill:function(){v(document.getElementById("field_Symbol")),section2.selectAll(".params").attr("disabled",!0)},rendering_params:{}};function oe(e){var t=E(section2),n=t.append("p").attr("class","params_section2 opt_point").style("display","none");n.append("p").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.grid.map_type"}).html(i18next.t("app_page.func_options.grid.map_type"));var a=n.insert("select").attrs({class:"params i18n",id:"Gridded_map_type"}),r=t.append("p").attr("class","params_section2 opt_point").style("display","none");r.append("p").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.grid.mesh_type"}).html(i18next.t("app_page.func_options.grid.mesh_type"));var o=r.insert("select").attrs({class:"params i18n",id:"Gridded_mesh_type"}),i=t.append("p").attr("class","params_section2 opt_point").style("display","none");i.append("p").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.grid.func"}).html(i18next.t("app_page.func_options.grid.func"));var l=i.insert("select").attrs({class:"params i18n",id:"Gridded_func_ratio"}),s=i.insert("select").attrs({class:"params i18n",id:"Gridded_func_stock"}),p=t.append("p").attr("class","params_section2 opt_point opt_field").styles({"margin-top":"2px",display:"none"});p.append("p").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.common.field"}).html(i18next.t("app_page.func_options.common.field")),p.insert("select").attrs({class:"params field_to_use",id:"Gridded_field_pt"});var c=t.append("p").attr("class","params_section2 opt_point opt_user_layer").style("display","none");c.append("p").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.grid.user_polygon_layer"}).html(i18next.t("app_page.func_options.grid.user_polygon_layer")),c.insert("select").attrs({class:"params mask_field",id:"Gridded_polygon_layer"});var d=t.append("p").attr("class","params_section2 opt_point opt_grid").styles({display:"none",margin:"35px 0 0 0"});d.append("span").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.grid.cellsize"}).html(i18next.t("app_page.func_options.grid.cellsize")),d.insert("input").style("width","100px").attrs({type:"number",class:"params",id:"Gridded_cellsize_pt",min:1,max:7e3,step:"any"}).property("value",10);var _=t.append("p").attr("class","params_section2 opt_point opt_grid").style("display","none");_.append("span").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.grid.shape"}).html(i18next.t("app_page.func_options.grid.shape"));var u=_.insert("select").attrs({class:"params i18n",id:"Gridded_shape_pt"}),m=t.append("p").attr("class","params_section2 opt_point opt_grid").styles({display:"none","padding-top":"10px"});m.append("p").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.common.mask"}).html(i18next.t("app_page.func_options.common.mask")),m.insert("select").attrs({class:"params mask_field",id:"Gridded_mask"}),[["app_page.func_options.grid.type_stock","stock"],["app_page.func_options.grid.type_ratio","ratio"]].forEach(function(e){a.append("option").text(i18next.t(e[0])).attrs({value:e[1],"data-i18n":"[text]"+e[0]})}),[["app_page.func_options.grid.user_polygons","user_polygons"],["app_page.func_options.grid.regular_grid","regular_grid"]].forEach(function(e){o.append("option").text(i18next.t(e[0])).attrs({value:e[1],"data-i18n":"[text]"+e[0]})}),[["app_page.func_options.grid.density_count","density_count"],["app_page.func_options.grid.density_weighted","density_weighted"],["app_page.func_options.grid.mean","mean"],["app_page.func_options.grid.stddev","stddev"]].forEach(function(e){l.append("option").text(i18next.t(e[0])).attrs({value:e[1],"data-i18n":"[text]"+e[0]}).property("disabled",e[2])}),[["app_page.func_options.grid.stock_count","count"],["app_page.func_options.grid.stock_weighted","weighted"]].forEach(function(e){s.append("option").text(i18next.t(e[0])).attrs({value:e[1],"data-i18n":"[text]"+e[0]}).property("disabled",e[2])});var y=t.append("p").attr("class","params_section2 opt_polygon").style("margin-top","9px");y.append("p").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.common.field"}).html(i18next.t("app_page.func_options.common.field")),y.insert("select").attrs({class:"params field_to_use",id:"Gridded_field"});var g=t.append("p").attr("class","params_section2 opt_polygon").style("margin","35px 0 0 0");g.append("span").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.grid.cellsize"}).html(i18next.t("app_page.func_options.grid.cellsize")),g.insert("input").style("width","100px").attrs({type:"number",class:"params",id:"Gridded_cellsize",min:1,max:7e3,step:"any"}).property("value",10);var f=t.append("p").attr("class","params_section2 opt_polygon");f.append("span").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.grid.shape"}).html(i18next.t("app_page.func_options.grid.shape"));var h=f.insert("select").attrs({class:"params i18n",id:"Gridded_shape"}),v=t.append("p").attr("class","params_section2 opt_polygon opt_point opt_grid").style("padding-top","2px");v.append("span").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.grid.coloramp"}).html(i18next.t("app_page.func_options.grid.coloramp"));var b=v.insert("select").attrs({class:"params",id:"Gridded_color_pal"});["Blues","BuGn","BuPu","GnBu","OrRd","PuBu","PuBuGn","PuRd","RdPu","YlGn","Greens","Greys","Oranges","Purples","Reds"].forEach(function(e){b.append("option").text(e).attr("value",e)}),[["app_page.func_options.grid.square","Square"],["app_page.func_options.grid.diamond","Diamond"],["app_page.func_options.grid.hexagon","Hexagon"]].forEach(function(e){h.append("option").text(i18next.t(e[0])).attrs({value:e[1],"data-i18n":"[text]"+e[0]}),u.append("option").text(i18next.t(e[0])).attrs({value:e[1],"data-i18n":"[text]"+e[0]})}),z(t,"Gridded_output_name"),P(t,"Gridded_yes",!1),section2.selectAll(".params").attr("disabled",!0)}var ie={fill:function(e){var t=d3.select("#Gridded_polygon_layer"),n=d3.select("#Gridded_mask"),r=(0,c.get_other_layer_names)();v(n.node()),v(t.node()),n.append("option").text("None").attr("value","None");for(var o,i=0,l=r.length;i<l;i++)o=r[i],"Polygon"===current_layers[o].type&&(n.append("option").text(o).attr("value",o),t.append("option").text(o).attr("value",o));if(e){var s=current_layers[e].type;if(section2.selectAll(".opt_polygon").style("display","Polygon"===s?null:"none"),section2.selectAll(".opt_point").style("display","Point"===s?null:"none"),"Point"===s){var d=document.getElementById("Gridded_map_type").value,_=document.getElementById("Gridded_mesh_type").value,g="ratio"===d?document.getElementById("Gridded_func_ratio").value:document.getElementById("Gridded_func_stock").value;"stock"===d?(document.getElementById("Gridded_func_stock").style.display=null,document.getElementById("Gridded_func_ratio").style.display="none",section2.select('option[value="regular_grid"]').property("disabled",!0)):(document.getElementById("Gridded_func_stock").style.display="none",document.getElementById("Gridded_func_ratio").style.display=null,section2.select('option[value="regular_grid"]').property("disabled",!1)),section2.selectAll(".opt_point.opt_grid").style("display","regular_grid"===_?null:"none"),section2.selectAll(".opt_point.opt_user_layer").style("display","regular_grid"!==_?null:"none"),section2.select(".opt_point.opt_field").style("display","density_count"!==g&&"count"!==g?null:"none"),section2.select("#Gridded_mesh_type").on("change",function(){"regular_grid"===this.value?(section2.selectAll(".opt_point.opt_grid").style("display",null),section2.selectAll(".opt_point.opt_user_layer").style("display","none")):"user_polygons"===this.value&&(section2.selectAll(".opt_point.opt_grid").style("display","none"),section2.selectAll(".opt_point.opt_user_layer").style("display",null))}),section2.select("#Gridded_func_ratio").on("change",function(){section2.select(".opt_point.opt_field").style("display","density_count"===this.value?"none":null),x.attr("value",["Gridded",e].join("_"))}),section2.select("#Gridded_func_stock").on("change",function(){section2.select(".opt_point.opt_field").style("display","count"===this.value?"none":null),x.attr("value",["PropSymbol",e].join("_"))}),section2.select("#Gridded_map_type").on("change",function(){section2.select("#Gridded_mesh_type").property("value","user_polygons").dispatch("change"),"stock"===this.value?(document.getElementById("Gridded_func_stock").style.display=null,document.getElementById("Gridded_func_ratio").style.display="none",section2.select('option[value="regular_grid"]').property("disabled",!0)):(document.getElementById("Gridded_func_stock").style.display="none",document.getElementById("Gridded_func_ratio").style.display=null,section2.select('option[value="regular_grid"]').property("disabled",!1))})}var f=(0,c.getFieldsType)("stock",e),h=section2.selectAll(".field_to_use"),x=section2.select("#Gridded_output_name"),w=section2.select("#Gridded_yes");f.forEach(function(e){h.append("option").text(e).attr("value",e)}),h.on("change",function(){"Point"!==s&&x.attr("value",["Gridded",this.value,e].join("_"))}),w.on("click",function(){var e=x.node().value;if("Point"===s){var t="stock"===document.getElementById("Gridded_map_type").value?"Gridded_func_stock":"Gridded_func_ratio",n={mesh_type:document.getElementById("Gridded_mesh_type").value,func_type:document.getElementById(t).value,field:document.getElementById("Gridded_field_pt").value,resolution:document.getElementById("Gridded_cellsize_pt").value,cell_shape:document.getElementById("Gridded_shape_pt").value,mask_layer:document.getElementById("Gridded_mask").value,polygon_layer:document.getElementById("Gridded_polygon_layer").value,color_palette:document.getElementById("Gridded_color_pal").value};if("user_polygons"===n.mesh_type&&!n.polygon_layer)return void(0,c.display_error_during_computation)(i18next.t("app_page.common.error_background_needed"));!function(e,t){var n=Object.getOwnPropertyNames(user_data)[0],r=new FormData,o=null;if("regular_grid"===e.mesh_type){var i=A(e.resolution);if(i){var l="low"===i?i18next.t("app_page.common.error_too_low_resolution"):i18next.t("app_page.common.error_too_high_resolution");return void(0,c.display_error_during_computation)(l)}}else if(!e.polygon_layer in current_layers)return void(0,c.display_error_during_computation)("Unable to find the layer");if("density_count"!==e.func_type){var s=e.field;o={},current_layers[n].original_fields.has(s)?o[s]=[]:o[s]=user_data[n].map(function(e){return e[s]})}r.append("json",JSON.stringify({topojson:current_layers[n].key_name,mesh_type:e.mesh_type,var_name:o,cellsize:1e3*e.resolution,grid_shape:e.cell_shape,polygon_layer:"regular_grid"!==e.mesh_type?current_layers[e.polygon_layer].key_name:null,mask_layer:"None"!==e.mask_layer?current_layers[e.mask_layer].key_name:null,func_type:e.func_type})),(0,c.xhrequest)("POST","compute/gridded_point",r,!0).then(function(n){if("count"===e.func_type||"weighted"===e.func_type){var r=(n=JSON.parse(n)).file.objects[Object.keys(n.file.objects)].geometries,o=e.func_type,i=0,l=-1/0;d3.select("#"+_app.layer_to_id.get(e.polygon_layer)).selectAll("path").each(function(e,t){var n=r[t].properties[o];e.properties[o]=n,i+=1,n>l&&(l=n)});var s=b(t.length>0?t:["PropSymbols",o,e.polygon_layer].join("_")),c={field:o,nb_features:i,new_name:s,ref_layer_name:e.polygon_layer,symbol:"circle",ref_size:40,ref_value:l,fill_color:"pink"};U(c),(0,y.zoom_without_redraw)(),(0,u.switch_accordion_section)(),(0,m.handle_legend)(s)}else{var d={result_layer_on_add:!0,func_name:"grid"};t.length>0&&/^\w+$/.test(t)&&(d.choosed_name=t);var _=e.func_type,g=(0,u.add_layer_topojson)(n,d);if(!g)return;var f=result_data[g],h=f.length,v=[],x=Math.floor(1+3.3*Math.log10(h));x=x>4?x-1:x;for(var w=0;w<h;w++)v.push(f[w][_]);current_layers[g].renderer="Gridded";var k=(0,p.discretize_to_colors)(v,"jenks",x,e.color_palette),A=a(k,6),j=A[0],S=A[1],E=A[2],z=A[3],B=A[4],P=A[5],O={nb_class:j,type:S,schema:[e.color_palette],breaks:E,no_data:P,colors:z,colorsByFeature:B,renderer:"Gridded",rendered_field:_};Y(g,O),(0,m.handle_legend)(g),(0,u.switch_accordion_section)()}},function(e){(0,c.display_error_during_computation)(),console.log(e)})}(n,e)}else!function(e,t,n,a,r){var o=Object.getOwnPropertyNames(user_data)[0],i=new FormData,l={},s=A(t);if(s){var d="low"===s?i18next.t("app_page.common.error_too_low_resolution"):i18next.t("app_page.common.error_too_high_resolution");return void(0,c.display_error_during_computation)(d)}current_layers[o].original_fields.has(e)?l[e]=[]:l[e]=user_data[o].map(function(t){return t[e]});i.append("json",JSON.stringify({topojson:current_layers[o].key_name,var_name:l,cellsize:1e3*t,grid_shape:n})),(0,c.xhrequest)("POST","compute/gridded",i,!0).then(function(t){var n={result_layer_on_add:!0,func_name:"grid"};r.length>0&&/^\w+$/.test(r)&&(n.choosed_name=r);var o=e+"_densitykm",i=(0,u.add_layer_topojson)(t,n);if(i){for(var l=result_data[i],s=l.length,c=Math.floor(1+3.3*Math.log10(s)),d=[],_=0;_<s;_++)d.push(+l[_][o]);current_layers[i].renderer="Gridded";var y=(0,p.discretize_to_colors)(d,"quantiles",c,a),g={nb_class:c,type:"quantiles",schema:[a],breaks:y[2],colors:y[3],colorsByFeature:y[4],renderer:"Gridded",rendered_field:o};Y(i,g),(0,m.handle_legend)(i),(0,u.switch_accordion_section)()}},function(e){(0,c.display_error_during_computation)(),console.log(e)})}(document.getElementById("Gridded_field").value,document.getElementById("Gridded_cellsize").value,document.getElementById("Gridded_shape").value,document.getElementById("Gridded_color_pal").value,e)}),x.attr("value",["Gridded",e].join("_")),document.getElementById("Gridded_cellsize").value=k("grid"),document.getElementById("Gridded_cellsize_pt").value=k("grid"),section2.selectAll(".params").attr("disabled",null)}},unfill:function(){v(document.getElementById("Gridded_field")),v(document.getElementById("Gridded_field_pt")),section2.selectAll(".params").attr("disabled",!0)}};function le(){var e=E(section2);e.append("p").attr("class","params_section2").append("span").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.flow.subtitle1"}).html(i18next.t("app_page.func_options.flow.subtitle1"));var t=e.append("p").attr("class","params_section2");t.append("p").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.flow.origin_field"}).html(i18next.t("app_page.func_options.flow.origin_field")),t.insert("select").attrs({id:"FlowMap_field_i",class:"params"}).styles({position:"relative",float:"right","margin-bottom":"7.5px"});var n=e.append("p").attr("class","params_section2");n.append("p").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.flow.destination_field"}).html(i18next.t("app_page.func_options.flow.destination_field")),n.append("select").attrs({class:"params",id:"FlowMap_field_j"}).styles({position:"relative",float:"right","margin-bottom":"7.5px"});var a=e.append("p").attr("class","params_section2");a.append("p").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.flow.intensity_field"}).html(i18next.t("app_page.func_options.flow.intensity_field")),a.append("select").attrs({class:"params",id:"FlowMap_field_fij"}).styles({position:"relative",float:"right","margin-bottom":"7.5px"});var r=e.append("p").attr("class","params_section2");r.append("p").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.flow.discretization"}).html(i18next.t("app_page.func_options.flow.discretization"));var o=r.insert("select").attrs({class:"params i18n",id:"FlowMap_discKind"});[["app_page.common.no_classification","no_classification"],["app_page.common.equal_interval","equal_interval"],["app_page.common.quantiles","quantiles"],["app_page.common.Q6","Q6"],["app_page.common.jenks","jenks"]].forEach(function(e){o.append("option").text(i18next.t(e[0])).attrs({value:e[1],"data-i18n":"[text]"+e[0]})});var i=e.append("div").attr("id","FlowMap_discSection").styles({clear:"both",display:"none","padding-top":"2px"}),l=e.append("div").attr("id","FlowMap_noDiscSection").styles({clear:"both","padding-top":"2px"}),s=l.append("p").attr("class","params_section2");s.append("span").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.choroprop.fixed_size"}).html(i18next.t("app_page.func_options.choroprop.fixed_size")),s.insert("input").attrs({id:"FlowMap_ref_size",type:"number",class:"params",min:.1,max:100,step:"any"}).style("width","50px"),s.append("span").html(" (px)");var p=l.append("p").attr("class","params_section2");p.append("span").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.choroprop.on_value"}).html(i18next.t("app_page.func_options.choroprop.on_value")),p.insert("input").styles({width:"100px","margin-left":"10px"}).attrs({type:"number",class:"params",id:"FlowMap_ref_value"}).attrs({min:.1,step:.1});var c=i.append("p").attr("class","params_section2");c.append("span").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.flow.nb_class"}).html(i18next.t("app_page.func_options.flow.nb_class")),c.insert("input").attrs({type:"number",class:"params",id:"FlowMap_nbClass",min:1,max:33}).style("width","50px").property("value",8),i.append("p").attrs({class:"params",id:"FlowMap_discTable"}),i.append("p").attr("class","params_section2").insert("span").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.flow.ref_layer_field"}).html(i18next.t("app_page.func_options.flow.ref_layer_field"));var d=e.append("p").attr("class","params_section2");d.append("p").attrs({class:"i18n","data-i18n":"[html]app_page.func_options.flow.join_field"}).html(i18next.t("app_page.func_options.flow.join_field")),d.insert("select").attrs({class:"params",id:"FlowMap_field_join"}),z(e,"FlowMap_output_name"),P(e,"FlowMap_yes",!1),d3.selectAll(".params").attr("disabled",!0)}var se={fill:function(e){var t=section2.select("#FlowMap_field_i"),n=section2.select("#FlowMap_field_j"),a=section2.select("#FlowMap_field_fij"),r=section2.select("#FlowMap_field_join"),o=section2.select("#FlowMap_nbClass"),i=section2.select("#FlowMap_discKind"),l=section2.select("#FlowMap_ref_value"),s=section2.select("#FlowMap_ref_size").property("value",20),p=section2.select("#FlowMap_yes"),_=section2.select("#FlowMap_output_name");joined_dataset.length>0&&0===document.getElementById("FlowMap_field_i").options.length&&Object.getOwnPropertyNames(joined_dataset[0][0]).forEach(function(e){t.append("option").text(e).attr("value",e),n.append("option").text(e).attr("value",e),a.append("option").text(e).attr("value",e)});if(e){var y=Object.getOwnPropertyNames(user_data[e][0]);y.forEach(function(e){r.append("option").text(e).attr("value",e)}),_.attr("value",y.length>=1?["Links",y[0]].join("_"):"LinksLayer")}else _.attr("value","LinksLayer");r.on("change",function(){_.attr("value",["Links",this.value].join("_"))});var g=void 0;if(a.on("change",function(){var e=this.value,t=i.node().value;if(g=joined_dataset[0].map(function(t){return+t[e]}),"no_classification"===t)l.property("value",(0,d.max_fast)(g));else{var n=+o.node().value;O(g,n,t,.5,10,"FlowMap_discTable")}}),i.on("change",function(){var e=this.value,t=a.node().value;if(g=joined_dataset[0].map(function(e){return+e[t]}),"no_classification"===e)section2.select("#FlowMap_noDiscSection").style("display",null),section2.select("#FlowMap_discSection").style("display","none"),l.property("value",(0,d.max_fast)(g));else{section2.select("#FlowMap_noDiscSection").style("display","none"),section2.select("#FlowMap_discSection").style("display",null);var n=+o.node().value;"Q6"===e&&(n=6,o.property("value",6)),O(g,n,e,.5,10,"FlowMap_discTable")}}),o.on("change",function(){a.node().value;var e=this.value,t=i.node().value;O(g,e,t,.5,10,"FlowMap_discTable")}),p.on("click",function(){var e=i.node().value;"no_classification"===e?function(e,t,n,a,r,o,i){var l=Object.getOwnPropertyNames(user_data)[0],s=new FormData,p={};p[a]=user_data[l].map(function(e){return e[a]}),s.append("json",JSON.stringify({topojson:current_layers[l].key_name,csv_table:JSON.stringify(joined_dataset[0]),field_i:e,field_j:t,field_fij:n,join_field:p})),(0,c.xhrequest)("POST","compute/links",s,!0).then(function(e){var t={result_layer_on_add:!0,func_name:"flow"};i.length>0&&/^\w+$/.test(i)&&(t.choosed_name=i);var a=JSON.parse(e);a.file.objects.LinksLayer.geometries=a.file.objects.LinksLayer.geometries.sort(function(e,t){return+t.properties[n]-+e.properties[n]});var s=(0,u.add_layer_topojson)(JSON.stringify(a),t);if(s){var p=map.select("#"+_app.layer_to_id.get(s)).selectAll("path"),c=n,_=result_data[s].map(function(e){return+e[c]}),y=_.length,g=new d.PropSizer(o,r,"line");p.each(function(e){e.properties.color="#FF0000",e.properties.prop_value=g.scale(e.properties[n])}),p.styles(function(e){return{fill:"transparent",stroke:e.properties.color,"stroke-width":e.properties.prop_value}}),Object.assign(current_layers[s],{n_features:y,renderer:"LinksProportional",symbol:"path",rendered_field:n,size:[o,r],"stroke-width-const":void 0,is_result:!0,ref_layer_name:l,fill_color:{single:"#FF0000"},type:"Line"}),(0,u.switch_accordion_section)(),(0,m.handle_legend)(s)}})}(t.node().value,n.node().value,a.node().value,r.node().value,+s.node().value,+l.node().value,_.node().value):function(e,t,n,a,r,o){var i=Object.getOwnPropertyNames(user_data)[0],l=new FormData,s={},p=function(e){var t=void 0;if(e)t=document.getElementById(e);else if("flow"===_app.current_functionnality.name)document.getElementById("FlowMap_discTable");else{if("discont"!==_app.current_functionnality.name)return;document.getElementById("Discont_discTable")}var n=Array.prototype.map.call(t.querySelectorAll(".min_class"),function(e){return+e.value}),a=Array.prototype.map.call(t.querySelectorAll(".max_class"),function(e){return+e.value}),r=Array.prototype.map.call(t.querySelectorAll(".size_class"),function(e){return+e.value}),o=(n.length,function(e,t){return e-t}),i=[].concat(n),l=[].concat(a),s=[].concat(r),p=n.sort(o),c=a.sort(o),d=r.sort(o);return i.every(function(e,t){return p[t]===e})&&l.every(function(e,t){return c[t]===e})&&s.every(function(e,t){return d[t]===e})?{mins:p,maxs:c,sizes:d}:(swal("",i18next.t("app_page.common.error_values_order"),"error"),!1)}("FlowMap_discTable"),_=p.mins,y=p.maxs,g=p.sizes,f=_.length,h=[].concat(_,y[f-1]),v=min_fast(g),b=(0,d.max_fast)(g);s[a]=user_data[i].map(function(e){return e[a]}),l.append("json",JSON.stringify({topojson:current_layers[i].key_name,csv_table:JSON.stringify(joined_dataset[0]),field_i:e,field_j:t,field_fij:n,join_field:s})),(0,c.xhrequest)("POST","compute/links",l,!0).then(function(e){var t={result_layer_on_add:!0,func_name:"flow"};o.length>0&&/^\w+$/.test(o)&&(t.choosed_name=o);var a=(0,u.add_layer_topojson)(e,t);if(a){var r=map.select("#"+_app.layer_to_id.get(a)).selectAll("path"),l=n,s=result_data[a].map(function(e){return+e[l]}),p=s.length,c=new geostats(s);h[0]<c.min()&&(h[0]=c.min()),h[f]>c.max()&&(h[f]=c.max()),c.setClassManually(h),current_layers[a].fixed_stroke=!0,current_layers[a].renderer="LinksGraduated",current_layers[a].breaks=[],current_layers[a].linksbyId=[],current_layers[a].size=[v,b],current_layers[a].rendered_field=l,current_layers[a].ref_layer_name=i,current_layers[a].min_display=0;for(var d=current_layers[a].linksbyId,_=0;_<p;++_){var y=+s[_];d.push([_,y,g[c.getClass(y)]])}for(var x=0;x<f;++x)current_layers[a].breaks.push([[h[x],h[x+1]],g[x]]);r.style("fill-opacity",0).style("stroke-opacity",.8).style("stroke-width",function(e,t){return d[t][2]}),(0,u.switch_accordion_section)(),(0,m.handle_legend)(a)}},function(e){(0,c.display_error_during_computation)(),console.log(e)})}(t.node().value,n.node().value,a.node().value,r.node().value,0,_.node().value)}),e&&joined_dataset.length>0){section2.selectAll(".params").attr("disabled",null);var f=Object.getOwnPropertyNames(joined_dataset[0][0]);f.length>=3&&(n.node().value=f[1],a.node().value=f[2],n.node().dispatchEvent(new Event("change")),a.node().dispatchEvent(new Event("change")))}},unfill:function(){v(document.getElementById("FlowMap_field_i")),v(document.getElementById("FlowMap_field_j")),v(document.getElementById("FlowMap_field_fij")),v(document.getElementById("FlowMap_field_join")),document.getElementById("FlowMap_discTable").innerHTML="",document.getElementById("FlowMap_output_name").value="",section2.selectAll(".params").attr("disabled",!0)}};t.render_label=function(e,t,n){var a=t.label_field,r=t.color,o=t.font,l=t.ref_font_size+"px",s=[],p=[],_=t.uo_layer_name&&t.uo_layer_name.length>0?b(t.uo_layer_name):b("Labels_"+e),u=function(){return!0};void 0!==t.filter_options&&("sup"===t.filter_options.type_filter?u=function(e){return e[t.filter_options.field]>t.filter_options.filter_value}:"inf"===t.filter_options.type_filter&&(u=function(e){return e[t.filter_options.field]<t.filter_options.filter_value}));var m=encodeId(_),g=void 0;_app.layer_to_id.set(_,m),_app.id_to_layer.set(m,_);var f=void 0;if(n&&n.current_position&&(g=n.current_position),n&&n.data)f=(s=n.data).length;else if(e){var h=current_layers[e].symbol||"path",v=document.getElementById(_app.layer_to_id.get(e)).getElementsByTagName(h),x=0;f=v.length;for(var k=0;k<f;k++){var A=v[k].__data__;if(u(A.properties)){var j=void 0;if(A.geometry){if(-1===A.geometry.type.indexOf("Multi"))j=d3.geoCentroid(A.geometry);else{for(var S=[],E=0;E<A.geometry.coordinates.length;E++)S.push(path.area({type:A.geometry.type,coordinates:[A.geometry.coordinates[E]]}));var z=S.indexOf((0,d.max_fast)(S));j=d3.geoCentroid({type:A.geometry.type,coordinates:[A.geometry.coordinates[z]]})}x+=1,s.push({id:x,type:"Feature",properties:{label:A.properties[a],x:j[0],y:j[1]},geometry:{type:"Point",coordinates:j}})}else p.push([k,A])}}}var B=new i.default,P=map.insert("g",".legend").attrs({id:m,class:"layer no_clip"}).selectAll("text").data(s).enter().insert("text");return g?P.attrs(function(e,t){return{id:"Feature_"+t,x:g[t][0],y:g[t][1],"alignment-baseline":"middle","text-anchor":"middle"}}).styles(function(e,t){return{display:g[t][2],"font-size":g[t][3],"font-family":g[t][4],fill:g[t][5]}}).text(function(e,t){return g[t][6]}):P.attrs(function(e,t){var n=path.centroid(e.geometry);return{id:"Feature_"+t,x:n[0],y:n[1],"alignment-baseline":"middle","text-anchor":"middle"}}).styles({"font-size":l,"font-family":o,fill:r}).text(function(e){return e.properties.label}),P.on("mouseover",function(){this.style.cursor="pointer"}).on("mouseout",function(){this.style.cursor="initial"}).on("dblclick contextmenu",function(){var e;B.showMenu(d3.event,document.querySelector("body"),(e=this,[{name:i18next.t("app_page.common.edit_style"),action:function(){make_style_box_indiv_label(e)}},{name:i18next.t("app_page.common.delete"),action:function(){e.style.display="none"}}]))}).call(drag_elem_geo),current_layers[_]={n_features:s.length,renderer:"Label",symbol:"text",fill_color:r,rendered_field:a,is_result:!0,ref_layer_name:e,default_size:l,default_font:o},(0,c.create_li_layer_elem)(_,f,["Point","label"],"result"),p.length>0&&setTimeout(function(){w(p)},50),(0,y.zoom_without_redraw)(),_},t.render_label_graticule=function(e,t,n){var a=t.color,r=t.font,o=t.ref_font_size+"px",l=t.position_lat||"bottom",s=t.position_lon||"left",p=[],d=b("Labels_Graticule"),_=encodeId(d);_app.layer_to_id.set(d,_),_app.id_to_layer.set(_,d);var u=void 0;if(n&&n.data)u=(p=n.data).length;else if(e){var m=d3.geoGraticule().step([current_layers.Graticule.step,current_layers.Graticule.step]);u=(m=current_layers.Graticule.extent?m.extent(current_layers.Graticule.extent).lines():m.lines()).length;for(var g=0;g<u;g++){var f=m[g],h=void 0,v=void 0;f.coordinates[0][0]===f.coordinates[1][0]?(h=f.coordinates[0][0],v="bottom"===l?{type:"Point",coordinates:f.coordinates[0]}:{type:"Point",coordinates:f.coordinates[f.length-1]}):f.coordinates[0][1]===f.coordinates[1][1]&&(h=f.coordinates[0][1],v="left"===s?{type:"Point",coordinates:f.coordinates[0]}:{type:"Point",coordinates:f.coordinates[f.length-1]}),void 0!==h&&p.push({id:g,type:"Feature",properties:{label:h},geometry:v})}}var x=new i.default;return map.insert("g",".legend").attrs({id:_,class:"layer no_clip"}).selectAll("text").data(p).enter().insert("text").attrs(function(e,t){var n=path.centroid(e.geometry);return{id:"Feature_"+t,x:n[0],y:n[1],"alignment-baseline":"middle","text-anchor":"middle"}}).styles({"font-size":o,"font-family":r,fill:a}).text(function(e){return e.properties.label}).on("mouseover",function(){this.style.cursor="pointer"}).on("mouseout",function(){this.style.cursor="initial"}).on("dblclick contextmenu",function(){var e;x.showMenu(d3.event,document.querySelector("body"),(e=this,[{name:i18next.t("app_page.common.edit_style"),action:function(){make_style_box_indiv_label(e)}},{name:i18next.t("app_page.common.delete"),action:function(){e.style.display="none"}}]))}).call(drag_elem_geo),current_layers[d]={n_features:p.length,renderer:"Label",symbol:"text",fill_color:a,is_result:!0,ref_layer_name:e,default_size:o,default_font:r},(0,c.create_li_layer_elem)(d,u,["Point","label"],"result"),(0,y.zoom_without_redraw)(),d}},function(e,n,a){"use strict";(function(e){Object.defineProperty(n,"__esModule",{value:!0}),n.available_projections=n.shortListContent=void 0,n.handle_projection_select=function(){var e=this.querySelector('[value="last_projection"]'),t=this.value;if("more"===t)return this.value=e&&current_proj_name===e.name?"last_projection":current_proj_name,void h();if("proj4"===t)return this.value=e&&current_proj_name===e.name?"last_projection":current_proj_name,void u();"last_projection"===t?(t=e.name,e.projValue&&(_app.last_projection=e.projValue)):"ConicConformalFrance"===t?(t="def_proj4",_app.last_projection="+proj=lcc +lat_1=49 +lat_2=44 +lat_0=46.5 +lon_0=3 +x_0=700000 +y_0=6600000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs "):"AzimuthalEqualAreaEurope"===t&&(t="def_proj4",_app.last_projection="+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ");"def_proj4"===t?(current_proj_name=t,E(proj4(_app.last_projection)),g(this,_app.last_projection)):(current_proj_name=t,S(current_proj_name))},n.addLastProjectionSelect=f,n.isInterrupted=A,n.handleClipPath=j,n.change_projection=S,n.change_projection_4=E;var r=a(1),o=a(3),i=a(2),l=a(11),p=a(33),c=a(12);d3.geoWinkel1=function(){return d3.geoProjection((0,p.winkel1Raw)(45)).scale(200)},d3.geoHatano=function(){return d3.geoProjection(p.hatanoRaw).scale(200)};var d=n.shortListContent=["AzimuthalEqualAreaEurope","ConicConformalFrance","HEALPix","Mercator","NaturalEarth2","Robinson","TransverseMercator","WinkelTriple","more","proj4"],_=n.available_projections=new Map([["Armadillo",{name:"geoArmadillo",scale:"400",param_in:"other",param_ex:"aphylactic"}],["AzimuthalEquidistant",{name:"geoAzimuthalEquidistant",scale:"700",param_in:"plan",param_ex:"equidistant"}],["AzimuthalEqualArea",{name:"geoAzimuthalEqualArea",scale:"700",param_in:"plan",param_ex:"equalarea"}],["AzimuthalEqualAreaEurope",{name:"geoAzimuthalEqualArea",scale:"700",rotate:[-10,-52,0],bounds:[-10.67,34.5,31.55,71.05],param_in:"plan",param_ex:"equalarea"}],["Baker",{name:"geoBaker",scale:"400",param_in:"other",param_ex:"aphylactic"}],["Berhmann",{name:"geoCylindricalEqualArea",scale:"400",parallel:30,param_in:"cylindrical",param_ex:"equalarea"}],["Bertin",{name:"geoBertin1953",scale:"400",param_in:"other",param_ex:"aphylactic"}],["Boggs",{name:"geoBoggs",scale:"400",param_in:"pseudocylindre",param_ex:"equalarea"}],["InterruptedBoggs",{name:"geoInterruptedBoggs",scale:"400",param_in:"pseudocylindre",param_ex:"equalarea"}],["Bonne",{name:"geoBonne",scale:"400",param_in:"pseudocone",param_ex:"equalarea"}],["Bromley",{name:"geoBromley",scale:"400",param_in:"pseudocylindre",param_ex:"equalarea"}],["Collignon",{name:"geoCollignon",scale:"400",param_in:"pseudocylindre",param_ex:"equalarea"}],["ConicConformal",{name:"geoConicConformal",scale:"400",parallels:[44,49],bounds:[-25.5,-25.5,75.5,75.5],param_in:"cone",param_ex:"conformal"}],["ConicConformalFrance",{name:"geoConicConformal",scale:"400",parallels:[44,49],rotate:[-3,-46.5,0],bounds:[-10.67,34.5,31.55,71.05],param_in:"cone",param_ex:"conformal"}],["ConicEqualArea",{name:"geoConicEqualArea",scale:"400",param_in:"cone",param_ex:"equalarea"}],["ConicEquidistant",{name:"geoConicEquidistant",scale:"400",parallels:[40,45],param_in:"cone",param_ex:"equidistant"}],["CrasterParabolic",{name:"geoCraster",scale:"400",param_in:"pseudocylindre",param_ex:"equalarea"}],["Equirectangular",{name:"geoEquirectangular",scale:"400",param_in:"cylindrical",param_ex:"equidistant"}],["CylindricalEqualArea",{name:"geoCylindricalEqualArea",scale:"400",param_in:"cylindrical",param_ex:"equalarea"}],["CylindricalStereographic",{name:"geoCylindricalStereographic",scale:"400",param_in:"cylindrical",param_ex:"aphylactic"}],["EckertI",{name:"geoEckert1",scale:"400",param_in:"pseudocylindre",param_ex:"aphylactic"}],["EckertII",{name:"geoEckert2",scale:"400",param_in:"pseudocylindre",param_ex:"equalarea"}],["EckertIII",{name:"geoEckert3",scale:"525",param_in:"pseudocylindre",param_ex:"aphylactic"}],["EckertIV",{name:"geoEckert4",scale:"525",param_in:"pseudocylindre",param_ex:"equalarea"}],["EckertV",{name:"geoEckert5",scale:"400",param_in:"pseudocylindre",param_ex:"aphylactic"}],["EckertVI",{name:"geoEckert6",scale:"400",param_in:"pseudocylindre",param_ex:"equalarea"}],["Eisenlohr",{name:"geoEisenlohr",scale:"400",param_in:"other",param_ex:"conformal"}],["GallPeters",{name:"geoCylindricalEqualArea",scale:"400",parallel:45,param_in:"cylindrical",param_ex:"equalarea"}],["GallStereographic",{name:"geoCylindricalStereographic",scale:"400",parallel:45,param_in:"cylindrical",param_ex:"aphylactic"}],["Gilbert",{name:"geoGilbert",scale:"400",type:"",param_in:"other",param_ex:"aphylactic"}],["Gnomonic",{name:"geoGnomonic",scale:"400",param_in:"plan",param_ex:"aphylactic"}],["Gringorten",{name:"geoGringorten",scale:"400",param_in:"other",param_ex:"equalarea"}],["GringortenQuincuncial",{name:"geoGringortenQuincuncial",scale:"400",param_in:"other",param_ex:"equalarea"}],["Hatano",{name:"geoHatano",scale:"200",param_in:"other",param_ex:"equalarea"}],["HEALPix",{name:"geoHealpix",scale:"400",param_in:"pseudocylindre",param_ex:"equalarea"}],["HoboDyer",{name:"geoCylindricalEqualArea",scale:"400",parallel:37.5,param_in:"cylindrical",param_ex:"equalarea"}],["Homolosine",{name:"geoHomolosine",scale:"400",param_in:"pseudocylindre",param_ex:"equalarea"}],["InterruptedHomolosine",{name:"geoInterruptedHomolosine",scale:"400",param_in:"pseudocylindre",param_ex:"equalarea"}],["Loximuthal",{name:"geoLoximuthal",scale:"400",param_in:"pseudocylindre",param_ex:"aphylactic"}],["Mercator",{name:"geoMercator",scale:"375",param_in:"cylindrical",param_ex:"conformal"}],["Miller",{name:"geoMiller",scale:"375",param_in:"cylindrical",param_ex:"aphylactic"}],["MillerOblatedStereographic",{name:"geoModifiedStereographicMiller",scale:"375",param_in:"plan",param_ex:"conformal"}],["Mollweide",{name:"geoMollweide",scale:"400",param_in:"pseudocylindre",param_ex:"equalarea"}],["NaturalEarth",{name:"geoNaturalEarth1",scale:"400",param_in:"pseudocylindre",param_ex:"aphylactic"}],["NaturalEarth2",{name:"geoNaturalEarth2",scale:"400",param_in:"pseudocylindre",param_ex:"aphylactic"}],["Orthographic",{name:"geoOrthographic",scale:"475",clipAngle:90,param_in:"plan",param_ex:"aphylactic"}],["Patterson",{name:"geoPatterson",scale:"400",param_in:"cylindrical",param_ex:"aphylactic"}],["Polyconic",{name:"geoPolyconic",scale:"400",param_in:"pseudocone",param_ex:"aphylactic"}],["Peircequincuncial",{name:"geoPeirceQuincuncial",scale:"400",param_in:"other",param_ex:"conformal"}],["Robinson",{name:"geoRobinson",scale:"400",param_in:"pseudocylindre",param_ex:"aphylactic"}],["SinuMollweide",{name:"geoSinuMollweide",scale:"400",param_in:"pseudocylindre",param_ex:"equalarea"}],["InterruptedSinuMollweide",{name:"geoInterruptedSinuMollweide",scale:"400",param_in:"pseudocylindre",param_ex:"equalarea"}],["Sinusoidal",{name:"geoSinusoidal",scale:"400",param_in:"pseudocylindre",param_ex:"equalarea"}],["InterruptedSinusoidal",{name:"geoInterruptedSinusoidal",scale:"400",param_in:"pseudocylindre",param_ex:"equalarea"}],["Stereographic",{name:"geoStereographic",scale:"400",param_in:"cylindrical",param_ex:"aphylactic"}],["TransverseMercator",{name:"geoTransverseMercator",scale:"400",param_in:"cylindrical",param_ex:"conformal"}],["Werner",{name:"geoBonne",scale:"400",parallel:90,param_in:"pseudocone",param_ex:"equalarea"}],["Winkel1",{name:"geoWinkel1",scale:"200",param_in:"pseudocylindre",param_ex:"aphylactic"}],["WinkelTriple",{name:"geoWinkel3",scale:"400",param_in:"pseudoplan",param_ex:"aphylactic"}]]),u=function(){(0,r.make_dialog_container)("box_projection_input",i18next.t("app_page.section5.title"),"dialog");var e=document.getElementById("box_projection_input"),t=e.querySelector(".modal-dialog"),n=d3.select(e).select(".modal-body").attr("id","box_proj4");t.style.width=void 0,t.style.maxWidth="500px",t.style.minWidth="400px";var a=n.append("p");a.append("span").style("float","left").html(i18next.t("app_page.proj4_box.enter_string")),a.append("input").styles({width:"90%"}).attrs({id:"input_proj_string",placeholder:"EPSG:3035"});var o=function(e){helper_esc_key_twbs_cb(e,i)},i=function(){e.remove(),r.overlay_under_modal.hide(),document.removeEventListener("keydown",o)};e.querySelector(".btn_cancel").onclick=i,e.querySelector("#xclose").onclick=i,e.querySelector(".btn_ok").onclick=function(){var e=document.getElementById("input_proj_string").value.trim(),t=void 0,n=void 0,a=void 0;if((e.startsWith('"')||e.startsWith("'"))&&(e=e.substr(1)),(e.endsWith('"')||e.endsWith("'"))&&(e=e.slice(0,-1)),e.toUpperCase().startsWith("EPSG:")){var r=+e.toUpperCase().split("EPSG:")[1],o=_app.epsg_projections[r];o?(a=o.name,e=o.proj4):(n=i18next.t("app_page.common.missing_epsg"),e=void 0)}else a=k(e);i();try{t=proj4(e)}catch(e){return void swal({title:"Oops...",text:i18next.t("app_page.proj4_box.error",{detail:n||e}),type:"error",allowOutsideClick:!1,allowEscapeKey:!1}).then(function(){return null},function(){return null})}E(t)?(_app.last_projection=e,f("def_proj4",_app.last_projection,a),current_proj_name="def_proj4"):swal({title:"Oops...",text:i18next.t("app_page.proj4_box.error",{detail:""}),type:"error",allowOutsideClick:!1,allowEscapeKey:!1}).then(function(){return null},function(){return null})},document.addEventListener("keydown",o),r.overlay_under_modal.display()},m=function(e){var t=e.target;if(t&&"SELECT"===t.tagName){var n=t.tooltip,a=document.createElement("div");a.className="custom_tooltip",a.appendChild(document.createTextNode(n));var r=document.body.firstChild;r.parentNode.insertBefore(a,r);var o=this.getBoundingClientRect(),i=a.getBoundingClientRect(),l=o.bottom-i.height/2;a.setAttribute("style","top: "+l+"px; left: "+(o.right-15)+"px;")}},y=function(e){var t=e.target;if(t&&"SELECT"===t.tagName){var n=document.querySelector("div.custom_tooltip");n&&n.remove()}},g=function(e,t){e.tooltip=t,e.addEventListener("mouseover",m),e.addEventListener("mouseout",y)};function f(e,t,n){var a=document.getElementById("form_projection2");if(d.indexOf(e)>-1)a.value=e;else if("RGF93 / Lambert-93"===n)a.value="ConicConformalFrance";else if("ETRS89 / LAEA Europe"===n)a.value="AzimuthalEqualAreaEurope";else if(10===a.options.length){var r=a.querySelector("[value='more']"),o=document.createElement("option");o.className="i18n",o.value="last_projection",o.name=e,o.projValue=t,o.innerHTML=n||i18next.t("app_page.projection_name."+e),n||o.setAttribute("data-i18n","[text]app_page.projection_name."+e),a.insertBefore(o,r),a.value="last_projection"}else{var i=a.querySelector("[value='last_projection']");i.name=e,i.projValue=t,i.innerHTML=n||i18next.t("app_page.projection_name."+e),n?i.removeAttribute("data-i18n"):i.setAttribute("data-i18n","[text]app_page.projection_name."+e),a.value="last_projection"}t&&g(a,t)}var h=function(){function e(e,t){if(P.remove(),P=B.append("select").attr("id","select_proj").attr("size",18).style("min-width","195px"),e||t)if(t)if(e){var n=!0;_.forEach(function(a,r){a.param_in===e&&a.param_ex===t&&(n=!1,P.append("option").attrs({class:"i18n",value:r}).text(i18next.t("app_page.projection_name."+r)))}),n&&P.append("option").attrs({class:"i18n",value:"no_result"}).html(i18next.t("app_page.projection_box.no_result_projection"))}else _.forEach(function(e,n){e.param_ex===t&&P.append("option").attrs({class:"i18n",value:n}).text(i18next.t("app_page.projection_name."+n))});else _.forEach(function(t,n){t.param_in===e&&P.insert("option").attrs({class:"i18n",value:n}).text(i18next.t("app_page.projection_name."+n))});else Array.from(_.keys()).forEach(function(e){P.append("option").attrs({class:"i18n",value:e,"data-i18n":"app_page.projection_name."+e}).text(i18next.t("app_page.projection_name."+e))});P.on("dblclick",function(){"no_result"!==this.value&&a(this.value)})}function n(){var t=Array.prototype.filter.call(document.querySelector(".switch-field.f1").querySelectorAll("input"),function(e){return e.checked})[0];"any"===(t=void 0===t?void 0:t.value)&&(t=void 0);var n=Array.prototype.filter.call(document.querySelector(".switch-field.f2").querySelectorAll("input"),function(e){return e.checked})[0];"any"===(n=void 0===n?void 0:n.value)&&(n=void 0),e(t,n)}function a(e){current_proj_name=e,f(current_proj_name),S(current_proj_name),function(){if(proj.rotate){C.style("display","");var e=proj.rotate();I.node().value=-e[0],L.node().value=-e[1],N.node().value=-e[2]}else C.style("display","none");if(proj.parallels){var t=proj.parallels();F.style("display",""),W.style("display","none"),D.node().value=t[0],R.node().value=t[1]}else proj.parallel?(F.style("display","none"),W.style("display",""),H.node().value=proj.parallel()):(F.style("display","none"),W.style("display","none"))}()}var i=current_proj_name,l=[].concat(t),p=s,c=proj.rotate?proj.rotate():void 0,d=proj.parallels?proj.parallels():void 0,u=proj.parallel?proj.parallel():void 0,m=((0,r.make_dialog_container)("box_projection_customization",i18next.t("app_page.section5.title"),"dialog"),document.getElementById("box_projection_customization")),y=m.querySelector(".modal-dialog"),g=d3.select(m).select(".modal-body").attr("id","box_projection");y.style.width="700px";g.append("button").attrs({class:"accordion_proj active",id:"btn_choice_proj"}).style("padding","0 6px").html(i18next.t("app_page.projection_box.choice_projection"));var h=g.append("div").attrs({class:"panel show",id:"accordion_choice_projection"}).style("padding","10px").style("width","98%").append("div").attr("id","choice_proj_content").style("text-align","center"),w=h.append("div").styles({float:"left",width:"50%"}),k=h.append("div").styles({float:"right",width:"45%"}),A=h.append("div").styles({float:"left",width:"50%"});h.append("div").style("clear","both");var j=w.append("div").attr("class","switch-field f1");j.append("div").attrs({class:"switch-title"}).html(i18next.t("app_page.projection_box.filter_nature")),["any","other","cone","cylindrical","plan","pseudocone","pseudocylindre","pseudoplan"].forEach(function(e,t){var n="switch_proj1_elem_"+t;j.append("input").attrs({type:"radio",id:n,class:"filter1",name:"switch_proj1",value:e}),j.append("label").attr("for",n).html(i18next.t("app_page.projection_box."+e))});var z=A.append("div").attr("class","switch-field f2");z.append("div").attrs({class:"switch-title"}).html(i18next.t("app_page.projection_box.filter_prop")),["any","aphylactic","conformal","equalarea","equidistant"].forEach(function(e,t){var n="switch_proj2_elem_"+t;z.append("input").attrs({type:"radio",id:n,class:"filter2",name:"switch_proj2",value:e}),z.append("label").attr("for",n).html(i18next.t("app_page.projection_box."+e))}),Array.prototype.forEach.call(document.querySelectorAll(".filter1,.filter2"),function(e){e.onclick=n});var B=k.append("p").style("margin","auto"),P=B.append("select").attr("id","select_proj").attr("size",18);e(null,null),k.append("button").style("margin","5px 0 5px 0").attrs({id:"btn_valid_reproj",class:"button_st4 i18n"}).html(i18next.t("app_page.projection_box.ok_reproject")).on("click",function(){var e=document.getElementById("select_proj").value;"no_result"!==e&&a(e)});g.append("button").attrs({class:"accordion_proj",id:"btn_choice_proj"}).style("padding","0 6px").html(i18next.t("app_page.projection_box.projection_options"));var O=g.append("div").attrs({class:"panel",id:"accordion_choice_projection"}).style("padding","10px").style("width","98%").append("div").attr("id","options_proj_content").style("width","60%").style("transform","translateX(45%)"),C=O.append("div").style("display",c?"":"none"),M=C.append("p");M.append("span").style("float","left").html(i18next.t("app_page.section5.projection_center_lambda"));var I=M.append("input").styles({width:"60px",float:"right",height:"2rem"}).attrs({type:"number",value:c?-c[0]:0,min:-180,max:180,step:.5}).on("input",function(){this.value>180?this.value=180:this.value<-180&&(this.value=-180),v([-this.value,null,null])}),q=C.append("p").style("clear","both");q.append("span").style("float","left").html(i18next.t("app_page.section5.projection_center_phi"));var L=q.append("input").styles({width:"60px",float:"right",height:"2rem"}).attrs({type:"number",value:c?-c[1]:0,min:-180,max:180,step:.5}).on("input",function(){this.value>180?this.value=180:this.value<-180&&(this.value=-180),v([null,-this.value,null])}),T=C.append("p").style("clear","both");T.append("span").style("float","left").html(i18next.t("app_page.section5.projection_center_gamma"));var N=T.append("input").styles({width:"60px",float:"right",height:"2rem"}).attrs({type:"number",value:c?-c[2]:0,min:-90,max:90,step:.5}).on("input",function(){this.value>90?this.value=90:this.value<-90&&(this.value=-90),v([null,null,-this.value])}),F=O.append("div").styles({"text-align":"center",clear:"both"}).style("display",d?"":"none");F.append("span").html(i18next.t("app_page.section5.parallels"));var G=F.append("p").styles({"text-align":"center",margin:"auto"}),D=G.append("input").styles({width:"60px",display:"inline","margin-right":"2px"}).attrs({type:"number",value:d?d[0]:0,min:-90,max:90,step:.5}).on("input",function(){this.value>90?this.value=90:this.value<-90&&(this.value=-90),b([this.value,null])}),R=G.append("input").styles({width:"60px",display:"inline","margin-left":"2px"}).attrs({type:"number",value:d?d[1]:0,min:-90,max:90,step:.5}).on("input",function(){this.value>90?this.value=90:this.value<-90&&(this.value=-90),b([null,this.value])}),W=O.append("div").styles({"text-align":"center",clear:"both"}).style("display",u?"":"none");W.append("span").html(i18next.t("app_page.section5.parallel"));var H=W.append("p").styles({"text-align":"center",margin:"auto"}).append("input").styles({width:"60px",display:"inline","margin-right":"2px"}).attrs({type:"number",value:u||0,min:-90,max:90,step:.5}).on("input",function(){this.value>90?this.value=90:this.value<-90&&(this.value=-90),x(this.value)});"def_proj4"===i&&(O.selectAll("input").attr("disabled","disabled"),O.selectAll("span").styles({color:"darkgrey","font-style":"italic"})),(0,o.accordionize2)(".accordion_proj",m);var V=function(){m.remove(),r.overlay_under_modal.hide(),document.removeEventListener("keydown",U)},U=function(e){helper_esc_key_twbs_cb(e,Y)},Y=function(){if(V(),s=p,t=l.slice(),current_proj_name=i,"def_proj4"!==i)S(current_proj_name),f(current_proj_name);else if("def_proj4"===i){E(proj4(_app.last_projection));var e=Object.keys(_app.epsg_projections).map(function(e){return[e,_app.epsg_projections[e]]}).filter(function(e){return e[1].proj4===_app.last_projection});e=e&&e.length>0&&e[0].length>1?e[0][1].name:void 0,f(current_proj_name,_app.last_projection,e)}c&&v(c),d?b(d):u&&x(u)};m.querySelector(".btn_cancel").onclick=Y,m.querySelector("#xclose").onclick=Y,m.querySelector(".btn_ok").onclick=V,document.addEventListener("keydown",U),r.overlay_under_modal.display()};function v(e){var t=proj.rotate();proj.rotate(e.map(function(e,n){return e||t[n]})),map.selectAll(".layer").selectAll("path").attr("d",path),(0,l.reproj_symbol_layer)()}function b(e){var t=proj.parallels();proj.parallels(e.map(function(e,n){return e||t[n]})),map.selectAll(".layer").selectAll("path").attr("d",path),(0,l.reproj_symbol_layer)()}function x(e){proj.parallel(e),map.selectAll(".layer").selectAll("path").attr("d",path),(0,l.reproj_symbol_layer)()}var w=function(e){var t=function(t,n){return e.forward([57.29577951308232*t,57.29577951308232*n])};return t.invert=function(t,n){var a=e.inverse([t,n]);return[.017453292519943295*a[0],.017453292519943295*a[1]]},d3.geoProjection(t)},k=function(e){var t=Object.entries(_app.epsg_projections).filter(function(t){return t[1].proj4.indexOf(e)>-1||t[1].proj4.replace("+towgs84=0,0,0,0,0,0,0 ","").indexOf(e)>-1});return t.length>0?t[0][1].name:void 0};function A(e){return e.indexOf("interrupted")>-1||e.indexOf("armadillo")>-1||e.indexOf("healpix")>-1}function j(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=(arguments[1],e.toLowerCase()),n=defs.node().querySelector("#sphereClipPath"),a=defs.node().querySelector("#extent"),r=defs.node().querySelector("clipPath");if(n&&n.remove(),a&&a.remove(),r&&r.remove(),A(t))defs.append("path").datum({type:"Sphere"}).attr("id","sphereClipPath").attr("d",path),defs.append("clipPath").attr("id","clip").append("use").attr("xlink:href","#sphereClipPath"),map.selectAll(".layer:not(.no_clip)").attr("clip-path","url(#clip)"),svg_map.insertBefore(defs.node(),svg_map.childNodes[0]);else if(t.indexOf("conicconformal")>-1){var o=d3.geoGraticule().extentMajor([[-180,-60],[180,90]]).outline();defs.append("path").attr("id","extent").attr("d",path(o)),defs.append("clipPath").attr("id","clip").append("use").attr("xlink:href","#extent"),map.selectAll(".layer:not(.no_clip)").attr("clip-path","url(#clip)")}else map.selectAll(".layer").attr("clip-path",null)}function S(n){map.select(".brush").remove(),d3.select("img#btn_graticule").style("opacity","1").on("click",function(){return(0,c.add_layout_feature)("graticule")}),d3.select("img#btn_sphere").style("opacity","1").on("click",function(){return(0,c.add_layout_feature)("sphere")});var a=proj.rotate?[proj.rotate()[0],0,0]:[0,0,0],r=_.get(n);proj=d3[r.name](),r.parallels?proj=proj.parallels(r.parallels):r.parallel&&(proj=proj.parallel(r.parallel)),r.clipAngle&&(proj=proj.clipAngle(r.clipAngle)),r.rotate&&(a=r.rotate),proj.rotate&&proj.rotate(a),path=d3.geoPath().projection(proj).pointRadius(4),void 0!==proj.invert?(document.getElementById("brush_zoom_button").style.display="",d3.select("img#btn_scale").style("opacity","1").on("click",function(){return(0,c.add_layout_feature)("scale")})):(document.getElementById("brush_zoom_button").style.display="none",d3.select("img#btn_scale").style("opacity","0.3").on("click",null));var o=Object.getOwnPropertyNames(user_data)[0];if(!o&&r.bounds)scale_to_bbox(r.bounds);else if(!o){var p=Array.prototype.filter.call(svg_map.querySelectorAll(".layer"),function(e){return"hidden"!==e.style.visibility});o=p.length>0?e._app.id_to_layer.get(p[p.length-1].id):void 0}o?((0,i.scale_to_lyr)(o),(0,i.center_map)(o),(0,l.zoom_without_redraw)()):(proj.translate(t).scale(s),map.selectAll(".layer").selectAll("path").attr("d",path),(0,l.reproj_symbol_layer)());var d=document.querySelector("div.custom_tooltip");d&&d.remove();var u=document.querySelector("#form_projection2");u.removeAttribute("tooltip"),u.removeEventListener("mouseover",m),u.removeEventListener("mouseout",y),j(n,o)}function E(n){(0,i.remove_layer_cleanup)("Sphere"),e._app.last_projection&&(e._app.last_projection.indexOf("=lcc")>-1||e._app.last_projection.indexOf("Lambert_Conformal_Conic")>-1)?(d3.select("img#btn_graticule").style("opacity","0.3").on("click",null),d3.select("img#btn_sphere").style("opacity","0.3").on("click",null)):(d3.select("img#btn_graticule").style("opacity","1").on("click",function(){return(0,c.add_layout_feature)("graticule")}),d3.select("img#btn_sphere").style("opacity","1").on("click",function(){return(0,c.add_layout_feature)("sphere")})),map.select(".brush").remove();proj.rotate&&proj.rotate()[0];proj=w(n),path=d3.geoPath().projection(proj).pointRadius(4),void 0!==proj.invert?(document.getElementById("brush_zoom_button").style.display="",d3.select("img#btn_scale").style("opacity","1").on("click",function(){return(0,c.add_layout_feature)("scale")})):(document.getElementById("brush_zoom_button").style.display="none",d3.select("img#btn_scale").style("opacity","0.3").on("click",null));var a=Object.getOwnPropertyNames(user_data)[0];if(!a){var r=Array.prototype.filter.call(svg_map.querySelectorAll(".layer"),function(e){return"hidden"!==e.style.visibility});a=r.length>0?e._app.id_to_layer.get(r[r.length-1].id):void 0}if(a&&"World"!==a&&"Sphere"!==a&&"Graticule"!==a){var o=(0,i.fitLayer)(a);s=o[0],t=o[1],(isNaN(s)||0===s||isNaN(t[0])||isNaN(t[1]))&&(s=100,t=[0,0],scale_to_bbox([-10.67,34.5,31.55,71.05]))}else scale_to_bbox([-10.67,34.5,31.55,71.05]);return isNaN(s)||0===s||isNaN(t[0])||isNaN(t[1])?(s=100,t=[0,0],console.log("Error"),!1):(map.selectAll(".layer").selectAll("path").attr("d",path),(0,l.reproj_symbol_layer)(),(0,i.center_map)(a),(0,l.zoom_without_redraw)(),j(),!0)}}).call(this,a(4))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.scaleBar=void 0;s(n(10));var a=s(n(9)),r=n(1),o=n(7),i=n(6),l=n(15);function s(e){return e&&e.__esModule?e:{default:e}}t.scaleBar={create:function(e,t){var n=this,r=map.append("g").attrs({id:"scale_bar",class:"legend scale"}),o=h-100,s=this;if(this.x=40,this.y=o,this.bar_size=50,this.unit="km",this.precision=0,this.start_end_bar=!1,this.fixed_size=!1,!this.getDist()){var p=new a.default;if(this.under_rect=r.insert("rect").attrs({x:30,y:o-20,height:30,width:this.bar_size+20,id:"under_rect"}).styles({fill:"green","fill-opacity":0}),r.insert("rect").attrs({id:"rect_scale",x:40,y:o,height:2,width:this.bar_size}).style("fill","black"),r.insert("text").attrs({id:"text_limit_sup_scale",x:90,y:o-5}).styles({"font-family":"verdana","font-size":"11px","text-anchor":"middle"}).text(this.dist_txt+" km"),r.call((0,l.drag_legend_func)(r)),r.on("mouseover",function(){this.style.cursor="pointer",s.under_rect.style("fill-opacity",.1)}).on("mouseout",function(){this.style.cursor="pointer",s.under_rect.style("fill-opacity",0)}).on("contextmenu dblclick",function(e,t){return d3.event.preventDefault(),d3.event.stopPropagation(),p.showMenu(d3.event,document.querySelector("body"),[{name:i18next.t("app_page.common.edit_style"),action:function(){n.editStyle()}},{name:i18next.t("app_page.common.up_element"),action:function(){n.up_element()}},{name:i18next.t("app_page.common.down_element"),action:function(){n.down_element()}},{name:i18next.t("app_page.common.delete"),action:function(){n.remove()}}])}),e&&t&&r.attr("transform","translate("+[e-this.x,t-this.y]+")"),this.Scale=r,this.displayed=!0,this.dist>100)this.resize(100*(0,i.Mround)(this.dist/100));else if(this.dist>10)this.resize(10*(0,i.Mround)(this.dist/10));else if((0,i.Mround)(this.dist)>1)this.resize((0,i.Mround)(this.dist));else if((0,i.Mround)(10*this.dist)/10>.1)this.precision=1,this.resize((0,i.Mround)(10*this.dist)/10);else{var c=this.dist.toString().split(".");this.precision=c&&c.length>1?c[1].length:(""+this.dist).length,this.resize(this.dist)}pos_lgds_elem.set(r.attr("id")+" "+r.attr("class"),r.node().getBBox())}},getDist:function(){var e=w/2,t=h/2,n=d3.zoomTransform(svg_map),a=[n.x,n.y],r=n.k;isNaN(this.bar_size)&&(console.log("scaleBar.bar_size : NaN"),this.bar_size=50);var i=proj.invert([(e-a[0])/r,(t-a[1])/r]),l=proj.invert([(e+this.bar_size-a[0])/r,(t-a[1])/r]);if(!i||!l)return this.remove(),!0;this.dist=(0,o.coslaw_dist)([i[1],i[0]],[l[1],l[0]]);var s="km"==this.unit?1:"m"==this.unit?1e3:"mi"==this.unit?.621371:1;this.dist_txt=(this.dist*s).toFixed(this.precision)},resize:function(e){e=e||this.fixed_size;var t=+this.dist/e,n=this.bar_size/t;this.Scale.select("#rect_scale").attr("width",n),this.Scale.select("#text_limit_sup_scale").attr("x",this.x+n/2),this.bar_size=n,this.fixed_size=e,this.under_rect.attr("width",n+20),this.getDist()?this.remove():(this.Scale.select("#text_limit_sup_scale").text(this.fixed_size+" "+this.unit),this.handle_start_end_bar())},update:function(){this.getDist()?this.remove():this.fixed_size?this.resize():this.Scale.select("#text_limit_sup_scale").text(this.dist_txt+" "+this.unit)},up_element:function(){up_legend(this.Scale.node())},down_element:function(){down_legend(this.Scale.node())},remove:function(){pos_lgds_elem.delete(this.Scale.attr("id")+" "+this.Scale.attr("class")),this.Scale.remove(),this.Scale=null,this.displayed=!1},handle_start_end_bar:function(){this.Scale.selectAll(".se_bar").remove(),this.start_end_bar&&(this.Scale.insert("rect").attrs({class:"start_bar se_bar",x:this.x,y:this.y-4.5,width:"1.5px",height:"4.5px"}),this.Scale.insert("rect").attrs({class:"end_bar se_bar",x:this.x+this.bar_size-1.5,y:this.y-4.5,width:"1.5px",height:"4.5px"}))},editStyle:function(){var e=void 0,t=this,n=function(){e?t.resize(e):(t.fixed_size=!1,t.update())};(0,r.make_confirm_dialog2)("scaleBarEditBox",i18next.t("app_page.scale_bar_edit_box.title"),{widthFitContent:!0}).then(function(e){e&&n()});var a=d3.select(".scaleBarEditBox").select(".modal-body").style("width","295px");a.append("h3").html(i18next.t("app_page.scale_bar_edit_box.title"));var o=a.append("p").attr("class","line_elem2");o.append("span").html(i18next.t("app_page.scale_bar_edit_box.fixed_size")),o.append("input").style("float","right").attrs({id:"scale_fixed_field",type:"number"}).property("disabled",!t.fixed_size||null).property("value",+this.dist_txt).on("change",function(){e=+this.value,n()}),o.append("input").style("float","right").attrs({type:"checkbox",checked:!!t.fixed_size||null}).on("change",function(){a.select("#scale_fixed_field").attr("disabled")?(a.select("#scale_fixed_field").attr("disabled",null),e=+a.select("#scale_fixed_field").attr("value")):(a.select("#scale_fixed_field").attr("disabled",!0),e=!1),n()});var i=a.append("p").attr("class","line_elem2");i.insert("span").html(i18next.t("app_page.scale_bar_edit_box.precision")),i.insert("input").attrs({id:"scale_precision",type:"number",min:0,max:6,step:1}).styles({float:"right",width:"60px"}).property("value",+t.precision).on("change",function(){t.precision=+this.value,n()});var l=a.append("p").attr("class","line_elem2");l.insert("span").html(i18next.t("app_page.scale_bar_edit_box.unit"));var s=l.insert("select").style("float","right").attr("id","scale_unit").on("change",function(){t.unit=this.value,n()});s.append("option").text("km").attr("value","km"),s.append("option").text("m").attr("value","m"),s.append("option").text("mi").attr("value","mi"),s.node().value=t.unit;var p=a.append("p").attr("class","line_elem2");p.append("span").html(i18next.t("app_page.scale_bar_edit_box.start_end_bar")),p.append("input").style("float","right").attrs({id:"checkbox_start_end_bar",type:"checkbox"}).on("change",function(e){t.start_end_bar=!0!==t.start_end_bar,t.handle_start_end_bar()}),document.getElementById("checkbox_start_end_bar").checked=t.start_end_bar},displayed:!1}},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.bindTooltips=function(){(0,o.default)(".tt_menuleft",{arrow:!0,duration:[1,50],flip:!1,onShow:function(){Array.prototype.slice.call(document.querySelectorAll(".tippy-popper")).forEach(function(e){var t=e._tippy;t.state.visible&&(t.popperInstance.disableEventListeners(),t.hide())})},onShown:function(){var e=function(e){var t=function(e){var t=e.split(/\s*[(),]\s*/).slice(1,-1);if(6===t.length)return{m11:+t[0],m21:+t[2],m31:0,m41:+t[4],m12:+t[1],m22:+t[3],m32:0,m42:+t[5],m13:0,m23:0,m33:1,m43:0,m14:0,m24:0,m34:0,m44:1};if(16===t.length)return{m11:+t[0],m21:+t[4],m31:+t[8],m41:+t[12],m12:+t[1],m22:+t[5],m32:+t[9],m42:+t[13],m13:+t[2],m23:+t[6],m33:+t[10],m43:+t[14],m14:+t[3],m24:+t[7],m34:+t[11],m44:+t[15]};return{m11:1,m21:0,m31:0,m41:0,m12:0,m22:1,m32:0,m42:0,m13:0,m23:0,m33:1,m43:0,m14:0,m24:0,m34:0,m44:1}}(getComputedStyle(e,null).transform),n=i(-t.m13),a=void 0,r=void 0;0!==l(n)?(a=s(t.m23,t.m33),r=s(t.m12,t.m11)):(a=s(-t.m31,t.m22),r=0);return{rotate:{x:a,y:n,z:r},translate:{x:t.m41,y:t.m42,z:t.m43}}}(this);this.style.transform="translate3d("+(e.translate.x+360)+"px, "+e.translate.y+"px, 0)"},placement:"right"}),(0,o.default)(".tt",{arrow:!0,duration:[50,50],flip:!1}),(0,o.default)(".tt_func",{arrow:!0,distance:45,duration:[20,20],flip:!1,placement:"right"})};var a,r=n(20),o=(a=r)&&a.__esModule?a:{default:a};var i=Math.asin,l=Math.cos,s=Math.atan2},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.boxExplore2=void 0,t.make_table=i;var a=n(1),r=n(3);function o(t,n,o){function i(){var n,a=d,r=a.field1,o=a.field2,i=a.new_name,l=a.operator,s=a.opt_val;if(!u.test(i))return swal({title:"",text:i18next.t("app_page.explore_box.add_field_box.invalid_name"),type:"error",allowOutsideClick:!1}),e.reject("Invalid name");if("math_compute"===a.type_operation&&t.length>3200){for(var p=new FormData,c=[],_="user_const_value"===o?+s:[],m=0;m<t.length;m++)c.push(+t[m][r]);if("user_const_value"!==o)for(var y=0;y<t.length;y++)_.push(+t[y][o]);return p.append("var1",JSON.stringify(c)),p.append("var2",JSON.stringify(_)),p.append("operator",l),xhrequest("POST","/helpers/calc",p,!1).then(function(e){for(var n=JSON.parse(e),a=0;a<t.length;a++)t[a][i]=n[a];return!0})}if("math_compute"===a.type_operation){var g=(n=l,new Map([["+",function(e,t){return e+t}],["-",function(e,t){return e-t}],["/",function(e,t){return 0===t?"":e/t}],["*",function(e,t){return e*t}],["^",function(e,t){return Math.pow(e,t)}]]).get(n));if("user_const_value"!==o)for(var f=0;f<t.length;f++)null!=t[f][r]&&""!=t[f][r]&&null!=t[f][o]&&""!=t[f][o]?t[f][i]=g(+t[f][r],+t[f][o]):t[f][i]="";else{s=+s;for(var h=0;h<t.length;h++)null!=t[h][r]&&""!=t[h][r]?t[h][i]=g(+t[h][r],s):t[h][i]=""}return e.resolve(!0)}if("truncate"===l){if((s=+s)>=0)for(var v=0;v<t.length;v++)t[v][i]=t[v][r].substring(0,s);else for(var b=0;b<t.length;b++)t[b][i]=t[b][r].substr(s);return e.resolve(!0)}if("concatenate"===l){for(var x=0;x<t.length;x++)t[x][i]=[t[x][r],t[x][o]].join(s);return e.resolve(!0)}return e.reject("Unknown error")}function s(e,t){"string_field"!==e&&"user_const_value"!==k.node().value?(j.style("display","none"),A.text("")):"truncate"===t?(A.html(i18next.t("app_page.explore_box.add_field_box.keep_char")),k.attr("disabled",!0)):(A.html(i18next.t("app_page.explore_box.add_field_box.join_char")),k.attr("disabled",null))}var p=["+","-","*","/","^"],c=[[i18next.t("app_page.explore_box.add_field_box.concatenate"),"concatenate"],[i18next.t("app_page.explore_box.add_field_box.truncate"),"truncate"]],d={field1:void 0,field2:void 0,operator:void 0,type_operation:void 0,opt_val:void 0,new_name:i18next.t("app_page.explore_box.add_field_box.new_name_placeholder")};(0,a.make_confirm_dialog2)("addFieldBox",i18next.t("app_page.explore_box.button_add_field"),{width:w>430?430:void 0,height:h>280?280:void 0}).then(function(e){e&&(document.querySelector("body").style.cursor="wait",i().then(function(e){if(current_layers[n]&&current_layers[n].targeted){var t=type_col2(user_data[n],d.new_name)[0],a=current_layers[n].fields_type.findIndex(function(e){return e.name===t.name});a<0?current_layers[n].fields_type.push(t):current_layers[n].fields_type[a]=t,getAvailablesFunctionnalities(n),window.fields_handler&&(fields_handler.unfill(),fields_handler.fill(n))}o&&l.create(n)},function(e){"Invalid name"!==e&&display_error_during_computation(),console.log(e),document.querySelector("body").style.cursor=""}).done(function(){document.querySelector("body").style.cursor=""}))});Object.getOwnPropertyNames(t);var _=(0,r.type_col)(n),u=new RegExp(/^[a-z0-9_]+$/i),m=document.querySelector(".twbs > .addFieldBox"),y=d3.select(m).select(".modal-body").append("div"),g=y.append("div").attr("id","field_div1"),f=y.append("div").attr("id","field_div2"),v=(g.append("p").html(i18next.t("app_page.explore_box.add_field_box.new_name")).insert("input").property("value",i18next.t("app_page.explore_box.add_field_box.new_name_placeholder")).on("keyup",function(){u.test(this.value)||""===this.value?d.new_name=this.value:(this.value=d.new_name,swal({title:i18next.t("Error")+"!",text:i18next.t("Unauthorized character!"),type:"error",allowOutsideClick:!1}))}),g.append("p").html(i18next.t("app_page.explore_box.add_field_box.new_content")).insert("select").attr("id","type_content_select").on("change",function(){d.type_operation=this.value,function(e){if(b.node().remove(),x.node().remove(),k.node().remove(),b=g.append("select").on("change",function(){d.field1=this.value}),x=g.append("select").on("change",function(){d.operator=this.value,s(d.type_operation,this.value)}),k=g.append("select").on("change",function(){d.field2=this.value,j.style("display","user_const_value"===this.value?null:"none")}),"math_compute"===e){p.forEach(function(e){x.append("option").text(e).attr("value",e)});for(var t=Object.getOwnPropertyNames(_),n=0,a=t.length;n<a;n++){var r=t[n];"number"===_[r]&&(b.append("option").text(r).attr("value",r),k.append("option").text(r).attr("value",r))}k.append("option").attr("value","user_const_value").text(i18next.t("app_page.explore_box.add_field_box.constant_value")),j.style("display","none"),A.text(""),d.operator=p[0]}else{c.forEach(function(e){x.append("option").text(e[0]).attr("value",e[1])});for(var o=Object.getOwnPropertyNames(_),i=0,l=o.length;i<l;i++){var u=o[i];"string"===_[u]&&(b.append("option").text(u).attr("value",u),k.append("option").text(u).attr("value",u))}j.style("display",null),A.html(i18next.t("app_page.explore_box.add_field_box.join_char")),d.operator=c[0][1]}d.field1=b.node().value,d.field2=k.node().value}(this.value)}));[[i18next.t("app_page.explore_box.add_field_box.between_numerical"),"math_compute"],[i18next.t("app_page.explore_box.add_field_box.between_string"),"string_field"]].forEach(function(e,t){v.append("option").text(e[0]).attr("value",e[1])});for(var b=g.append("select").on("change",function(){d.field1=this.value}),x=g.append("select").on("change",function(){d.operator=this.value,s(d.type_operation,this.value)}),k=g.append("select").on("change",function(){d.field2=this.value}),A=f.append("p").attr("id","txt_opt").text(""),j=f.append("input").attr("id","val_opt").style("display","none").on("change",function(){d.opt_val=this.value}),S=v.node(),E=!1,z=Object.getOwnPropertyNames(_),B=0,P=z.length;B<P;B++){var O=z[B];if("number"===_[O]){E=!0;break}}S.value=E?"math_compute":"string_field",S.dispatchEvent(new Event("change"))}function i(e){var t=svg_map.querySelector("#"+_app.layer_to_id.get(e)).childNodes,n=[];if(t[0].__data__.properties&&0!==Object.getOwnPropertyNames(t[0].__data__.properties).length)for(var a=0,r=t.length;a<r;a++)n.push(t[a].__data__.properties);else for(var o=0,i=t.length;o<i;o++)n.push({id:t[o].__data__.id||o});return n}var l=t.boxExplore2={clean:function(){this.box_table.remove(),this.footer.remove(),this.datatable.destroy(),this.datatable=null,this.footer=null,this.box_table=null,this.nb_features=null,this.columns_names=null,this.columns_headers=null,this.tables=null,this.modal_box=null},display_table:function(e){var t=this;document.querySelector("body").style.cursor="";var n=this.tables.get(e);n=n?n[1]:i(e),this.nb_features=n.length,this.columns_names=Object.getOwnPropertyNames(n[0]),this.columns_headers=[];for(var a=0,r=this.columns_names,l=r.length;a<l;++a)this.columns_headers.push({data:r[a],title:r[a]});this.tables.get(e)&&(e!==dataset_name||e===dataset_name&&0===field_join_map.length)&&this.footer.insert("button").attrs({id:"add_field_button",class:"button_st4"}).styles({position:"absolute",left:"15px",padding:"10px","font-size":"1.1em"}).html(i18next.t("app_page.explore_box.button_add_field")).on("click",function(){t.modal_box.hide(),document.getElementById("browse_data_box").querySelector("#xclose").click(),o(n,e,t)});var s=["<b>",e,"</b><br>",this.nb_features," ",i18next.t("app_page.common.feature",{count:this.nb_features})," - ",this.columns_names.length," ",i18next.t("app_page.common.field",{count:this.columns_names.length})].join("");this.box_table.append("p").attr("id","table_intro").html(s),this.box_table.node().appendChild(function(e,t){var n=t||{};n.id=n.id||"myTable";for(var a=document,r=e.length,o=Object.getOwnPropertyNames(e[0]),i=o.length,l=a.createElement("table"),s=a.createElement("thead"),p=a.createElement("tbody"),c=a.createElement("tr"),d=0;d<i;d++){var _=a.createElement("th");_.innerHTML=o[d],c.appendChild(_)}s.appendChild(c),l.appendChild(s);for(var u=0;u<r;u++){for(var m=a.createElement("tr"),y=0;y<i;y++){var g=a.createElement("td");g.innerHTML=e[u][o[y]],m.appendChild(g)}p.appendChild(m)}return l.appendChild(p),l.setAttribute("id",n.id),l}(n,{id:"myTable"}));var p=[5,10,15,20,25];this.nb_features>25&&(this.nb_features>100&&p.push(100),p.push(this.nb_features));var c=p[p.length-1];c>1e3&&(c=100);var d=document.getElementById("myTable");this.datatable=new DataTable(d,{sortable:!0,searchable:!0,perPage:c,perPageSelect:p,labels:{placeholder:i18next.t("app_page.table.search"),perPage:i18next.t("app_page.table.entries_page"),noRows:i18next.t("app_page.table.no_rows"),info:i18next.t("app_page.table.info")}});var _=document.getElementById("browse_data_box"),u=_.querySelector(".modal-body");u.style.padding="12.5px 15px 15px 15px",u.style.height=window.innerHeight-150+"px",u.style.overflow="auto",_.style.height=null,setTimeout(function(){var e=_.querySelector("#myTable").getBoundingClientRect(),t=(e.height,_.querySelector(".dataTable-pagination").getBoundingClientRect().height,e.width);t>.85*window.innerWidth?(t=.9*window.innerWidth,_.querySelector(".modal-content").style.overflow="auto",_.querySelector(".modal-dialog").style.width=t+"px"):(t+=80,_.querySelector(".modal-dialog").style.width=t+"px"),_.style.left=(window.innerWidth-t)/2+"px"},200)},get_available_tables:function(){for(var e=Object.getOwnPropertyNames(user_data),t=dataset_name,n=Object.getOwnPropertyNames(result_data),a=new Map,r=0,o=e.length;r<o;r++){var i=e[r];a.set(i,[i18next.t("app_page.common.target_layer"),user_data[i]])}t&&a.set(dataset_name,[i18next.t("app_page.common.ext_dataset"),joined_dataset[0]]);for(var l=0,s=n.length;l<s;l++){var p=n[l];a.set(p,[i18next.t("app_page.common.result_layer"),result_data[p]])}return a},create:function(e){var t=this;this.columns_headers=[],this.nb_features=void 0,this.columns_names=void 0,this.tables=this.get_available_tables(),this.modal_box=(0,a.make_dialog_container)("browse_data_box",i18next.t("app_page.explore_box.title"),"discretiz_charts_dialog");var n=document.getElementById("browse_data_box");this.box_table=d3.select(n).select(".modal-body"),this.footer=d3.select(n).select(".modal-footer");var r=function(e){helper_esc_key_twbs_cb(e,o)},o=function(){n.remove(),a.overlay_under_modal.hide(),document.removeEventListener("keydown",r),t.clean()};n.querySelector(".btn_cancel").onclick=o,n.querySelector("#xclose").onclick=o,n.querySelector(".btn_ok").onclick=o,document.addEventListener("keydown",r),a.overlay_under_modal.display(),this.display_table(e)}}}).call(this,n(5))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.northArrow=void 0;s(n(10));var a=s(n(9)),r=n(1),o=n(6),i=n(2),l=n(12);function s(e){return e&&e.__esModule?e:{default:e}}t.northArrow={display:function(e,t){var n=this,r=e||w-100,s=t||h-100,p=this,c=map.append("g").attrs({id:"north_arrow",class:"legend",scale:1,rotate:null}).style("cursor","all-scroll");this.svg_node=c,this.displayed=!0,this.arrow_img=c.insert("image").attrs({x:r,y:s,height:"30px",width:"30px"}).attr("xlink:href","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABVCAYAAAD5cuL2AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAVjwAAFY8BlpPm3wAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAWvSURBVHic7ZxtiFVFGMd/e3W3dJdyFWpVSipcYiNrMYhACWspKLOICqPCKOyF7EXK0sIMytKSIoperKg2I+lDEJYIQWC1RAW1ZST2IlHZi1qxYi+7dO7twzNn773nnnPuOWfOzNxd7x/OhztnZp7//M+cmXmemXOhiSaaMICbge8C18KEZa8LKXuaAY4ATDRUbydwfCBtI3AS8GedslNCyh6eE68aFExVHILpwMMW7SWCTQEArgXOsWwzFrYFaEFehQ7LdiNhWwCAWcBaB3ZD4UIAgGXAfEe2q+BKgALwPDDJkf0qIrbwe+B3N7DGov1Q2BRgBTASSLsdg4ucJLApwA7goUDaROAFoM0ijyrYHgMeRISoxBxgpWUeo7AtwAiwBPgvkH4PcLJlLoCbWeAz4LFAWhvwMuZ8k0i4mgZXAzsDab3AbbaJuBJgGPELioH0B4ATbRJxJQDAh8DTgbTDkDHCGlwKAHAXsDuQZpWTawH+ApYCJVcEXAsA8C7wkivjjSAAwHLgJxeGG0WAIeBGF4YbRQCAt4DNto02kgAg4fS9Ng2aWnoOAOsDab+G5GtHZgIf+4ErgL5APifjgw2sBc52TcIVjkP8gY+RaPEhh1eBb5FF0CWOuVjHKYBHWYBvgFanjCzjbaThvgAl4AanjCxiHuVGVwrwGzIrWMUE2waBfmQHeAeyLzBVpbcDfwPvO+BkDQuRp70S2EZ1DygCB4GjnLEzjAISD/wZmEytAP71qCuCpnEl0kDf6YkSYITaAxJjHq1IY3dT3gSJEqCIRIjHFW5CGnd5RVqUAL4IvZY5GsMkxJn5gmrvM04AD9hql6Y53I006rxAepwA/nWWPZpmMAXZFg+b2+sJ4DEOHKX1SGPODLmXpAeUgIutMDWA6UiwY0vE/SQCeIijZH3PMA88gzTg1Ij7SXtACTk9OqYwG1nQvBKTJ6kAHhJOs+4o6eA1RIATYvKk6QElYJVBvrliDvLUnqyTL40AReAAMM0M5XyxFXFrZ9bJl7YHlIANZijnh/kI0SQnQbMIMAwcmzvrHDGAHIefWi8j2QQoAi/mzjonLEJI3pkwfxYBfBGiplZnKACDlIMdSZBVAA/ZR2woXIWQuz5FmawC+NeCnLhrww92fE262L6OAA3lKC1DSC1OWU63B5SAi/Tp66Ed+AX4nPRb7boCeEiv03KUdM8HLAe6kNNewTN/plFAfI6rLdsdRSfwB/BexvJ5vAIe0gOTzjw10OkBqxARnJ30Rvh3ISdLrGIGEux4U6OOPHqAvzAaIqOjlLUHrEG+5rw3Y/k80QIcgYxDVuAHO/o168mrB/iXNUdpszKmu321nXwFKCKf3xhFrzL0hEYdc5HGl5DV3D+qzjxE8JAPtI1hG7KF3ZWh7AzgWeRzmYPAfcg4MlOle+rSFUBnYI6FH+y4P2W5ycgAdQAh2A8cHZKvB/Hy/IboCDEvJcdEGEAWPp0J87cAlwLfK1LvIPHCeuhDltZZhfCAj8jZUbpQVX5HwvwLgE9VmZ2IEGlQUGV+oDzApRViUUqbsWQGgT3UX3LOBl5XBPYDt6LnrFS+Pml7wS5N26NYoipdGpOnE1gH/ItMkY8DR+ZhXGGaqn+EdL3hGl3DbcifmEQFO1qRbau9yuAWzB5v6UZ6WJH644NHuhBdKG5RlV0Wcq8P+FLd/wS7/wdwOvAByQbKFVmNdCB7coNU+ww9yOZHCfgR6QGuvju4AOmhUUL4jlKSMH0NVqtKzlW/wxYyzv8AgfJruI/oGWNd2kr9YMd2yiPxEOWFTJaVoGl0IA9lmFoRhoFj0lT2iCr4FNLN0yxkXGMWsInagfK5pBX4wQ6/4C7SL2QaAXORbxIrZ4WeJAU3qgL7kJD3WD/Hfz7wFdKmN+pl7kae/gbkhNd4wQRkIbcHOCMu42LiT3WMdbRT+0VaE00cyvgfEKvQLuWtHAIAAAAASUVORK5CYII="),this.drag_behavior=d3.drag().subject(function(){var e=d3.select(this.querySelector("image")),t=(0,l.get_coords_snap_lines)(this.id);return{x:+e.attr("x"),y:+e.attr("y"),map_locked:!!map_div.select("#hand_button").classed("locked"),snap_lines:t}}).on("start",function(){d3.event.sourceEvent.stopPropagation(),(0,i.handle_click_hand)("lock")}).on("end",function(){d3.event.subject&&!d3.event.subject.map_locked&&(0,i.handle_click_hand)("unlock"),pos_lgds_elem.set(this.id,this.getBBox())}).on("drag",function(){d3.event.sourceEvent.preventDefault();var e=this.querySelector("image"),t=this.querySelector("rect"),n=t.width.baseVal.value/2,a=+d3.event.x,r=+d3.event.y;if(!(a<0-n||a>w+n||r<0-n||r>h+n)&&(e.x.baseVal.value=a,e.y.baseVal.value=r,t.x.baseVal.value=a-7.5,t.y.baseVal.value=r-7.5,p.x_center=a-7.5+n,p.y_center=r-7.5+n,_app.autoalign_features)){for(var i=t.getBBox(),s=t.x.baseVal.value,c=s+i.width,d=t.y.baseVal.value,_=d+i.height,u=d3.event.subject.snap_lines.x,m=d3.event.subject.snap_lines.y,y=0;y<u.length;y++){if((0,o.Mabs)(u[y][0]-s)<10){var g=(0,o.Mmin)((0,o.Mmin)(m[y][0],m[y][1]),d),f=(0,o.Mmax)((0,o.Mmax)(m[y][0],m[y][1]),_);(0,l.make_red_line_snap)(u[y][0],u[y][0],g,f),a=u[y][0]+7.5}if((0,o.Mabs)(u[y][0]-c)<10){var v=(0,o.Mmin)((0,o.Mmin)(m[y][0],m[y][1]),d),b=(0,o.Mmax)((0,o.Mmax)(m[y][0],m[y][1]),_);(0,l.make_red_line_snap)(u[y][0],u[y][0],v,b),a=u[y][0]-i.width+7.5}if((0,o.Mabs)(m[y][0]-d)<10){var x=(0,o.Mmin)((0,o.Mmin)(u[y][0],u[y][1]),s),k=(0,o.Mmax)((0,o.Mmax)(u[y][0],u[y][1]),c);(0,l.make_red_line_snap)(x,k,m[y][0],m[y][0]),r=m[y][0]+7.5}if((0,o.Mabs)(m[y][0]-_)<10){var A=(0,o.Mmin)((0,o.Mmin)(u[y][0],u[y][1]),s),j=(0,o.Mmax)((0,o.Mmax)(u[y][0],u[y][1]),c);(0,l.make_red_line_snap)(A,j,m[y][0],m[y][0]),r=m[y][0]-i.height+7.5}}e.x.baseVal.value=a,e.y.baseVal.value=r,t.x.baseVal.value=a-7.5,t.y.baseVal.value=r-7.5,p.x_center=a-7.5+n,p.y_center=r-7.5+n}});var d=new a.default,_=document.getElementById("north_arrow").getBBox();this.under_rect=c.append("g").insert("rect").styles({fill:"green","fill-opacity":0}).attrs({x:_.x-7.5,y:_.y-7.5,height:_.height+15,width:_.width+15}),this.x_center=_.x+_.width/2,this.y_center=_.y+_.height/2,c.call(this.drag_behavior),c.on("mouseover",function(){p.under_rect.style("fill-opacity",.1)}).on("mouseout",function(){p.under_rect.style("fill-opacity",0)}).on("contextmenu dblclick",function(){return d3.event.preventDefault(),d.showMenu(d3.event,document.querySelector("body"),[{name:i18next.t("app_page.common.options"),action:function(){n.editStyle()}},{name:i18next.t("app_page.common.up_element"),action:function(){n.up_element()}},{name:i18next.t("app_page.common.down_element"),action:function(){n.down_element()}},{name:i18next.t("app_page.common.delete"),action:function(){n.remove()}}])})},up_element:function(){up_legend(this.svg_node.node())},down_element:function(){down_legend(this.svg_node.node())},remove:function(){pos_lgds_elem.delete(this.svg_node.attr("id")),this.svg_node.remove(),this.displayed=!1},editStyle:function(){var e=this,t=+e.under_rect.attr("width"),n=isNaN(+e.svg_node.attr("rotate"))?0:+e.svg_node.attr("rotate"),a=+e.x_center-t/2,o=+e.y_center-t/2;(0,r.make_confirm_dialog2)("arrowEditBox",i18next.t("app_page.north_arrow_edit_box.title"),{widthFitContent:!0}).then(function(e){});var i=d3.select(".arrowEditBox").select(".modal-body").style("width","295px");i.append("h3").html(i18next.t("app_page.north_arrow_edit_box.title"));var l=i.append("p").attr("class","line_elem2");l.append("span").html(i18next.t("app_page.north_arrow_edit_box.size")),l.append("span").style("float","right").html(" px"),l.append("input").attrs({class:"without_spinner",id:"txt_size_n_arrow",min:0,max:200,step:1,type:"number"}).styles({float:"right",width:"40px"}).property("value",t).on("change",function(){var e=document.getElementById("range_size_n_arrow");e.value=+this.value,e.dispatchEvent(new Event("change"))}),l.append("input").attrs({type:"range",min:1,max:200,step:1,id:"range_size_n_arrow"}).styles({"vertical-align":"middle",width:"140px",float:"right"}).property("value",t).on("change",function(){var t=+this.value;e.arrow_img.attrs({width:t,height:t});var n=e.arrow_img.node().getBBox();e.under_rect.attrs({x:n.x-7.5,y:n.y-7.5,height:n.height+15,width:n.width+15}),e.x_center=a+t/2,e.y_center=o+t/2,document.getElementById("txt_size_n_arrow").value=t});var s=i.append("p").attr("class","line_elem2");s.append("span").html(i18next.t("app_page.north_arrow_edit_box.rotation")),s.append("span").style("float","right").html(" °"),s.append("input").attrs({class:"without_spinner",id:"txt_rotate_n_arrow",min:0,max:360,step:"any",type:"number"}).styles({float:"right",width:"40px"}).property("value",n).on("change",function(){var t=+this.value;e.svg_node.attrs({rotate:t,transform:"rotate("+[t,e.x_center,e.y_center]+")"}),document.getElementById("range_rotate_n_arrow").value=t}),s.append("input").attrs({type:"range",min:0,max:360,step:.1,id:"range_rotate_n_arrow"}).styles({float:"right","vertical-align":"middle",width:"140px"}).property("value",n).on("change",function(){var t=+this.value;e.svg_node.attrs({rotate:t,transform:"rotate("+[t,e.x_center,e.y_center]+")"}),document.getElementById("txt_rotate_n_arrow").value=t})},displayed:!1}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.discretize_to_colors=void 0;var a=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,r=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(a=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(r)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();t.getOptNbClass=p,t.getBreaksQ6=c,t.getBreaksStdDev=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"center",a=arguments[3],r=e.min(),o=e.max(),l=e.mean(),s=e.stddev()*t,p="center"===n?[l-s/2,l+s/2]:[l-s,l,l+s],c=a||e.precision;for(;p[0]>r;)p.unshift(p[0]-s);for(;p[p.length-1]<o;)p.push(p[p.length-1]+s);var d=p.length-1;p[0]<r&&(p[1]<r&&console.log("This shouldn't happen (min)"),p[0]=r);p[d]>o&&(p[d-1]>o&&console.log("This shouldn't happen (max)"),p[d]=o);return{nb_class:d,breaks:p.map(function(e){return(0,i.round_value)(e,c)})}},t.discretize_to_size=function(e,t,n,r,o){for(var i=d(e,t,n),l=a(i,3),s=l[0],p=l[1],c=l[2],_=(o-r)/(c-1),u=Array(c).fill(0).map(function(e,t){return r+t*_}),m=[],y=0;y<p.length-1;++y)m.push([[p[y],p[y+1]],u[y]]);return[c,t,m,s]},t.getBreaks_userDefined=function(e,t){for(var n="string"==typeof t?function(e,t){var n=has_negative(e)?"- ":"-";return t.split(n).map(function(e){return+e.trim()})}(e,t):t,a=(e.length,n.length),r=new Array(a-1),o=0,i=1;i<a;++i){var l=n[i];for(r[i-1]=0;e[o]<=l;)r[i-1]+=1,o+=1}return{breaks:n,stock_class:r}};var r=n(8),o=n(3),i=n(7),l=Math.floor,s=Math.log10;function p(e){return l(1+3.3*s(e))}function c(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=e.length,a=[1,.05*n,.275*n,.5*n,.725*n,.95*n,n],r=[],o=0,l=void 0,s=[],p=0;p<7;++p)l=Mround(a[p])-1,r.push(+e[l]),s.push(l-o),o=l;return s.shift(),r[0]===r[1]&&(r[1]=(+e[1]+r[0])/2),r[6]===r[5]&&(r[5]=e[n-2]),null!=t&&(r=r.map(function(e){return(0,i.round_value)(e,t)})),{breaks:r,stock_class:s}}function d(e,t,n){var a=e.filter(function(e){return(0,o.isNumber)(e)}),r=e.length-a.length,l=+n||p(a.length),s=new geostats(a),d=void 0;if("Q6"===t){(d=c(s.sorted(),s.precision).breaks)[0]=s.min(),d[l]=s.max(),s.setClassManually(d)}else{var _=discretiz_geostats_switch.get(t);d=s[_](l),s.precision&&(d=d.map(function(e){return(0,i.round_value)(e,s.precision)}))}return[s,d,l,r]}t.discretize_to_colors=function(e,t,n,i){for(var l=i||"Reds",s=d(e,t,n),p=a(s,4),c=p[0],_=p[1],u=p[2],m=p[3],y=(0,r.getColorBrewerArray)(u,l),g=m>0?"#e7e7e7":null,f=[],h=0;h<e.length;++h)if((0,o.isNumber)(e[h])){var v=c.getClass(e[h]);f.push(y[v])}else f.push(g);return[u,t,_,y,f,g]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.button_replace=' <img src="static/img/replace_target_layer.png" id="replace_button" width="16" height="16" alt="replace_button"/>',t.button_trash=' <img src="static/img/Trash_font_awesome.png" id="trash_button" width="15" height="15" alt="trash_button"/>',t.button_legend=' <img src="static/img/qgis_legend.png" id="legend_button" width="17" height="17" alt="legend_button"/>',t.button_zoom_fit=' <img src="static/img/Inkscape_icons_zoom_fit_page.png" id="zoom_fit_button" width="16" height="16" alt="zoom_button"/></button>',t.button_table=' <img src="static/img/dataset.png" id="browse_data_button" width="16" height="16" alt="dataset_button"/></button>',t.button_type=new Map([["Point",'<img src="static/img/type_geom/dot.png" class="ico_type" width="17" height="17" alt="Point"/>'],["Line",'<img src="static/img/type_geom/line.png" class="ico_type" width="17" height="17" alt="Line"/>'],["Polygon",'<img src="static/img/type_geom/poly.png" class="ico_type" width="17" height="17" alt="Polygon"/>']]),t.button_result_type=new Map([["flow",'<img src="static/img/type_geom/layer_flow.png" class="ico_type" width="17" height="17" alt="flow"/>'],["symbol",'<img src="static/img/type_geom/layer_symbol.png" class="ico_type" width="17" height="17" alt="symbol"/>'],["grid",'<img src="static/img/type_geom/layer_grid.png" class="ico_type" width="17" height="17" alt="grid"/>'],["propchoro",'<img src="static/img/type_geom/layer_propchoro.png" class="ico_type" width="17" height="17" alt="propchoro"/>'],["typo",'<img src="static/img/type_geom/layer_typo.png" class="ico_type" width="17" height="17" alt="typo"/>'],["discont",'<img src="static/img/type_geom/layer_disc.png" class="ico_type" width="17" height="17" alt="discont"/>'],["cartogram",'<img src="static/img/type_geom/layer_cartogram.png" class="ico_type" width="17" height="17" alt="cartogram"/>'],["label",'<img src="static/img/type_geom/layer_label.png" class="ico_type" width="17" height="17" alt="label"/>'],["choro",'<img src="static/img/type_geom/layer_choro.png" class="ico_type" width="17" height="17" alt="choro"/>'],["smooth",'<img src="static/img/type_geom/layer_smooth.png" class="ico_type" width="17" height="17" alt="smooth"/>'],["prop",'<img src="static/img/type_geom/layer_prop.png" class="ico_type" width="17" height="17" alt="prop"/>'],["waffle",'<img src="static/img/type_geom/layer_waffle.png" class="ico_type" width="17" height="17" alt="waffle"/>']]),t.eye_open0='<img src="static/img/b/eye_open.png" class="active_button" id="eye_open"  width="17" height="17" alt="Visible"/>',t.sys_run_button='<img src="static/img/High-contrast-system-run.png" width="22" height="22" style="vertical-align: inherit;" alt="submit"/>',t.sys_run_button_t2='<img src="static/img/High-contrast-system-run.png" class="style_target_layer" width="18" height="18" alt="Layer_rendering" style="float:right;"/>'},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.display_discretization=void 0;var a=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,r=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(a=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(r)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();t.display_categorical_box=function(t,n,a,i){var l=new RegExp(/^#([0-9a-f]{6}|[0-9a-f]{3})$/i),s=current_layers[n].n_features,p=i.length,c=Object.keys(current_layers).filter(function(e){return"Categorical"===current_layers[e].renderer||"PropSymbolsTypo"===current_layers[e].renderer}),_=((0,o.make_dialog_container)("categorical_box",i18next.t("app_page.categorical_box.title",{layer:n,nb_features:s}),"dialog"),d3.select("#categorical_box").select(".modal-body").styles({"overflow-y":"scroll","max-height":window.innerHeight-145+"px"}));_.append("h3").html(""),_.append("p").html(i18next.t("app_page.symbol_typo_box.field_categ",{field:a,nb_class:+p,nb_features:+s})),_.append("ul").style("padding","unset").attr("id","sortable_typo_name").selectAll("li").data(i).enter().append("li").styles({margin:"auto","list-style":"none"}).attr("class","typo_class").attr("id",function(e,t){return["line",t].join("_")}),_.selectAll(".typo_class").append("input").styles({width:"140px",height:"auto",display:"inline-block","vertical-align":"middle","margin-right":"20px"}).attrs(function(e){return{class:"typo_name",value:e.display_name,id:e.name}}),_.selectAll(".typo_class").insert("p").attr("class","color_square").style("background-color",function(e){return e.color}).styles({width:"22px",height:"22px",margin:"auto",display:"inline-block","vertical-align":"middle","border-radius":"10%"}).on("click",function(){var e=this,t=e.style.backgroundColor,n=document.createElement("input");n.setAttribute("type","color"),n.setAttribute("value",(0,r.rgb2hex)(t)),n.className="color_input",n.onchange=function(t){e.style.backgroundColor=(0,r.hexToRgb)(t.target.value,"string"),e.nextSibling.value=t.target.value},n.dispatchEvent(new MouseEvent("click"))}),_.selectAll(".typo_class").append("input").attr("class","color_hex").styles({height:"22px","vertical-align":"middle"}).property("value",function(e){return e.color}).style("width","60px").on("keyup",function(){l.test(this.value)&&(this.previousSibling.style.backgroundColor=this.value)}),_.selectAll(".typo_class").insert("span").attrs(function(e){return{class:"typo_count_ft","data-count":e.nb_elem}}).html(function(e){return i18next.t("app_page.symbol_typo_box.count_feature",{count:+e.nb_elem})}),_.insert("p").insert("button").attr("class","button_st3").html(i18next.t("app_page.categorical_box.new_random_colors")).on("click",function(){for(var e=document.getElementsByClassName("typo_class"),t=0;t<e.length;++t){var n=(0,r.randomColor)();e[t].querySelector(".color_square").style.backgroundColor=n,e[t].querySelector(".color_hex").value=n}}),c.length>0&&_.insert("p").attr("class","button_copy_style").styles({margin:"5px",cursor:"pointer","font-style":"italic"}).html(i18next.t("app_page.categorical_box.copy_style")).on("click",function(){(function(e){var t=e[0];return swal({title:i18next.t("app_page.categorical_box.title_copy_style_box"),html:'<div id="copy_style_box_content" style="margin: 35px;"></div>',showCancelButton:!0,showConfirmButton:!0,cancelButtonText:i18next.t("app_page.common.close"),animation:"slide-from-top",onOpen:function(){document.querySelector(".swal2-modal").style.width="400px";var n=d3.select("#copy_style_box_content"),a=n.append("select");e.forEach(function(e){a.append("option").attr("value",e).html(e)}),a.on("change",function(){t=this.value})}}).then(function(e){return t},function(e){return null})})(c).then(function(e){if(e){var t=current_layers[e].color_map,n=_.select("#sortable_typo_name").selectAll("li");n.selectAll("input.typo_name").each(function(e){var n=t.get(e.name);n&&(e.display_name=n[1],this.value=n[1])}),n.selectAll("p").each(function(e){var n=t.get(e.name);n&&(e.color=n[0],this.style.backgroundColor=n[0],this.nextSibling.value=n[0])})}})});new Sortable(document.getElementById("sortable_typo_name"));var u=e.pending(),m=document.getElementById("categorical_box"),y=function(){u.resolve(!1),document.removeEventListener("keydown",g),m.remove();var e=d();e||o.overlay_under_modal.hide()};function g(e){var t=e||window.event,n="key"in t?"Escape"===t.key||"Esc"===t.key:27===t.keyCode;n&&(t.stopPropagation(),y())}return m.querySelector(".btn_ok").onclick=function(){var e=function(){for(var e=document.getElementsByClassName("typo_class"),t=new Map,n=0;n<e.length;n++){var a=(0,r.rgb2hex)(e[n].querySelector(".color_square").style.backgroundColor),o=e[n].querySelector(".typo_name").value,i=e[n].querySelector(".typo_count_ft").getAttribute("data-count");t.set(e[n].__data__.name,[a,o,i])}return t}(),n=t.map(function(t){return e.get(t[a])[0]});u.resolve([p,e,n]),document.removeEventListener("keydown",g),m.remove(),d()||o.overlay_under_modal.hide()},m.querySelector(".btn_cancel").onclick=y,m.querySelector("#xclose").onclick=y,document.addEventListener("keydown",g),o.overlay_under_modal.display(),u.promise};var r=n(8),o=n(1),i=n(3),l=n(2),s=n(7),p=n(6),c=n(24);t.display_discretization=function(t,n,u,m){var y=function(){var e=d3.select("#color_div");e.selectAll(".color_params").remove(),e.selectAll(".color_txt").remove(),e.selectAll(".color_txt2").remove(),e.selectAll(".central_class").remove(),e.selectAll(".central_color").remove(),e.selectAll("#reverse_pal_btn").remove(),document.getElementById("button_palette_box").style.display="";var t=e.insert("p").attr("class","color_txt").style("margin-left","10px").html(i18next.t("disc_box.color_palette")).insert("select").attr("class","color_params").styles({width:"116px","background-image":"url(/static/img/palettes/Blues.png)"}).on("change",function(){this.style.backgroundImage="url(/static/img/palettes/"+this.value+".png)",b.draw()});if(["Blues","BuGn","BuPu","GnBu","OrRd","PuBu","PuBuGn","PuRd","RdPu","YlGn","Greens","Greys","Oranges","Purples","Reds"].forEach(function(e){t.append("option").text(e).attrs({value:e,title:e}).styles({"background-image":"url(/static/img/palettes/"+e+".png)"})}),_app.custom_palettes)for(var n=Array.from(_app.custom_palettes.entries()),a=0;a<n.length;a++)t.append("option").text(n[a][0]).attrs({value:"user_"+n[a][0],title:n[a][0],nb_colors:n[a][1].length}).property("disabled",n[a][1].length!==u);d3.select(".color_txt").insert("p").style("text-align","center").insert("button").styles({"margin-top":"10px"}).attrs({class:"button_st3",id:"reverse_pal_btn"}).html(i18next.t("disc_box.reverse_palette")).on("click",function(){Se=!0,b.draw()})},g=function(){var e=d3.select("#color_div");e.selectAll(".color_params").remove(),e.selectAll(".color_txt").remove(),e.selectAll(".color_txt2").remove(),e.selectAll("#reverse_pal_btn").remove(),document.getElementById("button_palette_box").style.display="none",e.insert("p").attr("class","central_class").html(i18next.t("disc_box.break_on")).insert("input").style("width","50px").attrs({type:"number",class:"central_class",id:"centr_class",min:1,max:u-1,step:1,value:(0,p.Mround)(u/2)}).on("change",function(){b.draw()});var t=e.insert("p").attr("class","color_txt").style("display","inline").html(i18next.t("disc_box.left_colramp")).insert("select").style("width","116px").attr("class","color_params_left").on("change",function(){this.style.backgroundImage="url(/static/img/palettes/"+this.value+".png)",b.draw()}),n=e.insert("p").styles({display:"inline","margin-left":"70px"}).attr("class","color_txt2").html(i18next.t("disc_box.right_colramp")).insert("select").style("width","116px").attr("class","color_params_right").on("change",function(){this.style.backgroundImage="url(/static/img/palettes/"+this.value+".png)",b.draw()});["Blues","BuGn","BuPu","GnBu","OrRd","PuBu","PuBuGn","PuRd","RdPu","YlGn","Greens","Greys","Oranges","Purples","Reds"].forEach(function(e){t.append("option").attrs({value:e,title:e}).styles({"background-image":"url(/static/img/palettes/"+e+".png)"}).text(e),n.append("option").attrs({value:e,title:e}).styles({"background-image":"url(/static/img/palettes/"+e+".png)"}).text(e)}),document.getElementsByClassName("color_params_right")[0].selectedIndex=14;var a=e.insert("p").attr("class","central_color");a.insert("input").attrs({type:"checkbox",id:"central_color_chkbx"}).on("change",function(){b.draw(),this.checked?e.select("#central_color_val").style("display",""):e.select("#central_color_val").style("display","none")}),a.select("input").node().checked=!0,a.insert("label").attr("for","central_color_chkbx").html(i18next.t("disc_box.colored_central_class")),a.insert("input").attrs({type:"color",id:"central_color_val",value:"#e5e5e5"}).style("margin","0px 10px").on("change",b.draw)},f=function(e){X.node().value=e,document.getElementById("nb_class_range").value=e,u=e;var t=document.querySelector(".color_params");if(t){for(var n=t.selectedIndex,a=t.querySelectorAll("option"),r=0;r<a.length;r++)a[r].value.startsWith("user_")&&(a[r].disabled=u!==+a[r].getAttribute("nb_colors"));a[n].value.startsWith("user_")&&a[n].getAttribute("nb_colors")!==u&&setSelected(t,"Blues")}},v=function(e){e.call(d3.axisBottom().scale(me).tickFormat(U))},b={compute:function(){var t=void 0;I=new geostats(z),q=[],z=I.sorted();var n=e.pending();if(z.length>7500&&"jenks"===P){var a=new Worker("static/js/webworker_jenks.js");return _app.webworker_to_cancel=a,_app.waitingOverlay.display({zIndex:5e3}),a.postMessage([z,u]),a.onmessage=function(e){q=e.data,I.setClassManually(q),I.doCount(),L=Array.prototype.slice.call(I.counter),_app.waitingOverlay.hide(),_app.webworker_to_cancel=void 0,T=[];for(var t=0,r=L.length;t<r;t++){var o={};o.val=L[t],o.offset=0===t?0:T[t-1].width+T[t-1].offset,o.width=q[t+1]-q[t],o.height=o.val/(q[t+1]-q[t]),T[t]=o}n.resolve(!0),a.terminate()},n.promise}if("Q6"===P)t=(0,c.getBreaksQ6)(z,I.precision),(q=t.breaks)[0]=G,q[6]=D,I.setClassManually(q),I.doCount(),L=Array.prototype.slice.call(I.counter);else if("stddev_f"===P)t=(0,c.getBreaksStdDev)(I,F.share,F.role_mean,I.precision),f(u=t.nb_class),q=t.breaks,I.setClassManually(t.breaks),I.doCount(),L=Array.prototype.slice.call(I.counter);else if("user_defined"===P){t=(0,c.getBreaks_userDefined)(I.sorted(),N),L=t.stock_class,q=t.breaks,u=t.breaks.length-1,f(u),q[0]>G&&(q[0]=G),q[u]<D&&(q[u]=D);var r=q.slice();r[0]<G&&(r[0]=G),r[u]>D&&(r[u]=D),I.setClassManually(r)}else q=I[discretiz_geostats_switch.get(P)](u),I.doCount(),L=Array.prototype.slice.call(I.counter);if(0===L.length)return n.resolve(!1),n.promise;T=[];for(var o=0,i=L.length;o<i;o++){var l={};l.val=L[o],l.offset=0===o?0:T[o-1].width+T[o-1].offset,l.width=q[o+1]-q[o],l.height=l.val/(q[o+1]-q[o]),T[o]=l}return n.resolve(!0),n.promise},draw:function(e){if(w.select("#svg_discretization").selectAll(".bar").remove(),w.select("#svg_discretization").selectAll(".text_bar").remove(),e)S=e.slice();else{var t=w.select(".color_params_left").node()?"diverging":"sequential";if("sequential"===t)if(Se)S=S.reverse(),Se=!1;else{var n=document.querySelector(".color_params").value;S=n.startsWith("user_")?_app.custom_palettes.get(n.slice(5)):(S=(0,r.getColorBrewerArray)(u,n)).slice(0,u)}else if("diverging"===t){var a=document.querySelector(".color_params_left").value,o=document.querySelector(".color_params_right").value,i=+document.getElementById("centr_class").value,l=document.querySelector(".central_color > input").checked?document.getElementById("central_color_val").value:[],s=u-i+1,c=i-1,d=(0,p.Mmax)(s,c),_=(0,r.getColorBrewerArray)(d,o),m=(0,r.getColorBrewerArray)(d,a);_=_.slice(0,s),m=m.slice(0,c).reverse(),S=[].concat(m,l,_)}}for(var y=0,g=T.length;y<g;++y)T[y].color=S[y];var f,h,b,x;me.domain([q[0],q[q.length-1]]),ye.domain([0,d3.max(T.map(function(e){return e.height+e.height/3}))]),ue.select(".x_axis").transition().call(v),f=me(R),h=me(I.median()),b=me(R-W),x=me(R+W),fe.transition().attrs({x1:f,x2:f}),we.transition().attr("x",f),be.transition().attrs({x1:h,x2:h}),xe.transition().attr("x",h),ve.transition().attrs({x1:b,x2:b}),he.transition().attrs({x1:x,x2:x}),ke.selectAll(".indiv").attrs(function(e){return{x1:me(e.value),x2:me(e.value)}});var k=d3.scaleLinear().range([0,ae]).domain([0,d3.max(T.map(function(e){return e.offset+e.width}))]);ue.selectAll(".bar").data(T).enter().append("rect").attrs(function(e,t){return{class:"bar",id:"bar_"+t,transform:"translate(0, -7.5)",x:k(e.offset),y:ye(e.height)-re.bottom,width:k(e.width),height:ne-ye(e.height)}}).styles(function(e){return{fill:e.color,opacity:.95,"stroke-opacity":1}}).on("mouseover",function(){this.parentElement.querySelector("#text_bar_"+this.id.split("_")[1]).style.display=null}).on("mouseout",function(){this.parentElement.querySelector("#text_bar_"+this.id.split("_")[1]).style.display="none"});return ue.selectAll(".txt_bar").data(T).enter().append("text").attrs(function(e,t){return{id:"text_bar_"+t,class:"text_bar","text-anchor":"middle",dy:".75em",x:k(e.offset+e.width/2),y:ye(e.height)-2*re.top-re.bottom-1.5}}).styles({color:"black",cursor:"default",display:"none"}).text(function(e){return U(e.val)}),document.getElementById("user_breaks_area").value=q.join(" - "),!0}},x=((0,o.make_dialog_container)("discretiz_charts",[i18next.t("disc_box.title")," - ",t," - ",n].join(""),"discretiz_charts_dialog"),document.getElementById("discretiz_charts")),w=d3.select(x).select(".modal-body"),k=void 0;if(result_data.hasOwnProperty(t))k=result_data[t];else if(user_data.hasOwnProperty(t))k=user_data[t];else{var A=svg_map.querySelector("#"+_app.idLayer.get(t));k=Array.prototype.map.call(A.children,function(e){return e.__data__.properties})}for(var j=[],S=[],E=k.length,z=[],B=void 0,P=m.type,O=0;O<E;O++){var C=k[O][n];(0,i.isNumber)(C)&&(z.push(+k[O][n]),j.push(O))}E===z.length?B=0:(B=E-z.length,E=z.length);var M=E>20?20:E,I=new geostats(z),q=[],L=[],T=[],N=null,F=m.extra_options&&m.extra_options.role_mean?m.extra_options:{role_mean:"center",share:1};0===I.variance()&&0===I.stddev()&&(I=new geostats(z));var G=I.min(),D=I.max(),R=I.mean(),W=I.stddev();z=I.sorted();var H=[[i18next.t("app_page.common.equal_interval"),"equal_interval"],[i18next.t("app_page.common.quantiles"),"quantiles"],[i18next.t("app_page.common.stddev_f"),"stddev_f"],[i18next.t("app_page.common.Q6"),"Q6"],[i18next.t("app_page.common.jenks"),"jenks"]];I._hasZeroValue()||I._hasNegativeValue()||H.push([i18next.t("app_page.common.geometric_progression"),"geometric_progression"]);var V=(0,s.get_precision_axis)(G,D,I.precision),U=d3.format(V),Y=w.append("div").attr("id","discretization_panel"),J=Y.insert("p").insert("select").attr("class","params").on("change",function(){"stddev_f"===(P=this.value)?(K.style("display",""),document.getElementById("nb_class_range").disabled="disabled",X.style("disabled","disabled"),$.style("display","none")):(K.style("display","none"),document.getElementById("nb_class_range").disabled=!1,X.style("disabled",!1),$.style("display","inline")),"Q6"===P&&f(6),b.compute().then(function(e){e&&b.draw()})});H.forEach(function(e){J.append("option").text(e[0]).attr("value",e[1])});var K=Y.insert("p").styles({margin:"auto",display:"stddev_f"===P?"":"none"});K.insert("span").html(i18next.t("disc_box.stddev_share_txt1")),K.insert("input").attrs({type:"number",min:.1,max:10,step:.1,class:"without_spinner",id:"stddev_share"}).styles({width:"45px","margin-left":"10px","margin-right":"10px"}).property("value",F.share).on("change",function(){var e=this.value;0===e||e*W>D-G||e*W*21<D-G?this.value=F.share:(F.share=e,b.compute().then(function(e){e&&b.draw()}))}),K.insert("span").html(i18next.t("disc_box.stddev_share_txt2"));var Q=K.insert("p").style("margin","auto");Q.insert("p").style("margin","auto").html(i18next.t("disc_box.stddev_role_mean")),[[i18next.t("disc_box.stddev_center_mean"),"center"],[i18next.t("disc_box.stddev_break_mean"),"bound"]].forEach(function(e){Q.insert("input").attrs({type:"radio",name:"role_mean",value:e[1],id:"button_stddev_"+e[1]}).on("change",function(){F.role_mean=this.value,b.compute().then(function(e){e&&b.draw()})}),Q.insert("label").style("font-weight","400").attrs({for:"button_stddev_"+e[1]}).html(e[0])}),document.getElementById("button_stddev_"+F.role_mean).checked=!0;var X=Y.append("input").attrs({type:"number",class:"without_spinner",min:2,max:M,step:1}).styles({width:"30px",margin:"0 10px","vertical-align":"calc(20%)"}).property("value",u).on("change",function(){var e=$.node();e.value=this.value,e.dispatchEvent(new Event("change"))});Y.append("span").html(i18next.t("disc_box.class"));var Z,$=Y.insert("input").attrs({id:"nb_class_range",type:"range",min:2,max:M,step:1}).styles({display:"inline",width:"60px","vertical-align":"middle",margin:"10px"}).property("value",u).on("change",function(){var e=this;P=J.node().value;var t=u;if("Q6"===P)f(6);else if("stddev_f"===P)return void f(u);f(+this.value),b.compute().then(function(n){if(n){b.draw();var a=document.getElementById("centr_class");a&&(a.max=u,a>u&&(a.value=(0,p.Mround)(u/2)))}else e.value=t,X.node().value=+t})}),ee=w.append("div").attr("id","ref_histo_box");ee.append("div").attr("id","inner_ref_histo_box"),J.node().value=P,Z=(0,i.make_content_summary)(I),w.append("div").attr("id","summary").styles({"font-size":"11px",float:"right",margin:"10px 10px 0px 10px"}).insert("p").html(["<b>",i18next.t("disc_box.summary"),"</b><br>",Z].join(""));var te=_(w,I,U);te("histogram");var ne=h/5>100?h/5:100,ae=window.innerWidth-40>760?760:window.innerWidth-40,re={top:7.5,right:30,bottom:7.5,left:30},oe=ne-re.top-re.bottom;if(d3.select(x).select(".modal-dialog").styles({width:ae+re.top+re.bottom+90+"px",height:window.innerHeight-60+"px"}),z.length<500){var ie="histogram";ee.append("p").style("text-align","center").insert("button").attrs({id:"button_switch_plot",class:"i18n button_st4","data-i18n":"[text]disc_box.switch_ref_histo"}).styles({padding:"3px","font-size":"10px"}).html(i18next.t("disc_box.switch_ref_histo")).on("click",function(){var e=void 0;"histogram"===ie?(te("box_plot"),ie="box_plot",e="_boxplot"):"box_plot"===ie?(te("beeswarm"),ie="beeswarm",e="_beeswarm"):"beeswarm"===ie&&(te("histogram"),ie="histogram",e=""),document.getElementById("ref_histo_title").innerHTML="<b>"+i18next.t("disc_box.hist_ref_title"+e)+"</b>"})}var le,se,pe,ce,de,_e=w.append("div").append("svg").attrs({id:"svg_discretization",width:ae+re.left+re.right,height:ne+re.top+re.bottom});le=w.append("div").attrs({id:"histo_options",class:"row equal"}).styles({margin:"5px 5px 10px 15px",width:"100%"}),se=le.append("div").attr("class","col-xs-6 col-sm-3"),pe=le.append("div").attr("class","col-xs-6 col-sm-3"),ce=le.append("div").attr("class","col-xs-6 col-sm-3"),de=le.append("div").attr("class","col-xs-6 col-sm-3"),se.insert("button").attrs({class:"btn_population"}).html(i18next.t("disc_box.disp_rug_pop")).on("click",function(){this.classList.contains("active")?(this.classList.remove("active"),ke.style("display","none"),ke.classed("active",!1)):(this.classList.add("active"),ke.style("display",""),ke.classed("active",!0))}),pe.insert("button").attrs({class:"btn_mean"}).html(i18next.t("disc_box.disp_mean")).on("click",function(){this.classList.contains("active")?(this.classList.remove("active"),fe.style("stroke-width",0),we.style("fill","none"),fe.classed("active",!1)):(this.classList.add("active"),fe.style("stroke-width",2),we.style("fill","blue"),fe.classed("active",!0))}),ce.insert("button").attrs({class:"btn_median"}).html(i18next.t("disc_box.disp_median")).on("click",function(){this.classList.contains("active")?(this.classList.remove("active"),be.style("stroke-width",0).classed("active",!1),xe.style("fill","none")):(this.classList.add("active"),be.style("stroke-width",2).classed("active",!0),xe.style("fill","darkgreen"))}),de.insert("button").attrs({class:"btn_stddev"}).html(i18next.t("disc_box.disp_sd")).on("click",function(){this.classList.contains("active")?(this.classList.remove("active"),ve.style("stroke-width",0),ve.classed("active",!1),he.style("stroke-width",0),he.classed("active",!1)):(this.classList.add("active"),ve.style("stroke-width",2),ve.classed("active",!0),he.style("stroke-width",2),he.classed("active",!0))});var ue=_e.append("g").attr("transform","translate("+re.left+","+re.top+")"),me=d3.scaleLinear().domain([G,D]).range([0,ae]),ye=d3.scaleLinear().range([ne,0]),ge=_e.append("g").attr("transform","translate(30, 0)"),fe=void 0,he=void 0,ve=void 0,be=void 0,xe=void 0,we=void 0,ke=void 0;fe=ge.append("line").attrs({class:"line_mean",x1:me(R),y1:10,x2:me(R),y2:ne-re.bottom}).styles({"stroke-width":0,stroke:"blue",fill:"none"}).classed("active",!1),we=ge.append("text").attrs({y:0,dy:"0.75em",x:me(R),"text-anchor":"middle"}).style("fill","none").text(i18next.t("disc_box.mean")),be=ge.append("line").attrs({class:"line_med",x1:me(I.median()),y1:10,x2:me(I.median()),y2:ne-re.bottom}).styles({"stroke-width":0,stroke:"darkgreen",fill:"none"}).classed("active",!1),xe=ge.append("text").attrs({y:0,dy:"0.75em",x:me(I.median()),"text-anchor":"middle"}).style("fill","none").text(i18next.t("disc_box.median")),ve=ge.append("line").attrs({class:"lines_std",x1:me(R-W),y1:10,x2:me(R-W),y2:ne-re.bottom}).styles({"stroke-width":0,stroke:"grey",fill:"none"}).classed("active",!1),he=ge.append("line").attrs({class:"lines_std",x1:me(R+W),y1:10,x2:me(R+W),y2:ne-re.bottom}).styles({"stroke-width":0,stroke:"grey",fill:"none"}).classed("active",!1),(ke=ge.append("g").style("display","none")).selectAll(".indiv").data(z.map(function(e){return{value:+e}})).enter().insert("line").attrs(function(e){return{class:"indiv",x1:me(e.value),y1:ne-re.bottom-10,x2:me(e.value),y2:ne-re.bottom}}).styles({stroke:"red",fill:"none","stroke-width":1}),ue.append("g").attrs({class:"x_axis",transform:"translate(0,"+oe+")"}).call(d3.axisBottom().scale(me).tickFormat(U));w.append("button").attrs({class:"accordion_disc active",id:"btn_acc_disc_color"}).style("padding","0 6px").html(i18next.t("disc_box.title_color_scheme"));var Ae=w.append("div").attrs({class:"panel show",id:"accordion_colors"}).style("width","98%"),je=Ae.append("div").attr("id","color_div").style("text-align","center");[[i18next.t("disc_box.sequential"),"sequential"],[i18next.t("disc_box.diverging"),"diverging"]].forEach(function(e){je.insert("label").style("margin","20px").html(e[0]).insert("input").attrs({type:"radio",name:"color_scheme",value:e[1],id:"button_"+e[1]}).on("change",function(){"sequential"===this.value?y():g(),b.draw()})});var Se=!1;document.getElementById("button_sequential").checked=!0,Ae.append("span").attr("id","button_palette_box").styles({margin:"5px",float:"right",cursor:"pointer","font-style":"italic"}).html(i18next.t("app_page.palette_box.button")).on("click",function(){(function(e,t){var n=new RegExp(/^#([0-9a-f]{6}|[0-9a-f]{3})$/i),a=new RegExp(/^[a-zA-Z0-9_]*$/),o=Array.from(_app.custom_palettes.keys()),i=void 0,l=void 0;if(t&&t.length===e)l=t.slice();else{l=[];for(var s=0;s<e;s++)l.push((0,r.randomColor)())}return swal({title:i18next.t("app_page.palette_box.title"),html:'<div id="palette_box_content" style="display: inline-flex;"></div><div id="palette_box_name"></div>',showCancelButton:!0,showConfirmButton:!0,cancelButtonText:i18next.t("app_page.common.close"),animation:"slide-from-top",onOpen:function(){document.querySelector(".swal2-modal").style.width=85*e+"px";var t=d3.select("#palette_box_content"),r=t.selectAll("p").data(l).enter().append("p");r.append("input").attr("id",function(e,t){return t}).attr("type","color").style("width","60px").property("value",function(e){return e}).on("change",function(e,t){l[t]=this.value,this.nextSibling.value=this.value}),r.append("input").attr("id",function(e,t){return t}).style("width","60px").property("value",function(e){return e}).on("keyup",function(e,t){n.test(this.value)&&(l[t]=this.value,this.previousSibling.value=this.value)});var s=d3.select("#palette_box_name");s.append("p").attr("id","palette_box_error_zone").style("background","#e3e3e3"),s.append("span").html(i18next.t("app_page.palette_box.new_name")),s.append("input").style("width","70px").on("keyup",function(){var e;null!==(""!==(e=this.value)&&a.test(e)?o.indexOf(e)>-1?(d3.select("#palette_box_error_zone").html(i18next.t("app_page.palette_box.error_name_existing")),document.querySelector(".swal2-confirm").disabled=!0,null):(d3.select("#palette_box_error_zone").html(""),document.querySelector(".swal2-confirm").disabled=!1,e):(d3.select("#palette_box_error_zone").html(i18next.t("app_page.palette_box.error_name_invalid")),document.querySelector(".swal2-confirm").disabled=!0,null))&&(i=this.value)}),document.querySelector(".swal2-confirm").disabled=!0}}).then(function(e){return[l,i]},function(e){return null})})(u).then(function(e){if(e){var t=a(e,2),n=t[0],r=t[1],o=document.querySelector(".color_params");addNewCustomPalette(r,n),o&&(d3.select(o).append("option").text(r).attrs({value:"user_"+r,title:r,nb_colors:n.length}),setSelected(o,"user_"+r))}})});w.append("button").attrs({class:"accordion_disc",id:"btn_acc_disc_break"}).style("padding","0 6px").html(i18next.t("disc_box.title_break_values"));var Ee=w.append("div").attrs({class:"panel",id:"accordion_breaks_vals"}).style("width","98%").append("div").attr("id","user_breaks");if(Ee.insert("textarea").attrs({id:"user_breaks_area",placeholder:i18next.t("app_page.common.expected_class")}).style("width","600px"),Ee.insert("button").text(i18next.t("app_page.common.valid")).on("click",function(){N=document.getElementById("user_breaks_area").value,P="user_defined",b.compute().then(function(e){e&&b.draw()})}),(0,l.accordionize)(".accordion_disc",x),B>0&&(d3.select("#color_div").append("div").attr("id","no_data_section").append("p").html(i18next.t("disc_box.withnodata",{count:+B})).append("input").attrs({type:"color",value:"#ebebcd",id:"no_data_color"}).style("margin","0px 10px"),m.no_data&&(document.getElementById("no_data_color").value=m.no_data)),m.schema){if(1===m.schema.length)y(),document.querySelector(".color_params").value=m.schema[0],document.querySelector(".color_params").style.backgroundImage="url(/static/img/palettes/"+m.schema[0]+".png)";else if(m.schema.length>1){g(),document.getElementById("button_diverging").checked=!0;var ze=0;if(setSelected(document.querySelector(".color_params_left"),m.schema[0]),m.schema.length>2){var Be=document.getElementById("central_color_val");Be.style.display="",Be.value=m.schema[1],ze=1,document.querySelector(".central_color").querySelector("input").checked=!0}else document.querySelector(".central_color").querySelector("input").checked=!1;setSelected(document.querySelector(".color_params_right"),m.schema[1+ze])}}else y();m.type&&"user_defined"===m.type&&(N=m.breaks),b.compute().then(function(e){e&&b.draw(m.colors)});var Pe=e.pending();x.querySelector(".btn_ok").onclick=function(){q=q.map(function(e){return+e});var e=[],t=null;B>0&&(t=document.getElementById("no_data_color").value);for(var a=0;a<k.length;++a){var r=k[a][n];if((0,i.isNumber)(r)){var l=I.getClass(+r);e.push(S[l])}else e.push(t)}var s=[];d3.select(".color_params_left").node()?(s.push(document.querySelector(".color_params_left").value),document.querySelector(".central_color").querySelector("input").checked&&s.push(document.getElementById("central_color_val").value),s.push(document.querySelector(".color_params_right").value)):s.push(document.querySelector(".color_params").value),Pe.resolve([u,P,q,S,e,s,t,"stddev_f"===P?F:void 0]),document.removeEventListener("keydown",Ce),x.remove(),d()||o.overlay_under_modal.hide()};var Oe=function(){Pe.resolve(!1),document.removeEventListener("keydown",Ce),x.remove(),d()||o.overlay_under_modal.hide()};x.querySelector(".btn_cancel").onclick=Oe,x.querySelector("#xclose").onclick=Oe;var Ce=function(e){var t=e||window.event;("key"in t?"Escape"===t.key||"Esc"===t.key:27===t.keyCode)&&(t.stopPropagation(),Oe())};return document.addEventListener("keydown",Ce),o.overlay_under_modal.display(),Pe.promise};function d(e){var t=void 0!==e?document.querySelector(e):document.querySelector(".styleBox");return!!(t&&t.modal&&t.modal.show)&&(t.modal.show(),!0)}var _=function(e,t,n){var a=h/7.25>80?h/7.25:80,r=w/4>320?320:w/4,o=t.sorted(),i=o.length/3>51?50:(0,p.Mceil)((0,p.Msqrt)(o.length))+1,l=t.getQuantile(4).map(function(e){return+e}),s=10,c=20,d=10,_=20,u=r-c-_,m=a-s-d,y=e.select("#ref_histo_box").select("#inner_ref_histo_box");y.append("p").attrs({id:"ref_histo_title"}).styles({margin:"auto","text-align":"center"}).html("<b>"+i18next.t("disc_box.hist_ref_title")+"</b>");var g=y.append("svg").attrs({id:"svg_ref_histo",width:r+_+c,height:a+s+d}),f=d3.scaleLinear().domain([t.min(),t.max()]).rangeRound([0,u]),v=g.append("g").attr("transform","translate("+(_+c)+","+s+")");return function(e){if(v.remove(),v=g.append("g").attr("transform","translate("+(_+c)+","+s+")"),"histogram"===e){var t=d3.histogram().domain(f.domain()).thresholds(f.ticks(i))(o),a=d3.scaleLinear().domain([0,d3.max(t,function(e){return e.length})]).range([m,0]);v.selectAll(".bar").data(t).enter().append("rect").attrs(function(e){return{class:"bar",width:(0,p.Mabs)(f(e.x1))-(0,p.Mabs)(f(e.x0)),height:m-a(e.length),x:0,transform:"translate("+f(e.x0)+","+a(e.length)+")"}}).styles({fill:"beige",stroke:"black","stroke-width":"0.4px"});v.append("g").style("font-size","10px").attrs({class:"x_axis",transform:"translate(0,"+m+")"}).call(d3.axisBottom().scale(f).ticks(4).tickFormat(n)).selectAll("text").attrs({x:-4,y:4,dy:".45em",transform:"rotate(-40)"}).style("text-anchor","end"),v.append("g").attr("class","y_axis").style("font-size","10px").call(d3.axisLeft().scale(a).ticks(5).tickFormat(d3.format(".0f")))}else if("box_plot"===e){v.append("g").style("font-size","10px").attrs({class:"x_axis",transform:"translate(0,"+m+")"}).call(d3.axisBottom().scale(f).ticks(4).tickFormat(n)).selectAll("text").attrs({x:-4,y:4,dy:".45em",transform:"rotate(-40)"}).style("text-anchor","end");var r=(s+m-d)/2;v.append("g").insert("line").attrs({x1:f(l[0]),y1:2*s,x2:f(l[0]),y2:m-2*d}).styles({"stroke-width":1,stroke:"black",fill:"none"}),v.append("g").insert("rect").attrs({x:f(l[1]),y:s,width:f(l[2])-f(l[1]),height:m-d-s}).styles({"stroke-width":1,stroke:"black",fill:"lightblue"}),v.append("g").insert("line").attrs({x1:f(l[2]),y1:s,x2:f(l[2]),y2:m-d}).styles({"stroke-width":3,stroke:"black",fill:"none"}),v.append("g").insert("rect").attrs({x:f(l[2]),y:s,width:f(l[3])-f(l[2]),height:m-d-s}).styles({"stroke-width":1,stroke:"black",fill:"lightblue"}),v.append("g").insert("line").attrs({x1:f(l[4]),y1:2*s,x2:f(l[4]),y2:m-2*d}).styles({"stroke-width":1,stroke:"black",fill:"none"}),v.append("g").insert("line").attrs({x1:f(l[0]),y1:r,x2:f(l[1]),y2:r}).styles({"stroke-width":1,stroke:"black",fill:"none","stroke-dasharray":"3,3"}),v.append("g").insert("line").attrs({x1:f(l[3]),y1:r,x2:f(l[4]),y2:r}).styles({"stroke-width":1,stroke:"black",fill:"none","stroke-dasharray":"3,3"})}else if("beeswarm"===e){for(var y=o.map(function(e){return{value:+e}}),h=d3.forceSimulation(y).force("x",d3.forceX(function(e){return f(e.value)}).strength(1)).force("y",d3.forceY(m/2).strength(2)).force("collide",d3.forceCollide(4)).stop(),b=0;b<75;++b)h.tick();v.append("g").style("font-size","10px").attrs({class:"x_axis",transform:"translate(0,"+m+")"}).call(d3.axisBottom().scale(f).ticks(4).tickFormat(n)).selectAll("text").attrs({x:-4,y:4,dy:".45em",transform:"rotate(-40)"}).style("text-anchor","end");var x=v.append("g").attr("class","cells").selectAll("g").data(d3.voronoi().extent([[0,0],[u,m]]).x(function(e){return e.x}).y(function(e){return e.y}).polygons(y)).enter().append("g");x.append("circle").attrs(function(e){if(e)return{r:y.lenght<250?2.5:y.lenght<500?1.5:1,transform:"translate("+e.data.x+","+e.data.y+")"}}),x.append("path").attr("d",function(e){if(e)return"M"+e.join("L")+"Z"})}}}}).call(this,n(5))},,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handleZoomRect=void 0;var a=n(6),r=n(2),o=n(11),i=(t.handleZoomRect=function(){var e=map.select(".brush");e.node()?(d3.select("#brush_zoom_button").classed("active",!1),e.remove()):(d3.select("#info_button").classed("active")&&(0,r.displayInfoOnMove)(),d3.select("#brush_zoom_button").classed("active",!0),i())},function(){if(proj.invert){var e=d3.brush().on("end",function(){var i=d3.event.selection;if(i){var l=i[0][0],s=i[1][0],p=i[1][1],c=i[0][1],d=d3.zoomTransform(svg_map),_=[d.x,d.y],u=d.k,m=proj.invert([(l-_[0])/u,(p-_[1])/u]),y=proj.invert([(s-_[0])/u,(c-_[1])/u]),g=path.bounds({type:"MultiPoint",coordinates:[m,y]});map.select(".brush").call(e.move,null);var f=.95/(0,a.Mmax)((g[1][0]-g[0][0])/w,(g[1][1]-g[0][1])/h);svg_map.__zoom.k=f,svg_map.__zoom.x=(w-f*(g[1][0]+g[0][0]))/2,svg_map.__zoom.y=(h-f*(g[1][1]+g[0][1]))/2,(0,o.zoom_without_redraw)()}else if(!n)return n=setTimeout(r,t)}),t=350,n=void 0;map.append("g").attr("class","brush").call(e)}function r(){n=null}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.world_topology={type:"Topology",objects:{World:{type:"GeometryCollection",crs:{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}},geometries:[{type:"Polygon",properties:{id:"1"},arcs:[[0],[1],[2],[3],[4],[5],[6],[7],[8],[9]]},{type:"Polygon",properties:{id:"2"},arcs:[[10]]},{type:"Polygon",properties:{id:"3"},arcs:[[11]]},{type:"Polygon",properties:{id:"4"},arcs:[[12]]},{type:"Polygon",properties:{id:"5"},arcs:[[13]]},{type:"Polygon",properties:{id:"6"},arcs:[[14]]},{type:"Polygon",properties:{id:"7"},arcs:[[15]]},{type:"Polygon",properties:{id:"8"},arcs:[[16]]},{type:"Polygon",properties:{id:"9"},arcs:[[17]]},{type:"Polygon",properties:{id:"10"},arcs:[[18]]},{type:"Polygon",properties:{id:"11"},arcs:[[19]]},{type:"Polygon",properties:{id:"12"},arcs:[[20]]},{type:"Polygon",properties:{id:"13"},arcs:[[21]]},{type:"Polygon",properties:{id:"14"},arcs:[[22]]},{type:"Polygon",properties:{id:"15"},arcs:[[23]]},{type:"Polygon",properties:{id:"16"},arcs:[[24]]},{type:"Polygon",properties:{id:"17"},arcs:[[25]]},{type:"Polygon",properties:{id:"18"},arcs:[[26]]},{type:"Polygon",properties:{id:"19"},arcs:[[27]]},{type:"Polygon",properties:{id:"20"},arcs:[[28]]},{type:"Polygon",properties:{id:"21"},arcs:[[29]]},{type:"Polygon",properties:{id:"22"},arcs:[[30]]},{type:"Polygon",properties:{id:"23"},arcs:[[31]]},{type:"Polygon",properties:{id:"24"},arcs:[[32]]},{type:"Polygon",properties:{id:"25"},arcs:[[33]]},{type:"Polygon",properties:{id:"26"},arcs:[[34]]},{type:"Polygon",properties:{id:"27"},arcs:[[35]]},{type:"Polygon",properties:{id:"28"},arcs:[[36]]},{type:"Polygon",properties:{id:"29"},arcs:[[37]]},{type:"Polygon",properties:{id:"30"},arcs:[[38]]},{type:"Polygon",properties:{id:"31"},arcs:[[39]]},{type:"Polygon",properties:{id:"32"},arcs:[[40]]},{type:"Polygon",properties:{id:"33"},arcs:[[41]]},{type:"Polygon",properties:{id:"34"},arcs:[[42]]},{type:"Polygon",properties:{id:"35"},arcs:[[43]]},{type:"Polygon",properties:{id:"36"},arcs:[[44]]},{type:"Polygon",properties:{id:"37"},arcs:[[45]]},{type:"Polygon",properties:{id:"38"},arcs:[[46]]},{type:"Polygon",properties:{id:"39"},arcs:[[47]]},{type:"Polygon",properties:{id:"40"},arcs:[[48]]},{type:"Polygon",properties:{id:"41"},arcs:[[49],[50],[51],[52],[53],[54]]},{type:"Polygon",properties:{id:"42"},arcs:[[55]]},{type:"Polygon",properties:{id:"43"},arcs:[[56]]},{type:"Polygon",properties:{id:"44"},arcs:[[57]]},{type:"Polygon",properties:{id:"45"},arcs:[[58]]},{type:"Polygon",properties:{id:"46"},arcs:[[59]]},{type:"Polygon",properties:{id:"47"},arcs:[[60]]},{type:"Polygon",properties:{id:"48"},arcs:[[61]]},{type:"Polygon",properties:{id:"49"},arcs:[[62]]},{type:"Polygon",properties:{id:"50"},arcs:[[63]]},{type:"Polygon",properties:{id:"51"},arcs:[[64]]},{type:"Polygon",properties:{id:"52"},arcs:[[65]]},{type:"Polygon",properties:{id:"53"},arcs:[[66]]},{type:"Polygon",properties:{id:"54"},arcs:[[67]]},{type:"Polygon",properties:{id:"55"},arcs:[[68]]},{type:"Polygon",properties:{id:"56"},arcs:[[69]]},{type:"Polygon",properties:{id:"57"},arcs:[[70]]},{type:"Polygon",properties:{id:"58"},arcs:[[71]]},{type:"Polygon",properties:{id:"59"},arcs:[[72]]},{type:"Polygon",properties:{id:"60"},arcs:[[73]]},{type:"Polygon",properties:{id:"61"},arcs:[[74]]},{type:"Polygon",properties:{id:"62"},arcs:[[75]]},{type:"Polygon",properties:{id:"63"},arcs:[[76]]},{type:"Polygon",properties:{id:"64"},arcs:[[77]]},{type:"Polygon",properties:{id:"65"},arcs:[[78]]},{type:"Polygon",properties:{id:"66"},arcs:[[79]]},{type:"Polygon",properties:{id:"67"},arcs:[[80]]},{type:"Polygon",properties:{id:"68"},arcs:[[81]]},{type:"Polygon",properties:{id:"69"},arcs:[[82]]},{type:"Polygon",properties:{id:"70"},arcs:[[83]]},{type:"Polygon",properties:{id:"71"},arcs:[[84]]},{type:"Polygon",properties:{id:"72"},arcs:[[85]]},{type:"Polygon",properties:{id:"73"},arcs:[[86]]},{type:"Polygon",properties:{id:"74"},arcs:[[87]]},{type:"Polygon",properties:{id:"75"},arcs:[[88]]},{type:"Polygon",properties:{id:"76"},arcs:[[89]]},{type:"Polygon",properties:{id:"77"},arcs:[[90]]},{type:"Polygon",properties:{id:"78"},arcs:[[91]]},{type:"Polygon",properties:{id:"79"},arcs:[[92]]},{type:"Polygon",properties:{id:"80"},arcs:[[93]]},{type:"Polygon",properties:{id:"81"},arcs:[[94]]},{type:"Polygon",properties:{id:"82"},arcs:[[95]]},{type:"Polygon",properties:{id:"83"},arcs:[[96]]},{type:"Polygon",properties:{id:"84"},arcs:[[97]]},{type:"Polygon",properties:{id:"85"},arcs:[[98]]},{type:"Polygon",properties:{id:"86"},arcs:[[99]]},{type:"Polygon",properties:{id:"87"},arcs:[[100]]},{type:"Polygon",properties:{id:"88"},arcs:[[101]]},{type:"Polygon",properties:{id:"89"},arcs:[[102]]},{type:"Polygon",properties:{id:"90"},arcs:[[103]]},{type:"Polygon",properties:{id:"91"},arcs:[[104]]},{type:"Polygon",properties:{id:"92"},arcs:[[105]]},{type:"Polygon",properties:{id:"93"},arcs:[[106]]},{type:"Polygon",properties:{id:"94"},arcs:[[107]]},{type:"Polygon",properties:{id:"95"},arcs:[[108]]},{type:"Polygon",properties:{id:"96"},arcs:[[109]]},{type:"Polygon",properties:{id:"97"},arcs:[[110]]},{type:"Polygon",properties:{id:"98"},arcs:[[111]]},{type:"Polygon",properties:{id:"99"},arcs:[[112]]},{type:"Polygon",properties:{id:"100"},arcs:[[113]]},{type:"Polygon",properties:{id:"101"},arcs:[[114]]},{type:"Polygon",properties:{id:"102"},arcs:[[115]]},{type:"Polygon",properties:{id:"103"},arcs:[[116]]},{type:"Polygon",properties:{id:"104"},arcs:[[117]]},{type:"Polygon",properties:{id:"105"},arcs:[[118]]},{type:"Polygon",properties:{id:"106"},arcs:[[119]]},{type:"Polygon",properties:{id:"107"},arcs:[[120]]},{type:"Polygon",properties:{id:"108"},arcs:[[121]]},{type:"Polygon",properties:{id:"109"},arcs:[[122]]},{type:"Polygon",properties:{id:"110"},arcs:[[123]]},{type:"Polygon",properties:{id:"111"},arcs:[[124]]},{type:"Polygon",properties:{id:"112"},arcs:[[125]]},{type:"Polygon",properties:{id:"113"},arcs:[[126]]},{type:"Polygon",properties:{id:"114"},arcs:[[127]]},{type:"Polygon",properties:{id:"115"},arcs:[[128]]},{type:"Polygon",properties:{id:"116"},arcs:[[129]]},{type:"Polygon",properties:{id:"117"},arcs:[[130]]},{type:"Polygon",properties:{id:"118"},arcs:[[131]]},{type:"Polygon",properties:{id:"119"},arcs:[[132]]},{type:"Polygon",properties:{id:"120"},arcs:[[133]]},{type:"Polygon",properties:{id:"121"},arcs:[[134]]},{type:"Polygon",properties:{id:"122"},arcs:[[135]]},{type:"Polygon",properties:{id:"123"},arcs:[[136]]},{type:"Polygon",properties:{id:"124"},arcs:[[137]]},{type:"Polygon",properties:{id:"125"},arcs:[[138]]},{type:"Polygon",properties:{id:"126"},arcs:[[139]]},{type:"Polygon",properties:{id:"127"},arcs:[[140]]},{type:"Polygon",properties:{id:"128"},arcs:[[141]]},{type:"Polygon",properties:{id:"129"},arcs:[[142]]},{type:"Polygon",properties:{id:"130"},arcs:[[143]]},{type:"Polygon",properties:{id:"131"},arcs:[[144]]},{type:"Polygon",properties:{id:"132"},arcs:[[145]]},{type:"Polygon",properties:{id:"133"},arcs:[[146]]},{type:"Polygon",properties:{id:"134"},arcs:[[147]]},{type:"Polygon",properties:{id:"135"},arcs:[[148]]},{type:"Polygon",properties:{id:"136"},arcs:[[149]]},{type:"Polygon",properties:{id:"137"},arcs:[[150]]},{type:"Polygon",properties:{id:"138"},arcs:[[151]]},{type:"Polygon",properties:{id:"139"},arcs:[[152]]},{type:"Polygon",properties:{id:"140"},arcs:[[153]]},{type:"Polygon",properties:{id:"141"},arcs:[[154]]},{type:"Polygon",properties:{id:"142"},arcs:[[155]]},{type:"Polygon",properties:{id:"143"},arcs:[[156]]},{type:"Polygon",properties:{id:"144"},arcs:[[157]]},{type:"Polygon",properties:{id:"145"},arcs:[[158]]},{type:"Polygon",properties:{id:"146"},arcs:[[159]]},{type:"Polygon",properties:{id:"147"},arcs:[[160]]},{type:"Polygon",properties:{id:"148"},arcs:[[161]]},{type:"Polygon",properties:{id:"149"},arcs:[[162]]},{type:"Polygon",properties:{id:"150"},arcs:[[163]]},{type:"Polygon",properties:{id:"151"},arcs:[[164]]},{type:"Polygon",properties:{id:"152"},arcs:[[165]]},{type:"Polygon",properties:{id:"153"},arcs:[[166]]},{type:"Polygon",properties:{id:"154"},arcs:[[167]]},{type:"Polygon",properties:{id:"155"},arcs:[[168]]},{type:"Polygon",properties:{id:"156"},arcs:[[169]]},{type:"Polygon",properties:{id:"157"},arcs:[[170]]},{type:"Polygon",properties:{id:"158"},arcs:[[171]]},{type:"Polygon",properties:{id:"159"},arcs:[[172]]},{type:"Polygon",properties:{id:"160"},arcs:[[173]]},{type:"Polygon",properties:{id:"161"},arcs:[[174]]},{type:"Polygon",properties:{id:"162"},arcs:[[175]]},{type:"Polygon",properties:{id:"163"},arcs:[[176]]},{type:"Polygon",properties:{id:"164"},arcs:[[177]]},{type:"Polygon",properties:{id:"165"},arcs:[[178]]},{type:"Polygon",properties:{id:"166"},arcs:[[179]]},{type:"Polygon",properties:{id:"167"},arcs:[[180]]},{type:"Polygon",properties:{id:"168"},arcs:[[181]]},{type:"Polygon",properties:{id:"169"},arcs:[[182]]},{type:"Polygon",properties:{id:"170"},arcs:[[183]]},{type:"Polygon",properties:{id:"171"},arcs:[[184]]},{type:"Polygon",properties:{id:"172"},arcs:[[185]]},{type:"Polygon",properties:{id:"173"},arcs:[[186]]},{type:"Polygon",properties:{id:"174"},arcs:[[187]]},{type:"Polygon",properties:{id:"175"},arcs:[[188]]},{type:"Polygon",properties:{id:"176"},arcs:[[189]]},{type:"Polygon",properties:{id:"177"},arcs:[[190]]},{type:"Polygon",properties:{id:"178"},arcs:[[191]]},{type:"Polygon",properties:{id:"179"},arcs:[[192]]},{type:"Polygon",properties:{id:"180"},arcs:[[193]]},{type:"Polygon",properties:{id:"181"},arcs:[[194]]},{type:"Polygon",properties:{id:"182"},arcs:[[195]]},{type:"Polygon",properties:{id:"183"},arcs:[[196]]},{type:"Polygon",properties:{id:"184"},arcs:[[197]]},{type:"Polygon",properties:{id:"185"},arcs:[[198]]},{type:"Polygon",properties:{id:"186"},arcs:[[199]]},{type:"Polygon",properties:{id:"187"},arcs:[[200]]}]}},arcs:[[[52723,52414],[-127,105],[126,669],[33,510],[-84,422],[-180,81],[-104,411],[-88,-154],[-268,35],[-312,-188],[-165,204],[-197,789],[-134,203],[-472,6],[-302,-89],[-120,-65],[-910,-786],[-286,204],[1,10],[76,24],[-320,47],[-516,-116],[-469,-390],[-483,457],[-310,594],[-300,427],[-287,271],[-180,450],[-40,502],[-82,422],[-396,687],[-147,441],[-327,345],[-7,422],[53,301],[-171,614],[176,665],[139,1073],[-46,754],[-87,240],[91,471],[-226,565],[14,79],[49,246],[233,1143],[399,1359],[253,339],[172,711],[414,239],[253,382],[256,655],[-54,735],[163,676],[203,399],[475,444],[253,1013],[150,50],[276,-422],[397,102],[9,-30],[192,-117],[908,805],[524,185],[515,50],[125,-141],[596,249],[339,-83],[369,240],[382,-205],[-89,-541],[49,-473],[-288,-526],[57,-359],[326,-300],[235,-201],[278,41],[513,-296],[235,-642],[367,-109],[470,-472],[192,141],[111,406],[-63,289],[178,484],[291,214],[410,-163],[3,-186],[524,-205],[47,-180],[609,-166],[468,-311],[370,392],[433,9],[156,-187],[181,-88],[296,154],[79,155],[173,868],[240,899],[-16,730],[30,581],[-187,-220],[-220,128],[-242,-359],[-244,-67],[-216,297],[-373,201],[-79,-371],[-202,-72],[-204,362],[-352,-54],[59,206],[-172,-30],[-41,469],[-186,198],[-78,260],[149,232],[-175,288],[184,535],[671,17],[22,465],[556,-86],[581,534],[731,-163],[138,-285],[522,-186],[503,3],[383,340],[-6,649],[-420,431],[-280,438],[-685,544],[37,146],[303,-21],[0,787],[423,191],[-290,55],[-643,-260],[-303,-280],[145,-458],[258,5],[-57,-167],[-583,-407],[-303,718],[253,173],[-720,403],[-443,-617],[19,-197],[-283,-512],[-17,-338],[-264,-739],[108,-280],[152,-336],[159,-95],[-2,-124],[-446,-11],[-193,-223],[-170,-113],[-48,192],[-279,154],[-383,-180],[12,-194],[-104,-76],[-141,159],[-70,-258],[215,-503],[-160,-228],[341,-330],[-242,-497],[68,-423],[-48,-105],[-290,339],[-77,-169],[-209,640],[240,330],[-231,-62],[-321,801],[-192,547],[16,696],[-242,325],[-234,273],[-20,30],[-458,423],[-228,338],[-158,536],[-83,48],[-45,-263],[-52,24],[-85,361],[32,60],[-359,-91],[-12,-682],[347,-415],[127,-537],[291,-383],[251,6],[-1,-297],[332,-213],[335,-316],[-54,-215],[-265,187],[-140,-471],[183,-170],[-244,-813],[-128,7],[25,460],[-158,763],[-525,680],[-188,-15],[-542,677],[-274,930],[-384,234],[-340,-363],[-18,-29],[-62,-51],[-377,-351],[-532,281],[-230,-246],[19,-388],[15,-269],[-326,-398],[-297,-135],[-365,-877],[153,-451],[-654,-1151],[-641,-14],[-251,-333],[-153,-56],[-170,532],[-254,134],[-440,-98],[56,770],[-193,201],[232,1317],[-26,561],[-151,550],[392,484],[181,-112],[790,-107],[720,2],[175,802],[15,852],[-245,457],[-481,538],[-292,291],[-10,225],[478,-6],[113,-209],[364,88],[-138,543],[197,38],[262,-225],[493,541],[7,375],[261,126],[237,218],[115,-8],[32,-2],[-124,61],[292,450],[66,363],[551,284],[129,-124],[9,243],[372,-69],[123,199],[-97,578],[-149,954],[198,303],[228,105],[261,283],[-30,-500],[132,-251],[-407,-552],[-17,-391],[453,-421],[398,227],[489,-184],[577,271],[549,123],[276,-144],[172,296],[308,114],[5,445],[179,854],[246,118],[168,-256],[195,-21],[115,339],[-209,298],[-23,476],[626,261],[637,-106],[346,295],[-144,229],[-260,94],[-1267,-364],[-519,418],[-42,1273],[596,601],[550,912],[-331,195],[-641,-166],[-297,-954],[-418,-241],[-492,-715],[-95,-707],[521,-695],[-174,-371],[-452,-307],[-28,-654],[-232,-798],[-324,35],[-90,-359],[-301,-103],[-569,1725],[58,375],[-269,148],[-547,-571],[-547,-79],[-293,366],[215,301],[-297,134],[145,374],[-216,369],[140,798],[553,237],[22,181],[582,570],[438,704],[332,198],[215,780],[321,359],[316,570],[557,389],[323,572],[1212,225],[514,333],[819,66],[920,-519],[-66,-276],[772,-275],[652,-87],[1403,-852],[-21,-549],[-274,-366],[-563,-12],[-1235,370],[282,-354],[77,-899],[699,-425],[221,125],[-457,508],[157,148],[975,-364],[-223,495],[691,651],[546,-372],[-98,744],[83,432],[-219,395],[728,-96],[216,-346],[-333,-205],[91,-347],[520,65],[28,323],[1559,782],[396,-423],[1116,472],[525,487],[933,-172],[1147,-701],[236,314],[-557,469],[-49,925],[431,309],[142,501],[726,468],[343,-465],[-126,-532],[80,-390],[76,-1143],[79,-552],[-473,-807],[-671,-85],[331,-350],[469,127],[639,787],[239,756],[405,-156],[298,142],[-384,351],[-582,-5],[31,596],[-20,990],[332,-158],[79,-381],[291,-47],[91,386],[325,97],[311,187],[652,-395],[525,-51],[-812,538],[36,591],[1653,190],[-212,208],[891,714],[1846,366],[267,-143],[1442,767],[644,-49],[1e3,-230],[887,6],[645,-345],[-161,-665],[-1811,-1036],[1260,283],[721,-101],[1377,45],[3,-219],[716,-133],[929,477],[1001,-193],[405,-255],[-293,-601],[278,-367],[327,-222],[548,531],[308,-258],[649,114],[578,-236],[444,116],[-34,617],[558,160],[1498,-242],[572,-375],[891,-474],[1605,96],[472,-217],[0,-449],[237,-306],[518,183],[1499,56],[396,-452],[280,21],[104,628],[1366,-150],[1228,-512],[-2,-1087],[-3,-1152],[-458,-418],[255,-354],[113,-596],[-186,-195],[-685,-57],[-628,-244],[-712,-561],[-210,-426],[-136,-95],[-321,347],[-1144,-279],[-482,-269],[-88,-351],[-301,-530],[371,-218],[-151,-544],[162,-336],[-340,-30],[3,-736],[-584,-389],[-117,-529],[-273,-206],[-247,-781],[-289,-378],[-169,1180],[-155,1353],[138,853],[395,598],[431,352],[234,418],[1157,1271],[158,764],[-370,-87],[-236,-488],[-629,-633],[54,788],[-610,-71],[-759,-897],[-62,-627],[-485,-190],[-316,220],[-478,351],[-460,-348],[-723,277],[-881,-207],[-627,-560],[-623,-809],[-302,-496],[-654,-704],[462,-174],[-55,-451],[571,292],[534,-42],[240,-615],[-27,-710],[-274,-805],[61,-280],[-138,-927],[-251,-381],[-323,-899],[-614,-1052],[-208,-514],[-551,-472],[-396,279],[-286,-506],[-292,-429],[19,-412],[-610,-627],[-19,-334],[253,-312],[268,-773],[63,-691],[-154,-597],[-328,-236],[-338,-194],[-93,482],[137,470],[-113,482],[139,195],[-52,403],[-553,166],[213,688],[-299,454],[-418,-302],[-280,-406],[-195,-82],[174,371],[-155,91],[300,561],[-313,241],[-205,-419],[-250,-175],[-145,-403],[-349,-44],[-60,-284],[151,-278],[209,8],[37,-502],[130,-92],[361,411],[191,-191],[213,21],[137,-75],[-460,-472],[-384,-579],[-127,-499],[296,-234],[348,-877],[119,-807],[-438,-110],[449,-163],[-359,-370],[192,31],[168,-289],[-127,-315],[28,-422],[-125,-240],[-261,-692],[-109,-235],[-60,-609],[-112,-139],[-160,-375],[-425,-577],[-173,-361],[-475,-72],[-154,-149],[59,-82],[-21,-123],[-71,-47],[-61,49],[7,95],[46,92],[-204,208],[66,-376],[14,-37],[25,-70],[-42,-30],[-165,-121],[-325,-167],[-350,-188],[-5,-400],[-172,-132],[-48,706],[-328,129],[-158,-123],[-335,-272],[-60,-450],[-151,-134],[-114,-576],[227,-504],[56,-377],[594,-1200],[184,-739],[8,-685],[-48,-348],[-76,-549],[-220,-371],[-265,-192],[-106,-17],[-113,-462],[-481,-551],[39,726],[-123,327],[-229,47],[14,324],[-161,-74],[-51,410],[-301,591],[-275,20],[35,440],[-257,-39],[-5,-697],[-239,-1189],[26,-516],[166,35],[116,-563],[37,-448],[165,-393],[158,-14],[141,-331],[291,-505],[91,-337],[-4,-1056],[239,-873],[-258,53],[-578,755],[-157,587],[-103,1235],[-62,247],[-408,1116],[-127,89],[152,1047],[6,812],[-53,821],[-116,290],[-102,686],[-39,956],[-208,481],[-29,-368],[-380,-578],[-338,162],[111,882],[-128,734],[-182,284],[69,347],[-282,198],[-130,462],[-180,851],[-183,21],[-85,162],[-10,-312],[-415,-414],[-242,-22],[-57,178],[-335,-399],[44,-290],[-202,-438],[-259,-193],[-350,-751],[-494,-715],[2,-259],[-294,-150],[-69,-273],[-204,-99],[-58,-380],[81,-959],[-135,-765],[-3,-1002],[-163,-160],[-85,-420],[-199,-178],[-54,-326],[-149,-187],[-270,498],[-280,1586],[-198,673],[-154,1060],[-227,787],[-221,2173],[64,387],[-94,947],[-115,-100],[-7,-448],[-311,-285],[-257,252],[-309,660],[342,154],[-432,363],[-122,375],[-153,-23],[-132,495],[-251,467],[-765,-161],[-531,5],[-468,73],[-716,258],[-83,619],[-187,202],[-431,-406],[-302,122],[-359,540],[-289,198],[-363,1270],[-313,118],[-116,-253],[-162,19],[135,-837],[122,-535],[314,-458],[39,-624],[185,-568],[-10,474],[178,457],[203,-135],[-49,-613],[-209,-253],[98,-213],[109,-136],[600,72],[490,1002],[54,129],[83,-28],[-28,-249],[29,-374],[214,-590],[454,-255],[279,-756],[-354,-1026],[-115,91],[-112,-473],[39,-426],[-257,-118],[-158,-502],[-250,-56],[-116,-478],[-279,-15],[-259,-197],[-222,-218],[-18,-374],[-736,-506],[-249,-399],[-185,8],[-365,-362],[-288,-50],[-218,-353],[-259,-76],[-194,354],[-153,1443],[25,376],[-135,624],[-162,262],[-332,1189],[-244,281],[-157,492],[0,709],[-174,713],[-259,279],[-81,533],[-157,381],[-402,1267],[-158,25],[84,722],[1,119],[-19,-39],[-224,-973],[-233,435],[-186,806],[-65,-205],[148,-588],[178,-357],[140,-776],[416,-1518],[51,-602],[330,-539],[64,-413],[61,-1221],[60,-259],[292,-406],[176,-1092],[134,-486],[400,-359],[144,-404],[401,-710],[72,-405],[-173,-171],[135,-126],[287,-594],[191,-24],[220,263],[193,-103],[255,276],[437,44],[369,196],[147,230],[137,-90],[-32,-731],[-93,-638],[-278,-860],[-223,-1047],[-303,-972],[-533,-1163],[-411,-506],[-300,-541],[-385,-854],[-152,-480],[-378,-614],[-176,-961],[-97,-142],[-115,-780],[191,-476],[-51,-836],[134,-964],[187,-284],[28,-1821],[85,-477],[-71,-583],[-204,-549],[-769,-829],[-168,-407],[-483,-757],[222,-1451],[-121,-1260],[-620,-545],[-99,-234],[104,-516],[-142,-983],[-332,-581],[-220,-741],[-512,-988],[-403,-554],[-395,-156],[-228,-225],[-637,109],[-458,-209],[-267,-259],[-407,545],[-179,604],[119,96],[-28,567],[-247,758],[-221,1022],[-331,720],[-228,1822],[-24,1085],[-278,841],[-64,381],[-363,1159],[-23,512],[-4,838],[145,604],[66,753],[313,688],[32,923],[-210,894],[103,444],[-150,817],[-154,455],[253,146],[-271,56],[-56,429],[-248,623],[-337,712],[-242,808],[79,1108],[136,215]],[[86664,77890],[100,-404],[251,583],[-351,-179]],[[58657,46892],[-162,622],[-5,318],[-227,395],[55,203],[-81,845],[-125,643],[-30,-1001],[112,-942],[190,-383],[107,-489],[166,-211]],[[59464,51233],[50,453],[-71,294],[-202,81],[-375,-299],[-38,-501],[-48,-597],[60,-379],[388,103],[236,845]],[[66682,77670],[-33,299],[139,272],[-2,146],[-70,44],[-122,-261],[-162,-17],[-157,-81],[42,-42],[112,-110],[83,-82],[-70,-230],[48,-270],[152,-26],[40,358]],[[65852,75988],[80,-123],[80,-76],[67,107],[-67,222],[-74,16],[-86,-146]],[[64565,75886],[77,565],[-217,60],[-454,1049],[305,390],[325,39],[173,759],[-549,232],[-551,-457],[-447,-328],[-255,-756],[151,-135],[60,-686],[311,-677],[365,-850],[-126,-168],[-157,-947],[71,-467],[283,-126],[261,-384],[228,-89],[584,137],[-28,301],[18,898],[-114,603],[-230,60],[31,585],[242,-255],[276,282],[-227,555],[-142,-16],[-145,-135],[-16,-392],[-103,353]],[[57678,85247],[20,573],[-123,-116],[18,-376],[85,-81]],[[51407,82322],[21,-127],[68,53],[5,132],[-94,-58]],[[59419,46241],[100,-416],[13,-721],[-80,-285],[82,-696],[74,-103],[74,35],[-45,764],[75,354],[-13,89],[-7,13],[-42,73],[-6,20],[-120,879],[-27,59],[-28,48],[-3,7],[-47,-120]],[[52421,54028],[94,-40],[-100,-355],[-128,113],[134,282]],[[99745,47026],[23,54],[39,-103],[6,-119],[-33,0],[-35,168]],[[99771,47233],[-53,-108],[-47,98],[57,127],[43,-117]],[[70473,54273],[-3,-58],[-29,-44],[-51,1],[-28,47],[6,65],[36,46],[42,-3],[27,-54]],[[70391,54827],[50,30],[55,-44],[3,-86],[-40,-77],[-61,13],[-22,84],[15,80]],[[70380,53869],[65,9],[32,-55],[12,-84],[-24,-48],[-56,-14],[-42,42],[-8,62],[21,88]],[[32840,61703],[29,-39],[-11,-41],[-39,12],[-8,49],[29,19]],[[64004,67159],[152,16],[-63,-409],[-101,68],[12,325]],[[28292,66386],[110,-210],[50,-206],[79,-207],[-6,-103],[-116,0],[-54,221],[-83,121],[-77,111],[61,117],[-31,155],[67,1]],[[28541,66314],[66,44],[97,-28],[7,-89],[-117,-10],[-53,83]],[[33463,59361],[-42,69],[3,75],[32,-20],[21,-55],[20,-13],[37,6],[-24,-55],[-47,-7]],[[62184,44813],[-114,80],[-53,139],[-11,268],[83,16],[97,-332],[-2,-171]],[[43362,60942],[212,-71],[79,-216],[-134,-211],[-208,58],[-56,218],[107,222]],[[32931,60804],[50,-33],[20,-83],[4,-73],[-38,-37],[-26,75],[-38,98],[-10,92],[38,-39]],[[53320,84087],[116,-347],[-37,-270],[-154,-129],[-46,190],[-132,41],[-112,276],[149,222],[216,17]],[[45518,68312],[38,-139],[-21,-127],[-52,-87],[-97,-10],[-74,83],[-11,139],[25,140],[97,54],[95,-53]],[[50890,74810],[105,-121],[-128,-188],[-126,195],[149,114]],[[47940,87630],[228,248],[66,-164],[-118,-498],[-176,414]],[[93905,55860],[39,92],[78,6],[13,-99],[-27,-120],[-75,-28],[-42,66],[14,83]],[[49302,80301],[-68,6],[27,36],[48,30],[-7,-72]],[[32900,58769],[-53,3],[22,115],[51,132],[49,-7],[-25,-147],[-44,-96]],[[48720,82994],[21,159],[61,-46],[-42,-163],[-40,50]],[[54348,73970],[0,-249],[-149,-338],[55,-136],[-67,-293],[-735,662],[92,215],[364,-74],[440,213]],[[52533,75595],[67,18],[129,-435],[-75,-795],[-195,-151],[-134,203],[17,412],[-56,555],[247,193]],[[49410,80211],[48,-21],[-4,-44],[-75,22],[31,43]],[[5845,53105],[71,63],[103,-18],[51,-131],[-52,-125],[-105,-43],[-67,105],[-1,149]],[[32592,61827],[48,-92],[-3,-55],[-33,12],[-15,58],[-44,46],[-12,55],[13,28],[46,-52]],[[33069,59738],[-35,53],[0,121],[56,73],[25,-74],[-5,-149],[-41,-24]],[[97513,55954],[34,-26],[68,2],[17,37],[-17,61],[35,-45],[-4,-44],[-22,-31],[-84,-14],[-55,30],[-15,98],[43,-68]],[[54040,72433],[-90,6],[-34,130],[57,97],[108,-98],[-41,-135]],[[66031,40264],[25,-109],[-37,-112],[-85,12],[-16,115],[47,86],[66,8]],[[96394,51519],[-21,-13],[-19,10],[-8,28],[9,27],[18,8],[19,-10],[5,-25],[-3,-25]],[[87404,56211],[25,121],[47,98],[-9,-152],[-40,-186],[-80,-201],[-45,-29],[36,183],[66,166]],[[78965,52628],[-32,-76],[-74,-21],[-72,42],[-49,100],[227,-45]],[[51857,51880],[-55,27],[-26,94],[15,98],[58,44],[70,-32],[12,-105],[-27,-78],[-47,-48]],[[65412,49233],[40,-73],[15,-203],[-51,43],[-42,135],[38,98]],[[1320,39750],[117,-57],[-87,-159],[-75,148],[45,68]],[[32999,59383],[0,100],[5,59],[29,10],[27,-23],[-14,-142],[-34,-110],[-13,106]],[[2148,44096],[251,-309],[-87,-44],[-243,131],[-64,177],[143,45]],[[34952,54919],[63,229],[264,-166],[277,-464],[87,-353],[98,-74],[66,-308],[174,-899],[155,-87],[5,-287],[-322,-709],[-287,-503],[228,117],[241,382],[228,-2],[285,-162],[-97,-885],[132,143],[107,567],[518,-150],[458,-533],[43,-405],[294,117],[297,-281],[626,-8],[419,-489],[360,-699],[465,-134],[198,-1160],[-4,-431],[-137,-741],[-307,-754],[-137,-156],[-319,-1076],[-187,10],[-88,-428],[-7,-754],[56,-673],[-76,-1057],[-163,-484],[4,-517],[-378,-1213],[29,-245],[-278,-338],[-25,-241],[-502,27],[-232,-116],[-204,-321],[-426,-365],[-238,-343],[-209,-564],[-66,-1576],[-277,-480],[-140,-587],[-592,-1470],[49,200],[288,717],[109,443],[-119,16],[-74,-288],[-118,-319],[-183,-820],[-211,-367],[-107,-375],[-326,-333],[-381,36],[-225,256],[-204,-5],[-148,305],[52,861],[-103,-1061],[396,-689],[-29,-395],[162,-392],[-258,-750],[-408,-311],[-682,-183],[-242,113],[102,-317],[-130,-543],[43,-325],[-401,-165],[-308,261],[-50,-737],[350,-49],[52,-392],[-227,140],[1,-270],[-250,-401],[-74,-781],[-166,20],[-315,-357],[-80,-317],[232,-485],[224,-35],[3,-565],[-441,-558],[-77,-540],[-290,-217],[-81,-373],[200,-788],[-276,54],[-393,-277],[-49,-620],[-601,328],[-215,263],[-196,625],[-107,709],[199,220],[-78,1335],[235,518],[-308,-268],[-150,46],[17,464],[127,549],[138,613],[155,-51],[-38,-692],[-88,-388],[173,42],[94,786],[18,451],[228,1261],[-137,289],[-223,-153],[-52,447],[65,573],[131,281],[-119,1020],[128,322],[156,918],[116,259],[168,907],[59,675],[-62,1228],[97,189],[-66,559],[97,333],[203,1737],[-39,473],[146,1780],[-93,1783],[-276,375],[-35,232],[-608,613],[-413,497],[-306,735],[19,417],[-396,1190],[-372,1771],[-272,823],[-315,412],[-42,1056],[253,487],[107,113],[-7,267],[-95,13],[-117,351],[-48,597],[236,644],[6,453],[293,162],[45,181],[137,698],[155,-40],[207,775],[-112,134],[26,1376],[-154,398],[-161,384],[79,301],[-203,214],[-229,-83],[-201,-248],[132,-413],[-189,-88],[-87,186],[-125,138],[-303,136],[-102,-66],[-234,339],[30,237],[-291,355],[-122,-55],[-210,460],[48,418],[-541,1032],[93,63],[-140,245],[-269,-93],[-363,278],[-340,131],[-258,340],[-459,889],[-265,196],[-162,-262],[-311,-182],[-338,185],[-301,316],[-612,424],[-209,360],[-469,256],[-134,311],[-288,285],[-189,598],[139,625],[-167,660],[-690,1422],[-321,395],[59,312],[-386,851],[-176,138],[-251,539],[-271,1051],[22,199],[-523,433],[76,-994],[504,-1004],[20,-332],[266,-662],[407,-1498],[243,-319],[-117,-395],[-114,384],[-495,710],[-71,809],[-228,352],[-131,-37],[-394,654],[246,52],[35,292],[-459,748],[-103,609],[-294,990],[-268,690],[-335,314],[-327,101],[-48,397],[-178,302],[-310,881],[-75,425],[-293,568],[-35,527],[-154,352],[96,571],[-135,812],[110,597],[70,1651],[-237,819],[706,-105],[-150,579],[-45,0],[-680,894],[-241,-29],[-435,430],[-18,561],[-282,628],[-440,601],[139,533],[-278,5],[-109,342],[-254,330],[-548,1016],[-432,271],[-297,-182],[-395,410],[-566,358],[-687,237],[-311,-67],[-870,584],[-368,-133],[-17,-472],[-265,22],[-492,-455],[-201,333],[88,696],[-413,-740],[-303,-189],[238,-310],[-244,-361],[-515,-369],[-147,-342],[-523,-314],[-78,-278],[-310,-59],[-659,-468],[-315,46],[419,438],[346,63],[799,949],[172,720],[-297,-157],[-496,140],[-395,-114],[-323,771],[-303,-114],[-504,434],[212,157],[-426,442],[-47,865],[618,96],[221,-133],[711,412],[-109,687],[-542,-303],[-849,99],[-525,580],[934,555],[288,-275],[417,-1],[68,388],[-487,203],[-281,396],[-513,328],[86,297],[525,31],[678,802],[1073,297],[341,270],[1343,-494],[692,43],[1361,-311],[358,77],[638,-268],[1427,-429],[806,701],[1425,66],[527,-475],[256,367],[236,-344],[338,222],[423,-41],[941,-428],[835,-86],[313,-274],[-452,-268],[465,-137],[1329,15],[420,-650],[-199,1168],[558,164],[496,-503],[605,-179],[1003,23],[-6,349],[472,-25],[155,-490],[810,628],[-216,512],[-555,287],[-155,612],[647,569],[433,-371],[291,-768],[-78,-313],[495,-352],[417,209],[255,-244],[-63,-595],[485,-229],[329,1422],[751,-116],[375,-580],[-335,-89],[343,-590],[-81,-267],[-601,-459],[-601,-21],[-424,-480],[-641,355],[180,-356],[584,-107],[-290,-548],[-501,34],[-131,-370],[-822,175],[676,-296],[39,-189],[-503,-159],[-425,-769],[-233,-870],[107,-705],[356,12],[204,-801],[-79,-230],[465,178],[598,-233],[361,-468],[824,-462],[656,-73],[-14,-1239],[533,-936],[177,-84],[346,668],[-51,360],[-175,697],[-125,266],[381,216],[482,602],[19,690],[-136,398],[-415,411],[371,766],[-258,497],[172,355],[-169,468],[184,168],[756,-248],[306,187],[638,-768],[455,-201],[-11,-283],[53,-470],[306,-543],[403,-211],[355,244],[467,1063],[412,-1072],[392,-959],[182,-649],[445,-544],[435,-167],[-416,-359],[400,79],[214,-352],[230,-80],[36,-702],[-356,-395],[-413,-63],[-382,-569],[-566,-56],[-1263,19],[-268,-533],[-470,-335],[2,-148],[644,361],[221,165],[187,53],[199,-148],[80,-268],[-69,-245],[-163,-246],[-36,-523],[200,-451],[568,-360],[154,173],[255,-335],[-604,-435],[-315,-7],[-325,-631],[-153,134],[8,505],[459,425],[-114,179],[-320,-241],[-352,-18],[-208,-366],[-371,-34],[-367,-696],[-54,-291],[39,-344],[193,-242],[-19,-100],[-409,-56],[-392,-137],[-211,-143],[-59,-192],[540,211],[76,-175],[-639,-384],[45,-226],[-240,-479],[-173,203],[108,-428],[2,-449],[-150,-239],[-87,352],[-181,481],[75,-565],[43,-363],[69,-190],[-99,-789],[-145,95],[17,-471],[-170,-29],[-249,-455],[-203,-65],[-117,-343],[-319,-402],[-278,-542],[-52,-397],[217,-1429],[195,-900],[-130,-928],[-161,-46],[-176,453],[-94,552],[-216,588],[57,568],[-387,711],[-240,-217],[-410,375],[-693,15],[-173,-189],[-67,-253],[70,-320],[-220,-30],[-296,151],[-144,309],[-120,-171],[-256,138],[-469,-229],[-198,-353],[-234,-96],[-308,-914],[115,-601],[-143,-835],[-66,-1106],[206,-1123],[388,-1083],[357,-358],[843,423],[195,286],[103,936],[159,163],[507,182],[315,-96],[-13,-333],[-241,-714],[86,-71],[-110,-718],[-73,73],[-53,-456],[18,-360],[-133,-641],[132,-67],[138,113],[385,-81],[116,128],[452,-111],[58,-260],[265,-209],[-122,-985],[21,-511],[-104,-590],[62,-259],[298,-777],[91,-324],[261,-134],[353,445],[285,-9],[273,-180],[181,-323],[118,-69],[369,522],[31,653],[185,302],[134,-193],[48,312],[249,-13],[312,475],[29,134],[102,65],[106,-126],[-3,-228],[-176,-149],[98,-505],[-144,-512],[169,-447],[132,410],[-132,604],[397,373],[50,108],[-106,80],[-18,137],[67,76],[104,-79],[8,-294],[235,-31],[256,-568],[469,105],[118,-238],[300,-74],[171,296],[393,80],[113,-179],[-84,-406],[271,89],[237,-322],[-74,-442],[286,-8],[238,-287],[305,-713],[250,-424],[-22,-346],[61,320],[826,-145],[-33,-254]],[[25116,79484],[-397,-290],[-301,-397],[142,-117],[194,212],[125,-226],[596,623],[68,-116],[-16,-260],[264,-268],[611,142],[128,-189],[-98,840],[-282,39],[-160,443],[-510,136],[-364,-572]],[[26637,78534],[-175,-282],[-629,30],[-177,-520],[86,-117],[-161,-885],[24,-569],[147,-375],[176,143],[121,627],[-89,382],[76,611],[284,393],[196,146],[286,-153],[44,-593],[184,-235],[76,-521],[191,210],[125,706],[-91,371],[416,-447],[91,199],[-270,637],[-931,242]],[[27043,76351],[-226,-481],[265,-188],[231,73],[611,510],[168,252],[-16,58],[-676,-171],[-351,-352],[-6,299]],[[28039,76766],[652,35],[256,667],[-346,-302],[-570,-84],[-191,-286],[199,-30]],[[30823,42305],[116,195],[-208,400],[-180,-194],[251,-216],[41,5],[-20,-190]],[[52621,76475],[6,-441],[-23,-331],[-58,-12],[-77,95],[-69,390],[30,166],[115,52],[5,105],[71,-24]],[[32806,61180],[46,92],[72,-80],[46,133],[33,-144],[-8,-124],[-93,47],[-48,-69],[-48,145]],[[33165,60197],[-31,-80],[-78,31],[-30,76],[-15,115],[40,54],[72,-83],[42,-113]],[[65484,39987],[81,-29],[40,-94],[-13,-104],[-99,15],[-51,69],[-10,99],[52,44]],[[89749,83174],[148,-902],[-58,-494],[294,-1550],[-340,61],[-141,-774],[230,-865],[-240,125],[-35,-406],[-137,-91],[-76,403],[103,786],[-32,501],[127,1356],[-119,429],[12,901],[125,91],[46,300],[93,129]],[[12,89353],[3,1217],[1,974],[1517,-1101],[823,-84],[420,-456],[-140,-244],[-409,-122],[-292,-712],[-623,340],[-208,386],[-655,13],[-437,-211]],[[64052,91773],[-307,-404],[-285,-8],[-17,447],[283,370],[283,-92],[43,-313]],[[21,92731],[1,298],[344,35],[403,-224],[-748,-109]],[[89728,94628],[413,-100],[-306,-443],[-810,80],[703,463]],[[90757,95319],[974,-53],[777,-41],[-1350,-300],[-401,394]],[[88641,95670],[627,48],[1115,-385],[-465,-326],[-1212,-149],[-610,257],[-23,341],[568,214]],[[68651,95674],[-1602,-444],[-620,-512],[-186,-152],[-385,-356],[-412,-696],[138,-631],[426,-305],[-688,-102],[-548,161],[-267,491],[390,1195],[1472,1214],[1118,196],[715,216],[312,-31],[137,-244]],[[78591,97501],[521,-346],[-1643,-645],[672,969],[450,22]],[[77159,97993],[700,-292],[-233,-632],[-1274,38],[-442,553],[1249,333]],[[63563,98386],[798,-78],[904,59],[596,97],[644,10],[-1383,-924],[-752,-157],[-510,266],[-297,727]],[[76802,98861],[546,-404],[-1528,-412],[982,816]],[[30936,21519],[49,-379],[547,-673],[369,-100],[-385,-237],[-587,95],[-585,26],[-268,251],[326,226],[37,577],[278,322],[219,-108]],[[99999,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-3,0],[-135,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-123,0],[-16,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-139,0],[-138,0],[-139,0],[-139,0],[-138,0],[-139,0],[0,271],[0,271],[0,271],[0,271],[0,271],[0,271],[0,271],[0,271],[0,272],[0,271],[0,271],[0,271],[1830,-95],[748,760],[3657,-111],[307,1291],[2047,963],[-2069,469],[-586,460],[198,465],[1781,-207],[657,-152],[1056,359],[-792,559],[552,99],[2476,384],[543,396],[410,-212],[1924,145],[1435,-63],[1091,159],[1283,62],[28,-274],[840,190],[131,-400],[884,-43],[875,134],[607,-200],[753,113],[-832,422],[-415,529],[48,338],[1389,-16],[3315,-83],[552,-331],[712,8],[440,398],[668,-445],[1931,299],[773,264],[212,428],[15,813],[-317,601],[275,266],[-41,983],[311,673],[555,722],[435,417],[395,241],[708,365],[357,-14],[-806,-654],[-624,-504],[-61,-217],[-313,-176],[-342,-596],[24,-629],[264,-264],[373,-543],[85,-595],[324,-455],[284,-953],[-216,-767],[-689,-625],[-1926,-729],[-2060,69],[551,-568],[779,-20],[-603,-341],[-757,72],[57,-217],[-801,-246],[-964,506],[-33,-260],[960,-483],[1083,-31],[224,-868],[1278,125],[1653,-524],[923,-1069],[661,-53],[1308,668],[2356,225],[630,-277],[804,671],[1600,351],[1555,254],[-254,338],[-1549,424],[703,888],[1350,551],[809,242],[1965,394],[394,526],[473,-54],[386,330],[-368,139],[341,263],[862,439],[143,468],[386,280],[500,-322],[-57,479],[606,54],[-132,-365],[1773,9],[635,259],[1847,341],[746,-272],[310,423],[244,-174],[1179,-112],[864,-155],[166,332],[423,-331],[119,235],[748,-363],[944,415],[806,172],[-51,666],[733,-252],[12,-254],[707,31],[257,-292],[318,783],[2106,818],[355,-157],[139,497],[489,-201],[-182,446],[948,315],[521,-104],[1084,-910],[307,119],[842,-59],[1313,-226],[327,90],[174,-435],[-132,-480],[-688,-563],[545,-234],[-484,-682],[-125,-581],[731,273],[833,1288],[1448,613],[358,566],[1620,617],[834,176],[669,-29],[441,186],[494,-144],[1330,172],[83,-265],[697,556],[715,-20],[1174,-372],[641,-19],[134,347],[633,167],[716,-589],[-14,-280],[732,131],[145,-215],[1947,641],[224,-311],[655,-189],[463,592],[851,24],[88,-230],[569,149],[1172,-310],[859,-35],[331,-156],[217,-230],[788,-555],[1546,-162],[-3,280],[699,-535],[945,-172],[621,-819],[29,351],[1558,-275],[731,-582],[-195,-715],[-1400,-509],[-667,-842],[231,-936],[852,-895],[-1498,-271],[191,-524],[-348,-723],[2350,-1034],[3169,-780],[0,-271],[0,-271],[0,-271],[0,-272],[0,-271],[0,-271],[0,-271],[0,-271],[0,-271],[0,-271],[0,-271],[0,-271]],[[33312,5936],[-160,-729],[-1680,315],[1217,262],[623,152]],[[5474,6183],[340,-319],[-1844,-177],[932,791],[572,-295]],[[31435,6660],[-975,-726],[-69,468],[1044,258]],[[37402,6513],[448,-62],[58,-806],[-2953,-390],[227,443],[856,329],[330,861],[872,129],[588,-248],[-426,-256]],[[16335,9502],[-142,-508],[-378,409],[520,99]],[[14976,9617],[569,-197],[8,-356],[-906,314],[329,239]],[[29462,10104],[106,-424],[-714,20],[608,404]],[[23128,10579],[340,-443],[-1032,15],[-851,144],[963,211],[580,73]],[[30549,11985],[479,-966],[-165,-696],[-596,-349],[-381,353],[-443,-59],[-376,144],[428,419],[406,-45],[365,164],[90,352],[-336,244],[-24,575],[553,-136]],[[90109,28535],[481,-348],[527,265],[128,-218],[-49,-743],[-96,-548],[-165,-31],[-143,-209],[-231,50],[-210,546],[-242,1236]],[[88211,31313],[78,-352],[-389,41],[-57,380],[368,-69]],[[86176,45448],[285,61],[168,-280],[-245,-209],[-283,72],[75,356]],[[89596,45671],[147,-933],[99,-164],[27,-655],[114,-438],[149,202],[241,-451],[15,-864],[208,-685],[35,-716],[391,-549],[244,-129],[186,-598],[196,-643],[247,-283],[-3,-411],[268,-352],[396,-1101],[0,-640],[111,-1049],[-296,-2059],[-196,-244],[-252,-844],[-46,-489],[-169,-412],[-40,-1039],[-473,-72],[-426,-459],[-96,-297],[-292,349],[-511,-189],[-316,283],[-207,-19],[-359,298],[-172,404],[31,322],[-164,431],[-295,116],[93,536],[-64,322],[-189,-452],[-125,1005],[-275,-321],[-161,-634],[-192,621],[-226,724],[-518,295],[-294,320],[-607,-123],[-473,-335],[-306,23],[-575,-512],[-164,-470],[-554,68],[-425,-61],[-449,-566],[-485,-82],[-422,396],[-37,485],[189,135],[4,944],[-196,826],[1,423],[-226,791],[-43,455],[-88,235],[-143,322],[-99,465],[230,-161],[110,70],[-93,331],[-83,620],[93,309],[-28,538],[101,414],[100,-83],[76,92],[225,190],[379,555],[148,-102],[218,210],[783,420],[241,681],[139,173],[-42,513],[219,392],[165,-541],[85,178],[-89,544],[188,60],[48,368],[150,106],[118,480],[507,463],[276,-574],[399,-141],[-70,308],[214,845],[241,406],[467,57],[-29,375],[146,50],[118,-264],[251,-73],[320,-91],[242,115],[133,-234],[-77,-383],[-197,-140],[-9,-540],[-148,-298],[369,-693],[648,-576],[267,-456],[231,147],[167,800],[45,2037],[161,919],[104,128]],[[81666,54489],[309,224],[204,328],[258,845],[269,-367],[8,-277],[177,-65],[238,-342],[-193,-176],[20,-261],[-299,-163],[-34,-418],[179,-675],[-63,-217],[317,-532],[-331,-87],[-103,-770],[-295,-714],[62,-264],[-177,-798],[-373,-323],[-25,256],[-250,155],[-143,126],[-139,-107],[-221,-70],[-132,289],[-301,23],[-95,1094],[-180,144],[7,498],[-123,473],[67,420],[152,301],[158,-246],[260,155],[81,434],[435,278],[276,829]],[[31432,20057],[-213,-172],[-247,-11],[-131,-232],[-141,-57],[-107,126],[-130,115],[-99,307],[327,-6],[247,-9],[494,-61]],[[29676,21015],[476,-253],[-215,-133],[-261,386]],[[29257,23038],[-134,-153],[-136,581],[13,631],[166,89],[12,-569],[79,-579]],[[29474,27613],[168,73],[-134,-1022],[-195,36],[161,913]],[[29140,63299],[-38,2],[-696,-26],[182,351],[-273,142],[-195,535],[-313,34],[-155,213],[-381,69],[-15,283],[-251,9],[-176,-293],[-307,-230],[123,506],[516,304],[444,-60],[540,-422],[254,-313],[489,-424],[81,-223],[261,-37],[140,-321],[-230,-99]],[[59170,71751],[-120,63],[-56,141],[57,163],[118,13],[20,117],[157,-30],[233,162],[-161,-292],[35,-127],[-104,-78],[-37,-103],[-142,-29]],[[30067,63192],[205,129],[312,-172],[80,-313],[348,-251],[-137,-163],[-515,32],[-198,-475],[-100,250],[-82,114],[-438,13],[-142,230],[285,-97],[103,224],[-112,610],[391,-131]],[[99996,42523],[2,-310],[-315,-200],[-72,228],[385,282]],[[99519,41844],[117,-203],[20,-261],[-105,-144],[-174,21],[-135,161],[-13,272],[97,182],[193,-28]],[[33555,22281],[-414,-543],[123,709],[291,-166]],[[33671,22279],[359,-43],[-95,-255],[-363,-216],[-244,-4],[343,518]],[[47986,83558],[319,82],[157,-319],[-204,-323],[76,-652],[-193,-577],[-557,-223],[-468,174],[80,389],[148,342],[-171,153],[92,527],[382,-30],[53,510],[286,-53]],[[49070,85622],[-203,-409],[644,-270],[-394,-816],[429,-272],[545,-1439],[400,-346],[-220,-381],[105,-399],[-301,-221],[-359,55],[-687,-170],[-42,-186],[-498,-18],[527,694],[-486,298],[304,209],[12,546],[269,86],[108,431],[-660,509],[154,280],[-254,331],[-181,485],[104,537],[228,452],[456,14]],[[56639,72302],[518,-110],[132,-171],[-418,-62],[-339,209],[107,134]],[[56498,74314],[253,-249],[-14,-173],[-314,299],[75,123]],[[35353,92117],[163,-260],[-300,-105],[-423,201],[81,385],[479,-221]],[[42931,92514],[-521,-239],[-125,117],[37,147],[620,199],[228,-55],[63,-228],[-302,59]],[[41053,99999],[3019,-569],[-14,-312],[37,-326],[1042,-75],[476,256],[625,-359],[-624,-463],[-914,-74],[34,-649],[-28,-597],[203,-521],[-938,-549],[490,1],[142,-594],[-651,-454],[341,-570],[-492,-114],[-465,200],[-600,-205],[445,-471],[777,-538],[76,-544],[-519,-60],[-256,369],[-365,61],[-650,-177],[-87,-293],[264,-219],[549,243],[815,-172],[-1087,-818],[-1034,-328],[-552,-43],[-542,-748],[-591,-470],[-569,-69],[-815,-413],[151,-791],[-531,-511],[-198,-1589],[-383,-24],[-310,353],[-393,143],[-443,196],[-671,1120],[-307,618],[-299,823],[-202,802],[375,834],[408,22],[51,703],[-1004,535],[195,156],[404,-123],[-74,378],[-387,167],[-506,-20],[-103,588],[68,319],[-212,474],[-271,455],[-569,597],[-1017,271],[-1376,-172],[-549,414],[-247,518],[-444,263],[85,212],[1479,269],[343,211],[-726,258],[505,193],[1618,779],[1822,508],[1092,-336],[-166,415],[1653,-414],[397,355],[3200,695]],[[83336,46449],[248,-120],[131,-237],[-199,-102],[-203,162],[-275,174],[298,123]],[[84738,46375],[-178,-390],[-350,-214],[-47,343],[180,285],[67,192],[166,81],[110,60],[75,135],[490,295],[237,-105],[-342,-267],[-408,-415]],[[82450,47053],[-65,-308],[-147,56],[51,273],[161,-21]],[[82769,47173],[282,-120],[15,-185],[-199,-20],[-242,-94],[-132,53],[46,253],[230,113]],[[84455,47255],[-1,-122],[-290,-164],[-52,-90],[-376,-216],[-426,66],[-49,259],[131,74],[370,-36],[693,229]],[[82081,47144],[114,-162],[-103,-123],[-127,64],[-92,121],[4,91],[204,9]],[[88478,47142],[-305,-176],[-54,400],[137,277],[227,89],[73,-267],[-78,-323]],[[81944,47870],[-95,-176],[-308,-22],[-141,188],[544,10]],[[79488,48377],[331,-41],[305,-166],[153,-248],[409,-84],[159,218],[433,-194],[172,-408],[346,-126],[-31,-333],[67,-211],[-389,287],[-146,-98],[-610,193],[-340,221],[-257,-51],[-501,234],[4,247],[-301,100],[-32,186],[228,274]],[[87383,48714],[153,78],[18,-490],[-26,-298],[-193,-93],[24,391],[24,412]],[[85297,50004],[48,-242],[-140,-146],[-174,59],[-34,293],[141,136],[159,-100]],[[85861,50194],[555,-304],[-72,-277],[-259,191],[-246,74],[-248,-19],[-94,283],[364,52]],[[79957,50370],[108,-98],[17,-184],[-109,-98],[-129,92],[-3,220],[116,68]],[[84591,50897],[745,16],[-76,-253],[-704,24],[35,213]],[[87632,50923],[-46,267],[219,-101],[249,36],[-4,-250],[-226,-18],[-192,66]],[[79409,50981],[159,-476],[133,-173],[-21,-161],[-147,-97],[-47,191],[-96,309],[-185,57],[-30,260],[88,-2],[146,92]],[[77461,51384],[113,-302],[51,-238],[-88,-48],[-101,170],[-99,277],[25,177],[99,-36]],[[89159,46594],[-290,574],[-304,-17],[71,333],[-283,1233],[-584,519],[-207,33],[-371,378],[-256,-177],[-10,322],[-203,505],[197,183],[-233,146],[-73,337],[-236,43],[79,361],[407,264],[352,-209],[135,-1232],[280,-288],[259,658],[229,84],[157,340],[575,-511],[309,-132],[847,-497],[496,-805],[-23,-323],[478,-311],[113,-420],[-244,-29],[59,-416],[257,-341],[124,-563],[161,34],[24,-295],[230,-132],[-32,-200],[209,-285],[-754,225],[-257,407],[-270,790],[-590,67],[-271,-209],[118,-361],[-209,-212],[-466,129]],[[77059,52830],[146,-423],[-66,-238],[-197,543],[117,118]],[[84739,52803],[90,-153],[-296,-581],[-347,67],[-642,-131],[-85,-366],[61,-604],[229,309],[489,204],[225,-49],[-114,-251],[-358,-164],[-188,-344],[172,-587],[-31,-363],[196,-368],[-395,-265],[40,328],[-204,315],[52,450],[-193,-263],[-18,-1322],[-269,89],[76,600],[-92,510],[-148,194],[159,646],[-2,435],[113,335],[91,793],[78,196],[157,155],[159,-134],[639,-93],[356,412]],[[85602,52942],[-86,-436],[252,278],[93,-145],[-234,-404],[317,-70],[-39,-275],[-285,-34],[111,-418],[-60,-217],[-266,420],[-70,441],[0,436],[124,607],[143,-183]],[[76528,55067],[173,-186],[381,-17],[224,-675],[402,-518],[225,-590],[136,78],[296,-522],[96,-352],[360,-308],[-115,-539],[287,-193],[140,-722],[206,-68],[125,-491],[-81,-1482],[-72,-35],[-113,189],[-159,-162],[-236,513],[-384,553],[-335,809],[-223,1020],[-192,527],[-131,100],[-168,958],[-243,274],[-16,262],[-604,1129],[-95,324],[116,124]],[[75774,59507],[77,368],[75,-234],[-96,-591],[-76,-702],[-44,254],[-5,254],[69,651]],[[45544,90163],[551,-181],[196,-547],[-332,-500],[-459,-356],[-704,-225],[-677,276],[-245,490],[-514,13],[290,288],[-467,149],[9,445],[432,234],[344,-370],[331,-206],[173,324],[538,-116],[534,282]],[[28693,62468],[227,-91],[195,-176],[-87,-110],[-188,29],[-201,-74],[-184,87],[-255,223],[191,90],[302,22]],[[86383,71299],[208,-118],[82,-379],[-191,-893],[-189,-213],[-121,140],[-12,488],[70,165],[-59,261],[-107,-80],[-75,298],[394,331]],[[87266,71631],[200,-128],[-192,-514],[-182,110],[-195,-318],[-125,334],[125,300],[189,-13],[180,229]],[[89242,75658],[221,-1044],[-270,-674],[-16,-572],[-132,-631],[77,-311],[-254,-481],[-41,234],[-435,-346],[-377,15],[-207,-546],[-257,32],[63,410],[-287,104],[-280,-211],[-646,-185],[-7,203],[575,690],[422,77],[333,-120],[255,1009],[158,145],[44,-313],[219,113],[330,568],[171,769],[-53,625],[192,276],[202,164]],[[89448,78021],[260,142],[216,-915],[474,-33],[-21,-435],[-478,-369],[-115,-420],[-429,272],[-239,-116],[56,-299],[-226,-163],[-92,727],[359,275],[235,1334]],[[72335,57431],[266,-707],[143,-665],[-55,-498],[-303,-310],[-203,509],[-64,1337],[216,334]],[[63708,44875],[164,-544],[151,-1387],[-71,-304],[-164,245],[58,-580],[-97,-717],[-444,-2698],[-215,-1413],[-553,-374],[-307,337],[-90,341],[14,549],[-148,702],[79,533],[270,804],[-149,1416],[253,708],[379,299],[209,293],[493,1029],[66,621],[102,140]],[[56347,96975],[270,-168],[-387,-552],[-419,190],[-159,469],[425,204],[270,-143]],[[54672,97846],[1164,-634],[-561,-177],[-606,-1095],[-859,692],[-836,1033],[1067,144],[500,-516],[131,553]],[[56428,98137],[1113,-303],[-860,-384],[-579,-35],[-936,561],[1262,161]],[[98028,28506],[117,-328],[210,74],[59,-449],[-521,-1156],[-298,-312],[-179,-938],[-296,-387],[-338,-13],[-536,457],[189,866],[712,426],[386,560],[273,982],[222,218]],[[98077,32018],[414,-681],[69,-708],[327,-466],[333,-209],[221,260],[159,-100],[-194,-795],[-266,-201],[-20,-421],[-418,-825],[-148,136],[93,482],[-85,365],[-316,243],[247,370],[76,619],[-230,862],[-375,1030],[113,39]],[[84900,57375],[182,-120],[46,-676],[41,-549],[-113,-563],[-82,449],[-145,-179],[89,-356],[-89,-332],[-175,4],[-253,460],[-16,675],[-160,-132],[-185,70],[-169,-267],[98,593],[408,345],[107,-124],[176,320],[208,45],[32,337]],[[84241,58162],[85,-88],[-151,-1031],[-177,462],[134,162],[109,495]],[[84443,58219],[43,-467],[-171,-321],[128,788]],[[83282,58448],[43,-482],[-273,-475],[-106,-348],[-392,-504],[451,1072],[112,215],[165,522]],[[84567,58432],[150,-38],[68,-649],[-125,-59],[-93,746]],[[83971,58613],[263,-59],[-153,-622],[-207,-84],[97,765]],[[84699,59074],[161,-180],[19,-565],[-89,-101],[-270,830],[179,16]],[[83659,59544],[160,-343],[-141,-327],[-246,751],[227,-81]],[[83585,62533],[316,-12],[134,-838],[-83,-445],[-181,-223],[-55,-359],[98,-641],[161,-82],[44,169],[236,-100],[181,-255],[-94,-127],[223,-349],[-242,-50],[-157,345],[-86,-108],[-238,262],[-112,-15],[-223,89],[1,337],[-153,235],[-75,900],[136,-201],[9,886],[160,582]],[[93002,48680],[307,-595],[-55,-205],[-267,533],[15,267]],[[92286,49425],[-37,-729],[-251,-394],[-435,-92],[-346,302],[13,191],[470,-50],[437,410],[-43,370],[192,-8]],[[91956,50277],[303,-193],[252,-570],[-40,-468],[-70,475],[-176,353],[-219,169],[-50,234]],[[31357,62525],[455,-87],[54,-142],[-80,-170],[-435,57],[-42,228],[48,114]],[[94913,46056],[118,-240],[-56,-154],[-125,107],[-44,207],[107,80]],[[94337,46438],[132,85],[193,-217],[38,-229],[-145,-43],[-157,164],[-61,240]],[[94666,47024],[114,-119],[47,-543],[-142,205],[-19,457]],[[94053,47469],[458,-399],[1,-245],[-385,370],[-74,274]],[[33272,58060],[-85,-539],[-204,216],[-37,386],[326,-63]],[[83787,66367],[48,-241],[-68,-941],[-136,-708],[-133,-29],[-149,725],[36,360],[242,734],[160,100]],[[6742,63469],[205,-219],[275,-342],[-175,-159],[-202,235],[-183,213],[-287,313],[367,-41]],[[4512,83553],[108,-171],[-442,-103],[334,274]],[[12908,84435],[313,-255],[234,-352],[-31,-196],[-353,371],[-163,432]],[[12315,84877],[310,-141],[276,-621],[-586,762]],[[7496,85205],[11,-237],[-319,-447],[-168,396],[476,288]],[[12301,85378],[249,-428],[-444,201],[195,227]],[[12379,85439],[298,-197],[322,-587],[-211,25],[-409,759]],[[3863,86662],[217,-346],[-249,-86],[-430,401],[462,31]],[[2313,88585],[873,-293],[3,-393],[-631,335],[-245,351]],[[96374,43185],[132,-419],[104,-261],[-156,31],[-75,263],[-104,114],[-48,360],[147,-88]],[[26712,78420],[548,-134],[-6,-303],[-587,390],[45,47]],[[32128,78941],[294,-276],[362,-69],[-158,-278],[-432,256],[-66,367]],[[33194,78911],[192,-479],[-163,-304],[-142,-68],[-176,297],[289,554]],[[32185,80609],[625,-343],[-101,-165],[-372,186],[-152,322]],[[34527,81397],[132,-264],[-126,-465],[-3,-359],[172,-75],[146,133],[303,-165],[-125,-389],[187,-46],[-9,-310],[80,-169],[10,-498],[-171,-100],[-196,301],[-275,-128],[-194,-8],[54,366],[-932,12],[-80,184],[198,416],[359,1069],[213,292],[257,203]],[[27379,82581],[256,-343],[-153,-81],[-277,222],[174,202]],[[13140,82904],[235,-48],[260,-414],[232,-385],[-328,238],[-166,187],[-233,422]],[[27295,88162],[-285,-458],[-318,129],[304,342],[299,-13]],[[26253,89737],[961,-529],[510,-617],[-230,-206],[-406,136],[-148,291],[-280,-118],[-247,-539],[-196,360],[-299,146],[206,309],[129,767]],[[29045,91417],[131,-317],[-25,-312],[-299,37],[-251,286],[0,376],[113,179],[331,-249]],[[22491,92265],[926,-399],[-482,-331],[-599,55],[155,675]],[[18279,94063],[1005,-215],[1040,213],[65,234],[481,-333],[74,-533],[295,-926],[378,-402],[102,-516],[-428,-124],[-850,229],[-1269,-368],[-658,25],[-290,366],[-439,42],[-408,397],[905,188],[732,-27],[-539,238],[-1138,-44],[-222,240],[634,204],[-819,144],[-22,210],[650,386],[721,372]],[[27482,94373],[764,9],[462,-466],[-394,69],[-565,-177],[-267,565]],[[25956,94378],[446,-108],[-485,-490],[197,-452],[452,736],[787,234],[290,-884],[801,331],[667,-149],[433,-387],[324,-102],[1142,-613],[346,-492],[125,-314],[209,-571],[511,-331],[606,-426],[-195,-700],[-402,-243],[-375,427],[-408,322],[-114,-516],[658,-867],[77,-708],[-498,55],[-486,186],[1009,-915],[-224,-128],[-1011,514],[-793,618],[-379,421],[-447,30],[-352,-39],[-539,140],[-129,455],[291,131],[617,-119],[348,85],[-142,430],[589,560],[-179,643],[-748,605],[-983,628],[-704,-146],[-106,-172],[-1146,166],[-673,203],[-392,836],[292,769],[693,347]],[[22269,94402],[714,-20],[-69,-406],[248,-233],[15,-483],[-599,-370],[-873,647],[503,328],[-438,304],[499,233]],[[24237,94511],[708,-106],[-192,-607],[-520,-214],[-102,-496],[-416,338],[-173,1041],[695,44]],[[16227,94782],[1310,-270],[429,-349],[-1372,-714],[-104,-432],[-685,-234],[-747,498],[560,1046],[-273,336],[882,119]],[[23779,95386],[361,-517],[-359,-44],[-497,293],[-239,579],[734,-311]],[[22664,95998],[286,-569],[-182,-376],[-638,-7],[-639,279],[-179,553],[538,204],[814,-84]],[[19814,96089],[911,-671],[-172,-348],[-782,9],[-1167,-389],[-390,65],[-856,399],[-147,316],[844,385],[558,-84],[484,-433],[366,163],[-125,286],[476,302]],[[23545,96198],[1054,-185],[843,-512],[1298,13],[1135,-206],[71,-341],[-665,-241],[-2267,43],[-547,242],[-297,513],[-760,379],[135,295]],[[17743,96462],[64,-446],[-1102,-483],[-712,42],[871,781],[879,106]],[[19554,96808],[128,-339],[-824,-92],[-314,334],[1010,97]],[[23271,97132],[547,-621],[-972,170],[-288,480],[713,-29]],[[19065,97493],[407,-412],[-848,-168],[441,580]],[[21206,97538],[1139,-427],[150,-406],[-1369,201],[80,632]],[[23681,99139],[1904,-1311],[-434,-968],[-708,28],[-1281,963],[-170,965],[689,323]],[[30642,99713],[1386,-119],[940,-411],[-938,-464],[-2356,-1067],[-555,-75],[17,-595],[-847,-477],[108,-509],[-1914,89],[-210,-287],[-971,52],[-293,440],[848,54],[-159,495],[243,393],[182,322],[-496,668],[-853,687],[2250,380],[316,236],[3302,188]],[[14497,80889],[115,142],[394,-305],[277,-85],[408,-527],[123,-415],[-327,56],[-337,272],[-354,449],[-299,413]],[[95422,40299],[150,-7],[353,-411],[109,-304],[409,-512],[-47,-211],[-624,659],[-350,786]],[[80745,63447],[155,-128],[-135,-346],[-37,-371],[-269,-333],[-267,228],[-19,444],[207,297],[190,117],[175,92]]],bbox:[-179.9999885408,-89.999999,179.9999885408,83.61347077],transform:{scale:[.0036000357711737114,.001736152059220592],translate:[-179.9999885408,-89.999999]}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hatanoRaw=y,t.winkel1Raw=function(e){var t=i(e);function n(e,n){var a=e,r=n;return[.5*a*(t+i(n)),r]}return n.invert=function(e,n){var a=n;return[2*e/(t+i(a)),a]},n};var a=Math.sin,r=Math.asin,o=Math.abs,i=Math.cos,l=20,s=1e-7,p=2.67595,c=2.43763,d=1.75859,_=1.93052,u=.85,m=Math.PI/2;function y(e,t){var n=a(t)*(t<0?c:p),r=t,m=void 0,y=void 0;for(y=l;y&&(r-=m=(r+a(r)-n)/(1+i(r)),!(o(m)<s));--y);return[u*e*i(r*=.5),a(r)*(r<0?_:d)]}y.invert=function(e,t){var n=e,l=t,s=l*(l<0?.5179951515653813:.5686373742600607);if(o(s)>1){if(o(s)>1.000001)return console.log("Error"),[NaN,NaN];s=s>0?m:-m}else s=r(s);if(n=1.1764705882352942*n/i(s),l=((s+=s)+a(s))*(l<0?.4102345310814193:.3736990601468637),o(l)>1){if(o(l)>1.000001)return console.log("Error"),[NaN,NaN];l=l>0?m:-m}else l=r(l);return[n,l]}},function(e,n,a){"use strict";(function(e){Object.defineProperty(n,"__esModule",{value:!0});var r=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,r=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(a=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(r)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();n.get_map_template=m,n.save_map_template=function(){_app.waitingOverlay.display(),m().then(function(e){var t="data:text/json;charset=utf-8,"+encodeURIComponent(e);_app.waitingOverlay.hide(),(0,p.clickLinkFromDataUrl)(t,"magrit_project.json")})},n.load_map_template=function(){d3.select(document.createElement("input")).attrs({type:"file",name:"file",accept:".json"}).on("change",function(){var e,t,n;e=d3.event,t=e.target.files[0],(n=new FileReader).onloadend=function(){v(n.result)},n.readAsText(t)}).node().dispatchEvent(new MouseEvent("click"))},n.apply_user_preferences=v;var o=a(8),i=a(16),l=a(2),p=a(3),c=a(17),d=a(23),_=a(18);function u(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function m(){var t=function(e,t){var n=[],a=e.length;if("circle"===t)for(var r=0;r<a;r++)n.push({cx:e[r].getAttribute("cx"),cy:e[r].getAttribute("cy")});else for(var o=0;o<a;o++)n.push({x:e[o].getAttribute("x"),y:e[o].getAttribute("y")});return n},n=function(e){for(var t=[],n=e.length,a=0;a<n;a++)t.push(e[a].getAttribute("transform"));return t},a=function(e){var t=e.id,n="true"===e.getAttribute("visible_rect")?{color:e.querySelector("#under_rect").style.fill,opacity:e.querySelector("#under_rect").style.fillOpacity}:void 0,a={type:t,display:e.getAttribute("display"),transform:e.getAttribute("transform"),field:e.getAttribute("layer_field"),rounding_precision:e.getAttribute("rounding_precision"),rect_fill_value:n,title:e.querySelector("#legendtitle").innerHTML,subtitle:e.querySelector("#legendsubtitle").innerHTML,bottom_note:e.querySelector("#legend_bottom_note").innerHTML};if("legend_root"===t||"legend_root_horiz"===t){a.boxgap=e.getAttribute("boxgap");var r=e.querySelector("#no_data_txt");r&&(a.no_data_txt=r.innerHTML)}else if("legend_root_symbol"===t)a.nested_symbols=e.getAttribute("nested"),a.join_line=e.getAttribute("join_line");else if("legend_root_waffle"===t){var o=e.getAttribute("layer_name");a.field=current_layers[o].rendered_field,a.ratio_txt=e.querySelector("#ratio_txt").innerHTML}return a},r={},i=[],l=map.selectAll("g.layer"),s=document.getElementById("map_title"),p=document.querySelectorAll(".legend:not(.title):not(.legend_feature)"),c=d3.zoomTransform(svg_map);if(r.projection=current_proj_name,"def_proj4"===current_proj_name&&(r.custom_projection=_app.last_projection),r.projection_scale=proj.scale(),r.projection_translate=proj.translate(),r.projection_center=proj.center(),r.projection_rotation=void 0!==proj.rotate?proj.rotate():void 0,r.projection_parallels=void 0!==proj.parallels?proj.parallels():void 0,r.projection_parallel=void 0!==proj.parallel?proj.parallel():void 0,r.zoom_translate=[c.x,c.y],r.zoom_scale=c.k,r.div_width=+w,r.div_height=+h,r.n_layers=l._groups[0].length,r.background_color=map.style("background-color"),r.canvas_rotation="string"==typeof canvas_rotation_value?canvas_rotation_value.match(/\d+/):void 0,r.custom_palettes=Array.from(_app.custom_palettes.entries()),s&&(r.title={content:s.textContent,x:s.getElementsByTagName("text")[0].getAttribute("x"),y:s.getElementsByTagName("text")[0].getAttribute("y"),style:s.getElementsByTagName("text")[0].getAttribute("style")}),joined_dataset.length>0&&0===field_join_map.length&&(r.joined_dataset=joined_dataset[0],r.dataset_name=dataset_name),r.global_order=Array.from(svg_map.querySelectorAll(".legend,.layer")).map(function(e){return["#",e.id,".",e.className.baseVal.split(" ").join(".")].join("")}),r.layout_features={},p)for(var m=0;m<p.length;m++){var y=p[m];if("scale_bar"===y.id)r.layout_features.scale_bar={bar_size:_.scaleBar.bar_size,displayed:_.scaleBar.displayed,dist:_.scaleBar.dist,dist_txt:_.scaleBar.dist_txt,fixed_size:_.scaleBar.fixed_size,precision:_.scaleBar.precision,unit:_.scaleBar.unit,x:_.scaleBar.x,y:_.scaleBar.y,transform:_.scaleBar.Scale._groups[0][0].getAttribute("transform")||""};else if("north_arrow"===y.id){var g=d.northArrow.arrow_img._groups[0][0];r.layout_features.north_arrow={arrow_img:y.getAttribute("href"),displayed:d.northArrow.displayed,x_img:g.getAttribute("x"),y_img:g.getAttribute("y"),x_center:d.northArrow.x_center,y_center:d.northArrow.y_center,size:g.getAttribute("width")}}else if(y.classList.contains("user_ellipse")){r.layout_features.user_ellipse||(r.layout_features.user_ellipse=[]);var f=y.childNodes[0];r.layout_features.user_ellipse.push({rx:f.getAttribute("rx"),ry:f.getAttribute("ry"),cx:f.getAttribute("cx"),cy:f.getAttribute("cy"),stroke:f.style.stroke,stroke_width:f.style.strokeWidth,id:y.id})}else if(y.classList.contains("user_rectangle")){r.layout_features.user_rectangle||(r.layout_features.user_rectangle=[]);var v=y.childNodes[0];r.layout_features.user_rectangle.push({x:v.getAttribute("x"),y:v.getAttribute("y"),rx:v.getAttribute("rx"),ry:v.getAttribute("ry"),width:v.getAttribute("width"),height:v.getAttribute("height"),style:v.getAttribute("style"),id:y.id})}else if(y.classList.contains("arrow")){r.layout_features.arrow||(r.layout_features.arrow=[]);var b=y.childNodes[0];r.layout_features.arrow.push({stroke_width:b.style.strokeWidth,stroke:b.style.stroke,pt1:[b.x1.baseVal.value,b.y1.baseVal.value],pt2:[b.x2.baseVal.value,b.y2.baseVal.value],id:y.id,marker_head:b.getAttribute("marker-end")})}else if(y.classList.contains("txt_annot")){r.layout_features.text_annot||(r.layout_features.text_annot=[]);var x=y.querySelector("text");r.layout_features.text_annot.push({id:y.id,content:Array.prototype.map.call(x.querySelectorAll("tspan"),function(e){return e.innerHTML}).join("\n"),style:x.getAttribute("style"),position_x:x.getAttribute("x"),position_y:x.getAttribute("y"),transform:x.getAttribute("transform")})}else if(y.classList.contains("single_symbol")){r.layout_features.single_symbol||(r.layout_features.single_symbol=[]);var k=y.childNodes[0];r.layout_features.single_symbol.push({id:y.id,x:k.getAttribute("x"),y:k.getAttribute("y"),width:k.getAttribute("width"),height:k.getAttribute("height"),href:k.getAttribute("href"),scalable:y.classList.contains("scalable-legend")})}}for(var A=r.n_layers-1;A>-1;--A){i[A]={};var S=i[A],E=l._groups[0][A].id,z=_app.id_to_layer.get(E),B=current_layers[z],P=!B.sphere?B.graticule?"graticule":"layer":"sphere",O=B.n_features,C=void 0;S.layer_name=z,S.layer_type=P,S.n_features=O,S.visible="hidden"!==l._groups[0][A].style.visibility?"":"hidden";var M=document.getElementsByClassName("lgdf_"+E);if(0===M.length?S.legend=void 0:1===M.length?S.legend=[a(M[0])]:2===M.length&&(S.legend="legend_root"===M[0].id?[a(M[0]),a(M[1])]:[a(M[1]),a(M[0])]),map.select("#"+E).attr("filter")&&(S.filter_shadow=!0),B["stroke-width-const"]&&(S["stroke-width-const"]=B["stroke-width-const"]),void 0!==B.pointRadius&&(S.pointRadius=B.pointRadius),void 0!==B.fixed_stroke&&(S.fixed_stroke=B.fixed_stroke),B.colors_breaks&&(S.colors_breaks=B.colors_breaks),void 0!==B.options_disc&&(S.options_disc=B.options_disc),B.targeted)C=map.select("#"+E).selectAll("path"),S.fill_opacity=C.style("fill-opacity"),S.targeted=!0,S.topo_geom=!0,S.fill_color=B.fill_color,S.fields_type=B.fields_type,S.stroke_color=C.style("stroke");else if("sphere"===P||"graticule"===P||"World"===z)C=map.select("#"+E).selectAll("path"),S.fill_color=(0,o.rgb2hex)(C.style("fill")),S.stroke_color=(0,o.rgb2hex)(C.style("stroke")),"graticule"===P&&(S.stroke_dasharray=current_layers.Graticule.dasharray,S.step=current_layers.Graticule.step);else if(B.renderer)if(B.renderer.indexOf("PropSymbols")>-1&&"Line"!==B.type){var I=B.symbol;C=map.select("#"+E).selectAll(I);var q=Array.prototype.map.call(svg_map.querySelector("#"+E).getElementsByTagName(I),function(e){return e.__data__});S.symbol=I,S.size_legend_symbol=B.size_legend_symbol,S.rendered_field=B.rendered_field,B.rendered_field2&&(S.rendered_field2=B.rendered_field2),S.current_position=t(C._groups[0],I),S.renderer=B.renderer,S.size=B.size,S.fill_color=B.fill_color,S.stroke_color=C.style("stroke"),S.ref_layer_name=B.ref_layer_name,S.geo_pt={type:"FeatureCollection",features:q},"PropSymbolsTypo"===B.renderer&&(S.color_map=[].concat(u(B.color_map))),B.break_val&&(S.break_val=B.break_val)}else if((B.renderer.indexOf("PropSymbols")>-1||"LinksProportional"===B.renderer)&&"Line"===B.type){var L=B.symbol;C=map.select("#"+E).selectAll("path");var T=Array.prototype.map.call(svg_map.querySelector("#"+E).getElementsByTagName("path"),function(e){return e.__data__});S.symbol=L,S.rendered_field=B.rendered_field,B.rendered_field2&&(S.rendered_field2=B.rendered_field2),S.renderer=B.renderer,S.size=B.size,S.fill_color=B.fill_color,S.ref_layer_name=B.ref_layer_name,S.geo_line={type:"FeatureCollection",features:T},"PropSymbolsTypo"===B.renderer&&(S.color_map=[].concat(u(B.color_map))),B.break_val&&(S.break_val=B.break_val)}else if(["Stewart","Gridded","Choropleth","Categorical","Carto_doug","OlsonCarto"].indexOf(B.renderer)>-1)!function(){C=map.select("#"+E).selectAll("path"),S.renderer=B.renderer,S.topo_geom=!0,S.fill_color=B.fill_color,S.stroke_color=C.style("stroke"),S.rendered_field=B.rendered_field,S.ref_layer_name=B.ref_layer_name;var e=[],t="Line"===B.type?"stroke":"fill";C.each(function(){e.push((0,o.rgb2hex)(this.style[t]))}),S.color_by_id=e,"Categorical"!==B.renderer?S.options_disc=B.options_disc:S.color_map=[].concat(u(B.color_map)),"Stewart"===B.renderer?S.color_palette=B.color_palette:"OlsonCarto"===B.renderer&&(S.scale_max=B.scale_max,S.scale_byFeature=B.scale_byFeature)}();else if("LinksGraduated"===B.renderer||"DiscLayer"===B.renderer)C=map.select("#"+E).selectAll("path"),S.renderer=B.renderer,S.fill_color=B.fill_color,S.topo_geom=!0,S.rendered_field=B.rendered_field,S.ref_layer_name=B.ref_layer_name,S.size=B.size,S.min_display=B.min_display,S.breaks=B.breaks,"LinksGraduated"===B.renderer&&(S.linksbyId=B.linksbyId.slice(0,O));else if("TypoSymbols"===B.renderer){C=map.select("#"+E).selectAll("image"),S.renderer=B.renderer,S.symbols_map=[].concat(u(B.symbols_map)),S.rendered_field=B.rendered_field,S.ref_layer_name=B.ref_layer_name;for(var N=[],F=C._groups[0],G=0;G<F.length;G++){var D=F[G];N.push({display:D.style.display,data:D.__data__,pos:[D.getAttribute("x"),D.getAttribute("y")],size:D.getAttribute("width")})}S.current_state=N}else if("Label"===B.renderer){C=map.select("#"+E).selectAll("text");var R=document.getElementById(E).getElementsByTagName("text");S.renderer=B.renderer,S.rendered_field=B.rendered_field,S.default_font=B.default_font,S.default_size=+B.default_size.slice(0,2),S.fill_color=B.fill_color;for(var W=[],H=[],V=R.length-1;V>-1;V--){var U=R[V];W.push(U.__data__),H.push([+U.getAttribute("x"),+U.getAttribute("y"),U.style.display,U.style.fontSize,U.style.fontFamily,U.style.fill,U.textContent])}S.data_labels=W,S.current_position=H}else if("TwoStocksWaffle"===B.renderer){var Y=B.symbol;C=map.select("#"+E).selectAll(Y),S.symbol=Y,S.rendered_field=B.rendered_field,S.renderer=B.renderer,S.size=B.size,S.fill_color=B.fill_color,S.ratio=B.ratio,S.nCol=B.nCol,S.ref_layer_name=B.ref_layer_name,S.result_data=JSON.stringify(result_data[z]),S.current_position=n(svg_map.querySelectorAll("#"+E+" > g"))}else C=map.select("#"+E).selectAll("path");else C=map.select("#"+E).selectAll("path"),S.fill_opacity=C.style("fill-opacity"),S.fill_color=B.fill_color,S.topo_geom=!0,S.stroke_color=C.style("stroke");S.stroke_opacity=C.style("stroke-opacity"),S.fill_opacity=C.style("fill-opacity")}return e.all(i.map(function(e){return e.topo_geom?j(e.layer_name):null})).then(function(e){for(var t=0;t<i.length;t++)e[t]&&(i[t].topo_geom=e[t]);return JSON.stringify({map_config:r,layers:i,info:{version:_app.version}})})}function y(e){swal({title:i18next.t("app_page.common.error")+"!",text:""+i18next.t("app_page.common.error_map_project")+(e||"Unknown"),type:"error",allowOutsideClick:!1})}var g=function(e){if(!e||!e.version)return{app_version:void 0,p_version:void 0};var t=e.version,n=t.split(".");return{app_version:t,p_version:{major:n[0],minor:n[1],patch:n[2]}}},f=function(){for(var e=Object.getOwnPropertyNames(current_layers),t=0,n=e.length;t<n;t++)(0,l.remove_layer_cleanup)(e[t]);for(var a=svg_map.childNodes,r=a.length,o=r-1;o>-1;o--)a[o].remove();for(var i=(r=(a=layer_list.node().childNodes).length)-1;i>-1;i--)a[i].remove();current_layers={}};function v(e){var n=(0,p.isValidJSON)(e),a=r(n,2),u=a[0],m=a[1];if(u){var v=m.map_config,j=m.layers;if(j&&v){var S=g(m.info),E=S.app_version,z=S.p_version;f(),_app.waitingOverlay.display({cancel_button:!1}),window.fields_handler&&clean_menu_function(),(0,i.reset_user_values)();var B=function(e,t,n){var a=map.select("#"+e).selectAll(n);"circle"===n?a.attrs(function(e,n){return{cx:t[n].cx,cy:t[n].cy}}):a.attrs(function(e,n){return{x:t[n].x,y:t[n].y}})},P=function(e,t,n){map.select("#"+e).selectAll("g").attr("transform",function(e,n){return t[n]})},O=function(){setTimeout(function(){var e=svg_map.__zoom;if(e.k=v.zoom_scale,e.x=v.zoom_translate[0],e.y=v.zoom_translate[1],zoom_without_redraw(),s=v.projection_scale,t=v.projection_translate,proj.scale(s).translate(t),v.projection_rotation&&(proj=proj.rotate(v.projection_rotation)),path=d3.geoPath().projection(proj).pointRadius(4),map.selectAll(".layer").selectAll("path").attr("d",path),handleClipPath(current_proj_name),reproj_symbol_layer(),function(){if(v.title){handle_title(v.title.content);var e=document.getElementById("map_title").getElementsByTagName("text")[0];e.setAttribute("x",v.title.x),e.setAttribute("y",v.title.y),e.setAttribute("style",v.title.style),document.querySelector("input#title.list_elem_section4").value=v.title.content}if(v.layout_features){if(v.layout_features.scale_bar&&(_.scaleBar.create(),_.scaleBar.bar_size=v.layout_features.scale_bar.bar_size,_.scaleBar.displayed=v.layout_features.scale_bar.displayed,_.scaleBar.dist=v.layout_features.scale_bar.dist,_.scaleBar.dist_txt=v.layout_features.scale_bar.dist_txt,_.scaleBar.fixed_size=v.layout_features.scale_bar.fixed_size,_.scaleBar.precision=v.layout_features.scale_bar.precision,_.scaleBar.x=v.layout_features.scale_bar.x,_.scaleBar.y=v.layout_features.scale_bar.y,_.scaleBar.Scale._groups[0][0].setAttribute("transform",v.layout_features.scale_bar.transform),!1===_.scaleBar.fixed_size?_.scaleBar.update():_.scaleBar.resize()),v.layout_features.north_arrow&&(d.northArrow.display(),d.northArrow.arrow_img._groups[0][0].setAttribute("x",v.layout_features.north_arrow.x_img),d.northArrow.arrow_img._groups[0][0].setAttribute("y",v.layout_features.north_arrow.y_img),d.northArrow.arrow_img._groups[0][0].setAttribute("width",v.layout_features.north_arrow.size),d.northArrow.arrow_img._groups[0][0].setAttribute("height",v.layout_features.north_arrow.size),d.northArrow.under_rect._groups[0][0].setAttribute("x",v.layout_features.north_arrow.x_img-7.5),d.northArrow.under_rect._groups[0][0].setAttribute("y",v.layout_features.north_arrow.y_img-7.5),d.northArrow.x_center=v.layout_features.north_arrow.x_center,d.northArrow.y_center=v.layout_features.north_arrow.y_center,d.northArrow.displayed=v.layout_features.north_arrow.displayed),v.layout_features.arrow)for(var t=0;t<v.layout_features.arrow.length;t++){var n=v.layout_features.arrow[t],a=new UserArrow(n.id,n.pt1,n.pt2,svg_map,!0),r=a.arrow.select("line").node();a.hide_head=null===v.layout_features.arrow[t].marker_head,r.setAttribute("marker-end",v.layout_features.arrow[t].marker_head),r.style.stroke=v.layout_features.arrow[t].stroke,r.style.strokeWidth=v.layout_features.arrow[t].stroke_width}if(v.layout_features.user_ellipse)for(var o=0;o<v.layout_features.user_ellipse.length;o++){var i=v.layout_features.user_ellipse[o],l=new UserEllipse(i.id,[i.cx,i.cy],svg_map,!0),s=l.ellipse.node().querySelector("ellipse");s.setAttribute("rx",i.rx),s.setAttribute("ry",i.ry),s.style.stroke=i.stroke,s.style.strokeWidth=i.stroke_width}if(v.layout_features.user_rectangle)for(var p=0;p<v.layout_features.user_rectangle.length;p++){var c=v.layout_features.user_rectangle[p],u=new UserRectangle(c.id,[c.x,c.y],svg_map,!0),m=u.rectangle.node().querySelector("rect");m.setAttribute("rx",c.rx),m.setAttribute("ry",c.ry),m.setAttribute("height",c.height),m.setAttribute("width",c.width),m.setAttribute("style",c.style)}if(v.layout_features.text_annot)for(var y=0;y<v.layout_features.text_annot.length;y++){var g=v.layout_features.text_annot[y],f=new Textbox(svg_map,g.id,[g.position_x,g.position_y]);f.textAnnot.node().setAttribute("style",g.style),f.textAnnot.attrs({transform:g.transform,x:g.position_x,y:g.position_y}).selectAll("tspan").attrs({x:g.position_x,y:g.position_y}),f.fontSize=+g.style.split("font-size: ")[1].split("px")[0],f.fontFamily=(g.style.split("font-family: ")[1].split(";")[0]||"").replace(", ",","),f.updateLineHeight(),f.update_text(g.content)}if(v.layout_features.single_symbol)for(var h=0;h<v.layout_features.single_symbol.length;h++){var b=v.layout_features.single_symbol[h],x=add_single_symbol(b.href,b.x,b.y,b.width,b.height,b.id);if(b.scalable){var w=x.node().parentElement;w.classList.add("scalable-legend"),w.setAttribute("transform",["translate(",v.zoom_translate[0],",",v.zoom_translate[1],") scale(",v.zoom_scale,",",v.zoom_scale,")"].join(""))}}}}(),v.global_order){if(z.minor<=4){if(k(v.global_order),j.length>1){var n=j.map(function(e){return e.layer_name});x(n),n.reverse(),b(n)}}else if(v.global_order&&v.global_order.length>1&&(z.minor>4||4===z.minor&&z.patch>1)){x(j.map(function(e){return e.layer_name})),k(v.global_order)}}else if(j.length>1){var a=j.map(function(e){return e.layer_name});x(a),a.reverse(),b(a)}v.canvas_rotation&&(document.getElementById("form_rotate").value=v.canvas_rotation,document.getElementById("canvas_rotation_value_txt").value=v.canvas_rotation,rotate_global(v.canvas_rotation)),_app.waitingOverlay.hide();var r=Object.getOwnPropertyNames(user_data)[0];r&&getAvailablesFunctionnalities(r);for(var o=0;o<C.length;o++)C[o][0](C[o][1],C[o][2],C[o][3])},150)},C=[],M=0,I=new Map([["LinksGraduated","flow"],["Carto_doug","cartogram"],["OlsonCarto","cartogram"],["Stewart","smooth"],["Gridded","grid"],["DiscLayer","discont"],["Choropleth","choro"],["Categorical","typo"]]);if(w=+v.div_width,h=+v.div_height,(0,l.canvas_mod_size)([w,h]),document.getElementById("input-width").value=w,document.getElementById("input-height").value=h,_app.custom_palettes=new Map(v.custom_palettes),current_proj_name=v.projection.replace(/ /g,""),v.custom_projection){proj=getD3ProjFromProj4(proj4(v.custom_projection)),_app.last_projection=v.custom_projection;var q=Object.keys(_app.epsg_projections).map(function(e){return[e,_app.epsg_projections[e]]}).filter(function(e){return e[1].proj4===_app.last_projection});q=q&&q.length>0&&q[0].length>1?q[0][1].name:void 0,addLastProjectionSelect(current_proj_name,_app.last_projection,q)}else proj=d3[c.available_projections.get(current_proj_name).name](),addLastProjectionSelect(current_proj_name);v.projection_parallels&&(proj=proj.parallels(v.projection_parallels)),v.projection_parallel&&(proj=proj.parallel(v.projection_parallel)),v.projection_clipAngle&&(proj=proj.clipAngle(v.projection_clipAngle)),s=v.projection_scale,t=v.projection_translate,proj.scale(s).translate(t),v.projection_rotation&&(proj=proj.rotate(v.projection_rotation)),defs=map.append("defs"),path=d3.geoPath().projection(proj).pointRadius(4),map.selectAll(".layer").selectAll("path").attr("d",path),map.style("background-color",v.background_color),document.querySelector("input#bg_color").value=(0,o.rgb2hex)(v.background_color),v.joined_dataset&&(field_join_map=[],joined_dataset=[v.joined_dataset.slice()],dataset_name=v.dataset_name,update_menu_dataset());for(var L=function(e){var t=j[e],n=t.layer_name,a=t.layer_type,r=void 0;(void 0===E||0===z.major&&z.minor<=3&&z.patch<3)&&("Sphere"===n?a="sphere":"Graticule"===n&&(a="graticule"));var o=t.fill_opacity,i=t.stroke_opacity;if(t.topo_geom){var l={skip_alert:!0,choosed_name:n,skip_rescale:!0};t.targeted?l.target_layer_on_add=!0:t.renderer&&(l.func_name=I.get(t.renderer),l.result_layer_on_add=!0),void 0!==t.pointRadius&&(l.pointRadius=t.pointRadius),n=handle_reload_TopoJSON(t.topo_geom,l);var s=current_layers[n];t.renderer&&(s.renderer=t.renderer),t.targeted&&t.fields_type&&(s.fields_type=t.fields_type,document.getElementById("btn_type_fields").removeAttribute("disabled")),r=_app.layer_to_id.get(n);var p=map.select("#"+r);if(s.rendered_field=t.rendered_field,t.ref_layer_name&&(s.ref_layer_name=t.ref_layer_name),t.size&&(s.size=t.size),t.colors_breaks&&(s.colors_breaks=t.colors_breaks),t.options_disc&&(s.options_disc=t.options_disc),t.fill_color&&(s.fill_color=t.fill_color),t.color_palette&&(s.color_palette=t.color_palette),t.renderer){if(["Choropleth","Stewart","Gridded"].indexOf(t.renderer)>-1)p.selectAll("path").style("Line"===s.type?"stroke":"fill",function(e,n){return t.color_by_id[n]});else if("LinksGraduated"===t.renderer)s.linksbyId=t.linksbyId,s.min_display=t.min_display,s.breaks=t.breaks,p.selectAll("path").styles(function(e,n){return{display:+e.properties.fij>t.min_display?null:"none",stroke:t.fill_color.single,"stroke-width":s.linksbyId[n][2]}});else if("DiscLayer"===t.renderer){s.min_display=t.min_display||0,s.breaks=t.breaks;var c=0!==s.min_display?s.min_display*current_layers[n].n_features:-1;p.selectAll("path").styles(function(e,n){return{fill:"none",stroke:t.fill_color.single,display:n<=c?null:"none","stroke-width":e.properties.prop_val}})}else t.renderer.startsWith("Categorical")&&render_categorical(n,{colorByFeature:t.color_by_id,color_map:new Map(t.color_map),rendered_field:t.rendered_field,renderer:"Categorical"});t.legend&&A(n,t.legend)}t.stroke_color&&p.selectAll("path").style("stroke",t.stroke_color),t["stroke-width-const"]&&(s["stroke-width-const"]=t["stroke-width-const"],p.style("stroke-width",t["stroke-width-const"])),t.fixed_stroke&&(s.fixed_stroke=t.fixed_stroke),t.fill_color&&t.fill_color.single&&"DiscLayer"!==t.renderer?p.selectAll("path").style("Line"!==s.type?"fill":"stroke",t.fill_color.single):t.fill_color&&t.fill_color.random&&p.selectAll("path").style("Line"!==s.type?"fill":"stroke",function(){return Colors.names[Colors.random()]}),p.selectAll("path").styles({"fill-opacity":o,"stroke-opacity":i}),"hidden"===t.visible&&handle_active_layer(n),t.filter_shadow&&createDropShadow(r),(M+=1)===v.n_layers&&O()}else if("World"===n)add_simplified_land_layer({skip_rescale:!0,fill:t.fill_color,stroke:t.stroke_color,fill_opacity:o,stroke_opacity:i,stroke_width:t["stroke-width-const"]+"px",visible:"hidden"!==t.visible,drop_shadow:t.filter_shadow}),(M+=1)===v.n_layers&&O();else{if("sphere"===a||"graticule"===a){var d={layer_name:n,stroke:t.stroke_color,fill_opacity:o,stroke_opacity:i,stroke_width:t["stroke-width-const"]+"px"};"graticule"===a?(d.fill="none",d.stroke_dasharray=t.stroke_dasharray,d.step=t.step):d.fill=t.fill_color,add_layout_feature(a,d),r=_app.layer_to_id.get(n)}else if(t.renderer&&(t.renderer.startsWith("PropSymbol")||"LinksProportional"===t.renderer)){var _=t.geo_line||t.geo_pt,u="path"===t.symbol?"line":t.symbol,m={new_name:n,field:t.rendered_field,ref_value:t.size[0],ref_size:t.size[1],symbol:u,nb_features:_.features.length,ref_layer_name:t.ref_layer_name,renderer:t.renderer};"PropSymbolsChoro"===t.renderer||"PropSymbolsTypo"===t.renderer?m.fill_color=t.fill_color.class:t.fill_color.random?m.fill_color="#fff":void 0!==t.fill_color.single?m.fill_color=t.fill_color.single:t.fill_color.two&&(m.fill_color=t.fill_color,m.break_val=t.break_val),"line"===t.symbol||"path"===t.symbol?make_prop_line(m,_):(make_prop_symbols(m,_),t.stroke_color&&map.select("#"+_app.layer_to_id.get(n)).selectAll(t.symbol).style("stroke",t.stroke_color)),"PropSymbolsTypo"===t.renderer&&(current_layers[n].color_map=new Map(t.color_map)),t.options_disc&&(current_layers[n].options_disc=t.options_disc),t.rendered_field2&&(current_layers[n].rendered_field2=t.rendered_field2),t.colors_breaks&&(current_layers[n].colors_breaks=t.colors_breaks),t.size_legend_symbol&&(current_layers[n].size_legend_symbol=t.size_legend_symbol),t.legend&&A(n,t.legend),current_layers[n]["stroke-width-const"]=t["stroke-width-const"],r=_app.layer_to_id.get(n);var y=map.select("#"+r).selectAll(t.symbol);y.styles({"stroke-width":t["stroke-width-const"]+"px","fill-opacity":o,"stroke-opacity":i}),t.fill_color.random&&y.style("fill",function(e){return Colors.names[Colors.random()]}),t.current_position&&C.push([B,r,t.current_position,t.symbol])}else if(t.renderer&&t.renderer.startsWith("Label")){var g={uo_layer_name:n,label_field:t.rendered_field,color:t.fill_color,ref_font_size:t.default_size,font:t.default_font};render_label(null,g,{data:t.data_labels,current_position:t.current_position}),r=_app.layer_to_id.get(n)}else if(t.renderer&&"TwoStocksWaffle"===t.renderer)render_twostocks_waffle(void 0,{nCol:t.nCol,ratio:t.ratio,symbol_type:t.symbol,new_name:n,size:t.size,ref_colors:t.fill_color,fields:t.rendered_field,result_data:t.result_data}),r=_app.layer_to_id.get(n),map.select("#"+r).selectAll(t.symbol).style("fill-opacity",t.fill_opacity),t.legend&&A(n,t.legend),t.current_position&&C.push([P,r,t.current_position,t.symbol]);else if(t.renderer&&t.renderer.startsWith("TypoSymbol")){var f=new Map(t.symbols_map),h={type:"FeatureCollection",features:t.current_state.map(function(e){return e.data})},b=h.features.length,x=new ContextMenu;r=encodeId(n),_app.layer_to_id.set(n,r),_app.id_to_layer.set(r,n),map.append("g").attrs({id:r,class:"layer"}).selectAll("image").data(h.features).enter().insert("image").attrs(function(e,n){var a=f.get(e.properties.symbol_field),r=t.current_state[n],o=r.pos;return{x:o[0]-a[1]/2,y:o[1]-a[1]/2,width:r.size,height:r.size,"xlink:href":a[0]}}).style("display",function(e,n){return t.current_state[n].display}).on("mouseover",function(){this.style.cursor="pointer"}).on("mouseout",function(){this.style.cursor="initial"}).on("contextmenu dblclick",function(){var e;x.showMenu(d3.event,document.querySelector("body"),(e=this,[{name:i18next.t("app_page.common.edit_style"),action:function(){make_style_box_indiv_symbol(e)}},{name:i18next.t("app_page.common.delete"),action:function(){e.style.display="none"}}]))}).call(drag_elem_geo),create_li_layer_elem(n,b,["Point","symbol"],"result"),current_layers[n]={n_features:b,renderer:"TypoSymbols",symbols_map:f,rendered_field:t.rendered_field,is_result:!0,symbol:"image",ref_layer_name:t.ref_layer_name},t.legend&&A(n,t.legend)}t.filter_shadow&&createDropShadow(r),"hidden"===t.visible&&"World"!==n&&handle_active_layer(n),(M+=1)===v.n_layers&&O()}},T=v.n_layers-1;T>-1;--T)L(T)}else y(i18next.t("app_page.common.error_invalid_map_project"))}else y(i18next.t("app_page.common.error_invalid_map_project")+m)}function b(e){var t=svg_map.querySelectorAll(".layer")[0].parentNode,n=e.length;e=e.map(function(e){return _app.layer_to_id.get(e)});for(var a=0;a<n;a++)document.getElementById(e[a])&&t.insertBefore(document.getElementById(e[a]),t.firstChild);svg_map.insertBefore(defs.node(),svg_map.childNodes[0])}function x(e){for(var t=document.getElementsByClassName("layer_list")[0],n=(t.childNodes,e.length),a=0;a<n;a++){var r="li."+_app.layer_to_id.get(e[a]);t.querySelector(r)&&t.insertBefore(t.querySelector(r),t.firstChild)}}function k(e){for(var t=svg_map.querySelectorAll(".legend,.layer")[0].parentNode,n=e.length,a=0;a<n;a++){var r=svg_map.querySelector(e[a]);r&&t.appendChild(r)}svg_map.insertBefore(defs.node(),svg_map.childNodes[0])}function A(e,t){for(var n=0;n<t.length;n++){var a=t[n];"legend_root"===a.type?createLegend_choro(e,a.field,a.title,a.subtitle,a.boxgap,a.rect_fill_value,a.rounding_precision,a.no_data_txt,a.bottom_note):"legend_root_symbol"===a.type?createLegend_symbol(e,a.field,a.title,a.subtitle,a.nested_symbols,a.join_line,a.rect_fill_value,a.rounding_precision,a.bottom_note):"legend_root_lines_class"===a.type?createLegend_discont_links(e,a.field,a.title,a.subtitle,a.rect_fill_value,a.rounding_precision,a.bottom_note):"legend_root_lines_symbol"===a.type?createLegend_line_symbol(e,a.field,a.title,a.subtitle,a.rect_fill_value,a.rounding_precision,a.bottom_note):"legend_root_waffle"===a.type?createLegend_waffle(e,a.field,a.title,a.subtitle,a.rect_fill_value,a.ratio_txt,a.bottom_note):"legend_root_horiz"===a.type&&createLegend_choro_horizontal(e,a.field,a.title,a.subtitle,a.boxgap,a.rect_fill_value,a.rounding_precision,a.no_data_txt,a.bottom_note);var r=svg_map.querySelector("#"+a.type+".lgdf_"+_app.layer_to_id.get(e));r.setAttribute("transform",a.transform),"none"===a.display&&r.setAttribute("display","none")}}var j=function(t){for(var n=svg_map.querySelector("#"+_app.layer_to_id.get(t)).querySelectorAll("path"),a=n.length,r=[],o=0;o<a;o++)r.push(n[o].__data__);var i={};return i[t]={type:"FeatureCollection",features:r},e.resolve(JSON.stringify(topojson.topology(i)))}}).call(this,a(5))},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.export_compo_svg=function(e){e=s(e,"svg"),function(){svg_map.setAttribute("xmlns:inkscape","http://www.inkscape.org/namespaces/inkscape");for(var e=svg_map.getElementsByTagName("g"),t=e.length-1;t>-1;t--)if(""!==e[t].id){if(e[t].classList.contains("layer"))e[t].setAttribute("inkscape:label",e[t].id);else if(e[t].id.indexOf("legend")>-1){var n=e[t].className.baseVal.split("lgdf_")[1];e[t].setAttribute("inkscape:label","legend_"+n)}else e[t].setAttribute("inkscape:label",e[t].id);e[t].setAttribute("inkscape:groupmode","layer")}}(),r(),t=document.createElement("rect"),t.id="background",t.setAttribute("width","100%"),t.setAttribute("height","100%"),t.setAttribute("fill",document.getElementById("bg_color").value),svg_map.insertBefore(t,svg_map.firstChild);var t;var n=i(),p=document.getElementById("svg_map"),c=(new XMLSerializer).serializeToString(p);c.match(/^<svg[^>]+xmlns="http\:\/\/www\.w3\.org\/2000\/svg"/)||(c=c.replace(/^<svg/,'<svg xmlns="http://www.w3.org/2000/svg"'));c.match(/^<svg[^>]+"http\:\/\/www\.w3\.org\/1999\/xlink"/)||(c=c.replace(/^<svg/,'<svg xmlns:xlink="http://www.w3.org/1999/xlink"'));c=['<?xml version="1.0" standalone="no"?>\r\n',c].join("");var d="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(c);(0,a.clickLinkFromDataUrl)(d,e).then(function(e){o(),l(n),function(){svg_map.removeAttribute("xmlns:inkscape");for(var e=svg_map.getElementsByTagName("g"),t=e.length-1;t>-1;t--)""!==e[t].id&&(e[t].removeAttribute("inkscape:label"),e[t].removeAttribute("inkscape:groupmode"))}(),svg_map.querySelector("rect#background").remove()}).catch(function(e){(0,a.display_error_during_computation)(),console.log(e)})},t.export_compo_png=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments[2];e._app.waitingOverlay.display(),n=s(n,"png");var p=i();r();var c=d3.select("body").append("canvas").attrs({id:"canvas_map_export",height:h,width:w}).node(),d=document.querySelector("#svg_map"),_=void 0,u=void 0,m=void 0;try{_=(new XMLSerializer).serializeToString(d),u=c.getContext("2d"),m=new Image}catch(t){return e._app.waitingOverlay.hide(),c.remove(),void(0,a.display_error_during_computation)(String(t))}if(1!==t)try{!function(e,t){e.style.width||(e.style.width=e.width+"px");e.style.height||(e.style.height=e.height+"px");e.width=Mceil(e.width*t),e.height=Mceil(e.height*t),e.getContext("2d").scale(t,t)}(c,t)}catch(t){return e._app.waitingOverlay.hide(),c.remove(),void(0,a.display_error_during_computation)(i18next.t("app_page.common.error_too_high_resolution")+" "+String(t))}var y=void 0;m.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(_),m.onload=function(){u.drawImage(m,0,0);try{y=c.toDataURL("image/png")}catch(t){return e._app.waitingOverlay.hide(),c.remove(),void(0,a.display_error_during_computation)(String(t))}(0,a.clickLinkFromDataUrl)(y,n).then(function(t){o(),l(p),e._app.waitingOverlay.hide(),c.remove()}).catch(function(e){(0,a.display_error_during_computation)(),console.log(e)})}},t.export_layer_geo=function(e,t,n,r){var o=new FormData;o.append("layer",e),o.append("layer_name",current_layers[e].key_name),o.append("format",t),"proj4string"===n?o.append("projection",JSON.stringify({proj4string:r})):o.append("projection",JSON.stringify({name:n}));var i=new Map([["GeoJSON","geojson"],["TopoJSON","topojson"],["ESRI Shapefile","zip"],["GML","zip"],["KML","kml"]]);(0,a.xhrequest)("POST","get_layer2",o,!0).then(function(n){if(0===n.indexOf('{"Error"')||0===n.length){var r=void 0;return r=n.indexOf('{"Error"')<5?i18next.t(JSON.parse(n).Error):i18next.t("app_page.common.error_msg"),void swal({title:"Oops...",text:r,type:"error",allowOutsideClick:!1,allowEscapeKey:!1}).then(function(){return null},function(){return null})}var o=i.get(t),l=[e,o].join("."),s=void 0;s=o.indexOf("json")>-1?"data:text/json;charset=utf-8,"+encodeURIComponent(n):o.indexOf("kml")>-1?"data:text/xml;charset=utf-8,"+encodeURIComponent(n):"data:application/zip;base64,"+n,(0,a.clickLinkFromDataUrl)(s,l)},function(e){console.log(e)})};var a=n(3);function r(){var e=function(){var e=[svg_map.getElementsByTagName("text"),svg_map.getElementsByTagName("p")],t=[];e.map(function(e){return e||[]});for(var n=0;n<2;n++)for(var a=function(a){var r=e[n][a].style.fontFamily;customs_fonts.forEach(function(e){r.indexOf(e)>-1&&-1===t.indexOf(e)&&t.push(e)})},r=0;r<e[n].length;r++)a(r);return t}();if(0!==e.length){var t=Array.prototype.filter.call(document.styleSheets,function(e){return e.href&&e.href.indexOf("style-fonts.css")>-1?e:null})[0].cssRules,n=e.map(function(e){return String(t[customs_fonts.indexOf(e)].cssText)}),a=document.createElement("style");a.innerHTML=n.join(" "),svg_map.querySelector("defs").appendChild(a)}}function o(){var e=svg_map.querySelector("defs").querySelector("style");e&&e.remove()}function i(){for(var e=document.getElementsByTagName("foreignObject"),t=[],n=0;n<e.length;n++){var a=e[n];t.push([a.getAttribute("width"),a.getAttribute("height")]),a.setAttribute("width","100%"),a.setAttribute("height","100%")}return t}function l(e){for(var t=document.getElementsByTagName("foreignObject"),n=0;n<e.length;n++){var a=t[n];a.setAttribute("width",e[n][0]),a.setAttribute("height",e[n][1])}}function s(e,t){var n=e.toLowerCase().indexOf(t)>-1?e.substring(0,e.lastIndexOf(".")):e;return new RegExp(/^[().a-z0-9_-]+$/i).test(n)&&n.length<250?n+"."+t:"export."+t}}).call(this,n(4))},function(e,t,n){"use strict";(function(e){n(1),n(3)}).call(this,n(5))},function(e,t,n){"use strict";(function(e,a){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,r=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(a=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(r)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();t.handle_click_layer=function(e){current_layers[e].graticule?function(e){(0,i.check_remove_existing_box)(".styleBox");var t=(0,c.cloneObj)(current_layers.Graticule),n=map.select("#L_Graticule > path"),a=map.select("#L_Graticule");(0,i.make_confirm_dialog2)("styleBox",e,{top:!0,widthFitContent:!0,draggable:!0}).then(function(e){return null});var r=document.querySelector(".twbs > .styleBox"),o=d3.select(r).select(".modal-content").style("width","300px").select(".modal-body"),l=o.append("p").attr("class","line_elem");l.append("span").html(i18next.t("app_page.layer_style_popup.color")),l.append("input").attr("type","color").style("float","right").property("value",t.fill_color.single).on("change",function(){n.style("stroke",this.value),current_layers.Graticule.fill_color.single=this.value});var s=o.append("p").attr("class","line_elem");s.append("span").html(i18next.t("app_page.layer_style_popup.opacity")),s.append("input").attrs({type:"range",min:0,max:1,step:.1}).styles({width:"58px","vertical-align":"middle",display:"inline",float:"right"}).property("value",t.opacity).on("change",function(){n.style("stroke-opacity",this.value),current_layers.Graticule.opacity=+this.value,o.select("#graticule_opacity_txt").html(100*+this.value+"%")}),s.append("span").attr("id","graticule_opacity_txt").style("float","right").html(100*t.opacity+"%");var d=o.append("p").attr("class","line_elem");d.append("span").html(i18next.t("app_page.layer_style_popup.width")),d.append("input").attr("type","number").styles({width:"60px",float:"right"}).property("value",t["stroke-width-const"]).on("change",function(){a.style("stroke-width",this.value),current_layers.Graticule["stroke-width-const"]=+this.value});var _=o.append("p").attr("class","line_elem");_.append("span").html(i18next.t("app_page.layer_style_popup.graticule_steps")),_.append("input").attrs({id:"graticule_range_steps",type:"range",min:0,max:100,step:1}).styles({"vertical-align":"middle",width:"58px",display:"inline",float:"right"}).property("value",t.step).on("change",function(){var e=a.node().nextSibling,t=+this.value,r=+document.getElementById("graticule_dasharray_txt").value;current_layers.Graticule.step=t,map.select("#L_Graticule").remove(),map.append("g").attrs({id:"L_Graticule",class:"layer"}).append("path").datum(d3.geoGraticule().step([t,t])).attrs({class:"graticule",d:path,"clip-path":"url(#clip)"}).styles({fill:"none",stroke:current_layers.Graticule.fill_color.single,"stroke-dasharray":r}),(0,u.zoom_without_redraw)(),n=map.select("#L_Graticule").selectAll("path"),a=map.select("#L_Graticule"),svg_map.insertBefore(a.node(),e),o.select("#graticule_step_txt").property("value",t)}),_.append("input").attrs({type:"number",min:0,max:100,step:"any",class:"without_spinner",id:"graticule_step_txt"}).styles({width:"30px","margin-left":"10px",float:"right"}).property("value",t.step).on("change",function(){var e=document.getElementById("graticule_range_steps");e.value=+this.value,e.dispatchEvent(new MouseEvent("change"))});var m=o.append("p").attr("class","line_elem");m.append("span").html(i18next.t("app_page.layer_style_popup.graticule_dasharray")),m.append("input").attrs({type:"range",min:0,max:50,step:.1,id:"graticule_range_dasharray"}).styles({"vertical-align":"middle",width:"58px",display:"inline",float:"right"}).property("value",t.dasharray).on("change",function(){n.style("stroke-dasharray",this.value),current_layers.Graticule.dasharray=+this.value,o.select("#graticule_dasharray_txt").property("value",this.value)}),m.append("input").attrs({type:"number",min:0,max:100,step:"any",class:"without_spinner",id:"graticule_dasharray_txt"}).styles({width:"30px","margin-left":"10px",float:"right"}).property("value",t.dasharray).on("change",function(){var e=document.getElementById("graticule_range_dasharray");e.value=+this.value,e.dispatchEvent(new MouseEvent("change"))});var y=o.append("p").attr("class","line_elem");y.append("input").attrs({type:"checkbox",id:"clip_graticule"}).property("checked",!!t.extent||null).on("change",function(){var e=a.node().nextSibling,t=+document.getElementById("graticule_step_txt").value,r=+document.getElementById("graticule_dasharray_txt").value,o=d3.geoGraticule().step([t,t]);if(map.select("#L_Graticule").remove(),this.checked){var i=_target_layer_file.bbox,l=[[10*Math.round((i[0]-12)/10),10*Math.round((i[1]-12)/10)],[10*Math.round((i[2]+12)/10),10*Math.round((i[3]+12)/10)]];l[0]<-180&&(l[0]=-180),l[1]<-90&&(l[1]=-90),l[2]>180&&(l[2]=180),l[3]>90&&(l[3]=90),o=o.extent(l),current_layers.Graticule.extent=l}else current_layers.Graticule.extent=void 0;map.append("g").attrs({id:"L_Graticule",class:"layer"}).append("path").datum(o).attrs({class:"graticule",d:path,"clip-path":"url(#clip)"}).styles({fill:"none",stroke:current_layers.Graticule.fill_color.single,"stroke-dasharray":r}),(0,u.zoom_without_redraw)(),n=map.select("#L_Graticule").selectAll("path"),a=map.select("#L_Graticule"),svg_map.insertBefore(a.node(),e)}),y.append("label").attrs({for:"clip_graticule"}).html(i18next.t("app_page.layer_style_popup.graticule_clip")),g=o,g.append("p").append("span").attr("id","generate_labels").styles({cursor:"pointer","margin-top":"15px"}).html(i18next.t("app_page.layer_style_popup.generate_labels")).on("mouseover",function(){this.style.fontWeight="bold"}).on("mouseout",function(){this.style.fontWeight=""}).on("click",function(){(0,p.render_label_graticule)("Graticule",{color:"#000",font:"verdana",ref_font_size:12,uo_layer_name:["Labels","Graticule"].join("_")})});var g}():"Line"===current_layers[e].type?function(e){(0,i.check_remove_existing_box)(".styleBox");var t=current_layers[e].renderer,n="#"+_app.layer_to_id.get(e),a=map.select(n).selectAll("path"),p=a.style("fill-opacity"),_=(0,c.cloneObj)(current_layers[e].fill_color),m=void 0,y=void 0,g=void 0;current_layers[e].colors_breaks&&current_layers[e].colors_breaks instanceof Array?y=current_layers[e].colors_breaks.concat([]):_.random&&(m=[],a.each(function(e){m.push(this.style.stroke)}));var f=a.style("stroke-opacity"),x=+current_layers[e]["stroke-width-const"],k=a.style("stroke"),A=void 0,j=void 0,S=void 0;k.startsWith("rgb")&&(k=(0,o.rgb2hex)(k));var E=[];Array.prototype.forEach.call(svg_map.querySelector(n).querySelectorAll("path"),function(e){E.push(e.__data__.properties)});var z=function(e){for(var t=a._groups[0],n=0,r=e.length;n<r;n++)t[n].style.strokeWidth=e[n]};(0,i.make_confirm_dialog2)("styleBox",e,{top:!0,widthFitContent:!0,draggable:!0}).then(function(r){if(r){if(void 0!==t&&void 0!==g&&"Categorical"!==t&&"PropSymbolsTypo"!==t&&"LinksProportional"!==t){current_layers[e].fill_color={class:g.colorsByFeature};for(var i=[],l=g.breaks.length-1;l>0;--l)i.push([[g.breaks[l-1]," - ",g.breaks[l]].join(""),g.breaks[l-1]]);current_layers[e].colors_breaks=i,current_layers[e].rendered_field=g.field,current_layers[e].options_disc={schema:g.schema,colors:g.colors,no_data:g.no_data,type:g.type,breaks:g.breaks,extra_options:g.extra_options},"legend_root"===document.querySelector(".legend.legend_feature.lgdf_"+_app.layer_to_id.get(e)).id?v("choro",e,g.field):v("choro_horiz",e,g.field)}else"Categorical"!==t&&"PropSymbolsTypo"!==t||void 0===g?"DiscLayer"===t?(a.each(function(e){e.properties.prop_val=this.style.strokeWidth}),v("line_class",e)):"LinksGraduated"===t&&(a.each(function(t,n){current_layers[e].linksbyId[n][2]=this.style.strokeWidth}),v("line_class",e)):(current_layers[e].color_map=g.color_map,current_layers[e].fill_color={class:[].concat(g.colorsByFeature)},v("choro",e,g.field));t&&(t.startsWith("PropSymbols")||"LinksProportional"===t)&&(a.each(function(e){e.properties.color=this.style.stroke}),v("line_symbol",e)),O!==e&&w(e,check_layer_name(O.trim())),(0,u.zoom_without_redraw)()}else{a.style("fill-opacity",p).style("stroke-opacity",f);var s=+d3.zoomTransform(map.node()).k;map.select(n).style("stroke-width",x/s+"px"),current_layers[e]["stroke-width-const"]=x;var c=Object.getOwnPropertyNames(_)[0];if("LinksGraduated"===current_layers[e].renderer&&void 0!==A)current_layers[e].min_display=A,current_layers[e].breaks=S,a.style("fill-opacity",0).style("stroke",_.single).style("display",function(t){return+t.properties[current_layers[e].rendered_field]>A?null:"none"}).style("stroke-opacity",f).style("stroke-width",function(t,n){return current_layers[e].linksbyId[n][2]});else if("DiscLayer"===current_layers[e].renderer&&void 0!==A){current_layers[e].min_display=A,current_layers[e].size=j,current_layers[e].breaks=S;var d=0!==A?A*current_layers[e].n_features:-1;a.style("fill-opacity",0).style("stroke",_.single).style("stroke-opacity",f).style("display",function(e,t){return+t<=d?null:"none"}).style("stroke-width",function(e){return e.properties.prop_val})}else"single"===c?a.style("stroke",_.single).style("stroke-opacity",f):"random"===c?a.style("stroke-opacity",f).style("stroke",function(e,t){return m[t]||o.Colors.names[o.Colors.random()]}):"class"===c&&"LinksGraduated"===t&&a.style("stroke-opacity",function(t,n){return current_layers[e].linksbyId[n][0]}).style("stroke",k);current_layers[e].colors_breaks&&(current_layers[e].colors_breaks=y),current_layers[e].fill_color=_,(0,u.zoom_without_redraw)()}});var B=document.querySelector(".twbs > .styleBox"),P=d3.select(B).select(".modal-content").style("width","300px").select(".modal-body"),O=e;if(h(P,e).on("change",function(){O=this.value}),"Categorical"===t||"PropSymbolsTypo"===t){var C="Categorical"===t?current_layers[e].rendered_field:current_layers[e].rendered_field2;P.insert("p").styles({margin:"auto","text-align":"center"}).append("button").attr("class","button_disc").styles({"font-size":"0.8em","text-align":"center"}).html(i18next.t("app_page.layer_style_popup.choose_colors")).on("click",function(){var t=prepare_categories_array(e,C,current_layers[e].color_map),n=r(t,2),o=n[0];n[1];B.modal.hide(),display_categorical_box(result_data[e],e,C,o).then(function(e){B.modal.show(),e&&(g={nb_class:e[0],color_map:e[1],colorsByFeature:e[2],renderer:"Categorical",rendered_field:C,field:C},a.transition().style("stroke",function(e,t){return g.colorsByFeature[t]}))})})}else if("Choropleth"===t||"PropSymbolsChoro"===t)P.append("p").styles({margin:"auto","text-align":"center"}).append("button").attr("class","button_disc").html(i18next.t("app_page.layer_style_popup.choose_discretization")).on("click",function(){B.modal.hide();var t=g?{schema:g.schema,colors:g.colors,no_data:g.no_data,type:g.type,breaks:g.breaks,extra_options:g.extra_options}:current_layers[e].options_disc;(0,l.display_discretization)(e,current_layers[e].rendered_field,t.breaks.length-1,t).then(function(t){B.modal.show(),t&&(g={nb_class:t[0],type:t[1],breaks:t[2],colors:t[3],colorsByFeature:t[4],schema:t[5],no_data:t[6],field:current_layers[e].rendered_field,extra_options:t[7]},a.transition().style("stroke",function(e,t){return g.colorsByFeature[t]}))})});else{var M=P.append("p").attr("class","line_elem");M.insert("span").html(i18next.t("app_page.layer_style_popup.color")),M.insert("input").attr("type","color").style("float","right").property("value",k).on("change",function(){a.style("stroke",this.value),current_layers[e].fill_color={single:this.value}})}if("LinksGraduated"===t){A=current_layers[e].min_display||0,S=current_layers[e].breaks.slice();var I=current_layers[e].rendered_field,q=0;a.each(function(e){+e.properties[I]>q&&(q=+e.properties[I])});var L=P.append("p").attr("class","line_elem");L.append("span").html(i18next.t("app_page.layer_style_popup.display_flow_larger")),L.insert("input").attrs({type:"range",min:0,max:q,step:.5}).styles({width:"58px","vertical-align":"middle",display:"inline",float:"right","margin-right":"0px"}).property("value",A).on("change",function(){var t=+this.value;P.select("#larger_than").html(["<i> ",t," </i>"].join("")),a.style("display",function(e){return+e.properties[I]>t?null:"none"}),current_layers[e].min_display=t}),L.insert("label").attr("id","larger_than").style("float","right").html("<i> "+A+" </i>"),P.append("p").style("text-align","center").append("button").attr("class","button_disc").html(i18next.t("app_page.layer_style_popup.modify_size_class")).on("click",function(){B.modal.hide(),(0,s.display_discretization_links_discont)(e,current_layers[e].rendered_field,current_layers[e].breaks.length,"user_defined").then(function(t){if(B.modal.show(),t){var n=t[0],r=t[1].map(function(e){return e[1]}),o=current_layers[e].linksbyId;n.setClassManually(t[2]),current_layers[e].breaks=t[1],a.style("fill-opacity",0).style("stroke-width",function(e,t){return r[n.getClass(+o[t][1])]})}})})}else if("DiscLayer"===t){A=+current_layers[e].min_display||0,j=current_layers[e].size.slice(),S=current_layers[e].breaks.slice();Math.max.apply(null,result_data[e].map(function(e){return e.disc_value}));var T=P.append("p").attr("class","line_elem");T.append("span").html(i18next.t("app_page.layer_style_popup.discont_threshold")),T.insert("input").attrs({type:"range",min:0,max:1,step:.1}).styles({width:"58px","vertical-align":"middle",display:"inline",float:"right","margin-right":"0px"}).property("value",A).on("change",function(){var t=+this.value,n=0!==t?t*current_layers[e].n_features:-1;P.select("#larger_than").html(["<i> ",100*t," % </i>"].join("")),a.style("display",function(e,t){return t<=n?null:"none"}),current_layers[e].min_display=t}),T.insert("label").attr("id","larger_than").style("float","right").html(["<i> ",100*A," % </i>"].join("")),P.append("p").style("text-align","center").append("button").attr("class","button_disc").html(i18next.t("app_page.layer_style_popup.choose_discretization")).on("click",function(){B.modal.hide(),(0,s.display_discretization_links_discont)(e,"disc_value",current_layers[e].breaks.length,"user_defined").then(function(t){if(B.modal.show(),t){var n=t[0],r=t[1].map(function(e){return e[1]});n.setClassManually(t[2]),current_layers[e].breaks=t[1],current_layers[e].size=[r[0],r[r.length-1]],a.style("fill-opacity",0).style("stroke-width",function(e,t){return r[n.getClass(+e.properties.disc_value)]})}})})}var N=P.append("p").attr("class","line_elem");if(N.insert("span").html(i18next.t("app_page.layer_style_popup.opacity")),N.insert("input").attrs({type:"range",min:0,max:1,step:.1}).styles({width:"58px","vertical-align":"middle",display:"inline",float:"right"}).property("value",f).on("change",function(){N.select("#opacity_val_txt").html(" "+this.value),a.style("stroke-opacity",this.value)}),N.append("span").attr("id","opacity_val_txt").styles({display:"inline",float:"right"}).html(" "+f),t&&(t.startsWith("PropSymbols")||t.startsWith("Links")||"DiscLayer"===t)){if(t.startsWith("PropSymbols")||"LinksProportional"===t){var F=current_layers[e].rendered_field,G=result_data[e].map(function(e){return+e[F]}),D=P.append("p");D.append("span").html(i18next.t("app_page.layer_style_popup.field_symbol_size",{field:current_layers[e].rendered_field})),D.append("span").html(i18next.t("app_page.layer_style_popup.symbol_fixed_size")),D.insert("input").styles({width:"60px",float:"right"}).attrs({type:"number",id:"max_size_range",min:.1,step:"any"}).property("value",current_layers[e].size[1]).on("change",function(){var t=+this.value,n=(0,d.prop_sizer3_e)(G,current_layers[e].size[0],t,"line");current_layers[e].size[1]=t,z(n)}),D.append("span").style("float","right").html("(px)");var R=P.append("p").attr("class","line_elem");R.append("span").html(i18next.t("app_page.layer_style_popup.on_value")),R.insert("input").styles({width:"100px",float:"right"}).attrs({type:"number",min:.1,step:.1}).property("value",+current_layers[e].size[0]).on("change",function(){var t=+this.value,n=(0,d.prop_sizer3_e)(G,t,current_layers[e].size[1],"line");z(n),current_layers[e].size[0]=t})}}else{var W=P.append("p");W.append("span").html(i18next.t("app_page.layer_style_popup.width")),W.insert("input").attrs({type:"number",min:0,step:.1}).styles({width:"60px",float:"right"}).property("value",x).on("change",function(){var t=+this.value,a=+d3.zoomTransform(map.node()).k;map.select(n).style("stroke-width",t/a+"px"),current_layers[e]["stroke-width-const"]=t})}b(P,e)}(e):current_layers[e].renderer&&current_layers[e].renderer.indexOf("PropSymbol")>-1?function(e){(0,i.check_remove_existing_box)(".styleBox");var t=_app.layer_to_id.get(e),n="#"+t,a=current_layers[e].ref_layer_name,s=current_layers[e].renderer,p=current_layers[e].symbol,_=current_layers[e].rendered_field,m=map.select(n).selectAll(p),x=[current_layers[e].size[0],current_layers[e].size[1]],k=void 0,A=m.style("stroke"),j=m.style("stroke-width"),S=void 0,E=m.style("fill-opacity"),z=m.style("stroke-opacity"),B=(0,c.cloneObj)(current_layers[e].fill_color),P=result_data[e].map(function(e){return+e[_]}),O=void 0,C=function(e){var t=m._groups[0];if("circle"===p)for(var n=0,a=e.length;n<a;n++)t[n].setAttribute("r",e[n]);else if("rect"===p)for(var r=0,o=e.length;r<o;r++){var i=+t[r].getAttribute("height"),l=[+t[r].getAttribute("x")+i/2-e[r]/2,+t[r].getAttribute("y")+i/2-e[r]/2];t[r].setAttribute("x",l[0]),t[r].setAttribute("y",l[1]),t[r].setAttribute("height",e[r]),t[r].setAttribute("width",e[r])}};current_layers[e].colors_breaks&&current_layers[e].colors_breaks instanceof Array?O=[].concat(current_layers[e].colors_breaks):void 0!==current_layers[e].break_val?O=current_layers[e].break_val:B.random&&(S=[],m.each(function(e){S.push(this.style.fill)}));A.startsWith("rgb")&&(A=(0,o.rgb2hex)(A));j.endsWith("px")&&(j=j.substring(0,j.length-2));(0,i.make_confirm_dialog2)("styleBox",e,{top:!0,widthFitContent:!0,draggable:!0}).then(function(a){if(a){var r=document.querySelector(["#legend_root_symbol.lgdf_",t].join(""));if(r&&(0,u.redraw_legends_symbols)(r),"circle"===p?m.each(function(e,t){e.properties.prop_value=this.getAttribute("r"),e.properties.color=(0,o.rgb2hex)(this.style.fill)}):m.each(function(e,t){e.properties.prop_value=this.getAttribute("height"),e.properties.color=(0,o.rgb2hex)(this.style.fill)}),("PropSymbolsChoro"===s||"PropSymbolsTypo"===s)&&void 0!==k){if("PropSymbolsChoro"===s){current_layers[e].fill_color={class:[].concat(k.colorsByFeature)},current_layers[e].colors_breaks=[];for(var i=k.breaks.length-1;i>0;--i)current_layers[e].colors_breaks.push([[k.breaks[i-1]," - ",k.breaks[i]].join(""),k.colors[i-1]]);current_layers[e].options_disc={schema:k.schema,colors:k.colors,no_data:k.no_data,type:k.type,breaks:k.breaks,extra_options:k.extra_options}}else"PropSymbolsTypo"===s&&(current_layers[e].fill_color={class:[].concat(k.colorsByFeature)},current_layers[e].color_map=k.color_map);current_layers[e].rendered_field2=k.field,"legend_root"===document.querySelector(".legend.legend_feature.lgdf_"+_app.layer_to_id.get(e)).id?v("choro",e,current_layers[e].rendered_field):v("choro_horiz",e,current_layers[e].rendered_field)}q!==e&&w(e,check_layer_name(q.trim()))}else{m.style("fill-opacity",E),map.select(n).style("stroke-width",j),current_layers[e]["stroke-width-const"]=j;var l=Object.getOwnPropertyNames(B)[0];if("single"===l?m.style("fill",B.single).style("stroke-opacity",z).style("stroke",A):"two"===l?(current_layers[e].break_val=O,current_layers[e].fill_color={two:[B.two[0],B.two[1]]},m.style("fill",function(e,t){return P[t]>O?B.two[1]:B.two[0]}).style("stroke-opacity",z).style("stroke",A)):"class"===l?(m.style("fill-opacity",E).style("fill",function(t,n){return current_layers[e].fill_color.class[n]}).style("stroke-opacity",z).style("stroke",A),current_layers[e].colors_breaks=O):"random"===l?m.style("fill",function(e,t){return S[t]||o.Colors.names[o.Colors.random()]}).style("stroke-opacity",z).style("stroke",A):"categorical"===l&&f(e,B.categorical[0],p,B.categorical[1]),current_layers[e].fill_color=B,current_layers[e].size[1]!==x[1]){var c=(0,d.prop_sizer3_e)(P,x[0],x[1],p);C(c),current_layers[e].size=[x[0],x[1]]}}(0,u.zoom_without_redraw)()});var M=document.querySelector(".twbs > .styleBox"),I=d3.select(M).select(".modal-content").style("width","300px").select(".modal-body");I.append("p").styles({"text-align":"center",color:"grey"}).html([i18next.t("app_page.layer_style_popup.rendered_field",{field:current_layers[e].rendered_field}),i18next.t("app_page.layer_style_popup.reference_layer",{layer:a})].join(""));var q=e;if(h(I,e).on("change",function(){q=this.value}),"PropSymbolsChoro"===s){var L=current_layers[e].rendered_field2;I.append("p").styles({margin:"auto","text-align":"center"}).html(i18next.t("app_page.layer_style_popup.field_symbol_color",{field:L})).append("button").attr("class","button_disc").html(i18next.t("app_page.layer_style_popup.choose_discretization")).on("click",function(){M.modal.hide();var t=k?{schema:k.schema,colors:k.colors,no_data:k.no_data,type:k.type,breaks:k.breaks,extra_options:k.extra_options}:current_layers[e].options_disc;(0,l.display_discretization)(e,L,t.breaks.length-1,t).then(function(e){M.modal.show(),e&&(k={nb_class:e[0],type:e[1],breaks:e[2],colors:e[3],colorsByFeature:e[4],schema:e[5],no_data:e[6],renderer:"PropSymbolsChoro",field:L,extra_options:e[7]},m.style("fill",function(e,t){return k.colorsByFeature[t]}))})})}else if(void 0!==current_layers[e].break_val){var T=I.append("div").attr("id","fill_color_section");T.append("p").style("text-align","center").html(i18next.t("app_page.layer_style_popup.color_break"));var N=T.append("p").style("display","inline"),F=N.insert("input").attrs({id:"col1",type:"color"}).property("value",current_layers[e].fill_color.two[0]).on("change",function(){var t=this,n=+D.node().value;current_layers[e].fill_color.two[0]=this.value,m.transition().style("fill",function(e,a){return P[a]>n?G.node().value:t.value})}),G=N.insert("input").attrs({id:"col2",type:"color"}).property("value",current_layers[e].fill_color.two[1]).on("change",function(){var t=this,n=+D.node().value;current_layers[e].fill_color.two[1]=this.value,m.transition().style("fill",function(e,a){return P[a]>n?t.value:F.node().value})});T.insert("span").html(i18next.t("app_page.layer_style_popup.break_value"));var D=T.insert("input").attr("type","number").style("width","75px").property("value",current_layers[e].break_val).on("change",function(){var t=+this.value;current_layers[e].break_val=t,m.transition().style("fill",function(e,n){return P[n]>t?G.node().value:F.node().value})})}else if("PropSymbolsTypo"===s){var R=current_layers[e].rendered_field2;I.append("p").style("margin","auto").html(i18next.t("app_page.layer_style_popup.field_symbol_color",{field:R})),I.append("p").style("text-align","center").insert("button").attr("class","button_disc").html(i18next.t("app_page.layer_style_popup.choose_colors")).on("click",function(){var t=prepare_categories_array(e,R,current_layers[e].color_map),n=r(t,2),a=n[0];n[1];M.modal.hide(),display_categorical_box(result_data[e],e,R,a).then(function(e){M.modal.show(),e&&(k={nb_class:e[0],color_map:e[1],colorsByFeature:e[2],renderer:"Categorical",rendered_field:R,field:R},m.style("fill",function(e,t){return k.colorsByFeature[t]}))})})}else{var W=(0,c.type_col2)(result_data[e]),H=((0,c.getFieldsType)("category",null,W),I.append("p").html(i18next.t("app_page.layer_style_popup.fill_color")).insert("select"));[[i18next.t("app_page.layer_style_popup.single_color"),"single"],[i18next.t("app_page.layer_style_popup.random_color"),"random"]].forEach(function(e){H.append("option").text(e[0]).attr("value",e[1])}),I.append("div").attr("id","fill_color_section"),H.on("change",function(){I.select("#fill_color_section").html("").on("click",null),"single"===this.value?(y(e,B,p),map.select(n).selectAll(p).transition().style("fill",B.single),current_layers[e].fill_color=(0,c.cloneObj)(B)):"random"===this.value&&(g(e,p),document.getElementById("random_color_btn").click())}),(0,c.setSelected)(H.node(),Object.getOwnPropertyNames(B)[0])}var V=I.append("p").attr("class","line_elem");V.append("span").html(i18next.t("app_page.layer_style_popup.fill_opacity")),V.insert("input").attrs({type:"range",min:0,max:1,step:.1}).styles({width:"58px","vertical-align":"middle",display:"inline",float:"right"}).property("value",E).on("change",function(){m.style("fill-opacity",this.value),V.select("#fill_opacity_txt").html(100*+this.value+"%")}),V.append("span").attr("id","fill_opacity_txt").style("float","right").html(100*+E+"%");var U=I.append("p").attr("class","line_elem");U.append("span").html(i18next.t("app_page.layer_style_popup.border_color")),U.insert("input").attr("type","color").style("float","right").property("value",A).on("change",function(){m.transition().style("stroke",this.value)});var Y=I.append("p");Y.append("span").html(i18next.t("app_page.layer_style_popup.border_opacity")),Y.insert("input").attrs({type:"range",min:0,max:1,step:.1}).styles({width:"58px","vertical-align":"middle",display:"inline",float:"right"}).property("value",z).on("change",function(){m.style("stroke-opacity",this.value),Y.select("#border_opacity_txt").html(""+this.value)}),Y.append("span").attr("id","border_opacity_txt").style("float","right").html(" "+z);var J=I.append("p").attr("class","line_elem");J.append("span").html(i18next.t("app_page.layer_style_popup.border_width")),J.insert("input").attrs({type:"number",min:0,step:.1}).styles({width:"60px",float:"right"}).property("value",j).on("change",function(){m.style("stroke-width",this.value+"px"),current_layers[e]["stroke-width-const"]=+this.value});var K=I.append("p");K.append("span").html(i18next.t("app_page.layer_style_popup.field_symbol_size",{field:_})),K.append("span").html(i18next.t("app_page.layer_style_popup.symbol_fixed_size")),K.insert("input").styles({width:"60px",float:"right"}).attrs({type:"number",id:"max_size_range",min:.1,step:"any"}).property("value",current_layers[e].size[1]).on("change",function(){var t=+this.value,n=(0,d.prop_sizer3_e)(P,current_layers[e].size[0],t,p);current_layers[e].size[1]=t,C(n)}),K.append("span").style("float","right").html("(px)");var Q=I.append("p").attr("class","line_elem");Q.append("span").html(i18next.t("app_page.layer_style_popup.on_value")),Q.insert("input").styles({width:"100px",float:"right"}).attrs({type:"number",min:.1,step:.1}).property("value",+current_layers[e].size[0]).on("change",function(){var t=+this.value,n=(0,d.prop_sizer3_e)(P,t,current_layers[e].size[1],p);C(n),current_layers[e].size[0]=t});var X=I.append("p"),Z=X.insert("input").style("margin","0").property("checked",!!current_layers[e].draggable||null).attrs({type:"checkbox",id:"checkbox_move_symbol"});X.insert("label").attr("for","checkbox_move_symbol").html(i18next.t("app_page.layer_style_popup.let_draggable")),Z.on("change",function(){this.checked?current_layers[e].draggable=!0:current_layers[e].draggable=!1}),I.append("p").style("text-align","center").insert("button").attrs({id:"reset_symb_loc",class:"button_st4"}).text(i18next.t("app_page.layer_style_popup.reset_symbols_location")).on("click",function(){m.transition().attrs(function(e){var t=path.centroid(e.geometry);return"circle"===p?{cx:t[0],cy:t[1]}:{x:t[0]-+e.properties.prop_value/2,y:t[1]-+e.properties.prop_value/2}})}),b(I,e)}(e):current_layers[e].renderer&&"Label"===current_layers[e].renderer?function(e){(0,i.check_remove_existing_box)(".styleBox");var t=map.select("#"+_app.layer_to_id.get(e)).selectAll("text"),n=current_layers[e].ref_layer_name,a={},r=[];(function(){var n=t._groups[0];r=[];for(var o=0;o<n.length;o++)r.push({color:n[o].style.fill,size:n[o].style.fontSize,display:n[o].style.display?n[o].style.display:null,position:[n[o].getAttribute("x"),n[o].getAttribute("y")],font:n[o].style.fontFamily});a={color:current_layers[e].fill_color,size:current_layers[e].default_size,font:current_layers[e].default_font}})(),(0,i.make_confirm_dialog2)("styleBox",e,{top:!0,widthFitContent:!0,draggable:!0}).then(function(n){n?s!==e&&w(e,check_layer_name(s.trim())):function(){for(var n=t._groups[0],o=0;o<n.length;o++)n[o].style.fill=r[o].color,n[o].style.fontSize=r[o].size,n[o].style.display=r[o].display,n[o].setAttribute("x",r[o].position[0]),n[o].setAttribute("y",r[o].position[1]),n[o].style.fontFamily=r[o].font;current_layers[e].fill_color=a.color,current_layers[e].default_size=a.size,current_layers[e].default_font=a.font}()});var o=document.querySelector(".twbs > .styleBox"),l=d3.select(o).select(".modal-content").style("width","300px").select(".modal-body");l.append("p").styles({"text-align":"center",color:"grey"}).html([i18next.t("app_page.layer_style_popup.rendered_field",{field:current_layers[e].rendered_field}),i18next.t("app_page.layer_style_popup.reference_layer",{layer:n})].join(""));var s=e;h(l,e).on("change",function(){s=this.value}),l.append("p").style("text-align","center").insert("button").attrs({id:"reset_labels_loc",class:"button_st4"}).text(i18next.t("app_page.layer_style_popup.reset_labels_location")).on("click",function(){t.transition().attrs(function(e){var t=path.centroid(e.geometry);return{x:t[0],y:t[1]}})}),l.append("p").style("text-align","center").insert("button").attrs({id:"reset_labels_display",class:"button_st4"}).text(i18next.t("app_page.layer_style_popup.redraw_labels")).on("click",function(){t.style("display",void 0)}),l.insert("p").styles({"text-align":"center","font-size":"9px"}).html(i18next.t("app_page.layer_style_popup.overrride_warning"));var p=l.append("p").attr("class","line_elem");p.append("span").html(i18next.t("app_page.layer_style_popup.labels_default_size")),p.insert("span").style("float","right").html(" px"),p.insert("input").attr("type","number").styles({float:"right",width:"70px"}).property("value",+current_layers[e].default_size.replace("px","")).on("change",function(){var n=this.value+"px";current_layers[e].default_size=n,t.style("font-size",n)});var c=l.insert("p").attr("class","line_elem");c.append("span").html(i18next.t("app_page.layer_style_popup.labels_default_color")),c.insert("input").attr("type","color").style("float","right").property("value",current_layers[e].fill_color).on("change",function(){current_layers[e].fill_color=this.value,t.transition().style("fill",this.value)});var d=l.insert("p").attr("class","line_elem");d.append("span").html(i18next.t("app_page.layer_style_popup.labels_default_font"));var _=d.insert("select").style("float","right").on("change",function(){current_layers[e].default_font=this.value,t.transition().style("font-family",this.value)});available_fonts.forEach(function(e){_.append("option").attr("value",e[1]).text(e[0])}),_.node().value=current_layers[e].default_font}(e):current_layers[e].renderer&&"TypoSymbols"===current_layers[e].renderer?function(e){(0,i.check_remove_existing_box)(".styleBox");var t=map.select("#"+_app.layer_to_id.get(e)).selectAll("image"),n=current_layers[e].ref_layer_name,a=current_layers[e].symbols_map,r=current_layers[e].rendered_field,o=[],l={};d3.zoomTransform(svg_map).k;(function(){for(var n=t._groups[0],a=0;a<n.length;a++)o.push({display:n[a].style.display?n[a].style.display:null,size:n[a].getAttribute("width"),position:[n[a].getAttribute("x"),n[a].getAttribute("y")]});l.size=current_layers[e].default_size})(),(0,i.make_confirm_dialog2)("styleBox",e,{top:!0,widthFitContent:!0,draggable:!0}).then(function(n){n?c!==e&&w(e,check_layer_name(c.trim())):function(){for(var n=t._groups[0],a=0;a<n.length;a++)n[a].setAttribute("width",o[a].size),n[a].setAttribute("height",o[a].size),n[a].setAttribute("x",o[a].position[0]),n[a].setAttribute("y",o[a].position[1]),n[a].style.display=o[a].display;current_layers[e].default_size=l.size}()});var s=document.querySelector(".twbs > .styleBox"),p=d3.select(s).select(".modal-content").style("width","300px").select(".modal-body");p.append("p").styles({"text-align":"center",color:"grey"}).html([i18next.t("app_page.layer_style_popup.rendered_field",{field:r}),i18next.t("app_page.layer_style_popup.reference_layer",{layer:n})].join(""));var c=e;h(p,e).on("change",function(){c=this.value}),p.append("p").style("text-align","center").insert("button").attrs({id:"reset_symb_loc",class:"button_st4"}).text(i18next.t("app_page.layer_style_popup.reset_symbols_location")).on("click",function(){t.transition().attrs(function(e){var t=path.centroid(e.geometry),n=a.get(e.properties.symbol_field)[1]/2;return{x:t[0]-n,y:t[1]-n}})}),p.append("p").style("text-align","center").insert("button").attrs({id:"reset_symb_display",class:"button_st4"}).text(i18next.t("app_page.layer_style_popup.redraw_symbols")).on("click",function(){t.style("display",void 0)});var d=p.append("p");d.append("span").html(i18next.t("app_page.layer_style_popup.symbols_size")),d.append("input").attrs({min:0,max:200,step:"any",type:"number"}).styles({width:"60px",margin:"auto"}).property("value",32).on("change",function(){var e=this.value;t.transition().attrs(function(){var t=this.height.baseVal.value;return{width:e+"px",height:e+"px",x:this.x.baseVal.value+t/2-e/2,y:this.y.baseVal.value+t/2-e/2}})})}(e):current_layers[e].renderer&&"TwoStocksWaffle"===current_layers[e].renderer?function(e){(0,i.check_remove_existing_box)(".styleBox");var t=Math.round,n=Math.floor,a="#"+_app.layer_to_id.get(e),r=current_layers[e].ref_layer_name,l=current_layers[e].symbol,s=current_layers[e].rendered_field,p=map.select(a),c={fill_opacity:p.selectAll(l).style("fill-opacity"),ref_colors:[].concat(current_layers[e].fill_color),size:current_layers[e].size,nCol:current_layers[e].nCol};(0,i.make_confirm_dialog2)("styleBox",e,{top:!0,widthFitContent:!0,draggable:!0}).then(function(t){t?(v("waffle",e,s),j!==e&&w(e,check_layer_name(j.trim()))):(current_layers[e].fill_color=c.ref_colors,current_layers[e].size=c.size,p.selectAll(l).style("fill-opacity",c.fill_opacity)),(0,u.zoom_without_redraw)()});var d=document.querySelector(".twbs > .styleBox"),_=d3.select(d).select(".modal-content").style("width","300px").select(".modal-body");_.append("p").styles({"text-align":"center",color:"grey"}).html([i18next.t("app_page.layer_style_popup.rendered_field",{field:s.join(" ,")}),i18next.t("app_page.layer_style_popup.reference_layer",{layer:r})].join(""));var m=_.append("p").attr("class","line_elem").attr("id","fill_color_section");m.append("span").html(i18next.t("app_page.layer_style_popup.fill_opacity")),m.insert("input").attrs({type:"range",min:0,max:1,step:.1}).styles({width:"58px","vertical-align":"middle",display:"inline",float:"right"}).property("value",c.fill_opacity).on("change",function(){p.selectAll(l).style("fill-opacity",+this.value),m.select("#fill_opacity_txt").html(100*+this.value+"%")}),m.append("span").attr("id","fill_opacity_txt").style("float","right").html(100*+c.fill_opacity+"%");var y=_.append("div").attr("id","ref_colors_section").style("clear","both");y.append("p").html(i18next.t("app_page.layer_style_popup.ref_colors"));for(var g=function(t){var n=y.append("p").style("margin","15px 5px");n.append("span").html(current_layers[e].rendered_field[t]),n.insert("input").attrs({id:t,type:"color"}).style("float","right").property("value",current_layers[e].fill_color[t]).on("change",function(){var n=(0,o.rgb2hex)(this.value),a=current_layers[e].fill_color[t];current_layers[e].fill_color[t]=n,p.selectAll(l).each(function(){(0,o.rgb2hex)(this.getAttribute("fill"))===a&&this.setAttribute("fill",n)})})},f=0;f<current_layers[e].fill_color.length;f++)g(f);var b=_.append("p").attr("class","line_elem").attr("id","size_section").style("clear","both");b.append("span").html(i18next.t("app_page.layer_style_popup.ref_size")),b.insert("input").attrs({type:"range",min:1,max:40,step:1}).styles({width:"58px","vertical-align":"middle",display:"inline",float:"right"}).property("value",c.size).on("change",function(){var a=+this.value,r=current_layers[e].nCol;current_layers[e].size=a,p.selectAll("g").selectAll(l).each(function(e,o){if("circle"===l){var i=t(o%r*2*a),s=n(2*n(o/r)*a);this.setAttribute("r",a),this.setAttribute("transform","translate(-"+i+", -"+s+")")}else{var p=a/5,c=t(o%r*a)+p*t(o%r),d=n(n(o/r)*a)+p*n(o/r);this.setAttribute("width",a),this.setAttribute("height",a),this.setAttribute("transform","translate(-"+c+", -"+d+")")}}),b.select("#size_section_txt").html(this.value+" px")}),b.append("span").attr("id","size_section_txt").style("float","right").html(c.size+" px");var x=_.append("p").attr("class","line_elem").attr("id","width_row_section");x.append("span").html(i18next.t("app_page.func_options.twostocks.waffle_width_rows")),x.insert("input").attrs({type:"range",min:1,max:10,step:1}).styles({width:"58px","vertical-align":"middle",display:"inline",float:"right"}).property("value",c.nCol).on("change",function(){var a=+this.value,r=current_layers[e].size;current_layers[e].nCol=a,p.selectAll("g").selectAll(l).each(function(e,o){if("circle"===l){var i=t(o%a*2*r),s=n(2*n(o/a)*r);this.setAttribute("transform","translate(-"+i+", -"+s+")")}else{var p=r/5,c=t(o%a*r)+p*t(o%a),d=n(n(o/a)*r)+p*n(o/a);this.setAttribute("transform","translate(-"+c+", -"+d+")")}}),x.select("#width_row_text").html(this.value)}),x.append("span").attr("id","width_row_text").style("float","right").html(c.nCol);var k=_.append("p"),A=k.insert("input").style("margin","0").property("checked",!!current_layers[e].draggable||null).attrs({type:"checkbox",id:"checkbox_move_symbol"});k.insert("label").attr("for","checkbox_move_symbol").html(i18next.t("app_page.layer_style_popup.let_draggable")),A.on("change",function(){this.checked?current_layers[e].draggable=!0:current_layers[e].draggable=!1});var j=e;h(_,e).on("change",function(){j=this.value})}(e):"Stewart"===current_layers[e].renderer?function(e){(0,i.check_remove_existing_box)(".styleBox");var t="#"+_app.layer_to_id.get(e),n=map.select(t).selectAll("path"),a=n.style("fill-opacity"),r=current_layers[e].n_features,l=(0,c.cloneObj)(current_layers[e].color_palette),s=function(t,a){var o=getColorBrewerArray(r,t);a&&o.reverse();for(var i=0;i<r;++i)d.breaks[i][1]=o[i];n.transition().style("fill",function(e,t){return o[t]}),current_layers[e].color_palette={name:t,reversed:a}},p=(0,c.cloneObj)(current_layers[e].fill_color),d={breaks:[].concat(current_layers[e].colors_breaks)},_=void 0;current_layers[e].colors_breaks&&current_layers[e].colors_breaks instanceof Array&&(_=current_layers[e].colors_breaks.concat([]));var m=n.style("stroke-opacity"),y=+current_layers[e]["stroke-width-const"],g=n.style("stroke");g.startsWith("rgb")&&(g=(0,o.rgb2hex)(g));(0,i.make_confirm_dialog2)("styleBox",e,{top:!0,widthFitContent:!0,draggable:!0}).then(function(r){if(r)current_layers[e].colors_breaks=d.breaks,current_layers[e].fill_color.class=d.breaks.map(function(e){return e[1]}),"legend_root"===document.querySelector(".legend.legend_feature.lgdf_"+_app.layer_to_id.get(e)).id?v("choro",e,current_layers[e].rendered_field):v("choro_horiz",e,current_layers[e].rendered_field),A!==e&&w(e,check_layer_name(A.trim())),(0,u.zoom_without_redraw)();else{n.style("fill-opacity",a).style("stroke-opacity",m);var o=+d3.zoomTransform(map.node()).k;map.select(t).style("stroke-width",y/o+"px"),current_layers[e]["stroke-width-const"]=y;Object.getOwnPropertyNames(p)[0];s(l.name,l.reversed),"legend_root"===document.querySelector(".legend.legend_feature.lgdf_"+_app.layer_to_id.get(e)).id?v("choro",e,current_layers[e].rendered_field):v("choro_horiz",e,current_layers[e].rendered_field),current_layers[e].colors_breaks=_,current_layers[e].fill_color=p,(0,u.zoom_without_redraw)()}});var f=document.querySelector(".twbs > .styleBox"),k=d3.select(f).select(".modal-content").style("width","300px").select(".modal-body"),A=e;h(k,e).on("change",function(){A=this.value});var j=k.insert("p").attr("class","line_elem");j.append("span").html(i18next.t("app_page.layer_style_popup.color_palette"));var S=j.insert("select").attr("id","coloramp_params").style("float","right").on("change",function(){s(this.value,!1)});["Blues","BuGn","BuPu","GnBu","OrRd","PuBu","PuBuGn","PuRd","RdPu","YlGn","Greens","Greys","Oranges","Purples","Reds"].forEach(function(e){S.append("option").text(e).attr("value",e)}),S.node().value=l.name,k.insert("p").attr("class","line_elem").styles({"text-align":"center",margin:"0 !important"}).insert("button").attrs({class:"button_st3",id:"reverse_colramp"}).html(i18next.t("app_page.layer_style_popup.reverse_palette")).on("click",function(){var e=document.getElementById("coloramp_params").value;s(e,!0)});var E=k.append("p").attr("class","line_elem");E.append("span").html(i18next.t("app_page.layer_style_popup.fill_opacity")),E.insert("input").attrs({type:"range",min:0,max:1,step:.1}).styles({width:"58px","vertical-align":"middle",display:"inline",float:"right","margin-right":"0px"}).property("value",a).on("change",function(){n.style("fill-opacity",this.value),E.select("#fill_opacity_txt").html(100*this.value+"%")}),E.append("span").style("float","right").attr("id","fill_opacity_txt").html(100*+a+"%");var z=k.append("p").attr("class","line_elem");z.insert("span").html(i18next.t("app_page.layer_style_popup.border_color")),z.insert("input").attr("type","color").style("float","right").property("value",g).on("change",function(){n.style("stroke",this.value)});var B=k.append("p").attr("class","line_elem");B.insert("span").html(i18next.t("app_page.layer_style_popup.border_opacity")),B.insert("input").attrs({type:"range",min:0,max:1,step:.1}).styles({width:"58px","vertical-align":"middle",display:"inline",float:"right"}).property("value","border_opacity").on("change",function(){B.select("#opacity_val_txt").html(" "+this.value),n.style("stroke-opacity",this.value)}),B.append("span").attr("id","opacity_val_txt").styles({display:"inline",float:"right"}).html(" "+m);var P=k.append("p");P.append("span").html(i18next.t("app_page.layer_style_popup.border_width")),P.insert("input").attrs({type:"number",min:0,step:.1}).styles({width:"60px",float:"right"}).property("value",y).on("change",function(){var n=+this.value,a=+d3.zoomTransform(map.node()).k;map.select(t).style("stroke-width",n/a+"px"),current_layers[e]["stroke-width-const"]=n});var O=k.append("p"),C=O.insert("input").style("margin","0").property("checked",!!map.select(t).attr("filter")||null).attrs({type:"checkbox",id:"checkbox_shadow_layer"});O.insert("label").attr("for","checkbox_shadow_layer").html(i18next.t("app_page.layer_style_popup.layer_shadow")),C.on("change",function(){if(this.checked)x(_app.layer_to_id.get(e));else{var n=map.select(t).attr("filter");svg_map.querySelector(n.substring(4).replace(")","")).remove(),map.select(t).attr("filter",null)}}),b(k,e)}(e):function(e){(0,i.check_remove_existing_box)(".styleBox");var t=current_layers[e].type,n=!0===current_layers[e].sphere,a=current_layers[e].renderer,s="#"+_app.layer_to_id.get(e),p=map.select(s).selectAll("path"),_=p.style("fill-opacity"),m=(0,c.cloneObj)(current_layers[e].fill_color),k=void 0,A=void 0,j=void 0;current_layers[e].colors_breaks&&current_layers[e].colors_breaks instanceof Array?k=current_layers[e].colors_breaks.concat([]):m.random&&(j=[],p.each(function(e){j.push(this.style.fill)}));var S=p.style("stroke-opacity"),E=+current_layers[e]["stroke-width-const"],z=[],B=p.style("stroke"),P=void 0;B.startsWith("rgb")&&(B=(0,o.rgb2hex)(B));Array.prototype.forEach.call(svg_map.querySelector(s).querySelectorAll("path"),function(e){z.push(e.__data__.properties)});var O=n?[]:current_layers[e].fields_type||(0,c.type_col2)(z);(0,i.make_confirm_dialog2)("styleBox",e,{top:!0,widthFitContent:!0,draggable:!0}).then(function(n){if(n){if("Point"===t&&current_layers[e].pointRadius&&(current_layers[e].pointRadius=+P),void 0!==a&&void 0!==A&&"Categorical"!==a){current_layers[e].fill_color={class:A.colorsByFeature};for(var r=[],i=A.breaks.length-1;i>0;--i)r.push([[A.breaks[i-1]," - ",A.breaks[i]].join(""),A.colors[i-1]]);current_layers[e].colors_breaks=r,current_layers[e].rendered_field=A.field,current_layers[e].options_disc={schema:A.schema,colors:A.colors,no_data:A.no_data,type:A.type,breaks:A.breaks,extra_options:A.extra_options}}else"Categorical"===a&&void 0!==A&&(current_layers[e].color_map=A.color_map,current_layers[e].fill_color={class:[].concat(A.colorsByFeature)});void 0!==A&&void 0!==A.field&&("legend_root"===document.querySelector(".legend.legend_feature.lgdf_"+_app.layer_to_id.get(e)).id?v("choro",e,current_layers[e].rendered_field):v("choro_horiz",e,current_layers[e].rendered_field)),I!==e&&w(e,check_layer_name(I.trim())),(0,u.zoom_without_redraw)()}else{p.style("fill-opacity",_).style("stroke-opacity",S);var l=+d3.zoomTransform(map.node()).k;map.select(s).style("stroke-width",E/l+"px"),current_layers[e]["stroke-width-const"]=E;var c=Object.getOwnPropertyNames(m)[0];"Point"===t&&current_layers[e].pointRadius?p.attr("d",path.pointRadius(+current_layers[e].pointRadius)):"single"===c?p.style("fill",m.single).style("stroke",B):"class"===c?p.style("fill-opacity",_).style("fill",function(e,t){return m.class[t]}).style("stroke-opacity",S).style("stroke",B):"random"===c?p.style("fill",function(e,t){return j[t]||o.Colors.names[o.Colors.random()]}).style("stroke",B):"categorical"===c&&f(e,m.categorical[0],"path",m.categorical[1]),current_layers[e].colors_breaks&&(current_layers[e].colors_breaks=k),current_layers[e].fill_color=m,(0,u.zoom_without_redraw)()}});var C=document.querySelector(".twbs > .styleBox"),M=d3.select(C).select(".modal-content").style("width","300px").select(".modal-body"),I=e;if("World"!==e){var q=h(M,e);q.on("change",function(){I=this.value})}if("Point"===t){P=current_layers[e].pointRadius;var L=M.append("p").attr("class","line_elem");L.append("span").html(i18next.t("app_page.layer_style_popup.point_radius")),L.append("input").attrs({type:"range",min:0,max:80,id:"point_radius_size"}).styles({width:"58px","vertical-align":"middle",display:"inline",float:"right","margin-right":"0px"}).property("value",P).on("change",function(){P=+this.value,document.getElementById("point_radius_size_txt").value=P,p.attr("d",path.pointRadius(P))}),L.append("input").attrs({type:"number",min:0,max:80,step:"any",class:"without_spinner",id:"point_radius_size_txt"}).styles({width:"30px","margin-left":"10px",float:"right"}).property("value",+P).on("change",function(){var e=document.getElementById("point_radius_size"),t=e.value;""===this.value||isNaN(+this.value)?this.value=t:(this.value=(0,d.round_value)(+this.value,2),e.value=this.value,P=this.value,p.attr("d",path.pointRadius(this.value)))})}if(void 0===current_layers[e].colors_breaks&&"Categorical"!==a)if(current_layers[e].targeted||current_layers[e].is_result){var T=(0,c.getFieldsType)("category",null,O),N=M.append("p").html(i18next.t("app_page.layer_style_popup.fill_color")).insert("select");[[i18next.t("app_page.layer_style_popup.single_color"),"single"],[i18next.t("app_page.layer_style_popup.categorical_color"),"categorical"],[i18next.t("app_page.layer_style_popup.random_color"),"random"]].forEach(function(e,t){N.append("option").text(e[0]).attr("value",e[1])}),M.append("div").attrs({id:"fill_color_section"}),N.on("change",function(){d3.select("#fill_color_section").html("").on("click",null),"single"===this.value?y(e,m):"categorical"===this.value?function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"path",r=d3.select("#fill_color_section").append("p");r.insert("span").html(i18next.t("app_page.layer_style_popup.categorical_field"));var i=r.insert("select");e.forEach(function(e){"id"!==e&&i.append("option").text(e).attr("value",e)}),n.categorical&&n.categorical instanceof Array&&(0,c.setSelected)(i.node(),n.categorical[0]);i.on("change",function(){var e=this.value,n=(current_layers[t].is_result?result_data[t]:user_data[t]).map(function(t){return t[e]}),r=new Set(n),i=[r.size," cat."].join("");d3.select("#nb_cat_txt").html(i);var l=new Map;Array.from(r.keys()).forEach(function(e){l.set(e,o.Colors.names[o.Colors.random()])}),current_layers[t].fill_color={categorical:[e,l]},f(t,e,a,l)}),n&&n.categorical||!(i.node().options.length>0)||(0,c.setSelected)(i.node(),i.node().options[0].value);r.append("span").attr("id","nb_cat_txt").html("")}(T,e,m):"random"===this.value&&(g(e),document.getElementById("random_color_btn").click())}),(0,c.setSelected)(N.node(),Object.getOwnPropertyNames(m)[0])}else M.append("div").attrs({id:"fill_color_section"}),y(e,m);else if("Categorical"===a){var F=current_layers[e].rendered_field;M.insert("p").styles({margin:"auto","text-align":"center"}).append("button").attr("class","button_disc").html(i18next.t("app_page.layer_style_popup.choose_colors")).on("click",function(){C.modal.hide();var t=prepare_categories_array(e,F,current_layers[e].color_map),n=r(t,2),a=n[0];n[1];display_categorical_box(result_data[e],e,F,a).then(function(e){C.modal.show(),e&&(A={nb_class:e[0],color_map:e[1],colorsByFeature:e[2],renderer:"Categorical",rendered_field:F,field:F},p.transition().style("fill",function(e,t){return A.colorsByFeature[t]}))})})}else if("Choropleth"===a)M.append("p").styles({margin:"auto","text-align":"center"}).append("button").attr("class","button_disc").html(i18next.t("app_page.layer_style_popup.choose_discretization")).on("click",function(){C.modal.hide();var t=A?{schema:A.schema,colors:A.colors,no_data:A.no_data,type:A.type,breaks:A.breaks,extra_options:A.extra_options}:current_layers[e].options_disc;(0,l.display_discretization)(e,current_layers[e].rendered_field,t.breaks.length-1,t).then(function(t){C.modal.show(),t&&(A={nb_class:t[0],type:t[1],breaks:t[2],colors:t[3],colorsByFeature:t[4],schema:t[5],no_data:t[6],field:current_layers[e].rendered_field,extra_options:t[7]},p.transition().style("fill",function(e,t){return A.colorsByFeature[t]}))})});else if("Gridded"===a){var G=current_layers[e].rendered_field;M.append("p").style("margin","auto").style("text-align","center").append("button").attr("class","button_disc").html(i18next.t("app_page.layer_style_popup.choose_discretization")).on("click",function(){C.modal.hide();var t=A?{schema:A.schema,colors:A.colors,no_data:A.no_data,type:A.type,breaks:A.breaks,extra_options:A.extra_options}:current_layers[e].options_disc;(0,l.display_discretization)(e,G,t.breaks.length-1,t).then(function(e){C.modal.show(),e&&(A={nb_class:e[0],type:e[1],breaks:e[2],colors:e[3],colorsByFeature:e[4],schema:e[5],no_data:e[6],renderer:"Choropleth",field:G,extra_options:e[7]},p.transition().style("fill",function(e,t){return A.colorsByFeature[t]}))})})}var D=M.append("p").attr("class","line_elem");D.append("span").html(i18next.t("app_page.layer_style_popup.fill_opacity")),D.insert("input").attrs({type:"range",min:0,max:1,step:.1}).styles({width:"58px","vertical-align":"middle",display:"inline",float:"right","margin-right":"0px"}).property("value",_).on("change",function(){p.style("fill-opacity",this.value),D.select("#fill_opacity_txt").html(100*this.value+"%")}),D.append("span").style("float","right").attr("id","fill_opacity_txt").html(100*+_+"%");var R=M.append("p").attr("class","line_elem");R.insert("span").html(i18next.t("app_page.layer_style_popup.border_color")),R.insert("input").attr("type","color").style("float","right").property("value",B).on("change",function(){p.style("stroke",this.value)});var W=M.append("p").attr("class","line_elem");W.insert("span").html(i18next.t("app_page.layer_style_popup.border_opacity")),W.insert("input").attrs({type:"range",min:0,max:1,step:.1}).styles({width:"58px","vertical-align":"middle",display:"inline",float:"right"}).property("value",S).on("change",function(){W.select("#opacity_val_txt").html(" "+this.value),p.style("stroke-opacity",this.value)}),W.append("span").attr("id","opacity_val_txt").styles({display:"inline",float:"right"}).html(" "+S);var H=M.append("p");H.append("span").html(i18next.t("app_page.layer_style_popup.border_width")),H.insert("input").attrs({type:"number",min:0,step:.1}).styles({width:"60px",float:"right"}).property("value",E).on("change",function(){var t=+this.value,n=+d3.zoomTransform(map.node()).k;map.select(s).style("stroke-width",t/n+"px"),current_layers[e]["stroke-width-const"]=t});var V=M.append("p"),U=V.insert("input").style("margin","0").property("checked",!!map.select(s).attr("filter")||null).attrs({type:"checkbox",id:"checkbox_shadow_layer"});V.insert("label").attr("for","checkbox_shadow_layer").html(i18next.t("app_page.layer_style_popup.layer_shadow")),U.on("change",function(){if(this.checked)x(_app.layer_to_id.get(e));else{var t=map.select(s).attr("filter");svg_map.querySelector(t.substring(4).replace(")","")).remove(),map.select(s).attr("filter",null)}}),b(M,e)}(e)};var o=n(8),i=n(1),l=n(26),s=n(36),p=n(16),c=n(3),d=n(7),_=n(2),u=n(11),m=n(22);function y(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"path",a=d3.select("#fill_color_section"),r="#"+_app.layer_to_id.get(e),o=t&&t.single?t.single:"#FFF",i=a.insert("p");i.insert("span").html(i18next.t("app_page.layer_style_popup.fill_color")),i.insert("input").attr("type","color").style("float","right").property("value",o).on("change",function(){map.select(r).selectAll(n).transition().style("fill",this.value),current_layers[e].fill_color={single:this.value}}),map.select(r).selectAll(n).transition().style("fill",o),current_layers[e].fill_color={single:o}}function g(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"path";d3.select("#fill_color_section").insert("span").attr("id","random_color_btn").styles({cursor:"pointer","text-align":"center"}).html(i18next.t("app_page.layer_style_popup.toggle_colors")).on("click",function(n,a){map.select("#"+_app.layer_to_id.get(e)).selectAll(t).transition().style("fill",function(){return(0,o.randomColor)()}),current_layers[e].fill_color={random:!0}})}function f(e,t,n,a){map.select("#"+_app.layer_to_id.get(e)).selectAll(n).transition().style("fill",function(e){return a.get(e.properties[t])})}function h(e,t){var n=e.insert("p").attr("class","inp_bottom");n.append("span").html(i18next.t("app_page.layer_style_popup.layer_name"));var a=n.append("input").attrs({id:"lyr_change_name",type:"text"}).styles({width:"200px",float:"left"});return a.node().value=t,a}function v(e,t,n){var a="choro"===e?[["#legend_root.lgdf_",_app.layer_to_id.get(t)].join(""),createLegend_choro]:"choro_horiz"===e?[["#legend_root_horiz.lgdf_",_app.layer_to_id.get(t)].join(""),createLegend_choro_horizontal]:"line_class"===e?[["#legend_root_lines_class.lgdf_",_app.layer_to_id.get(t)].join(""),createLegend_discont_links]:"line_symbol"===e?[["#legend_root_lines_symbol.lgdf_",_app.layer_to_id.get(t)].join(""),createLegend_line_symbol]:"waffle"===e?[["#legend_root_waffle.lgdf_",_app.layer_to_id.get(t)].join(""),createLegend_waffle]:void 0,o=r(a,2),i=o[0],l=o[1],s=document.querySelector(i);if(s){var p=s.getAttribute("transform"),c=s.querySelector("#legendtitle").innerHTML,d=s.querySelector("#legendsubtitle").innerHTML,_=s.getAttribute("rounding_precision"),u=s.querySelector("#legend_bottom_note").innerHTML,m=s.getAttribute("boxgap"),y="true"===s.getAttribute("visible_rect")?{color:s.querySelector("#under_rect").style.fill,opacity:s.querySelector("#under_rect").style.fillOpacity}:void 0;if(e.indexOf("choro")>-1){var g=s.querySelector("#no_data_txt");g=null!=g?g.textContent:null,s.remove(),l(t,n,c,d,m,y,_,g,u)}else"waffle"===e?(s.remove(),l(t,n,c,d,y,u)):(s.remove(),l(t,current_layers[t].rendered_field,c,d,y,_,u));s=document.querySelector(i),p&&s.setAttribute("transform",p)}}function b(t,n){var a=function(e){var t=document.getElementById(_app.layer_to_id.get(e)).childNodes[0];if(!t.__data__||!t.__data__.properties)return null;return Object.getOwnPropertyNames(t.__data__.properties)}(n)||[],r=(0,c.type_col2)((0,m.make_table)(n)).filter(function(e){return"ratio"===e.type||"stock"===e.type}).map(function(e){return e.name});if(a&&a.length>0){for(var o=t.append("p"),i={},l=0;l<a.length;l++)i[a[l]]=a[l];o.append("span").attr("id","generate_labels").styles({cursor:"pointer","margin-top":"15px"}).html(i18next.t("app_page.layer_style_popup.generate_labels")).on("mouseover",function(){this.style.fontWeight="bold"}).on("mouseout",function(){this.style.fontWeight=""}).on("click",function(){swal({title:"",html:'<div id="content_label_box">\n<p style="margin: 2px 0 2px 0;">'+i18next.t("app_page.layer_style_popup.field_label")+'</p>\n<select id="label_box_field">\n<option value="___">'+i18next.t("app_page.common.field")+'</option>\n</select>\n<div id="label_box_filter_section" style="margin: 10px 0 10px 0;font-size:0.9em;"></div>\n</div>',type:"question",customClass:"swal2_custom",showCancelButton:!0,showCloseButton:!1,allowEscapeKey:!1,allowOutsideClick:!1,confirmButtonColor:"#DD6B55",confirmButtonText:i18next.t("app_page.common.confirm"),inputOptions:i,onOpen:function(){var e=d3.select("#label_box_field");if(a.forEach(function(t){e.append("option").property("value",t).text(t)}),r.length>0){var t=d3.select("#label_box_filter_section");t.append("input").attrs({type:"checkbox",id:"label_box_filter_chk"}).on("change",function(){this.checked?n.style("display",null):n.style("display","none")});t.append("label").attr("for","label_box_filter_chk").html(i18next.t("app_page.layer_style_popup.filter_label"));var n=t.append("div").style("display","none"),o=n.append("select").attr("id","label_box_filter_field");r.forEach(function(e){o.append("option").property("value",e).text(e)});var i=n.append("select").attr("id","label_box_filter_type");i.append("option").property("value","sup").text(">"),i.append("option").property("value","inf").text("<"),n.append("input").attrs({type:"number",id:"label_box_filter_value"})}},preConfirm:function(){return new e(function(e,t){setTimeout(function(){var o=document.getElementById("label_box_field").value,i=void 0;if(r.length>0&&document.getElementById("label_box_filter_chk").checked){var l=document.getElementById("label_box_filter_value").value;if(!l||isNaN(l))return void t(i18next.t("app_page.common.incorrect_value"));i={field:document.getElementById("label_box_filter_field").value,type_filter:document.getElementById("label_box_filter_type").value,filter_value:l}}a.indexOf(o)<0?t(i18next.t("app_page.common.no_value")):(e(),(0,p.render_label)(n,{label_field:o,filter_options:i,color:"#000",font:"verdana",ref_font_size:12,uo_layer_name:["Labels",o,n].join("_")}))},50)})}}).then(function(e){},function(e){})})}}var x=function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","filter");t.setAttribute("id","filt_"+e),t.setAttribute("width","200%"),t.setAttribute("height","200%");var n=document.createElementNS("http://www.w3.org/2000/svg","feOffset");n.setAttributeNS(null,"result","offOut"),n.setAttributeNS(null,"in","SourceAlpha"),n.setAttributeNS(null,"dx","5"),n.setAttributeNS(null,"dy","5");var a=document.createElementNS("http://www.w3.org/2000/svg","feGaussianBlur");a.setAttributeNS(null,"result","blurOut"),a.setAttributeNS(null,"in","offOut"),a.setAttributeNS(null,"stdDeviation",10);var r=document.createElementNS("http://www.w3.org/2000/svg","feBlend");r.setAttributeNS(null,"in","SourceGraphic"),r.setAttributeNS(null,"in2","blurOut"),r.setAttributeNS(null,"mode","normal"),t.appendChild(n),t.appendChild(a),t.appendChild(r),defs.node().appendChild(t),svg_map.querySelector("#"+e).setAttribute("filter","url(#filt_"+e+")")};function w(e,t){var n=!1;"active"===document.getElementById("info_features").className&&(displayInfoOnMove(),n=!0);var r=a._app.layer_to_id.get(e),o=encodeId(t);current_layers[t]=(0,c.cloneObj)(current_layers[e]),delete current_layers[e];var i=document.querySelector("li."+r);if(i.classList.remove(r),i.classList.add(o),i.setAttribute("layer_name",t),i.innerHTML=i.innerHTML.replace(get_display_name_on_layer_list(e),get_display_name_on_layer_list(t)),svg_map.querySelector("#"+r).id=o,document.querySelectorAll('g[layer_name="'+e+'"]').forEach(function(e){e.setAttribute("layer_name",t),e.classList.remove("lgdf_"+r),e.classList.add("lgdf_"+o)}),Object.getOwnPropertyNames(result_data).indexOf(e)>-1&&(result_data[t]=[].concat(result_data[e]),delete result_data[e]),Object.getOwnPropertyNames(user_data).indexOf(e)>-1&&(user_data[t]=[].concat(user_data[e]),delete user_data[e]),current_layers[t].targeted){var l=document.getElementById("section1").querySelector("#input_geom");l.innerHTML=l.innerHTML.replace(e,t),window.fields_handler&&(window.fields_handler.unfill(),window.fields_handler.fill(t))}if(_app.current_functionnality&&"smooth"===_app.current_functionnality.name)for(var s=document.querySelectorAll("select#stewart_mask > option"),p=0;p<s.length;p++)s[p].value===e&&(s[p].value=t,s[p].innerHTML=t);for(var d=Object.getOwnPropertyNames(current_layers),u=0;u<d.length;u++)current_layers[d[u]].ref_layer_name===e&&(current_layers[d[u]].ref_layer_name=t);for(var m=document.getElementById("section5").querySelectorAll("#layer_to_export > option"),y=0;y<m.length;y++)m[y].value===e&&(m[y].value=t,m[y].innerHTML=t);_app.layer_to_id.set(t,o),_app.id_to_layer.set(o,t),_app.layer_to_id.delete(e),_app.id_to_layer.delete(r),(0,_.binds_layers_buttons)(t),n&&displayInfoOnMove()}}).call(this,n(5),n(4))},function(e,t,n){"use strict";(function(e,a){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,r=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(a=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(r)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();t.valid_join_check_display=l;var o=n(1);function i(){var t=Object.getOwnPropertyNames(e.user_data);1!==t.length||1!==e.joined_dataset.length?swal("",i18next.t("app_page.join_box.unable_join"),"error"):0!==field_join_map.length?(0,o.make_confirm_dialog2)("dialogBox",void 0,{html_content:i18next.t("app_page.join_box.ask_forget_join")}).then(function(e){e&&(l(),field_join_map=[],c(t),p(t[0]))}):e.user_data[t].length!==e.joined_dataset[0].length?(0,o.make_confirm_dialog2)("dialogBox",void 0,{html_content:i18next.t("app_page.join_box.ask_diff_nb_features")}).then(function(e){e&&p(t[0])}):p(t[0])}function l(e,t){if(e){var n=document.getElementById("img_data_ext");n.setAttribute("src","/static/img/b/jointrue.png"),n.setAttribute("alt","Validated join"),n.style.width="28px",n.style.height="28px",n.onclick=null;var a=t.split("/").map(function(e){return+e}),o=r(a,2),l=o[0],s=(o[1],document.getElementById("join_section"));s.innerHTML=[" <b>",t,i18next.t("app_page.join_box.match",{count:l}),"</b>"].join(" ");var p=document.createElement("button");p.setAttribute("id","join_button"),p.style.display="inline",p.innerHTML=[" - <i> ",i18next.t("app_page.join_box.change_field")," </i>"].join(""),p.onclick=i,s.appendChild(p)}else{var c=document.getElementById("img_data_ext");c.setAttribute("src","/static/img/b/joinfalse.png"),c.setAttribute("alt","Non-validated join"),c.style.width="28px",c.style.height="28px",c.onclick=i;var d=document.getElementById("join_section");d.innerHTML=[t,i18next.t("app_page.join_box.state_not_joined")].join("");var _=document.createElement("button");_.setAttribute("id","join_button"),_.style.display="inline",_.innerHTML='<button style="font-size: 11px;" class="button_st3" id="_join_button">'+i18next.t("app_page.join_box.button_join")+"</button>",_.onclick=i,d.appendChild(_)}}function s(t,n,r,o,i,s){var p=e.joined_dataset[0],c=e.user_data[t],d=[s,"/",n.length].join(""),_="",u=void 0;if(s>=n.length){swal({title:"",text:i18next.t("app_page.common.success"),type:"success",allowOutsideClick:!0});for(var m=Object.getOwnPropertyNames(p[0]),y=0,g=n.length;y<g;y++){u=field_join_map[y];for(var f=0,h=m.length;f<h;f++)(_=m[f]).length>0&&(c[y][_]=p[u][_])}return l(!0,d),a.resolve(!0)}return s>0?swal({title:i18next.t("app_page.common.confirm")+"!",text:i18next.t("app_page.join_box.partial_join",{ratio:d}),allowOutsideClick:!1,allowEscapeKey:!0,type:"question",showConfirmButton:!0,showCancelButton:!0,confirmButtonText:i18next.t("app_page.common.yes"),cancelButtonText:i18next.t("app_page.common.no")}).then(function(){for(var n=Object.getOwnPropertyNames(p[0]),r=0,o=field_join_map.length;r<o;r++){u=field_join_map[r];for(var i=0,s=n.length;i<s;i++)if((_=n[i]).length>0){void 0==u?null:""===p[u][_]?null:p[u][_],c[r][_]=void 0!=u?p[u][_]:null}}return swal({title:i18next.t("app_page.common.confirm")+"!",text:i18next.t("app_page.join_box.delete_not_join"),allowOutsideClick:!1,allowEscapeKey:!0,type:"question",showConfirmButton:!0,showCancelButton:!0,confirmButtonText:i18next.t("app_page.common.yes"),cancelButtonText:i18next.t("app_page.common.no")}).then(function(){for(var n=Object.keys(_target_layer_file.objects),r=_target_layer_file.objects[n[0]].geometries,o=[],i=[],s=0;s<c.length;s++)void 0!==field_join_map[s]&&(o.push(c[s]),i.push(r[s]));e.user_data[t]=o,_target_layer_file.objects[n[0]].geometries=i,updateLayer(t),l(!0,[e.user_data[t].length,e.user_data[t].length].join("/"));var p=new FormData,d=path_to_geojson2(t);return p.append("geojson",d),p.append("layer_name",t),xhrequest("POST","/layers/add",p,!1).then(function(e){current_layers[t].key_name=JSON.parse(e).key}).catch(function(e){display_error_during_computation(),console.log(e)}),a.resolve(!0)},function(e){return l(!0,d),a.resolve(!0)})},function(e){return field_join_map=[],a.resolve(!1)}):(swal("",i18next.t("app_page.join_box.no_match",{field1:o,field2:i}),"error"),field_join_map=[],a.resolve(!1))}var p=function(t){for(var n=[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(current_layers[t].original_fields.keys())),a=Object.getOwnPropertyNames(e.joined_dataset[0][0]),i=["<select id=button_field1>"],l=["<select id=button_field2>"],p={field1:n[0],field2:a[0]},c=0,d=n.length;c<d;c++)i.push(['<option value="',n[c],'">',n[c],"</option>"].join(""));i.push("</select>");for(var _=0,u=a.length;_<u;_++)a[_].length>0&&l.push(['<option value="',a[_],'">',a[_],"</option>"].join(""));l.push("</select>");var m=["<p><b><i>",i18next.t("app_page.join_box.select_fields"),"</i></b></p>",'<div style="padding:10px"><p>',i18next.t("app_page.join_box.geom_layer_field"),"</p>",i.join(""),'<em style="float:right;">(',t,")</em></div>",'<div style="padding:15px 10px 10px"><p>',i18next.t("app_page.join_box.ext_dataset_field"),"<br></p>",l.join(""),'<em style="float:right;">(',dataset_name,".csv)</em></div>","<br><p><strong>",i18next.t("app_page.join_box.ask_join"),"<strong></p></div>"].join("");(0,o.make_confirm_dialog2)("joinBox",i18next.t("app_page.join_box.title"),{html_content:m,widthFitContent:!0}).then(function(n){n&&function(t,n,a){var o=[],i=[],l=e.user_data[t],p=e.joined_dataset[0],c=l.length,d=0,_=void 0;field_join_map=[];for(var u=0,m=p.length;u<m;u++)i.push(p[u][a]);for(var y=0,g=l.length;y<g;y++)o.push(l[y][n]);if(has_duplicate(o)||has_duplicate(i))return swal("",i18next.t("app_page.join_box.error_not_uniques"),"warning");if(c>5e3){_app.waitingOverlay.display();var f=new Worker("static/dist/webworker_jointure.js");_app.webworker_to_cancel=f,f.postMessage([o,i]),f.onmessage=function(e){var i=r(e.data,2),l=i[0],p=i[1];_app.webworker_to_cancel=void 0,d=p,field_join_map=l,_app.waitingOverlay.hide(),s(t,o,0,n,a,d).then(function(e){f.terminate(),e&&make_box_type_fields(t)})}}else{if("number"==typeof o[0]&&"string"==typeof i[0])for(var h=0;h<c;h++)-1!==(_=i.indexOf(String(o[h])))?(field_join_map.push(_),d+=1):field_join_map.push(void 0);else if("number"==typeof i[0]&&"string"==typeof o[0])for(var v=0;v<c;v++)-1!==(_=i.indexOf(Number(o[v])))?(field_join_map.push(_),d+=1):field_join_map.push(void 0);else if("number"==typeof i[0]&&"number"==typeof o[0])for(var b=0;b<c;b++)-1!==(_=i.indexOf(o[b]))?(field_join_map.push(_),d+=1):field_join_map.push(void 0);else for(var x=0;x<c;x++)-1!==(_=i.indexOf(String(o[x])))?(field_join_map.push(_),d+=1):field_join_map.push(void 0);s(t,o,0,n,a,d).then(function(e){e&&make_box_type_fields(t)})}}(t,p.field1,p.field2)}),d3.select(".joinBox").styles({"text-align":"center","line-height":"0.9em"}),d3.select("#button_field1").style("float","left").on("change",function(){p.field1=this.value}),d3.select("#button_field2").style("float","left").on("change",function(){p.field2=this.value})},c=function(t){if(e.user_data[t]&&!(e.user_data[t].length<1))for(var n=e.user_data[t],a=current_layers[t].original_fields,r=Object.getOwnPropertyNames(n[0]).filter(function(e){return!a.has(e)}),o=r.length,i=0,l=n.length;i<l;i++)for(var s=0;s<o;s++)delete n[i][r[s]]}}).call(this,n(4),n(5))},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.make_style_box_indiv_symbol=function(e){var t=e.parentElement,n=t.classList.contains("layer")?"layer":"layout",a={size:+e.getAttribute("width").replace("px",""),scalable:!("layout"!==n||!t.classList.contains("scalable-legend"))},r={x:+e.getAttribute("x")+a.size/2,y:+e.getAttribute("y")+a.size/2},o=cloneObj(r);make_confirm_dialog2("styleTextAnnotation",i18next.t("app_page.single_symbol_edit_box.title")).then(function(n){if(!n)if(e.setAttribute("width",a.size+"px"),e.setAttribute("height",a.size+"px"),e.setAttribute("x",r.x-a.size/2),e.setAttribute("y",r.y-a.size/2),a.scalable){var o=svg_map.__zoom;t.setAttribute("transform","translate("+o.x+","+o.y+") scale("+o.k+","+o.k+")"),t.classList.contains("scalable-legend")||t.classList.add("scalable-legend")}else t.classList.contains("layer")||(t.removeAttribute("transform",void 0),t.classList.contains("scalable-legend")&&t.classList.remove("scalable-legend"))});var i=d3.select(".styleTextAnnotation").select(".modal-body").insert("div"),l=i.append("p").attr("class","line_elem");if(l.append("span").html(i18next.t("app_page.single_symbol_edit_box.image_size")),l.append("input").style("float","right").attrs({type:"number",id:"font_size",min:0,max:150,step:"any"}).property("value",a.size).on("change",function(){var t=+this.value;e.setAttribute("width",t+"px"),e.setAttribute("height",t+"px"),e.setAttribute("x",o.x-t/2),e.setAttribute("y",o.y-t/2)}),"layout"===n){t.classList.contains("scalable-legend");var s=i.append("p").attr("class","line_elem");s.append("label").attrs({for:"checkbox_symbol_zoom_scale",class:"i18n","data-i18n":"[html]app_page.single_symbol_edit_box.scale_on_zoom"}).html(i18next.t("app_page.single_symbol_edit_box.scale_on_zoom")),s.append("input").style("float","right").attrs({type:"checkbox",id:"checkbox_symbol_zoom_scale"}).on("change",function(){var n=svg_map.__zoom;this.checked?(e.setAttribute("x",(e.x.baseVal.value-n.x)/n.k),e.setAttribute("y",(e.y.baseVal.value-n.y)/n.k),t.setAttribute("transform","translate("+n.x+","+n.y+") scale("+n.k+","+n.k+")"),t.classList.add("scalable-legend")):(e.setAttribute("x",e.x.baseVal.value*n.k+n.x),e.setAttribute("y",e.y.baseVal.value*n.k+n.y),t.removeAttribute("transform"),t.classList.remove("scalable-legend")),o.x=+e.getAttribute("x"),o.y=+e.getAttribute("y")}),document.getElementById("checkbox_symbol_zoom_scale").checked=a.scalable}};t.display_box_symbol_typo=function(t,n,a){var r=current_layers[t].n_features,o=user_data[t],i=[],l=window.default_symbols;if(a)a.forEach(function(e,t){i.push({name:t,new_name:e[2],nb_elem:e[3],img:"url("+e[0]+")"})});else{a=new Map;for(var s=0;s<r;++s){var p=o[s][n],c=a.get(p);c?a.set(p,[c[0]+1,[s].concat(c[1])]):a.set(p,[1,[s]])}a.forEach(function(e,t){i.push({name:t,new_name:t,nb_elem:e[0],img:'url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIwAAACMCAYAAACuwEE+AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAADVwAAA1cBPbpBvAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAATySURBVHic7dxNiFVlHIDxZ5z8yvKjMgOTFLI0IrQMSg2jIFpESYSbyCGICqKINu6Kdm1KihZtomgRURRI9EH0YQXWLqJFqG1KIsiKQog+MFu8M1R3mo//nXPO+75znh+czVy55/+eeZy59753LkiSJEmSpCGN5B6gQRuAbQNfOwkcAc4GPux8IhXtLuDUwPErsAP4Dbg132jzx4LcA3RgFFgMvAzcmXmW6vUhmIk1jgLPAg9lnKV6fQoG0mO2x4HHMs1Svb4FM2Ef8PQUt2kafbhgU63xPuAFYGGHs1Svz8EA3A68BiztaJbq9SGY0Rluvwl4C1jewSzV60Mws1njLuB9YHXLs1TPYP5xBfARsK7FWapnMP+1CfgYuKilWapnMJNdQIpmawuzVM9g/t+5wAfAzoZnqV4fgpnpWdJUVgDvArsbnKV6fQhmLmtcDLwCjDU0S/UMZmanAc8BDzYwS/UMZnZGgP24aWkwQfuApxq+z6r0YeFNr/F+4HnSr6re6UMwwz5Lms4dwKvAkhbuu2h9CKatNd5M2rQ8s6X7L5LBzM21pE3Lc1o8R1EMZu62kTYtz2/5PEUwmGZsJu0/bezgXFkZTHPWk6LZ0tH5sjCYZq0hbVru6PCcnepDMG08rZ7OSuAd4MaOz9uJPgSTY42nAweAPRnO3SqDac8i4EXg7kznb4XBtGsUeIa0BzUvGEz7Rki73E8yDz5eJffF7EIpa3yAebBpWcrFbFNJa9xLegdftZuWJV3MtpS2xt3AG1S6aVnaxWxDiWu8DniP9FFqVSnxYjat1DVeSdq0XJt7kIhSL2aTSl7jJaT9pwtzDzJbJV/MpnS9NRC1gRTNZbkHmY0+BFPDGs8DDgLbM88xoxou5lzVssZVpE3LG3IPMp1aLuZc1LTGZcDrwG25B5lKTRdzWLWtcRHwEumDqotT9cvUs/Qo6a8WJ6wauH2UyR9XthA4Y+BrS5j8WXjLSN/gf1vO5Afag+dcQPpj/+nOuQc4THpAXIw+BPPD+KEG1PbjWpkZjEIMRiEGoxCDUYjBKMRgFGIwCjEYhRiMQgxGIQajEINRiMEoxGAUYjAKMRiFGIxCDEYhBqMQg1GIwSjEYBRiMAoxGIUYjEIMRiEGoxCDUYjBKMRgFGIwCjEYhRiMQgxGIQajEINRiMEoxGAUYjAKMRiFGIxCDEYhBqMQg1GIwSjEYBRiMAoxGIUYjEIMRiEGoxCDUYjBKMRgFGIwCjEYhRiMQgxGIQajEINRiMEoZCT3AENaDewErgEuBtYDG4ClA//uFHAUOAIcBj4BDgI/djSnMloJ3AscAv4ixTDMcRL4FLgHWN7pCtSJZcDDwAmGj2Sq4wTwyPg5NA9sB47RfCiDxzFgR0drUkvGgD9oP5aJ43dgbycrU+N2kb6BXcUycfwJXN/B+tSgRcDXdB/LxPHN+AyqxBj5Ypk4xlpfZaVKfOHuqtwDAFfnHqBUJQazLvcAlDFDkUoM5rvcAwDf5h6gVCUG82buAShjBs3SKPA5+R7wfjY+gyqyGThO97F8D2zqYH1qweV0G81xYGsnK1Nr1gAHaD+Wt4G1Ha1JLRsBbiG9raHpUA6N33et7wvSDLYD+4GvGD6Sr4An8MW5odT8P2sjsAW4lPQg+SzSm6xWjN/+C/Az8BPwJfAF6dnX0c4nlSRJkiRJgr8BhBGnmRww0QYAAAAASUVORK5CYII=")'})})}var d=i.length,_=make_dialog_container("symbol_box",i18next.t("app_page.symbol_typo_box.title",{layer:t,nb_features:r}),"dialog"),u=d3.select("#symbol_box").select(".modal-body").styles({"overflow-y":"scroll","max-height":window.innerHeight-145+"px"});u.append("h3").html(""),u.append("p").html(i18next.t("app_page.symbol_typo_box.field_categ",{field:n,nb_class:d,nb_features:r})),u.append("ul").style("padding","unset").attr("id","typo_categories").selectAll("li").data(i).enter().append("li").styles({margin:"auto","list-style":"none"}).attr("class","typo_class").attr("id",function(e,t){return["line",t].join("_")}),u.selectAll(".typo_class").append("span").attrs({class:"three_dots"}).style("cursor","grab"),u.selectAll(".typo_class").append("input").styles({width:"100px",height:"auto",display:"inline-block","vertical-align":"middle","margin-right":"7.5px"}).attrs(function(e){return{class:"typo_name",id:e.name}}).property("value",function(e){return e.new_name}),u.selectAll(".typo_class").insert("p").attrs({class:"symbol_section",title:i18next.t("app_page.symbol_typo_box.title_click")}).style("background-image",function(e){return e.img}).styles({width:"32px",height:"32px",margin:"0px 1px 0px 1px","border-radius":"10%",border:"1px dashed blue",display:"inline-block","background-size":"32px 32px","vertical-align":"middle"}).on("click",function(){var t=this;_.hide(),function(t,n){make_dialog_container("box_choice_symbol",i18next.t("app_page.box_choice_symbol.title"),"dialog");overlay_under_modal.display();var a=document.getElementById("box_choice_symbol"),r=a.querySelector(".btn_ok");a.querySelector(".modal-dialog").classList.add("fitContent"),r.disabled="disabled";var o=d3.select(a).select(".modal-body").style("width","220px");o.append("p").html("<b>"+i18next.t("app_page.box_choice_symbol.select_symbol")+"</b>");var i=o.append("div").styles({width:"190px",height:"100px",overflow:"auto",border:"1.5px solid #1d588b"}).attr("id","symbols_select");i.selectAll("p").data(t).enter().append("p").attrs(function(e){return{id:"p_"+e[0].replace(".png",""),title:e[0]}}).styles(function(e){return{width:"32px",height:"32px",margin:"auto",display:"inline-block","background-size":"32px 32px","background-image":'url("'+e[1]+'")'}}).on("click",function(){i.selectAll("p").each(function(){this.style.border="",this.style.padding="0px"}),this.style.padding="-1px",this.style.border="1px dashed red",r.disabled=!1,o.select("#current_symb").style("background-image",this.style.backgroundImage)}),o.append("p").attr("display","inline").html("<b>"+i18next.t("app_page.box_choice_symbol.upload_symbol")+"</b>"),o.append("p").styles({margin:"auto","text-align":"center"}).append("button").html(i18next.t("app_page.box_choice_symbol.browse")).on("click",function(){var e=document.createElement("input");e.setAttribute("type","file"),e.setAttribute("accept",".jpeg,.jpg,.svg,.png,.gif"),e.onchange=function(e){var t=e.target.files[0],n=(t.name,new FileReader);n.onloadend=function(){var e=['url("',n.result,'")'].join("");r.disabled=!1,o.select("#current_symb").style("background-image",e)},n.readAsDataURL(t)},e.dispatchEvent(new MouseEvent("click"))}),o.insert("p").style("text-align","center").html(i18next.t("app_page.box_choice_symbol.selected_symbol")),o.insert("div").style("text-align","center").append("p").attrs({class:"symbol_section",id:"current_symb"}).styles({width:"32px",height:"32px",margin:"auto",display:"inline-block","border-radius":"10%","background-size":"32px 32px","vertical-align":"middle","background-image":"url('')"});var l=e.pending(),s=function(e){helper_esc_key_twbs_cb(e,c)},p=function(){a.remove(),n?reOpenParent(n):overlay_under_modal.hide(),document.removeEventListener("keydown",s)};a.querySelector(".btn_ok").onclick=function(){var e=o.select("#current_symb").style("background-image");l.resolve(e),p()};var c=function(){l.resolve(!1),p()};return a.querySelector(".btn_cancel").onclick=c,a.querySelector("#xclose").onclick=c,document.addEventListener("keydown",s),l.promise}(l,".dialog").then(function(e){_.show(),e&&(t.style.backgroundImage=e)})}),u.selectAll(".typo_class").insert("span").html(function(e){return i18next.t("app_page.symbol_typo_box.count_feature",{nb_features:e.nb_elem})}),u.selectAll(".typo_class").insert("input").attrs({type:"number",id:"symbol_size"}).styles({width:"50px",display:"inline-block"}).property("value",50),u.selectAll(".typo_class").insert("span").style("display","inline-block").html(" px"),new Sortable(document.getElementById("typo_categories"));var m=e.pending(),y=document.getElementById("symbol_box"),g=function(e){helper_esc_key_twbs_cb(e,h)},f=function(){y.remove(),overlay_under_modal.hide(),document.removeEventListener("keydown",g)},h=function(){m.resolve(!1),f()};return y.querySelector(".btn_ok").onclick=function(){var e=function(){for(var e=document.getElementsByClassName("typo_class"),t=new Map,n=0;n<e.length;n++){var a=e[n].querySelector(".symbol_section"),r=e[n].querySelector(".typo_name").value;if(a.style.backgroundImage.length>7){var o=a.style.backgroundImage.split("url(")[1].substring(1).slice(0,-2),l=+e[n].querySelector("#symbol_size").value;t.set(e[n].__data__.name,[o,l,r,i[n].nb_elem])}else t.set(e[n].__data__.name,[null,0,r,i[n].nb_elem])}return t}();m.resolve([d,e]),f()},y.querySelector(".btn_cancel").onclick=h,y.querySelector("#xclose").onclick=h,document.addEventListener("keydown",g),overlay_under_modal.display(),m.promise}}).call(this,n(5))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=(d(n(10)),d(n(9))),o=n(8),i=n(1),l=n(3),s=n(2),p=n(12),c=n(6);function d(e){return e&&e.__esModule?e:{default:e}}var _=Math.round,u=function(){function e(t,n){var a=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[10,30];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var i=this;this.x=o[0],this.y=o[1],this.fontSize=14;var l=new r.default,d=d3.drag().subject(function(){var e=d3.select(this).select("text"),t=(0,p.get_coords_snap_lines)(this.id);return{x:e.attr("x"),y:e.attr("y"),map_locked:!!map_div.select("#hand_button").classed("locked"),snap_lines:t}}).on("start",function(){d3.event.sourceEvent.stopPropagation(),(0,s.handle_click_hand)("lock")}).on("end",function(){d3.event.subject&&!d3.event.subject.map_locked&&(0,s.handle_click_hand)("unlock"),pos_lgds_elem.set(this.id,this.querySelector("rect").getBBox()),console.log(this.querySelector("rect"))}).on("drag",function(){d3.event.sourceEvent.preventDefault();var e=d3.select(this).select("text").attrs({x:+d3.event.x,y:+d3.event.y}),t=e.attr("transform");if(t){var n=+t.match(/[-.0-9]+/g)[0];e.attr("transform","rotate("+n+", "+(d3.event.x+i.width)+", "+(d3.event.y+i.height)+")")}if(e.selectAll("tspan").attr("x",+d3.event.x),_app.autoalign_features)for(var a=e.node().getBBox(),r=a.x-10,o=r+a.width+20,l=a.y-10,s=l+a.height+20,d=d3.event.subject.snap_lines.x,_=d3.event.subject.snap_lines.y,u=0;u<d.length;u++){if((0,c.Mabs)(d[u][0]-r)<10){var m=(0,c.Mmin)((0,c.Mmin)(_[u][0],_[u][1]),l),y=(0,c.Mmax)((0,c.Mmax)(_[u][0],_[u][1]),s);(0,p.make_red_line_snap)(d[u][0],d[u][0],m,y),e.selectAll("tspan").attr("x",d[u][0]+10),e.attr("x",d[u][0]+10)}if((0,c.Mabs)(d[u][0]-o)<10){var g=(0,c.Mmin)((0,c.Mmin)(_[u][0],_[u][1]),l),f=(0,c.Mmax)((0,c.Mmax)(_[u][0],_[u][1]),s);(0,p.make_red_line_snap)(d[u][0],d[u][0],g,f),e.selectAll("tspan").attr("x",d[u][0]-a.width-10),e.attr("x",d[u][0]-a.width-10)}if((0,c.Mabs)(_[u][0]-l)<10){var h=(0,c.Mmin)((0,c.Mmin)(d[u][0],d[u][1]),r),v=(0,c.Mmax)((0,c.Mmax)(d[u][0],d[u][1]),o);(0,p.make_red_line_snap)(h,v,_[u][0],_[u][0]),e.attr("y",_[u][0]+a.height+7.5)}if((0,c.Mabs)(_[u][0]-s)<10){var b=(0,c.Mmin)((0,c.Mmin)(d[u][0],d[u][1]),r),x=(0,c.Mmax)((0,c.Mmax)(d[u][0],d[u][1]),o);(0,p.make_red_line_snap)(b,x,_[u][0],_[u][0]),e.attr("y",_[u][0]-17.5)}}if(e.attr("x",e.select("tspan").attr("x")),i.x=e.attr("x"),i.y=e.attr("y"),t){var w=+t.match(/[-.0-9]+/g)[0];e.attr("transform","rotate("+w+", "+i.x+", "+i.y+")")}i.update_bbox()}),u=map.append("g").attrs({id:n,class:"legend txt_annot"}).styles({cursor:"pointer"}).on("mouseover",function(){m.style("fill-opacity",.1)}).on("mouseout",function(){m.style("fill-opacity",0)}),m=u.append("rect").styles({fill:"green","fill-opacity":0}),y=u.append("text").attrs({x:this.x,y:this.y,id:["in_",n].join("")}).styles({"font-size":this.fontSize+"px","font-family":"verdana","text-anchor":"start"});y.append("tspan").attr("x",this.x).text(i18next.t("app_page.text_box_edit_box.constructor_default")),u.call(d),u.on("dblclick",function(){d3.event.preventDefault(),d3.event.stopPropagation(),a.editStyle()}).on("contextmenu",function(){l.showMenu(d3.event,document.querySelector("body"),[{name:i18next.t("app_page.common.edit_style"),action:function(){a.editStyle()}},{name:i18next.t("app_page.common.up_element"),action:function(){a.up_element()}},{name:i18next.t("app_page.common.down_element"),action:function(){a.down_element()}},{name:i18next.t("app_page.common.delete"),action:function(){a.remove()}}])}),this.lineHeight=_(1.4*this.fontSize),this.textAnnot=y,this.group=u,this.fontFamily="verdana",this.anchor="start",this.buffer=void 0,this.id=n,this.update_bbox(),pos_lgds_elem.set(this.id,u.node().getBBox())}return a(e,[{key:"remove",value:function(){pos_lgds_elem.delete(this.group.attr("id")),this.group.remove()}},{key:"update_text",value:function(e){var t=e.split("\n");this.textAnnot.selectAll("tspan").remove();for(var n=0;n<t.length;n++)this.textAnnot.append("tspan").attrs({x:this.x,dy:0===n?null:this.lineHeight}).html(t[n]);this.update_bbox()}},{key:"get_text_content",value:function(){var e=[];return this.textAnnot.selectAll("tspan").each(function(){e.push(this.innerHTML)}),e.join("\n")}},{key:"update_bbox",value:function(){var e=this.textAnnot.node().getBBox();this.width=e.width,this.height=e.height,this.group.select("rect").attrs({x:e.x-10,y:e.y-10,height:this.height+20,width:this.width+20})}},{key:"updateLineHeight",value:function(){var e=this;e.lineHeight=_(1.4*e.fontSize),e.textAnnot.selectAll("tspan").each(function(t,n){0!==n&&d3.select(this).attr("dy",e.lineHeight)})}},{key:"editStyle",value:function(){var e=this,t=this,n=t.textAnnot;(0,i.check_remove_existing_box)(".styleTextAnnotation");var a={size:t.fontSize,color:n.style("fill"),content:unescape(this.get_text_content()),transform_rotate:n.attr("transform"),x:n.attr("x"),y:n.attr("y"),font_weight:n.style("font-weight"),font_style:n.style("font-style"),text_decoration:n.style("text-decoration"),buffer:void 0!==t.buffer?(0,l.cloneObj)(t.buffer):void 0,text_shadow:n.style("text-shadow"),font_family:t.fontFamily};a.font_weight="400"===a.font_weight||""===a.font_weight?"":"bold",(0,i.make_confirm_dialog2)("styleTextAnnotation",i18next.t("app_page.text_box_edit_box.title"),{widthFitContent:!0}).then(function(r){r?S.node().checked||(t.buffer=void 0):(n.styles({color:a.color,"font-size":a.size+"px","font-weight":a.font_weight,"text-decoration":a.text_decoration,"font-style":a.font_style,"text-shadow":a.text_shadow,"font-family":a.font_family}),t.fontSize=a.size,t.fontFamily=a.font_family,n.attr("transform",a.transform_rotate),t.buffer=a.buffer,e.update_text(a.content))});var r=d3.select(".styleTextAnnotation").select(".modal-body").style("width","295px").insert("div").attr("id","styleTextAnnotation"),s="string"==typeof a.transform_rotate?a.transform_rotate.match(/[-.0-9]+/g):0;s=s&&3===s.length?+s[0]:0;var p=n.node().getBBox(),c=p.x,d=p.y,_=c+p.width/2,u=d+p.height/2,m=r.append("p").attr("class","line_elem2");m.append("span").html(i18next.t("app_page.text_box_edit_box.rotation")),m.append("span").style("float","right").html(" °"),m.append("input").attrs({type:"number",min:0,max:360,step:"any",class:"without_spinner",id:"textbox_txt_rotate"}).styles({width:"40px",float:"right"}).property("value",s).on("change",function(){var e=+this.value;n.attrs({x:c,y:d,transform:"rotate("+[e,_,u]+")"}),n.selectAll("tspan").attr("x",c),document.getElementById("textbox_range_rotate").value=e}),m.append("input").attrs({type:"range",min:0,max:360,step:.1,id:"textbox_range_rotate"}).styles({"vertical-align":"middle",width:"100px",float:"right",margin:"auto 10px"}).property("value",s).on("change",function(){var e=+this.value;n.attrs({x:c,y:d,transform:"rotate("+[e,_,u]+")"}),n.selectAll("tspan").attr("x",c),document.getElementById("textbox_txt_rotate").value=e});var y=r.append("p"),g=y.insert("select").on("change",function(){n.style("font-family",this.value),t.fontFamily=this.value});available_fonts.forEach(function(e){g.append("option").text(e[0]).attr("value",e[1])}),g.node().selectedIndex=available_fonts.map(function(e){return e[1]===t.fontFamily?"1":"0"}).indexOf("1"),y.append("input").attrs({id:"font_size",min:0,max:34,step:.1,type:"number"}).styles({width:"60px",margin:"0 15px"}).property("value",t.fontSize).on("change",function(){t.fontSize=+this.value,n.style("font-size",t.fontSize+"px"),t.updateLineHeight(),t.update_bbox()}),y.append("input").attrs({type:"color",id:"font_color"}).style("width","60px").property("value",(0,o.rgb2hex)(a.color)).on("change",function(){n.style("fill",this.value)});var f=r.append("p").style("text-align","center"),h=f.insert("span").attr("class","bold"===a.font_weight?"active button_disc":"button_disc").html('<img title="Bold" src="data:image/gif;base64,R0lGODlhFgAWAID/AMDAwAAAACH5BAEAAAAALAAAAAAWABYAQAInhI+pa+H9mJy0LhdgtrxzDG5WGFVk6aXqyk6Y9kXvKKNuLbb6zgMFADs=">'),v=f.insert("span").attr("class","italic"===a.font_style?"active button_disc":"button_disc").html('<img title="Italic" src="data:image/gif;base64,R0lGODlhFgAWAKEDAAAAAF9vj5WIbf///yH5BAEAAAMALAAAAAAWABYAAAIjnI+py+0Po5x0gXvruEKHrF2BB1YiCWgbMFIYpsbyTNd2UwAAOw==">'),b=f.insert("span").attr("class","underline"===a.text_decoration?"active button_disc":"button_disc").html('<img title="Underline" src="data:image/gif;base64,R0lGODlhFgAWAKECAAAAAF9vj////////yH5BAEAAAIALAAAAAAWABYAAAIrlI+py+0Po5zUgAsEzvEeL4Ea15EiJJ5PSqJmuwKBEKgxVuXWtun+DwxCCgA7">'),x=r.append("p");x.append("span").html(i18next.t("app_page.text_box_edit_box.content"));var w=x.append("span").attr("class","align-option").styles({"font-size":"11px","font-weight":"","margin-left":"10px",float:"right"}).html("right").on("click",function(){x.selectAll(".align-option").style("font-weight",""),w.style("font-weight","bold").style("font-size","12px"),n.style("text-anchor","end"),t.anchor="end",t.update_bbox()}),k=x.append("span").styles({"font-size":"11px","font-weight":"","margin-left":"10px",float:"right"}).attr("class","align-option").html("center").on("click",function(){x.selectAll(".align-option").style("font-weight",""),k.style("font-weight","bold").style("font-size","12px"),n.style("text-anchor","middle"),t.anchor="middle",t.update_bbox()}),A=x.append("span").styles({"font-size":"11px","font-weight":"","margin-left":"10px",float:"right"}).attr("class","align-option").html("left").on("click",function(){x.selectAll(".align-option").style("font-weight","").style("font-size","11px"),A.style("font-weight","bold").style("font-size","12px"),n.style("text-anchor","start"),t.anchor="start",t.update_bbox()});("start"===t.anchor?A:"middle"===t.anchor?k:w).style("font-weight","bold").style("font-size","12px"),x.append("span").html("<br>"),x.append("textarea").attr("id","annotation_content").styles({margin:"5px 0px 0px",width:"100%"}).on("keyup",function(){t.update_text(this.value)}),document.getElementById("annotation_content").value=a.content;var j=r.append("p"),S=j.append("input").attrs({type:"checkbox",id:"buffer_txt_chk",checked:void 0!==a.buffer||null}).on("change",function(){if(this.checked){E.style("display",""),void 0===t.buffer&&(t.buffer={color:"#FFFFFF",size:1});var e=t.buffer.color,a=t.buffer.size;n.style("text-shadow","-"+a+"px 0px 0px "+e+", 0px "+a+"px 0px "+e+", "+a+"px 0px 0px "+e+", 0px -"+a+"px 0px "+e)}else E.style("display","none"),n.style("text-shadow","none")});j.append("label").attrs({for:"buffer_txt_chk"}).text(i18next.t("app_page.text_box_edit_box.buffer"));var E=j.append("input").styles({display:void 0!==a.buffer?"":"none",float:"right"}).attr("type","color").property("value",a.buffer&&a.buffer.color?a.buffer.color:"#FFFFFF").on("change",function(){t.buffer.color=this.value;var e=t.buffer.color,a=t.buffer.size;n.style("text-shadow","-"+a+"px 0px 0px "+e+", 0px "+a+"px 0px "+e+", "+a+"px 0px 0px "+e+", 0px -"+a+"px 0px "+e)});h.on("click",function(){this.classList.contains("active")?(this.classList.remove("active"),n.style("font-weight","")):(this.classList.add("active"),n.style("font-weight","bold"))}),v.on("click",function(){this.classList.contains("active")?(this.classList.remove("active"),n.style("font-style","")):(this.classList.add("active"),n.style("font-style","italic"))}),b.on("click",function(){this.classList.contains("active")?(this.classList.remove("active"),n.style("text-decoration","")):(this.classList.add("active"),n.style("text-decoration","underline"))})}},{key:"up_element",value:function(){up_legend(this.group.node())}},{key:"down_element",value:function(){down_legend(this.group.node())}}]),e}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=c(n(10)),o=c(n(9)),i=n(8),l=n(6),s=n(2),p=n(1);function c(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:30,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:40;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parent=a||svg_map,this.svg_elem=d3.select(this.parent),this.id=t,this.stroke_width=4,this.stroke_color="rgb(0, 0, 0)",this.fill_color="rgb(255, 255, 255)",this.fill_opacity=0,this.height=i,this.width=o;var l=this;if(r)this.pt1=[+n[0],+n[1]];else{var p=svg_map.__zoom;this.pt1=[(+n[0]-p.x)/p.k,(+n[1]-p.y)/p.k]}return this.drag_behavior=d3.drag().subject(function(){var e=d3.select(this.querySelector("rect"));return{x:+e.attr("x"),y:+e.attr("y"),map_locked:!!map_div.select("#hand_button").classed("locked")}}).on("start",function(){d3.event.sourceEvent.stopPropagation(),(0,s.handle_click_hand)("lock")}).on("end",function(){d3.event.subject&&!d3.event.subject.map_locked&&(0,s.handle_click_hand)("unlock")}).on("drag",function(){d3.event.sourceEvent.preventDefault();var e=this.querySelector("rect"),t=d3.event.subject,n=(+d3.event.x-+t.x)/svg_map.__zoom.k,a=(+d3.event.y-+t.y)/svg_map.__zoom.k;l.pt1=[+t.x+n,+t.y+a],e.x.baseVal.value=l.pt1[0],e.y.baseVal.value=l.pt1[1]}),this.draw(),this}return a(e,[{key:"up_element",value:function(){up_legend(this.rectangle.node())}},{key:"down_element",value:function(){down_legend(this.rectangle.node())}},{key:"draw",value:function(){var e=this,t=new o.default;this.rectangle=this.svg_elem.append("g").attrs({class:"user_rectangle legend scalable-legend",id:this.id,transform:svg_map.__zoom.toString()});this.rectangle.insert("rect").attrs({x:this.pt1[0],y:this.pt1[1],height:this.height,width:this.width}).styles({fill:this.fill_color,"fill-opacity":0,stroke:this.stroke_color,"stroke-width":this.stroke_width});this.rectangle.on("contextmenu",function(){t.showMenu(d3.event,document.body,[{name:i18next.t("app_page.common.edit_style"),action:function(){e.editStyle()}},{name:i18next.t("app_page.common.up_element"),action:function(){e.up_element()}},{name:i18next.t("app_page.common.down_element"),action:function(){e.down_element()}},{name:i18next.t("app_page.common.delete"),action:function(){e.remove()}}])}).on("dblclick",function(){d3.event.preventDefault(),d3.event.stopPropagation(),e.handle_ctrl_pt()}).call(this.drag_behavior)}},{key:"remove",value:function(){this.rectangle.remove()}},{key:"handle_ctrl_pt",value:function(){var e=this,t=e.rectangle.node().querySelector("rect"),n=svg_map.__zoom,a=!!map_div.select("#hand_button").classed("locked"),o=[e.pt1[0]+t.width.baseVal.value/2,e.pt1[1]+t.height.baseVal.value/2],i=[e.pt1[0]+t.width.baseVal.value,e.pt1[1]+t.height.baseVal.value],p=r.default.notify(i18next.t("app_page.notification.instruction_modify_feature"),"warning",0),c=e.pt1.slice(),d=function(){_.remove(),p.dismiss(),e.rectangle.call(e.drag_behavior),e.rectangle.on("dblclick",function(){d3.event.preventDefault(),d3.event.stopPropagation(),e.handle_ctrl_pt()}),a||(0,s.handle_click_hand)("unlock"),document.getElementById("hand_button").onclick=s.handle_click_hand};document.getElementById("hand_button").onclick=function(){d(),(0,s.handle_click_hand)()},e.rectangle.on(".drag",null),(0,s.handle_click_hand)("lock");var _=map.insert("g");_.append("rect").attrs({x:0,y:0,width:w,height:h,class:"edit_rect"}).style("fill","transparent").on("dblclick",function(){d3.event.stopPropagation(),d3.event.preventDefault(),d()});_.append("rect").attrs({class:"ctrl_pt",id:"pt_top",height:8,width:8,x:o[0]*n.k+n.x-4,y:(o[1]-t.height.baseVal.value/2)*n.k+n.y-4}).call(d3.drag().on("drag",function(){var a=(d3.event.y-n.y)/n.k;if(!(e.height-(a-e.pt1[1])<2)){d3.select(this).attr("y",d3.event.y-4);var r=e.pt1[1];e.pt1[1]=t.y.baseVal.value=a,c=e.pt1.slice(),t.height.baseVal.value=e.height=(0,l.Mabs)(e.height-(e.pt1[1]-r)),map.selectAll("#pt_left,#pt_right").attr("y",(c[1]+e.height/2)*n.k+n.y)}})),_.append("rect").attrs({class:"ctrl_pt",height:8,width:8,id:"pt_left",x:(o[0]-t.width.baseVal.value/2)*n.k+n.x-4,y:o[1]*n.k+n.y-4}).call(d3.drag().on("drag",function(){var a=(d3.event.x-n.x)/n.k;if(!(e.width+(e.pt1[0]-a)<2)){d3.select(this).attr("x",d3.event.x-4);var r=e.pt1[0];e.pt1[0]=t.x.baseVal.value=a,c=e.pt1.slice(),t.width.baseVal.value=e.width=(0,l.Mabs)(e.width+(r-e.pt1[0])),map.selectAll("#pt_top,#pt_bottom").attr("x",(c[0]+e.width/2)*n.k+n.x)}})),_.append("rect").attrs({class:"ctrl_pt",id:"pt_bottom",x:o[0]*n.k+n.x-4,y:i[1]*n.k+n.y-4,height:8,width:8}).call(d3.drag().on("drag",function(){var a=-(c[1]-(d3.event.y-n.y)/n.k);a<2||(d3.select(this).attr("y",d3.event.y-4),e.height=t.height.baseVal.value=a,map.selectAll("#pt_left,#pt_right").attr("y",(c[1]+e.height/2)*n.k+n.y))})),_.append("rect").attrs({class:"ctrl_pt",id:"pt_right",x:i[0]*n.k+n.x-4,y:o[1]*n.k+n.y-4,height:8,width:8}).call(d3.drag().on("drag",function(){var a=-(c[0]-(d3.event.x-n.x)/n.k);a<2||(d3.select(this).attr("x",d3.event.x-4),e.width=t.width.baseVal.value=a,map.selectAll("#pt_top,#pt_bottom").attr("x",(c[0]+e.width/2)*n.k+n.x))}));e.rectangle.on("dblclick",function(){d3.event.stopPropagation(),d3.event.preventDefault(),d()})}},{key:"editStyle",value:function(){var e=this,t=e.rectangle.node().querySelector("rect"),n=(svg_map.__zoom,!!map_div.select("#hand_button").classed("locked")),a={pt1:this.pt1.slice()};n||(0,s.handle_click_hand)("lock"),(0,p.make_confirm_dialog2)("styleBoxRectangle",i18next.t("app_page.rectangle_edit_box.title"),{widthFitContent:!0}).then(function(r){r?(e.stroke_width=t.style.strokeWidth,e.stroke_color=t.style.stroke,e.fill_color=t.style.fill,e.fill_opacity=+t.style.fillOpacity):(e.pt1=a.pt1.slice(),t.style.strokeWidth=e.stroke_width,t.style.stroke=e.stroke_color,t.style.fill=e.fill_color,t.style.fillOpacity=e.fill_opacity),n||(0,s.handle_click_hand)("unlock")});var r=d3.select(".styleBoxRectangle").select(".modal-body").style("width","295px").insert("div").attr("id","styleBoxRectangle"),o=r.append("p").attr("class","line_elem2");o.append("span").style("margin","auto").html(i18next.t("app_page.rectangle_edit_box.stroke_width"));o.append("input").attrs({min:0,max:34,step:.1,type:"range"}).styles({width:"55px",float:"right"}).property("value",e.stroke_width).on("change",function(){t.style.strokeWidth=this.value,l.html(this.value+"px")});var l=o.append("span").styles({float:"right",margin:"0 5px 0 5px"}).html(e.stroke_width+" px"),c=r.append("p").attr("class","line_elem2");c.append("span").style("margin","auto").html(i18next.t("app_page.rectangle_edit_box.stroke_color")),c.append("input").style("float","right").attr("type","color").property("value",(0,i.rgb2hex)(e.stroke_color)).on("change",function(){t.style.stroke=this.value});var d=r.append("p").attr("class","line_elem2");d.append("span").style("margin","auto").html(i18next.t("app_page.rectangle_edit_box.fill_color")),d.append("input").style("float","right").attr("type","color").property("value",(0,i.rgb2hex)(e.fill_color)).on("change",function(){t.style.fill=this.value});var _=r.append("p").attr("class","line_elem2");_.append("span").style("margin","auto").html(i18next.t("app_page.rectangle_edit_box.fill_opacity")),_.append("input").attrs({min:0,max:1,step:.1,type:"range"}).styles({width:"55px",float:"right"}).property("value",t.style.fillOpacity).on("change",function(){t.style.fillOpacity=this.value,m.html(""+t.style.fillOpacity)});u.append("span").styles({float:"right",margin:"0 5px 0 5px"}).html(""+t.style.fillOpacity);var u=r.append("p").attr("class","line_elem2");u.append("span").style("margin","auto").html(i18next.t("app_page.rectangle_edit_box.rounded_corner")),u.append("input").attrs({min:0,max:Math.round(e.width/2),step:1,type:"range"}).styles({width:"55px",float:"right"}).property("value",t.rx.baseVal.value).on("change",function(){t.rx.baseVal.value=this.value,m.html(""+t.rx.baseVal.value)});var m=u.append("span").styles({float:"right",margin:"0 5px 0 5px"}).html(""+t.rx.baseVal.value)}}]),e}();t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=s(n(10)),o=s(n(9)),i=n(1),l=n(2);function s(e){return e&&e.__esModule?e:{default:e}}var p=Math.atan2,c=Math.sin,d=Math.cos,_=Math.PI,u=function(){function e(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parent=a||svg_map,this.svg_elem=d3.select(this.parent),this.id=t,this.stroke_width=4,this.stroke_color="rgb(0, 0, 0)",r)this.pt1=[+n[0],+n[1]];else{var o=svg_map.__zoom;this.pt1=[(+n[0]-o.x)/o.k,(+n[1]-o.y)/o.k]}var i=this;return this.drag_behavior=d3.drag().subject(function(){var e=d3.select(this.querySelector("ellipse"));return{x:+e.attr("cx"),y:+e.attr("cy"),map_locked:!!map_div.select("#hand_button").classed("locked")}}).on("start",function(){d3.event.sourceEvent.stopPropagation(),(0,l.handle_click_hand)("lock")}).on("end",function(){d3.event.subject&&!d3.event.subject.map_locked&&(0,l.handle_click_hand)("unlock")}).on("drag",function(){d3.event.sourceEvent.preventDefault();var e=this.querySelector("ellipse"),t=d3.event.subject,n=(+d3.event.x-+t.x)/svg_map.__zoom.k,a=(+d3.event.y-+t.y)/svg_map.__zoom.k;i.pt1=[+t.x+n,+t.y+a],e.cx.baseVal.value=i.pt1[0],e.cy.baseVal.value=i.pt1[1]}),this.draw(),this}return a(e,[{key:"draw",value:function(){var e=this,t=new o.default;this.ellipse=this.svg_elem.append("g").attrs({class:"user_ellipse legend scalable-legend",id:this.id,transform:svg_map.__zoom.toString()});this.ellipse.insert("ellipse").attrs({rx:30,ry:40,cx:this.pt1[0],cy:this.pt1[1]}).styles({fill:"rgb(255, 255, 255)","fill-opacity":0,stroke:this.stroke_color,"stroke-width":this.stroke_width});this.ellipse.on("contextmenu",function(){t.showMenu(d3.event,document.body,[{name:i18next.t("app_page.common.edit_style"),action:function(){e.editStyle()}},{name:i18next.t("app_page.common.up_element"),action:function(){e.up_element()}},{name:i18next.t("app_page.common.down_element"),action:function(){e.down_element()}},{name:i18next.t("app_page.common.delete"),action:function(){e.remove()}}])}).on("dblclick",function(){d3.event.preventDefault(),d3.event.stopPropagation(),e.handle_ctrl_pt()}).call(this.drag_behavior)}},{key:"remove",value:function(){this.ellipse.remove()}},{key:"up_element",value:function(){up_legend(this.ellipse.node())}},{key:"down_element",value:function(){down_legend(this.ellipse.node())}},{key:"calcAngle",value:function(){var e=this.ellipse.node().querySelector("ellipse"),t=e.rx.baseVal.value-this.pt1[0],n=e.ry.baseVal.value-this.pt1[1];return p(n,t)*(180/_)}},{key:"editStyle",value:function(){var e=this,t=e.ellipse.node().querySelector("ellipse"),n=(svg_map.__zoom,!!map_div.select("#hand_button").classed("locked")),a={pt1:this.pt1.slice(),rx:t.rx.baseVal.value,ry:t.ry.baseVal.value};(-this.calcAngle()).toFixed(0);n||(0,l.handle_click_hand)("lock"),(0,i.make_confirm_dialog2)("styleBoxEllipse",i18next.t("app_page.ellipse_edit_box.title"),{widthFitContent:!0}).then(function(r){map.selectAll(".ctrl_pt").remove(),r?(e.stroke_width=t.style.strokeWidth,e.stroke_color=t.style.stroke):(e.pt1=a.pt1.slice(),t.style.strokeWidth=e.stroke_width,t.style.stroke=e.stroke_color),n||(0,l.handle_click_hand)("unlock")});var r=d3.select(".styleBoxEllipse").select(".modal-body").style("width","295px").insert("div").attr("id","styleBoxEllipse"),o=r.append("p").attr("class","line_elem2");o.append("span").style("margin","auto").html(i18next.t("app_page.ellipse_edit_box.stroke_width")),o.append("input").attrs({min:0,max:34,step:.1,type:"range"}).styles({width:"80px",float:"right"}).property("value",e.stroke_width).on("change",function(){t.style.strokeWidth=this.value,s.html(this.value+"px")});var s=o.append("span").styles({float:"right",margin:"0 5px 0 5px"}).html(e.stroke_width+" px"),p=r.append("p").attr("class","line_elem2");p.append("span").style("margin","auto").html(i18next.t("app_page.ellipse_edit_box.stroke_color")),p.append("input").style("float","right").attr("type","color").property("value",e.stroke_color).on("change",function(){t.style.stroke=this.value})}},{key:"handle_ctrl_pt",value:function(){var e=this,t=e.ellipse.node().querySelector("ellipse"),n=svg_map.__zoom,a=!!map_div.select("#hand_button").classed("locked"),o=r.default.notify(i18next.t("app_page.notification.instruction_modify_feature"),"warning",0),i=function(){s.remove(),o.dismiss(),e.ellipse.call(e.drag_behavior),e.ellipse.on("dblclick",function(){d3.event.preventDefault(),d3.event.stopPropagation(),e.handle_ctrl_pt()}),a||(0,l.handle_click_hand)("unlock"),document.getElementById("hand_button").onclick=l.handle_click_hand};document.getElementById("hand_button").onclick=function(){i(),(0,l.handle_click_hand)()},e.ellipse.on(".drag",null),(0,l.handle_click_hand)("lock");var s=map.insert("g");s.append("rect").attrs({x:0,y:0,width:w,height:h,class:"edit_rect"}).style("fill","transparent").on("dblclick",function(){d3.event.stopPropagation(),d3.event.preventDefault(),i()});s.append("rect").attrs({id:"pt1",class:"ctrl_pt",height:8,width:8,x:(e.pt1[0]-t.rx.baseVal.value)*n.k+n.x-4,y:e.pt1[1]*n.k+n.y-4}).call(d3.drag().on("drag",function(){d3.select(this).attr("x",d3.event.x-4);var a=e.pt1[0]-(d3.event.x-n.x)/n.k;t.rx.baseVal.value=a})),s.append("rect").attrs({class:"ctrl_pt",height:8,width:8,id:"pt2",x:e.pt1[0]*n.k+n.x-4,y:(e.pt1[1]-t.ry.baseVal.value)*n.k+n.y-4}).call(d3.drag().on("drag",function(){d3.select(this).attr("y",d3.event.y-4);var a=e.pt1[1]-(d3.event.y-n.y)/n.k;t.ry.baseVal.value=a}));e.ellipse.on("dblclick",function(){d3.event.stopPropagation(),d3.event.preventDefault(),i()})}}],[{key:"calcDestFromOAD",value:function(e,t,n){var a=t/(180/_),r=n*d(a),o=n*c(a);return[e[0]+r,e[1]+o]}}]),e}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,r=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(a=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(r)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=c(n(10)),i=c(n(9)),l=n(1),s=n(6),p=n(2);function c(e){return e&&e.__esModule?e:{default:e}}var d=Math.atan2,_=Math.sin,u=Math.cos,m=Math.PI,y=function(){function e(t,n,a){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parent=r||svg_map,this.svg_elem=d3.select(this.parent),this.id=t,this.stroke_width=4,this.color="rgb(0, 0, 0)",this.hide_head=void 0,o)this.pt1=n,this.pt2=a;else{var i=svg_map.__zoom;this.pt1=[(n[0]-i.x)/i.k,(n[1]-i.y)/i.k],this.pt2=[(a[0]-i.x)/i.k,(a[1]-i.y)/i.k]}var l=this;this.drag_behavior=d3.drag().subject(function(){var e=d3.select(this.querySelector("line"));return{x:+e.attr("x2")-+e.attr("x1"),y:+e.attr("y2")-+e.attr("y1"),x1:e.attr("x1"),x2:e.attr("x2"),y1:e.attr("y1"),y2:e.attr("y2"),map_locked:!!map_div.select("#hand_button").classed("locked")}}).on("start",function(){d3.event.sourceEvent.stopPropagation(),(0,p.handle_click_hand)("lock")}).on("end",function(){d3.event.subject&&!d3.event.subject.map_locked&&(0,p.handle_click_hand)("unlock")}).on("drag",function(){d3.event.sourceEvent.preventDefault();var e=this.querySelector("line"),t=(e.style.strokeWidth.replace("px",""),d3.event.subject),n=(+d3.event.x-+t.x)/svg_map.__zoom.k,a=(+d3.event.y-+t.y)/svg_map.__zoom.k;l.pt1=[+t.x1+n,+t.y1+a],l.pt2=[+t.x2+n,+t.y2+a],e.x1.baseVal.value=l.pt1[0],e.x2.baseVal.value=l.pt2[0],e.y1.baseVal.value=l.pt1[1],e.y2.baseVal.value=l.pt2[1]}),(defs?defs.node().querySelector("marker"):null)||this.add_defs_marker(),this.draw()}return r(e,[{key:"add_defs_marker",value:function(){defs.append("marker").attrs({id:"arrow_head",viewBox:"0 -5 10 10",refX:5,refY:0,orient:"auto",markerWidth:4,markerHeight:4}).style("stroke-width",1).append("path").attrs({d:"M0,-5L10,0L0,5",class:"arrowHead"}),"defs"!==this.parent.childNodes[0].tagName&&this.parent.insertBefore(defs.node(),this.parent.childNodes[0])}},{key:"draw",value:function(){var e=this,t=new i.default;this.arrow=this.svg_elem.append("g").style("cursor","all-scroll").attrs({class:"arrow legend scalable-legend",id:this.id,transform:svg_map.__zoom.toString()}),this.arrow.insert("line").attrs({"marker-end":this.hide_head?null:"url(#arrow_head)",x1:this.pt1[0],y1:this.pt1[1],x2:this.pt2[0],y2:this.pt2[1]}).styles({"stroke-width":this.stroke_width,stroke:"rgb(0, 0, 0)"}),this.arrow.call(this.drag_behavior),this.arrow.on("contextmenu",function(){t.showMenu(d3.event,document.querySelector("body"),[{name:i18next.t("app_page.common.edit_style"),action:function(){e.editStyle()}},{name:i18next.t("app_page.common.up_element"),action:function(){e.up_element()}},{name:i18next.t("app_page.common.down_element"),action:function(){e.down_element()}},{name:i18next.t("app_page.common.delete"),action:function(){e.remove()}}])}),this.arrow.on("dblclick",function(){d3.event.preventDefault(),d3.event.stopPropagation(),e.handle_ctrl_pt()})}},{key:"remove",value:function(){this.arrow.remove()}},{key:"up_element",value:function(){up_legend(this.arrow.node())}},{key:"down_element",value:function(){down_legend(this.arrow.node())}},{key:"handle_ctrl_pt",value:function(){var e=this,t=e.arrow.node().querySelector("line"),n=svg_map.__zoom,a=!!map_div.select("#hand_button").classed("locked"),r=o.default.notify(i18next.t("app_page.notification.instruction_modify_feature"),"warning",0),i=function(){l.remove(),r.dismiss(),e.pt1=[t.x1.baseVal.value,t.y1.baseVal.value],e.pt2=[t.x2.baseVal.value,t.y2.baseVal.value],e.arrow.call(e.drag_behavior),e.arrow.on("dblclick",function(){d3.event.preventDefault(),d3.event.stopPropagation(),e.handle_ctrl_pt()}),a||(0,p.handle_click_hand)("unlock"),document.getElementById("hand_button").onclick=p.handle_click_hand};document.getElementById("hand_button").onclick=function(){i(),(0,p.handle_click_hand)()},e.arrow.on(".drag",null),(0,p.handle_click_hand)("lock");var l=map.insert("g");l.append("rect").attrs({x:0,y:0,width:w,height:h,class:"edit_rect"}).style("fill","transparent").on("dblclick",function(){d3.event.stopPropagation(),d3.event.preventDefault(),i()}),l.append("rect").attrs({x:e.pt1[0]*n.k+n.x-3,y:e.pt1[1]*n.k+n.y-3,height:6,width:6,id:"arrow_start_pt"}).styles({fill:"red",cursor:"grab"}).call(d3.drag().on("drag",function(){var e=d3.select(this),a=d3.event.x,r=d3.event.y;e.attrs({x:a-3,y:r-3}),t.x1.baseVal.value=(a-n.x)/n.k,t.y1.baseVal.value=(r-n.y)/n.k})),l.append("rect").attrs({x:e.pt2[0]*n.k+n.x-3,y:e.pt2[1]*n.k+n.y-3,height:6,width:6,id:"arrow_end_pt"}).styles({fill:"red",cursor:"grab"}).call(d3.drag().on("drag",function(){var e=d3.select(this),a=d3.event.x,r=d3.event.y;e.attrs({x:a-3,y:r-3}),t.x2.baseVal.value=(a-n.x)/n.k,t.y2.baseVal.value=(r-n.y)/n.k})),e.arrow.on("dblclick",function(){d3.event.stopPropagation(),d3.event.preventDefault(),i()})}},{key:"calcAngle",value:function(){var e=this.pt2[0]-this.pt1[0],t=this.pt2[1]-this.pt1[1];return d(t,e)*(180/m)}},{key:"calcDestFromOAD",value:function(e,t,n){var a=t/(180/m),r=n*u(a),o=n*_(a);return[e[0]+r,e[1]+o]}},{key:"editStyle",value:function(){var e={pt1:this.pt1.slice(),pt2:this.pt2.slice()},t=this,n=t.arrow.node().querySelector("line"),r=(-this.calcAngle()).toFixed(0),o=!!map_div.select("#hand_button").classed("locked");o||(0,p.handle_click_hand)("lock"),(0,l.check_remove_existing_box)(".styleBoxArrow"),(0,l.make_confirm_dialog2)("styleBoxArrow",i18next.t("app_page.arrow_edit_box.title"),{widthFitContent:!0}).then(function(a){a?(t.stroke_width=n.style.strokeWidth,t.color=n.style.stroke,t.pt1=[n.x1.baseVal.value,n.y1.baseVal.value],t.pt2=[n.x2.baseVal.value,n.y2.baseVal.value]):(n.x1.baseVal.value=e.pt1[0],n.y1.baseVal.value=e.pt1[1],n.x2.baseVal.value=e.pt2[0],n.y2.baseVal.value=e.pt2[1],t.pt1=e.pt1.slice(),t.pt2=e.pt2.slice(),n.style.strokeWidth=t.stroke_width,n.style.stroke=t.color),map.select("#arrow_start_pt").remove(),map.select("#arrow_end_pt").remove(),o||(0,p.handle_click_hand)("unlock")});var i=d3.select(".styleBoxArrow").select(".modal-body").style("width","295px").insert("div").attr("id","styleBoxArrow"),c=i.append("p").attr("class","line_elem2");c.append("span").html(i18next.t("app_page.arrow_edit_box.arrowWeight")),c.insert("span").styles({float:"right",width:"13px"}).html("&nbsp;px"),c.insert("input").attrs({id:"arrow_weight_text",class:"without_spinner",min:0,max:34,step:.1}).styles({width:"30px","margin-left":"10px",float:"right"}).property("value",t.stroke_width).on("input",function(){var e=document.getElementById("arrow_stroke_width");e.value=this.value,e.dispatchEvent(new Event("change"))}),c.append("input").attrs({id:"arrow_stroke_width",min:0,max:34,step:.1,type:"range"}).styles({float:"right","vertical-align":"middle",width:"80px"}).property("value",t.stroke_width).on("change",function(){n.style.strokeWidth=this.value,document.getElementById("arrow_weight_text").value=+this.value});var d=i.append("p").attr("class","line_elem2");d.append("span").html(i18next.t("app_page.arrow_edit_box.arrowAngle")),d.insert("span").styles({float:"right",width:"13px"}).html("&nbsp;°"),d.insert("input").attrs({id:"arrow_angle_text",class:"without_spinner",min:0,max:1,step:1}).styles({width:"30px","margin-left":"10px",float:"right"}).property("value",r).on("input",function(){var e=document.getElementById("arrow_angle");e.value=this.value,e.dispatchEvent(new Event("change"))}),d.insert("input").attrs({id:"arrow_angle",type:"range",min:0,max:360,step:1}).styles({width:"80px","vertical-align":"middle",float:"right"}).property("value",r).on("change",function(){var e=(0,s.Msqrt)((t.pt1[0]-t.pt2[0])*(t.pt1[0]-t.pt2[0])+(t.pt1[1]-t.pt2[1])*(t.pt1[1]-t.pt2[1])),r=-+this.value,o=t.calcDestFromOAD(t.pt1,r,e),i=a(o,2),l=i[0],p=i[1];n.x2.baseVal.value=l,n.y2.baseVal.value=p,document.getElementById("arrow_angle_text").value=+this.value});var _=i.append("p").attr("class","line_elem2");_.append("label").attrs({for:"checkbox_head_arrow"}).html(i18next.t("app_page.arrow_edit_box.arrowHead")),_.append("input").attrs({type:"checkbox",id:"checkbox_head_arrow"}).styles({"margin-left":"45px","vertical-align":"middle"}).property("checked",!0===t.hide_head).on("change",function(){this.checked?(t.hide_head=!0,t.arrow.select("line").attr("marker-end",null)):(t.hide_head=!1,t.arrow.select("line").attr("marker-end","url(#arrow_head)"))})}}]),e}();t.default=y},function(e,t,n){(e.exports=n(14)(!1)).push([e.i,".context-menu {\n\tfont-family: Arial, sans;\n\tposition: absolute;\n\tbackground: white;\n\tborder: 1px solid #c3c3c3;\n\tborder-radius: 5px;\n\tbox-shadow: 0 5px 5px #c3c3c3;\n\tpadding-top: 5px;\n\tpadding-bottom: 5px;\n\tmin-width: 200px;\n\tfont-size: 12pt;\n}\n\n.context-menu ul {\n\tlist-style: none;\n\tpadding-left: 0;\n\tmargin: 0;\n}\n\n.context-menu li {\n\tposition: relative;\n\tpadding-left: 20px;\n\tpadding-right: 30px;\n\tcursor: default;\n}\n\n.context-menu li:hover {\n\t//background: #b1b1ff;\n    background: rgba(145, 209, 230, 0.52);\n    color: rgb(0,0,0);\n}\n\n.context-menu li span.arrow {\n\tposition: absolute;\n\tfont-size: 0.8em;\n\tright: 10px;\n}\n\n.context-menu li div.context-menu {\n\tleft: 100%;\n\ttop: -5px;\n}",""])},function(e,t,n){var a=n(44);"string"==typeof a&&(a=[[e.i,a,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(13)(a,r);a.locals&&(e.exports=a.locals)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){(e.exports=n(14)(!1)).push([e.i,"#discretization_panel {\n    float: left;\n    font-size: 11px;\n    margin: 15px 0 0 27.5px;\n}\n\n#ref_histo_box {\n    float: right;\n    margin-top: 11px;\n    font-size: 10.5px;\n}\n\nlabel_it_inline {\n    font-size: 10px;\n    display: inline;\n}\n\n#svg_discretization .y_axis, #svg_discretization .x_axis {\n    stroke-width: 0.2;\n}\n\n.btn_mean {\n  background: #3498db;\n  background-image: -webkit-linear-gradient(top, #3498db, #2980b9);\n  background-image: -moz-linear-gradient(top, #3498db, #2980b9);\n  background-image: -ms-linear-gradient(top, #3498db, #2980b9);\n  background-image: -o-linear-gradient(top, #3498db, #2980b9);\n  background-image: linear-gradient(to bottom, #3498db, #2980b9);\n  -webkit-border-radius: 28;\n  -moz-border-radius: 28;\n  border-radius: 28px;\n  font-family: Arial;\n  color: #ffffff !important;\n  font-size: 14px;\n  padding: 10px 17px 10px 17px;\n  text-decoration: none;\n}\n\n.btn_mean.active {\n  border: solid #1f628d 3px;\n}\n\n.btn_mean:hover {\n  background: #3cb0fd;\n  background-image: -webkit-linear-gradient(top, #3cb0fd, #3498db);\n  background-image: -moz-linear-gradient(top, #3cb0fd, #3498db);\n  background-image: -ms-linear-gradient(top, #3cb0fd, #3498db);\n  background-image: -o-linear-gradient(top, #3cb0fd, #3498db);\n  background-image: linear-gradient(to bottom, #3cb0fd, #3498db);\n  text-decoration: none;\n}\n\n.btn_median {\n  background: #64d95e;\n  background-image: -webkit-linear-gradient(top, #64d95e, #53ba4e);\n  background-image: -moz-linear-gradient(top, #64d95e, #53ba4e);\n  background-image: -ms-linear-gradient(top, #64d95e, #53ba4e);\n  background-image: -o-linear-gradient(top, #64d95e, #53ba4e);\n  background-image: linear-gradient(to bottom, #64d95e, #53ba4e);\n  -webkit-border-radius: 28;\n  -moz-border-radius: 28;\n  border-radius: 28px;\n  font-family: Arial;\n  color: #ffffff !important;\n  font-size: 14px;\n  padding: 10px 17px 10px 17px;\n  text-decoration: none;\n}\n\n.btn_median.active {\n  border: solid #43963f 3px;\n}\n\n.btn_median:hover {\n  background: #7afc74;\n  background-image: -webkit-linear-gradient(top, #7afc74, #62db5c);\n  background-image: -moz-linear-gradient(top, #7afc74, #62db5c);\n  background-image: -ms-linear-gradient(top, #7afc74, #62db5c);\n  background-image: -o-linear-gradient(top, #7afc74, #62db5c);\n  background-image: linear-gradient(to bottom, #7afc74, #62db5c);\n  text-decoration: none;\n}\n\n.btn_population {\n  background: #d93434;\n  background-image: -webkit-linear-gradient(top, #d93434, #b82b2b);\n  background-image: -moz-linear-gradient(top, #d93434, #b82b2b);\n  background-image: -ms-linear-gradient(top, #d93434, #b82b2b);\n  background-image: -o-linear-gradient(top, #d93434, #b82b2b);\n  background-image: linear-gradient(to bottom, #d93434, #b82b2b);\n  -webkit-border-radius: 28;\n  -moz-border-radius: 28;\n  border-radius: 28px;\n  font-family: Arial;\n  color: #ffffff !important;\n  font-size: 14px;\n  padding: 10px 17px 10px 17px;\n  text-decoration: none;\n}\n\n.btn_population.active {\n  border: solid #8c1f1f 3px;\n}\n\n.btn_population:hover {\n  background: #fc3c3c;\n  background-image: -webkit-linear-gradient(top, #fc3c3c, #d9343c);\n  background-image: -moz-linear-gradient(top, #fc3c3c, #d9343c);\n  background-image: -ms-linear-gradient(top, #fc3c3c, #d9343c);\n  background-image: -o-linear-gradient(top, #fc3c3c, #d9343c);\n  background-image: linear-gradient(to bottom, #fc3c3c, #d9343c);\n  text-decoration: none;\n}\n\n.btn_stddev {\n  background: #d6d934;\n  background-image: -webkit-linear-gradient(top, #d6d934, #afb82c);\n  background-image: -moz-linear-gradient(top, #d6d934, #afb82c);\n  background-image: -ms-linear-gradient(top, #d6d934, #afb82c);\n  background-image: -o-linear-gradient(top, #d6d934, #afb82c);\n  background-image: linear-gradient(to bottom, #d6d934, #afb82c);\n  -webkit-border-radius: 28;\n  -moz-border-radius: 28;\n  border-radius: 28px;\n  font-family: Arial;\n  color: #ffffff !important;\n  font-size: 14px;\n  padding: 10px 17px 10px 17px;\n  text-decoration: none;\n}\n\n.btn_stddev.active {\n  border: solid #838a20 3px;\n}\n\n.btn_stddev:hover {\n  background: #edfa3c;\n  background-image: -webkit-linear-gradient(top, #edfa3c, #d6d934);\n  background-image: -moz-linear-gradient(top, #edfa3c, #d6d934);\n  background-image: -ms-linear-gradient(top, #edfa3c, #d6d934);\n  background-image: -o-linear-gradient(top, #edfa3c, #d6d934);\n  background-image: linear-gradient(to bottom, #edfa3c, #d6d934);\n  text-decoration: none;\n}\n",""])},function(e,t,n){var a=n(92);"string"==typeof a&&(a=[[e.i,a,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(13)(a,r);a.locals&&(e.exports=a.locals)},,function(e,t,n){(e.exports=n(14)(!1)).push([e.i,'body {\n    height:100%;\n    width:100%;\n    margin:0px;\n    padding:0px;\n    color: black;\n    background: #e3e3da;\n    -webkit-text-rendering: optimizeLegibility;\n    -moz-text-rendering: optimizeLegibility;\n    text-rendering: optimizeLegibility;\n}\n\nselect {\n    padding: .4em;\n    background: #efefef;\n    border-radius: 0px;\n    border-color: rgb(169,169,169);\n    border-width: 1px;\n}\n\n/*  Style for sliders */\ninput[type=range] {\n  -webkit-appearance: none;\n  width: 100%;\n  margin: 9px 5px 9px 0;\n}\ninput[type=range]:focus {\n  outline: none;\n}\ninput[type=range]::-webkit-slider-runnable-track {\n  width: 100%;\n  height: 4px;\n  cursor: pointer;\n  box-shadow: 1px 1px 2px #000000, 0px 0px 1px #0d0d0d;\n  background: #3071a9;\n  border-radius: 1.4px;\n  border: 0.2px solid #010101;\n}\ninput[type=range]::-webkit-slider-thumb {\n  box-shadow: 1px 1px 1px #000000, 0px 0px 1px #0d0d0d;\n  border: 0.5px solid #000000;\n  height: 18px;\n  width: 8px;\n  border-radius: 3px;\n  background: #ffffff;\n  cursor: pointer;\n  -webkit-appearance: none;\n  margin-top: -9.2px;\n}\ninput[type=range]:focus::-webkit-slider-runnable-track {\n  background: #367ebd;\n}\ninput[type=range]::-moz-range-track {\n  width: 100%;\n  height: 4px;\n  cursor: pointer;\n  box-shadow: 1px 1px 2px #000000, 0px 0px 1px #0d0d0d;\n  background: #3071a9;\n  border-radius: 1.4px;\n  border: 0.2px solid #010101;\n}\ninput[type=range]::-moz-range-thumb {\n  box-shadow: 1px 1px 1px #000000, 0px 0px 1px #0d0d0d;\n  border: 0.5px solid #000000;\n  height: 18px;\n  width: 8px;\n  border-radius: 3px;\n  background: #ffffff;\n  cursor: pointer;\n}\ninput[type=range]::-ms-track {\n  width: 100%;\n  height: 4px;\n  cursor: pointer;\n  background: transparent;\n  border-color: transparent;\n  color: transparent;\n}\ninput[type=range]::-ms-fill-lower {\n  background: #2a6495;\n  border: 0.2px solid #010101;\n  border-radius: 2.8px;\n  box-shadow: 1px 1px 2px #000000, 0px 0px 1px #0d0d0d;\n}\ninput[type=range]::-ms-fill-upper {\n  background: #3071a9;\n  border: 0.2px solid #010101;\n  border-radius: 2.8px;\n  box-shadow: 1px 1px 2px #000000, 0px 0px 1px #0d0d0d;\n}\ninput[type=range]::-ms-thumb {\n  box-shadow: 1px 1px 1px #000000, 0px 0px 1px #0d0d0d;\n  border: 0.5px solid #000000;\n  height: 18px;\n  width: 8px;\n  border-radius: 3px;\n  background: #ffffff;\n  cursor: pointer;\n  height: 4px;\n}\ninput[type=range]:focus::-ms-fill-lower {\n  background: #3071a9;\n}\ninput[type=range]:focus::-ms-fill-upper {\n  background: #367ebd;\n}\n/*  End of style for sliders */\n\n#header {\n    width: 100%;\n    height: 40px;\n    font-weight: bold;\n    color: rgb(0, 0, 0);\n    box-sizing: border-box;\n    background-color : #000;\n    line-height: 30px;\n    text-align: left;\n    font-family: "Inconsolata", Verdana, Tahoma;\n    letter-spacing: 3px;\n}\n\n#menu {\n    position: absolute;\n    padding: 5px 2.5px 5px 2.5px;\n    width: 345px;\n    font-size: 12px;\n}\n\n#map {\n    padding: 0px;\n    left: 355px;\n    margin-top: 5px;\n    background-color: white;\n    position: relative;\n    border: 1px solid lightgrey;\n}\n\n.user_panel{\n    text-align: left;\n    line-height: 14px;\n}\n\nh1.menu {\n    color:#2e91ce;\n    font-size:15px;\n}\n\na.logo {\n    position: absolute;\n    left : 0px;\n    top : 0px;\n    height:30px;\n    padding:0px;\n    vertical-align:middle;\n    font-weight : bold;\n    font-family: \'Helvetica Neue\', sans-serif;\n    font-size: 20px;\n    margin-left:5px\n}\n\n.icon {\n    box-sizing: border-box;\n    padding:10px;\n    box-sizing: border-box;\n    text-align:center;\n    vertical-align:middle;\n    display:inline-block;\n}\n\n.item-menu {\n    margin: auto;\n    vertical-align:middle;\n    float:right;\n    font-size: 12px;\n    letter-spacing: 2px;\n    margin-left: 6px;\n}\n\nh1 {\n    font-family: \'Enriqueta\', arial, serif;\n    line-height: 1.25;\n    margin: 0 0 10px;\n    font-size: 40px;element\n    font-weight: bold;\n}\n\nh2{\n    font-family: \'Enriqueta\', arial, serif;\n    font-size: 16px;\n    color : #2e91ce;\n    font-weight: bold;\n}\n\nh3{\n    font-family: \'Enriqueta\', arial, serif;\n    font-size: 13px;\n    color : #2e91ce;\n    font-weight: bold;\n}\n\na.menu {\n    line-height:30px;\n    color: white;\n}\n\n#section1 {\n    padding: 0.9em 0.3em 0.8em 0.2em;\n    font-size: 12px !important;\n}\n\n#section2 {\n    padding: 2px 8px;\n}\n\n#section2 input[type="text"], #section2 input[type="number"], #section2 input[type="color"] {\n    position: absolute;\n    right: 20px;\n    margin: auto;\n    min-width: 40px;\n    font-size: 12px;\n}\n\n.params_section2.inactive {\n  display: none;\n}\n\np.params_section2 {\n  margin: 15px 0;\n  clear: both;\n}\n\np.params_section2:first-of-type {\n  margin-top: 9px;\n}\n\np.params_section2 > span {\n  vertical-align: -moz-middle-with-baseline;\n}\n\np.params_section2 > p {\n  margin: auto;\n}\n\np.params_section2 > select {\n  position: relative;\n  float: right;\n  margin-bottom: 7.5px;\n  min-width: 40px;\n  font-size: 12px;\n  right: 20px;\n  max-width: 300px;\n}\n\n#section3 {\n    padding: 0.8em 0.5em 0.8em 0.5em;\n}\n\n#section4 {\n    font-size: 12px;\n    padding: 0.8em 1.2em 0.8em 1.2em;\n}\n\n.list_elem_section4 {\n    display: inline-flex;\n    margin: 2px;\n}\n\n#section5 {\n    padding: 0.8em 1.2em 0.8em 1.2em;\n}\n\n#section5 input[type="text"], #section5 input[type="number"], #section5 select {\n    margin-left: 5px;\n}\n\n#overlay, .overlay_drop {\n    width: 100%;\n    height: 100%;\n    position: fixed;\n    z-index: 0;\n    top: 0;\n    left: 0;\n    /*background: rgba(197, 69, 168, 0.47);*/\n    background: rgba(227, 227, 218, 0.5);\n    font-family: Arimo;\n    text-align: center;\n    font-size: 20px;\n}\n\n.overlay_drop {\n  font-weight: 800;\n  width: 99%;\n  height: 98%;\n}\n\n.cont_map_btn > button {\n  display: block;\n  font-size: 1.1em;\n  font-weight: bold;\n  text-align: center;\n  margin: 0 3px 0 0;\n  color: #ccc;\n  background-color: #555;\n  background: -webkit-linear-gradient(#888,#555);\n  background: linear-gradient(#888,#555);\n  border: 0 none;\n  border-radius: 3px;\n  text-shadow: 0 -1px 0 #000;\n  box-shadow: 1px 0 0 #666,4px 0 0 #444,5px 0 0 rgba(0,0,0,0.6);\n  cursor: pointer;\n  -webkit-transition: all 150ms ease;\n  transition: all 150ms ease;\n  width: 30px;\n  height: 30px;\n}\n\n.cont_map_btn > button:hover {\n  color: #fff; text-shadow: 0 -1px 0 #444, 0 0 5px #ffd, 0 0 8px #fff;\n}\n\n.cont_map_btn > button.active, .cont_map_btn > button:active\n{\n  color: #fff;\n  text-shadow: 0 -1px 0 #444,0 0 5px #ffd,0 0 8px #fff;\n  box-shadow: none;\n  -webkit-transform: translateX(5px);\n  transform: translateX(2px);\n  -webkit-animation: none;\n  animation: none;\n  background: linear-gradient(#555,#444);\n  width: 32px;\n  margin: 0;\n}\n\n.const_buttons {\n  border-radius: 10%;\n  height: 30px;\n  border-color:transparent;\n}\n\n#trash_button,#zoom_fit_button,.style_button,\n.style_target_layer,#legend_button,.active_button,#browse_data_button {\n  margin-left: 1.5px;\n  float: right;\n}\n\n#replace_button {\n  float: left;\n  margin-left: 1.5px;\n  margin-top: 2px;\n}\n\n.ico_type {\n  margin-top: 2px;\n  margin-right: 3px;\n  float: left;\n}\n\n.popup.active {\n  background: rgba(220, 220, 220, 0.94) none repeat scroll 0% 0%;\n  border: 3px;\n  padding: 20px;\n  color: black;\n  border-radius: 2%;\n  font: 12px "Enriqueta", arial, sans-serif;\n}\n\n.header_options_right {\n    clear: both;\n    float: right;\n    display:inline;\n    color: #99a8c4;\n    font-size:12px;\n    margin: auto;\n}\n\n.header_options_projection {\n    position: absolute;\n    left: 350px;\n    top: 0px;\n    color: #99a8c4;\n    margin: auto;\n}\n\n#info_features {\n    position: absolute;\n    cursor: default;\n    right: 34px;\n    top: 45px;\n    border-radius: 9px;\n    background-color: rgba(255, 255, 255, 0.5);\n    border: 1px solid #999;\n    font: 14px \'Source Sans Pro\', Helvetica, sans-serif;\n    padding-right:20px;\n    padding-left:20px;\n    color:black;\n}\n\n#sortable {\n    list-style-type:none;\n    margin:auto;\n    padding:0;\n    width:100%;\n    border-radius:10%\n}\n\n#sortable li {\n    margin: 5px 0 5px 0;\n    padding: 5px;\n    font-size: 10.5px;\n    line-height: 1.75em;\n    font-weight: bold;\n    background: #ffffff;\n    border-radius: 4%;\n    border: unset;\n    color: black;\n    cursor: pointer;\n    overflow-y: auto;\n}\n\n#sortable li.sortable_target {\n  background: #fff8ac;\n}\n\n#sortable li.sortable_target:hover {\n  background: #f3ec9e;\n}\n\n#sortable li:hover{\n    background: #e8e8e8;\n}\n\n#table_intro{\n    margin: 0 !important;\n    text-align: center;\n}\n\n.dataTable-sorter::before, .dataTable-sorter::after {\n    position: unset !important;\n}\n\n#join_button {\n    border-color: transparent;\n    background-color: transparent;\n}\n\n.button_sys_run {\n    border-color: transparent;\n    color: transparent;\n    background-color: transparent;\n}\n\n.noselect {\n  -webkit-touch-callout: none;\n  -webkit-user-select: none;\n  -khtml-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n}\n\n.zoom_rect{\n    fill: transparent;\n    stroke: black;\n    stroke-width: 0.7px;\n}\n\n.button_disc {\n\tbackground:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #ffffff), color-stop(1, #f6f6f6));\n\tbackground:-moz-linear-gradient(top, #ffffff 5%, #f6f6f6 100%);\n\tbackground:-webkit-linear-gradient(top, #ffffff 5%, #f6f6f6 100%);\n\tbackground:-o-linear-gradient(top, #ffffff 5%, #f6f6f6 100%);\n\tbackground:-ms-linear-gradient(top, #ffffff 5%, #f6f6f6 100%);\n\tbackground:linear-gradient(to bottom, #ffffff 5%, #f6f6f6 100%);\n\tbackground-color:#ffffff;\n\t-moz-border-radius:4px;\n\t-webkit-border-radius:4px;\n\tborder-radius:4px;\n\tborder:1px solid #dcdcdc;\n\tdisplay:inline-block;\n\tcursor:pointer;\n\tcolor:black;\n\tfont-family:Arial;\n\tfont-size:12px;\n\tfont-weight:bold;\n\tpadding:4px 13px;\n\ttext-decoration:none;\n}\n.button_disc:hover {\n\tbackground:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #f6f6f6), color-stop(1, #ffffff));\n\tbackground:-moz-linear-gradient(top, #f6f6f6 5%, #ffffff 100%);\n\tbackground:-webkit-linear-gradient(top, #f6f6f6 5%, #ffffff 100%);\n\tbackground:-o-linear-gradient(top, #f6f6f6 5%, #ffffff 100%);\n\tbackground:-ms-linear-gradient(top, #f6f6f6 5%, #ffffff 100%);\n\tbackground:linear-gradient(to bottom, #f6f6f6 5%, #ffffff 100%);\n\tbackground-color:#f6f6f6;\n}\n\n.button_disc:disabled {\n    color: #DDDFE4;\n}\n\n.button_disc.active {\n    box-shadow: inset 0 0 6px #000;\n}\n\n.button_st3 {\n\t-moz-box-shadow: 0px 1px 0px 0px #91b8b3;\n\t-webkit-box-shadow: 0px 1px 0px 0px #91b8b3;\n\tbox-shadow: 0px 1px 0px 0px #91b8b3;\n\tbackground:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #768d87), color-stop(1, #6c7c7c));\n\tbackground:-moz-linear-gradient(top, #768d87 5%, #6c7c7c 100%);\n\tbackground:-webkit-linear-gradient(top, #768d87 5%, #6c7c7c 100%);\n\tbackground:-o-linear-gradient(top, #768d87 5%, #6c7c7c 100%);\n\tbackground:-ms-linear-gradient(top, #768d87 5%, #6c7c7c 100%);\n\tbackground:linear-gradient(to bottom, #768d87 5%, #6c7c7c 100%);\n\tbackground-color:#768d87;\n\t-moz-border-radius:4px;\n\t-webkit-border-radius:4px;\n\tborder-radius:4px;\n\tborder:1px solid #566963;\n\tdisplay:inline-block;\n\tcursor:pointer;\n\tcolor:#ffffff;\n\tfont-family:Arial;\n\tfont-size:12px;\n\tpadding:3px 16px;\n\ttext-decoration:none;\n\tmargin: 0px 1px 0px 1px\n}\n.button_st3:hover {\n\tbackground:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #6c7c7c), color-stop(1, #768d87));\n\tbackground:-moz-linear-gradient(top, #6c7c7c 5%, #768d87 100%);\n\tbackground:-webkit-linear-gradient(top, #6c7c7c 5%, #768d87 100%);\n\tbackground:-o-linear-gradient(top, #6c7c7c 5%, #768d87 100%);\n\tbackground:-ms-linear-gradient(top, #6c7c7c 5%, #768d87 100%);\n\tbackground:linear-gradient(to bottom, #6c7c7c 5%, #768d87 100%);\n\tbackground-color:#6c7c7c;\n}\n\n.button_st3:disabled {\n    border: 1px solid #DDDFE4;\n    background: none;\n    background-color: #DDDFE4;\n    color: #fff;\n    box-shadow: none;\n}\n\n.button_st4 {\n    background:linear-gradient(to bottom, #3071a9 5%, #002e56 100%);\n    background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #3071a9), color-stop(1, #002e56));\n    background:-moz-linear-gradient(top, #3071a9 5%, #002e56 100%);\n    background:-webkit-linear-gradient(top, #3071a9 5%, #002e56 100%);\n    background:-o-linear-gradient(top, #3071a9 5%, #002e56 100%);\n    background:-ms-linear-gradient(top, #3071a9 5%, #002e56 100%);\n    background-color:#1d5966;\n    border-radius: 6px;\n    border: 1px solid #1d5966;\n    display: inline-block;\n    cursor: pointer;\n    color: #FFF !important;\n    padding: 4px 9px;\n    text-decoration: none;\n}\n\n.button_st4:hover {\n    background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #dfdfdf), color-stop(1, #ededed));\n    background:-moz-linear-gradient(top, #dfdfdf 5%, #ededed 100%);\n    background:-webkit-linear-gradient(top, #dfdfdf 5%, #ededed 100%);\n    background:-o-linear-gradient(top, #dfdfdf 5%, #ededed 100%);\n    background:-ms-linear-gradient(top, #dfdfdf 5%, #ededed 100%);\n    background:linear-gradient(to bottom, #dfdfdf 5%, #ededed 100%);\n    background-color:#dfdfdf;\n    border: 1px solid #dfdfdf;\n}\n\n.without_spinner {\n    -moz-appearance: textfield;\n    text-align: right;\n    border: none;\n    border-bottom-style: dashed;\n    border-bottom-width: 0.5px;\n}\n\n.without_spinner::-webkit-inner-spin-button,\n.without_spinner::-webkit-outer-spin-button {\n  -webkit-appearance: none;\n  margin: 0; /* Removes leftover margin */\n}\n\n.mini_button_ok {\n  -webkit-border-radius: 12;\n  -moz-border-radius: 12;\n  border-radius: 12px;\n  font-family: Arial;\n  color: #ffffff;\n  font-size: 20px;\n  background: #4bc238;\n  padding: 3px 10px 3px 10px;\n  margin: 5px;\n  text-decoration: none;\n  display:inline-block;\n}\n\n.mini_button_ok:hover {\n  background: #3dbf26;\n  background-image: -webkit-linear-gradient(top, #3dbf26, #519e41);\n  background-image: -moz-linear-gradient(top, #3dbf26, #519e41);\n  background-image: -ms-linear-gradient(top, #3dbf26, #519e41);\n  background-image: -o-linear-gradient(top, #3dbf26, #519e41);\n  background-image: linear-gradient(to bottom, #3dbf26, #519e41);\n  text-decoration: none;\n}\n\n.mini_button_none {\n  -webkit-border-radius: 12;\n  -moz-border-radius: 12;\n  border-radius: 12px;\n  font-family: Arial;\n  color: #ffffff;\n  font-size: 20px;\n  background: #ed2828;\n  padding: 3px 10px 3px 10px;\n  margin: 5px;\n  text-decoration: none;\n  display:inline-block;\n}\n\n.mini_button_none:hover {\n  background: #eb7373;\n  background-image: -webkit-linear-gradient(top, #eb7373, #ad0707);\n  background-image: -moz-linear-gradient(top, #eb7373, #ad0707);\n  background-image: -ms-linear-gradient(top, #eb7373, #ad0707);\n  background-image: -o-linear-gradient(top, #eb7373, #ad0707);\n  background-image: linear-gradient(to bottom, #eb7373, #ad0707);\n  text-decoration: none;\n}\n\n.mini_button_none_orange {\n  -webkit-border-radius: 12;\n  -moz-border-radius: 12;\n  border-radius: 12px;\n  font-family: Arial;\n  color: #ffffff;\n  font-size: 20px;\n  background: #ed8228;\n  padding: 3px 10px 3px 10px;\n  margin: 5px;\n  text-decoration: none;\n  display:inline-block;\n}\n\n.mini_button_none_orange:hover {\n  background: #eb7373;\n  background-image: -webkit-linear-gradient(top, #eca366, #e76e09);\n  background-image: -moz-linear-gradient(top, #eca366, #e76e09);\n  background-image: -ms-linear-gradient(top, #eca366, #e76e09);\n  background-image: -o-linear-gradient(top, #eca366, #e76e09);\n  background-image: linear-gradient(to bottom, #eca366, #e76e09);\n  text-decoration: none;\n}\n\nbutton.accordion, button.accordion_disc, button.accordion_proj  {\n    background-color: #595959;\n    color: #fff;\n    cursor: pointer;\n    padding: 4px 5px;\n    width: 100%;\n    border: none;\n    text-align: left;\n    outline: none;\n    font-size: 1.2em;\n    transition: 0.4s;\n    font-family: Baloo Bhaina;\n    margin: 1px;\n}\n\nbutton.accordion:after, button.accordion_disc:after, button.accordion_projc:after {\n    content: \'\\2795\';\n    font-size: 13px;\n    color: #777;\n    float: right;\n    margin-left: 5px;\n}\n\nbutton.accordion.active:after, button.accordion_disc.active:after, button.accordion_proj.active:after {\n    content: "\\2796";\n}\n\n#map_center_menu_ico:after {\n    content: \'\\2795\';\n    font-size: 14px;\n    color: #777;\n    margin-left: 4px;\n}\n\nli.to_hide {\n    padding: 4px;\n    margin-left: 8px;\n}\n\n#map_center_menu_ico.active:after {\n    content: "\\2796";\n}\n\ndiv.panel {\n    font-family: Verdana,Arial,sans-serif;\n    font-size: 1.1em;\n    color: #222222;\n    background: #ffffff;\n    overflow: hidden;\n    visibility: hidden;\n    width: 335px;\n    max-height: 0;\n    //opacity: 0;\n    border: 1px solid #aaaaaa;\n    border-top-color: rgb(170, 170, 170);\n    border-top-style: solid;\n    border-top-width: 1px;\n    border-bottom-right-radius: 8px;\n    border-bottom-left-radius: 8px;\n    transition: all 400ms ease-in-out;\n    transform: scaleY(0);\n}\n\ndiv.panel.show {\n    //opacity: 1;\n    max-height: 775px;\n    width: 335px;\n    margin: auto;\n    margin-bottom: 5px;\n    overflow: auto;\n    visibility: visible;\n    transform: scaleY(1);\n}\n\n.twbs .panel {\n    border: 1px solid #aaaaaa;\n    border-top-color: rgb(170, 170, 170);\n    border-top-style: solid;\n    border-top-width: 1px;\n    border-bottom-right-radius: 8px;\n    border-bottom-left-radius: 8px;\n}\n\n.twbs h3 {\n    font-size: 1.2em;\n    font-weight: bold;\n    margin-top: 4px;\n}\n\n.twbs .modal {\n    position: absolute;\n    overflow: visible;\n}\n\n.twbs .modal-title {\n    margin: 0;\n    line-height: 1.42857143;\n    font-weight: bold;\n    font-size: 1.3em;\n    padding: 4px;\n    border-top-right-radius: 8px;\n    border-top-left-radius: 8px;\n    border-bottom-right-radius: 8px;\n    border-bottom-left-radius: 8px;\n    overflow-wrap: break-word;\n    word-wrap: break-word;\n    width: 90%;\n}\n\n.twbs .modal-dialog {\n    font-family: arimo,Arial,sans-serif;\n    font-size: 11px;\n}\n\n.twbs .modal-body > p > span {\n    display: inline-block;\n}\n\n.twbs .modal-body > p > input {\n    display: inline-block;\n    margin: 0px 0px 0px 15px;\n}\n\n.twbs .modal-footer {\n    padding: 6px;\n}\n\n.twbs .modal-header {\n    padding: 8px;\n    background-color: #595959;\n    color: white;\n}\n\n.twbs #xclose {\n    padding: 1px 2px;\n    font-size: 15px;\n    margin-right: 5px;\n    margin-top: 2px;\n}\n\n.twbs .help-popover {\n    max-width: 500px;\n    width: 500px;\n}\n\n.twbs .modal-body > p {\n  margin: 11px 0 !important;\n  clear: both;\n}\n\n.twbs .modal-body > p.inp_bottom {\n  margin: 11px 0px 35px 0px !important;\n}\n\n.fitContent {\n  width: intrinsic !important;\n  width: -moz-max-content !important;\n  width: -webkit-max-content !important;\n}\n\nth {\n    border: 1px solid #d3d3d3;\n    text-align: center !important;\n    font-size: 12px;\n}\n\ntr:nth-child(even) {background: #DBDADA}\ntr:nth-child(odd) {background: ##EFECEC;}\n\n.m_elem_right {\n    position: absolute;\n    right: 20px;\n    width: 60px;\n    margin-left: 15px;\n    font-size: 12px;\n}\n\nselect.m_elem_right {\n  width: auto !important;\n}\n\n#export_filename.m_elem_right {\n  width: auto !important;\n}\n\np.line_elem {\n  display: inline-table;\n  width: 100%;\n}\n\np.line_elem2 {\n  display: inline-table;\n  width: 100%;\n  margin: 5px 0 10px;\n}\n\np.line_elem2 > input[type=range] {\n  margin: 2px;\n}\n\n\n.styleBox > p > input {\n  float: right;\n}\n\n.three_dots {\n  background: url(/static/img/3_dots_ico.png) no-repeat;\n  height: 20px;\n  float: left;\n  width: 10px;\n}\n\n.cells path {\n  fill: none;\n  pointer-events: all;\n}\n\n.cells :hover circle {\n  fill: red;\n}\n\nimg.layout_ft_ico {\n  width: 27px;\n  height: auto;\n  margin: 2px;\n  -webkit-filter: grayscale(1); /* Webkit Nightlies & Chrome Canary */\n  -webkit-transform: scale(0.9);\n  -webkit-transition: all .2s;\n}\n\nimg.layout_ft_ico:hover {\n  filter: none;\n  -webkit-filter: grayscale(0);\n  -webkit-transform: scale(1);\n}\n\n.swal2_blue {\n    background-color: rgb(48, 133, 214);\n    border-left-color: rgb(48, 133, 214);\n    border-right-color: rgb(48, 133, 214);\n}\n\n.swal2_custom {\n    overflow-wrap: break-word;\n}\n\n.swal2_large {\n    min-width: 380px;\n    min-height: 310px;\n}\n\n/*#txtwzr_table > tbody > tr > td, #txtwzr_table > thead > tr > th {\n    border-top: 1px solid #999;\n    padding: 8px;\n    vertical-align: top;\n}*/\n\n#box_projection > p {\n    clear: both;\n    padding: 8px;\n    font-size: 13px;\n}\n\n.ctrl_pt {\n    fill: red;\n    cursor: grab;\n    cursor: -webkit-grab;\n}\n\n.ctrl_pt:active {\n    fill: red;\n    cursor: grabbing;\n    cursor: -webkit-grabbing;\n}\n\n.alertify-notifier .ajs-message.ajs-warning {\n    background: rgb(228, 144, 83) !important;\n}\n\n.alertify-notifier .ajs-message {\n    font: 13px Roboto !important;\n    padding: 12px !important;\n}\n\n.styled-select {\n   background: url(/static/img/arrow_select.png) no-repeat 100% 0;\n   height: 29px;\n   overflow: hidden;\n   background-color: #000;\n   -webkit-border-radius: 20px;\n   -moz-border-radius: 20px;\n   border-radius: 20px;\n   margin-top: 3px;\n   letter-spacing: 1.5px;\n}\n\n.styled-select select {\n   background: transparent;\n   border: none;\n   font-size: 14px;\n   height: 29px;\n   padding: 5px;\n   width: 340px;\n   color: #fff;\n}\n\n#form_projection2 * {\n  background-color: black;\n}\n\n.alertify-notifier .ajs-message.ajs-warning {\n    background: rgb(228, 144, 83) !important;\n}\n\n.alertify-notifier .ajs-message {\n    font: 13px Roboto !important;\n    padding: 12px !important;\n}\n\n/*#_m_free_draw_layer > path {\n    fill: none;\n    stroke: #000;\n    stroke-width: 3px;\n    stroke-linejoin: round;\n    stroke-linecap: round;\n}*/\n\n.switch-field {\n  font-family: "Lucida Grande", Tahoma, Verdana, sans-serif;\n  padding: 20px;\n\toverflow: hidden;\n}\n\n.switch-title {\n  text-align: left;\n  margin-bottom: 6px;\n}\n\n.switch-field input {\n    position: absolute !important;\n    clip: rect(0, 0, 0, 0);\n    height: 1px;\n    width: 1px;\n    border: 0;\n    overflow: hidden;\n}\n\n.switch-field label {\n  float: left;\n}\n\n.switch-field label {\n  display: inline-block;\n  background-color: #e4e4e4;\n  color: rgba(0, 0, 0, 0.6);\n  font-size: 13px;\n  font-weight: normal;\n  text-align: center;\n  text-shadow: none;\n  padding: 5px 12px;\n  border: 1px solid rgba(0, 0, 0, 0.2);\n  -webkit-box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3), 0 1px rgba(255, 255, 255, 0.1);\n  box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3), 0 1px rgba(255, 255, 255, 0.1);\n  -webkit-transition: all 0.1s ease-in-out;\n  -moz-transition:    all 0.1s ease-in-out;\n  -ms-transition:     all 0.1s ease-in-out;\n  -o-transition:      all 0.1s ease-in-out;\n  transition:         all 0.1s ease-in-out;\n  margin: 2px;\n}\n\n.switch-field label:hover {\n\tcursor: pointer;\n}\n\n.switch-field input:checked + label {\n  background-color: #A5DC86;\n  -webkit-box-shadow: none;\n  box-shadow: none;\n}\n/*\n.switch-field label:first-of-type {\n  border-radius: 4px 0 0 4px;\n}\n\n.switch-field label:last-of-type {\n  border-radius: 0 4px 4px 0;\n}\n*/\n\n.custom_tooltip {\n  position: absolute;\n  background: #595959;\n  border-radius:4px;\n  padding: 6px 12px;\n  font-family: arial;\n  font-size: 12px;\n  text-shadow: 0px 1px 1px #000;\n  color: #ffc64a;\n  z-index: 1001;\n  overflow-wrap: break-word;\n}\n\n.tippy-popper {\n  font-family: Verdana,Arial,sans-serif;\n  font-size: 11px;\n}\n\n/*\nSpinner adapted from https://github.com/tobiasahlin/SpinKit\nCopyright (c) 2015 Tobias Ahlin (license MIT)\n*/\n.spinner {\n  margin: 30px auto;\n  width: 50px;\n  height: 50px;\n  text-align: center;\n  font-size: 10px;\n}\n\n.spinner > div {\n  background-color: #005327;\n  height: 100%;\n  width: 6px;\n  display: inline-block;\n\n  -webkit-animation: sk-stretchdelay 1.2s infinite ease-in-out;\n  animation: sk-stretchdelay 1.2s infinite ease-in-out;\n}\n\n.spinner .rect2 {\n  -webkit-animation-delay: -1.1s;\n  animation-delay: -1.1s;\n}\n\n.spinner .rect3 {\n  -webkit-animation-delay: -1.0s;\n  animation-delay: -1.0s;\n}\n\n.spinner .rect4 {\n  -webkit-animation-delay: -0.9s;\n  animation-delay: -0.9s;\n}\n\n.spinner .rect5 {\n  -webkit-animation-delay: -0.8s;\n  animation-delay: -0.8s;\n}\n\n@-webkit-keyframes sk-stretchdelay {\n  0%, 40%, 100% { -webkit-transform: scaleY(0.4) }\n  20% { -webkit-transform: scaleY(1.0) }\n}\n\n@keyframes sk-stretchdelay {\n  0%, 40%, 100% {\n    transform: scaleY(0.4);\n    -webkit-transform: scaleY(0.4);\n  }  20% {\n    transform: scaleY(1.0);\n    -webkit-transform: scaleY(1.0);\n  }\n}\n\n.opts_lgd_layout {\n  margin: 2px;\n  cursor: pointer;\n}\n\n.opts_lgd_layout.selected:before {\n  content: "\\2713   ";\n  font-weight: 800;\n  font-size: 1.75em;\n}\n\np.breaks_vals > input[type="number"] {\n  width: 70px !important;\n  margin: 1px !important;\n  height: 1em !important;\n}\n\np.breaks_vals > input[type="number"].size_class {\n  width: 60px !important;\n}\n\n#fields_select {\n  display: grid;\n}\n\n#fields_select > li {\n  background: transparent;\n  /* background: aliceblue; */\n  padding: 5px;\n  line-height: 2em;\n}\n\n#fields_select > li:nth-child(odd) {\n  background: lightgray;\n}\n\n#fields_select > li:first-child {\n  border-top-left-radius: 3px 3px;\n  border-top-right-radius: 3px 3px;\n}\n\n#fields_select > li:last-child {\n  border-bottom-left-radius: 3px 3px;\n  border-bottom-right-radius: 3px 3px;\n}\n\n/* Style for left menu section 1 */\nimg#remove_target, img#downgrade_target, img#table_layer_s1, img#remove_dataset, img#table_dataset_s1 {\n  margin: 10px 5px 0 0;\n  float: right;\n  opacity: 1;\n}\n\nimg#remove_target, img#remove_dataset {\n  opacity: 0.5;\n}\n\nimg#remove_target:hover, img#remove_dataset:hover {\n  opacity: 1;\n}\n\n/* End of style for left menu section 1 */\n',""])},function(e,t,n){var a=n(95);"string"==typeof a&&(a=[[e.i,a,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(13)(a,r);a.locals&&(e.exports=a.locals)},,,function(e,t,n){"use strict";(function(e,t){var a=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,r=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(a=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(r)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();n(96),n(93),n(91),n(89);var r=_(n(19)),o=_(n(29)),i=_(n(28)),l=n(2),s=n(3),p=n(6),c=(n(7),n(11)),d=(n(17),n(21));function _(e){return e&&e.__esModule?e:{default:e}}e.config({warnings:!0,longStackTraces:!0}),t.i18next=r.default,t.encodeId=function(e){return""===e?"L_":"L_"+e.replace(/[^a-zA-Z0-9_-]/g,function(e){return"_"+e[0].charCodeAt(0).toString(16)+"_"})},t.proj=d3.geoNaturalEarth2().scale(1).translate([0,0]),t.path=d3.geoPath().projection(proj).pointRadius(4),t.t=proj.translate(),t.s=proj.scale(),t.current_proj_name="NaturalEarth2",t.zoom=d3.zoom().on("zoom",c.zoom_without_redraw),t.w=(0,p.Mround)(window.innerWidth-361),t.h=window.innerHeight-55,t.user_data={},t.result_data={},t.joined_dataset=[],t.field_join_map=[],t.current_layers={},t.dataset_name=null,t.canvas_rotation_value=null,t.map_div=d3.select("#map"),t.pos_lgds_elem=new Map,t.map=map_div.styles({width:w+"px",height:h+"px"}).append("svg").attrs({id:"svg_map",width:w,height:h}).styles({position:"absolute","background-color":"rgba(255, 255, 255, 0)"}).on("contextmenu",function(e){d3.event.preventDefault()}).call(zoom),t.svg_map=map.node(),t.defs=map.append("defs"),t._app={current_functionnality:void 0,custom_palettes:new Map,existing_lang:["en","es","fr"],layer_to_id:new Map([["World",encodeId("World")],["Graticule",encodeId("Graticule")]]),legendRedrawTimeout:null,id_to_layer:new Map([[encodeId("World"),"World"],[encodeId("Graticule"),"Graticule"]]),targeted_layer_added:!1,to_cancel:void 0,version:document.querySelector("#header").getAttribute("v")},t.discretiz_geostats_switch=new Map([["jenks","getJenks"],["equal_interval","getEqInterval"],["quantiles","getQuantile"],["Q6","getBreaksQ6"],["geometric_progression","getGeometricProgression"]]),t.available_fonts=[["Arial","Arial,sans-serif"],["Arial Black","Arial Black,sans-serif"],["Arimo","Arimo,sans-serif"],["Baloo Bhaina","Baloo Bhaina,sans-serif"],["Bitter","Bitter,sans-serif"],["Dosis","Dosis,sans-serif"],["Impact","Impact,Charcoal,sans-serif"],["Inconsolata","Inconsolata,sans-serif"],["Georgia","Georgia,serif"],["Lobster","Lobster,serif"],["Lucida","Lucida Sans Unicode,Lucida Grande,sans-serif"],["Palatino","Palatino Linotype,Book Antiqua,Palatino,serif"],["Roboto","Roboto"],["Scope One","Scope One"],["Tahoma","Tahoma,Geneva,sans-serif"],["Trebuchet MS","Trebuchet MS,elvetica,sans-serif"],["Verdana","verdana"]],t.customs_fonts=["Arimo","Baloo Bhaina","Bitter","Dosis","Inconsolata","Lobster","Roboto","Scope One"],function(){var t=docCookies.getItem("user_lang")||window.navigator.language.split("-")[0],n={};if(document.querySelector("noscript").remove(),window.isIE=/MSIE/i.test(navigator.userAgent)||/Trident\/\d./i.test(navigator.userAgent)||/Edge\/\d./i.test(navigator.userAgent),window.location.search){var p=function(e){for(var t=e.substring(1).split("&"),n={},a=void 0,r=void 0,o=void 0,i=0;i<t.length;i++)-1===(a=t[i]).indexOf("=")?n[decodeURIComponent(a).trim()]=!0:(r=a.split("="),o=decodeURIComponent(r[0]).trim(),decodeURIComponent(r[1]).trim(),n[o]=decodeURIComponent(r[1]).trim());return n}(window.location.search);if(n.reload=p.reload,void 0!==history.replaceState){var c={Page:window.location.search,Url:window.location.pathname};history.replaceState(c,c.Page,c.Url)}}t=_app.existing_lang.indexOf(t)>-1?t:"en",e.all([function(t){return new e(function(e,n){r.default.use(o.default).init({debug:!0,lng:t,fallbackLng:_app.existing_lang[0],backend:{loadPath:"static/locales/{{lng}}/translation.json"}},function(t,a){t&&n(t),e(a)})})}(t),(0,s.xhrequest)("GET","static/json/epsg.json",void 0,!1)]).then(function(e){var t=a(e,2),o=(t[0],t[1]);window.localize=i.default.init(r.default),_app.epsg_projections=JSON.parse(o),(0,l.setUpInterface)(n.reload),localize(".i18n"),(0,d.bindTooltips)()})}(),t.get_map_xy0=function(){var e=svg_map.getBoundingClientRect();return{x:e.left,y:e.top}},t.helper_esc_key_twbs_cb=function(e,t){var n=e||window.event;("key"in n?"Escape"===n.key||"Esc"===n.key:27===n.keyCode)&&(n.stopPropagation(),t&&t())}}).call(this,n(5),n(4))}]);