<!DOCTYPE html>
 <html lang="en">
 <head>
     <meta charset="utf-8">
     <meta http-equiv="X-UA-Compatible" content="IE=edge">
     <meta name="viewport" content="width=device-width, initial-scale=1">
     <meta name="description" content="">
     <meta name="author" content="">
     <title>{{ title }}</title>
     <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
     <script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
     <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.js"></script>

     <style>
       #map { height: 320px; }
        .info {
            padding: 6px 8px;
            font: 14px/16px Arial, Helvetica, sans-serif;
            background: white;
            background: rgba(255,255,255,0.8);
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            border-radius: 5px;
        }
        .info h4 {
            margin: 0 0 5px;
            color: #777;
        }
     </style>
 </head>

 <body>
    <div><h3>{{ title }}</h3></div>
    <div id="map"></div>
    <div id="raw_result">{{ content }}</div>
    <div id="breaks">{{ breaks }}</div>
      <script>
	map = new L.Map('map');
	var osmUrl='http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
	var osmAttrib='Map data Â© <a href="http://openstreetmap.org">OpenStreetMap</a> contributors';
	var osm = new L.TileLayer(osmUrl, {minZoom: 4, maxZoom: 15, attribution: osmAttrib});		

    map.setView(new L.LatLng(48.3, 2.7),5);
    map.addLayer(osm);
    $(function(){
        var result = document.getElementById('raw_result').innerHTML;
        var breaks_val = JSON.parse(document.getElementById('breaks').innerHTML);
        document.getElementById('raw_result').style.display = "none";
        document.getElementById('breaks').style.display = "none";
        var geojsonLayer;
        /*
          var myStyle = {
              "color": "#ff7800",
              "weight": 5,
              "opacity": 0.75
          };*/
    
        function getColor(d, breaks_val) {
            return d <= breaks_val[0] ? '#67001F' :
                   d <= breaks_val[1] ? '#800026' :
                   d <= breaks_val[2]  ? '#BD0026' :
                   d <= breaks_val[3]  ? '#E31A1C' :
                   d <= breaks_val[4]  ? '#FC4E2A' :
                   d <= breaks_val[5]   ? '#FD8D3C' :
                   d <= breaks_val[6]   ? '#FEB24C' :
                   d <= breaks_val[7]   ? '#FED976' :
                              '#FFEDA0';
        };
    
        function style(feature) {
            return {
                fillColor: getColor(feature.properties.mean, breaks_val),
                weight: 2,
                opacity: 0.75,
                color: 'white',
                dashArray: '2',
                fillOpacity: 0.7
            };
        };
    
        function highlightFeature(e) {
            var layer = e.target;
            info.update(layer.feature.properties);
            layer.setStyle({
                weight: 5,
                color: '#666',
                dashArray: '',
                fillOpacity: 0.7
            });
        };
    
        function resetHighlight(e) {
            geojsonLayer.resetStyle(e.target);
            info.update();
        };
    
        function onEachFeature(feature, layer) {
            layer.on({
                mouseover: highlightFeature,
                mouseout: resetHighlight,
                click: zoomToFeature
            });
        };
        function zoomToFeature(e) {
            map.fitBounds(e.target.getBounds());
        };
        geojsonLayer = new L.GeoJSON(JSON.parse(result), {style:style, onEachFeature: onEachFeature});
        map.addLayer(geojsonLayer).fitBounds(geojsonLayer.getBounds());
        var info = L.control({position: 'bottomright'});

        info.onAdd = function (map) {
            this._div = L.DomUtil.create('div', 'info');
            this.update();
            return this._div;
        };
    
        info.update = function (props) {
            this._div.innerHTML = (props ? '<h3>Mean potential value</h3>' +
                '<b>' + props.mean + '</b><br/>' : '<b><i>SpatialPosition quickStewart output</b></i>');
        };


        info.addTo(map);
        alert(breaks_val);
    });
      </script>
 </body>
 </html>
